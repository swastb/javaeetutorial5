<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Chapter 7. Optimization</title><link rel="stylesheet" href="mysql-html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.69.1"><link rel="start" href="index.html" title="MySQL 6.0 Reference Manual"><link rel="up" href="index.html" title="MySQL 6.0 Reference Manual"><link rel="prev" href="backup-and-recovery.html" title="Chapter 6. Backup and Recovery"><link rel="next" href="language-structure.html" title="Chapter 8. Language Structure"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 7. Optimization</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="backup-and-recovery.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="language-structure.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="optimization"></a>Chapter 7. Optimization</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="optimization.html#optimize-overview">7.1. Optimization Overview</a></span></dt><dd><dl><dt><span class="section"><a href="optimization.html#design-limitations">7.1.1. MySQL Design Limitations and Tradeoffs</a></span></dt><dt><span class="section"><a href="optimization.html#portability">7.1.2. Designing Applications for Portability</a></span></dt><dt><span class="section"><a href="optimization.html#internal-use">7.1.3. What We Have Used MySQL For</a></span></dt><dt><span class="section"><a href="optimization.html#mysql-benchmarks">7.1.4. The MySQL Benchmark Suite</a></span></dt><dt><span class="section"><a href="optimization.html#custom-benchmarks">7.1.5. Using Your Own Benchmarks</a></span></dt></dl></dd><dt><span class="section"><a href="optimization.html#query-speed">7.2. Optimizing <code class="literal">SELECT</code> and Other Statements</a></span></dt><dd><dl><dt><span class="section"><a href="optimization.html#using-explain">7.2.1. Optimizing Queries with <code class="literal">EXPLAIN</code></a></span></dt><dt><span class="section"><a href="optimization.html#estimating-performance">7.2.2. Estimating Query Performance</a></span></dt><dt><span class="section"><a href="optimization.html#select-speed">7.2.3. Speed of <code class="literal">SELECT</code> Queries</a></span></dt><dt><span class="section"><a href="optimization.html#where-optimizations">7.2.4. <code class="literal">WHERE</code> Clause Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#range-optimization">7.2.5. Range Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#index-merge-optimization">7.2.6. Index Merge Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#condition-pushdown-optimization">7.2.7. Condition Pushdown Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#index-condition-pushdown-optimization">7.2.8. Index Condition Pushdown Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#is-null-optimization">7.2.9. <code class="literal">IS NULL</code> Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#left-join-optimization">7.2.10. <code class="literal">LEFT JOIN</code> and <code class="literal">RIGHT JOIN</code>
        Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#nested-loop-joins">7.2.11. Nested-Loop Join Algorithms</a></span></dt><dt><span class="section"><a href="optimization.html#nested-join-optimization">7.2.12. Nested Join Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#outer-join-simplification">7.2.13. Outer Join Simplification</a></span></dt><dt><span class="section"><a href="optimization.html#mrr-optimization">7.2.14. Multi-Range Read Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#bnl-bka-optimization">7.2.15. Block Nested-Loop and Batched Key Access Joins</a></span></dt><dt><span class="section"><a href="optimization.html#semi-joins">7.2.16. Semi-Join Strategies</a></span></dt><dt><span class="section"><a href="optimization.html#order-by-optimization">7.2.17. <code class="literal">ORDER BY</code> Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#group-by-optimization">7.2.18. <code class="literal">GROUP BY</code> Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#distinct-optimization">7.2.19. <code class="literal">DISTINCT</code> Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#in-subquery-optimization">7.2.20. Optimizing <code class="literal">IN</code>/<code class="literal">=ANY</code> Subqueries</a></span></dt><dt><span class="section"><a href="optimization.html#limit-optimization">7.2.21. <code class="literal">LIMIT</code> Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#switchable-optimizations">7.2.22. Using <code class="literal">optimizer_switch</code> to Control the
        Optimizer</a></span></dt><dt><span class="section"><a href="optimization.html#how-to-avoid-table-scan">7.2.23. How to Avoid Table Scans</a></span></dt><dt><span class="section"><a href="optimization.html#information-schema-optimization">7.2.24. <code class="literal">INFORMATION_SCHEMA</code> Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#insert-speed">7.2.25. Speed of <code class="literal">INSERT</code> Statements</a></span></dt><dt><span class="section"><a href="optimization.html#update-speed">7.2.26. Speed of <code class="literal">UPDATE</code> Statements</a></span></dt><dt><span class="section"><a href="optimization.html#delete-speed">7.2.27. Speed of <code class="literal">DELETE</code> Statements</a></span></dt><dt><span class="section"><a href="optimization.html#miscellaneous-optimization-tips">7.2.28. Other Optimization Tips</a></span></dt></dl></dd><dt><span class="section"><a href="optimization.html#locking-issues">7.3. Locking Issues</a></span></dt><dd><dl><dt><span class="section"><a href="optimization.html#internal-locking">7.3.1. Internal Locking Methods</a></span></dt><dt><span class="section"><a href="optimization.html#table-locking">7.3.2. Table Locking Issues</a></span></dt><dt><span class="section"><a href="optimization.html#concurrent-inserts">7.3.3. Concurrent Inserts</a></span></dt><dt><span class="section"><a href="optimization.html#metadata-locking">7.3.4. Metadata Locking Within Transactions</a></span></dt><dt><span class="section"><a href="optimization.html#external-locking">7.3.5. External Locking</a></span></dt></dl></dd><dt><span class="section"><a href="optimization.html#optimizing-database-structure">7.4. Optimizing Database Structure</a></span></dt><dd><dl><dt><span class="section"><a href="optimization.html#data-size">7.4.1. Make Your Data as Small as Possible</a></span></dt><dt><span class="section"><a href="optimization.html#indexes">7.4.2. Column Indexes</a></span></dt><dt><span class="section"><a href="optimization.html#multiple-column-indexes">7.4.3. Multiple-Column Indexes</a></span></dt><dt><span class="section"><a href="optimization.html#mysql-indexes">7.4.4. How MySQL Uses Indexes</a></span></dt><dt><span class="section"><a href="optimization.html#myisam-key-cache">7.4.5. The <code class="literal">MyISAM</code> Key Cache</a></span></dt><dt><span class="section"><a href="optimization.html#myisam-index-statistics">7.4.6. <code class="literal">MyISAM</code> Index Statistics Collection</a></span></dt><dt><span class="section"><a href="optimization.html#table-cache">7.4.7. How MySQL Opens and Closes Tables</a></span></dt><dt><span class="section"><a href="optimization.html#creating-many-tables">7.4.8. Disadvantages of Creating Many Tables in the Same Database</a></span></dt></dl></dd><dt><span class="section"><a href="optimization.html#optimizing-the-server">7.5. Optimizing the MySQL Server</a></span></dt><dd><dl><dt><span class="section"><a href="optimization.html#compile-and-link-options">7.5.1. How Compiling and Linking Affects the Speed of MySQL</a></span></dt><dt><span class="section"><a href="optimization.html#system-optimization">7.5.2. System Factors and Startup Parameter Tuning</a></span></dt><dt><span class="section"><a href="optimization.html#server-parameters">7.5.3. Tuning Server Parameters</a></span></dt><dt><span class="section"><a href="optimization.html#controlling-optimizer">7.5.4. Controlling Query Optimizer Performance</a></span></dt><dt><span class="section"><a href="optimization.html#query-cache">7.5.5. The MySQL Query Cache</a></span></dt><dt><span class="section"><a href="optimization.html#thread-information">7.5.6. Examining Thread Information</a></span></dt><dt><span class="section"><a href="optimization.html#connection-threads">7.5.7. How MySQL Uses Threads for Client Connections</a></span></dt><dt><span class="section"><a href="optimization.html#memory-use">7.5.8. How MySQL Uses Memory</a></span></dt><dt><span class="section"><a href="optimization.html#large-page-support">7.5.9. Enabling Large Page Support</a></span></dt><dt><span class="section"><a href="optimization.html#internal-temporary-tables">7.5.10. How MySQL Uses Internal Temporary Tables</a></span></dt><dt><span class="section"><a href="optimization.html#dns">7.5.11. How MySQL Uses DNS</a></span></dt></dl></dd><dt><span class="section"><a href="optimization.html#disk-issues">7.6. Disk Issues</a></span></dt><dd><dl><dt><span class="section"><a href="optimization.html#symbolic-links">7.6.1. Using Symbolic Links</a></span></dt></dl></dd></dl></div><p>
    Optimization is a complex task because ultimately it requires
    understanding of the entire system to be optimized. Although it may
    be possible to perform some local optimizations with little
    knowledge of your system or application, the more optimal you want
    your system to become, the more you must know about it.
  </p><p>
    This chapter tries to explain and give some examples of different
    ways to optimize MySQL. Remember, however, that there are always
    additional ways to make the system even faster, although they may
    require increasing effort to achieve.
  </p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="optimize-overview"></a>7.1. Optimization Overview</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="optimization.html#design-limitations">7.1.1. MySQL Design Limitations and Tradeoffs</a></span></dt><dt><span class="section"><a href="optimization.html#portability">7.1.2. Designing Applications for Portability</a></span></dt><dt><span class="section"><a href="optimization.html#internal-use">7.1.3. What We Have Used MySQL For</a></span></dt><dt><span class="section"><a href="optimization.html#mysql-benchmarks">7.1.4. The MySQL Benchmark Suite</a></span></dt><dt><span class="section"><a href="optimization.html#custom-benchmarks">7.1.5. Using Your Own Benchmarks</a></span></dt></dl></div><p>
      The most important factor in making a system fast is its basic
      design. You must also know what kinds of processing your system is
      doing, and what its bottlenecks are. In most cases, system
      bottlenecks arise from these sources:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          Disk seeks. It takes time for the disk to find a piece of
          data. With modern disks, the mean time for this is usually
          lower than 10ms, so we can in theory do about 100 seeks a
          second. This time improves slowly with new disks and is very
          hard to optimize for a single table. The way to optimize seek
          time is to distribute the data onto more than one disk.
        </p></li><li><p>
          Disk reading and writing. When the disk is at the correct
          position, we need to read the data. With modern disks, one
          disk delivers at least 10–20MB/s throughput. This is
          easier to optimize than seeks because you can read in parallel
          from multiple disks.
        </p></li><li><p>
          CPU cycles. When we have the data in main memory, we need to
          process it to get our result. Having small tables compared to
          the amount of memory is the most common limiting factor. But
          with small tables, speed is usually not the problem.
        </p></li><li><p>
          Memory bandwidth. When the CPU needs more data than can fit in
          the CPU cache, main memory bandwidth becomes a bottleneck.
          This is an uncommon bottleneck for most systems, but one to be
          aware of.
        </p></li></ul></div><p class="mnmas"><b>MySQL Enterprise</b>
        For instant notification of system bottlenecks subscribe to the
        MySQL Enterprise Monitor. For more information, see
        <a href="http://www.mysql.com/products/enterprise/advisors.html" target="_top">http://www.mysql.com/products/enterprise/advisors.html</a>.
      </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="design-limitations"></a>7.1.1. MySQL Design Limitations and Tradeoffs</h3></div></div></div><a class="indexterm" name="id3159579"></a><a class="indexterm" name="id3159591"></a><p>
        When using the <code class="literal">MyISAM</code> storage engine, MySQL
        uses extremely fast table locking that allows multiple readers
        or a single writer. The biggest problem with this storage engine
        occurs when you have a steady stream of mixed updates and slow
        selects on a single table. If this is a problem for certain
        tables, you can use another storage engine for them. See
        <a href="storage-engines.html" title="Chapter 13. Storage Engines">Chapter 13, <i>Storage Engines</i></a>.
      </p><p>
        MySQL can work with both transactional and non-transactional
        tables. To make it easier to work smoothly with
        non-transactional tables (which cannot roll back if something
        goes wrong), MySQL has the following rules. Note that these
        rules apply <span class="emphasis"><em>only</em></span> when not running in strict
        SQL mode or if you use the <code class="literal">IGNORE</code> specifier
        for <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> or
        <a href="sql-syntax.html#update" title="12.2.12. UPDATE Syntax"><code class="literal">UPDATE</code></a>.
      </p><a class="indexterm" name="id3159658"></a><div class="itemizedlist"><ul type="disc"><li><p>
            All columns have default values.
          </p></li><li><p>
            If you insert an inappropriate or out-of-range value into a
            column, MySQL sets the column to the “<span class="quote">best possible
            value</span>” instead of reporting an error. For numerical
            values, this is 0, the smallest possible value or the
            largest possible value. For strings, this is either the
            empty string or as much of the string as can be stored in
            the column.
          </p></li><li><p>
            All calculated expressions return a value that can be used
            instead of signaling an error condition. For example, 1/0
            returns <code class="literal">NULL</code>.
          </p></li></ul></div><p>
        To change the preceding behaviors, you can enable stricter data
        handling by setting the server SQL mode appropriately. For more
        information about data handling, see
        <a href="introduction.html#constraints" title="1.7.6. How MySQL Deals with Constraints">Section 1.7.6, “How MySQL Deals with Constraints”</a>,
        <a href="server-administration.html#server-sql-mode" title="5.1.7. Server SQL Modes">Section 5.1.7, “Server SQL Modes”</a>, and <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax">Section 12.2.5, “<code class="literal">INSERT</code> Syntax”</a>.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portability"></a>7.1.2. Designing Applications for Portability</h3></div></div></div><a class="indexterm" name="id3159740"></a><a class="indexterm" name="id3159749"></a><a class="indexterm" name="id3159758"></a><p>
        Because all SQL servers implement different parts of standard
        SQL, it takes work to write portable database applications. It
        is very easy to achieve portability for very simple selects and
        inserts, but becomes more difficult the more capabilities you
        require. If you want an application that is fast with many
        database systems, it becomes even more difficult.
      </p><p>
        All database systems have some weak points. That is, they have
        different design compromises that lead to different behavior.
      </p><p>
        To make a complex application portable, you need to determine
        which SQL servers it must work with, and then determine what
        features those servers support. You can use the MySQL
        <span><strong class="command">crash-me</strong></span> program to find functions, types,
        and limits that you can use with a selection of database
        servers. <span><strong class="command">crash-me</strong></span> does not check for every
        possible feature, but it is still reasonably comprehensive,
        performing about 450 tests. An example of the type of
        information <span><strong class="command">crash-me</strong></span> can provide is that you
        should not use column names that are longer than 18 characters
        if you want to be able to use Informix or DB2.
      </p><p>
        The <span><strong class="command">crash-me</strong></span> program and the MySQL benchmarks
        are all very database independent. By taking a look at how they
        are written, you can get a feeling for what you must do to make
        your own applications database independent. The programs can be
        found in the <code class="filename">sql-bench</code> directory of MySQL
        source distributions. They are written in Perl and use the DBI
        database interface. Use of DBI in itself solves part of the
        portability problem because it provides database-independent
        access methods. See <a href="optimization.html#mysql-benchmarks" title="7.1.4. The MySQL Benchmark Suite">Section 7.1.4, “The MySQL Benchmark Suite”</a>.
      </p><p>
        If you strive for database independence, you need to get a good
        feeling for each SQL server's bottlenecks. For example, MySQL is
        very fast in retrieving and updating rows for
        <code class="literal">MyISAM</code> tables, but has a problem in mixing
        slow readers and writers on the same table. Transactional
        database systems in general are not very good at generating
        summary tables from log tables, because in this case row locking
        is almost useless.
      </p><p class="mnmas"><b>MySQL Enterprise</b>
          For expert advice on choosing the database engine suitable to
          your circumstances subscribe to the MySQL Enterprise Monitor.
          For more information, see
          <a href="http://www.mysql.com/products/enterprise/advisors.html" target="_top">http://www.mysql.com/products/enterprise/advisors.html</a>.
        </p><p>
        To make your application <span class="emphasis"><em>really</em></span> database
        independent, you should define an easily extendable interface
        through which you manipulate your data. For example, C++ is
        available on most systems, so it makes sense to use a C++
        class-based interface to the databases.
      </p><p>
        If you use some feature that is specific to a given database
        system (such as the <a href="sql-syntax.html#replace" title="12.2.8. REPLACE Syntax"><code class="literal">REPLACE</code></a>
        statement, which is specific to MySQL), you should implement the
        same feature for other SQL servers by coding an alternative
        method. Although the alternative might be slower, it enables the
        other servers to perform the same tasks.
      </p><p>
        With MySQL, you can use the <code class="literal">/*! */</code> syntax to
        add MySQL-specific keywords to a statement. The code inside
        <code class="literal">/* */</code> is treated as a comment (and ignored)
        by most other SQL servers. For information about writing
        comments, see <a href="language-structure.html#comments" title="8.5. Comment Syntax">Section 8.5, “Comment Syntax”</a>.
      </p><p>
        If high performance is more important than exactness, as for
        some Web applications, it is possible to create an application
        layer that caches all results to give you even higher
        performance. By letting old results expire after a while, you
        can keep the cache reasonably fresh. This provides a method to
        handle high load spikes, in which case you can dynamically
        increase the cache size and set the expiration timeout higher
        until things get back to normal.
      </p><p>
        In this case, the table creation information should contain
        information about the initial cache size and how often the table
        should normally be refreshed.
      </p><p>
        An attractive alternative to implementing an application cache
        is to use the MySQL query cache. By enabling the query cache,
        the server handles the details of determining whether a query
        result can be reused. This simplifies your application. See
        <a href="optimization.html#query-cache" title="7.5.5. The MySQL Query Cache">Section 7.5.5, “The MySQL Query Cache”</a>.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="internal-use"></a>7.1.3. What We Have Used MySQL For</h3></div></div></div><a class="indexterm" name="id3159979"></a><a class="indexterm" name="id3159992"></a><p>
        This section describes an early application for MySQL.
      </p><p>
        During MySQL initial development, the features of MySQL were
        made to fit our largest customer, which handled data warehousing
        for a couple of the largest retailers in Sweden.
      </p><p>
        From all stores, we got weekly summaries of all bonus card
        transactions, and were expected to provide useful information
        for the store owners to help them find how their advertising
        campaigns were affecting their own customers.
      </p><p>
        The volume of data was quite huge (about seven million summary
        transactions per month), and we had data for 4–10 years
        that we needed to present to the users. We got weekly requests
        from our customers, who wanted instant access to new reports
        from this data.
      </p><p>
        We solved this problem by storing all information per month in
        compressed “<span class="quote">transaction tables.</span>” We had a set of
        simple macros that generated summary tables grouped by different
        criteria (product group, customer id, store, and so on) from the
        tables in which the transactions were stored. The reports were
        Web pages that were dynamically generated by a small Perl
        script. This script parsed a Web page, executed the SQL
        statements in it, and inserted the results. We would have used
        PHP or <span><strong class="command">mod_perl</strong></span> instead, but they were not
        available at the time.
      </p><p>
        For graphical data, we wrote a simple tool in C that could
        process SQL query results and produce GIF images based on those
        results. This tool also was dynamically executed from the Perl
        script that parses the Web pages.
      </p><p>
        In most cases, a new report could be created simply by copying
        an existing script and modifying the SQL query that it used. In
        some cases, we needed to add more columns to an existing summary
        table or generate a new one. This also was quite simple because
        we kept all transaction-storage tables on disk. (This amounted
        to about 50GB of transaction tables and 200GB of other customer
        data.)
      </p><p>
        We also let our customers access the summary tables directly
        with ODBC so that the advanced users could experiment with the
        data themselves.
      </p><p>
        This system worked well and we had no problems handling the data
        with quite modest Sun Ultra SPARCstation hardware
        (2×200MHz). Eventually the system was migrated to Linux.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mysql-benchmarks"></a>7.1.4. The MySQL Benchmark Suite</h3></div></div></div><a class="indexterm" name="id3160104"></a><a class="indexterm" name="id3160113"></a><p>
        This benchmark suite is meant to tell any user what operations a
        given SQL implementation performs well or poorly. You can get a
        good idea for how the benchmarks work by looking at the code and
        results in the <code class="filename">sql-bench</code> directory in any
        MySQL source distribution.
      </p><p>
        Note that this benchmark is single-threaded, so it measures the
        minimum time for the operations performed. We plan to add
        multi-threaded tests to the benchmark suite in the future.
      </p><p>
        To use the benchmark suite, the following requirements must be
        satisfied:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            The benchmark suite is provided with MySQL source
            distributions. You can either download a released
            distribution from <a href="http://dev.mysql.com/downloads/" target="_top">http://dev.mysql.com/downloads/</a>, or
            use the current development source tree. (See
            <a href="installing.html#installing-source-tree" title="2.9.3. Installing from the Development Source Tree">Section 2.9.3, “Installing from the Development Source Tree”</a>.)
          </p></li><li><p>
            The benchmark scripts are written in Perl and use the Perl
            DBI module to access database servers, so DBI must be
            installed. You also need the server-specific DBD drivers for
            each of the servers you want to test. For example, to test
            MySQL, PostgreSQL, and DB2, you must have the
            <code class="literal">DBD::mysql</code>, <code class="literal">DBD::Pg</code>,
            and <code class="literal">DBD::DB2</code> modules installed. See
            <a href="installing.html#perl-support" title="2.14. Perl Installation Notes">Section 2.14, “Perl Installation Notes”</a>.
          </p></li></ul></div><p>
        After you obtain a MySQL source distribution, you can find the
        benchmark suite located in its <code class="filename">sql-bench</code>
        directory. To run the benchmark tests, build MySQL, and then
        change location into the <code class="filename">sql-bench</code>
        directory and execute the <code class="literal">run-all-tests</code>
        script:
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>cd sql-bench</code></strong>
shell&gt; <strong class="userinput"><code>perl run-all-tests --server=<em class="replaceable"><code>server_name</code></em></code></strong>
</pre><p>
        <em class="replaceable"><code>server_name</code></em> should be the name of one
        of the supported servers. To get a list of all options and
        supported servers, invoke this command:
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>perl run-all-tests --help</code></strong>
</pre><a class="indexterm" name="id3160275"></a><p>
        The <span><strong class="command">crash-me</strong></span> script also is located in the
        <code class="filename">sql-bench</code> directory.
        <span><strong class="command">crash-me</strong></span> tries to determine what features a
        database system supports and what its capabilities and
        limitations are by actually running queries. For example, it
        determines:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            What data types are supported
          </p></li><li><p>
            How many indexes are supported
          </p></li><li><p>
            What functions are supported
          </p></li><li><p>
            How big a query can be
          </p></li><li><p>
            How big a <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">VARCHAR</code></a> column can
            be
          </p></li></ul></div><p>
        For more information about benchmark results, visit
        <a href="http://www.mysql.com/why-mysql/benchmarks/" target="_top">http://www.mysql.com/why-mysql/benchmarks/</a>.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="custom-benchmarks"></a>7.1.5. Using Your Own Benchmarks</h3></div></div></div><a class="indexterm" name="id3160376"></a><a class="indexterm" name="id3160385"></a><p>
        You should definitely benchmark your application and database to
        find out where the bottlenecks are. After fixing one bottleneck
        (or by replacing it with a “<span class="quote">dummy</span>” module), you can
        proceed to identify the next bottleneck. Even if the overall
        performance for your application currently is acceptable, you
        should at least make a plan for each bottleneck and decide how
        to solve it if someday you really need the extra performance.
      </p><p>
        For examples of portable benchmark programs, look at those in
        the MySQL benchmark suite. See
        <a href="optimization.html#mysql-benchmarks" title="7.1.4. The MySQL Benchmark Suite">Section 7.1.4, “The MySQL Benchmark Suite”</a>. You can take any program
        from this suite and modify it for your own needs. By doing this,
        you can try different solutions to your problem and test which
        really is fastest for you.
      </p><p>
        Another free benchmark suite is the Open Source Database
        Benchmark, available at
        <a href="http://osdb.sourceforge.net/" target="_top">http://osdb.sourceforge.net/</a>.
      </p><p>
        It is very common for a problem to occur only when the system is
        very heavily loaded. We have had many customers who contact us
        when they have a (tested) system in production and have
        encountered load problems. In most cases, performance problems
        turn out to be due to issues of basic database design (for
        example, table scans are not good under high load) or problems
        with the operating system or libraries. Most of the time, these
        problems would be much easier to fix if the systems were not
        already in production.
      </p><p>
        To avoid problems like this, you should put some effort into
        benchmarking your whole application under the worst possible
        load:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            The <a href="programs.html#mysqlslap" title="4.5.7. mysqlslap — Load Emulation Client"><span><strong class="command">mysqlslap</strong></span></a> program can be helpful for
            simulating a high load produced by multiple clients issuing
            queries simultaneously. See <a href="programs.html#mysqlslap" title="4.5.7. mysqlslap — Load Emulation Client">Section 4.5.7, “<span><strong class="command">mysqlslap</strong></span> — Load Emulation Client”</a>.
          </p></li><li><p>
            You can also try Super Smack, available at
            <a href="http://jeremy.zawodny.com/mysql/super-smack/" target="_top">http://jeremy.zawodny.com/mysql/super-smack/</a>.
          </p></li></ul></div><p>
        As suggested by the names of these programs, they can bring a
        system to its knees, so make sure to use them only on your
        development systems.
      </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="query-speed"></a>7.2. Optimizing <code class="literal">SELECT</code> and Other Statements</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="optimization.html#using-explain">7.2.1. Optimizing Queries with <code class="literal">EXPLAIN</code></a></span></dt><dt><span class="section"><a href="optimization.html#estimating-performance">7.2.2. Estimating Query Performance</a></span></dt><dt><span class="section"><a href="optimization.html#select-speed">7.2.3. Speed of <code class="literal">SELECT</code> Queries</a></span></dt><dt><span class="section"><a href="optimization.html#where-optimizations">7.2.4. <code class="literal">WHERE</code> Clause Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#range-optimization">7.2.5. Range Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#index-merge-optimization">7.2.6. Index Merge Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#condition-pushdown-optimization">7.2.7. Condition Pushdown Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#index-condition-pushdown-optimization">7.2.8. Index Condition Pushdown Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#is-null-optimization">7.2.9. <code class="literal">IS NULL</code> Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#left-join-optimization">7.2.10. <code class="literal">LEFT JOIN</code> and <code class="literal">RIGHT JOIN</code>
        Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#nested-loop-joins">7.2.11. Nested-Loop Join Algorithms</a></span></dt><dt><span class="section"><a href="optimization.html#nested-join-optimization">7.2.12. Nested Join Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#outer-join-simplification">7.2.13. Outer Join Simplification</a></span></dt><dt><span class="section"><a href="optimization.html#mrr-optimization">7.2.14. Multi-Range Read Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#bnl-bka-optimization">7.2.15. Block Nested-Loop and Batched Key Access Joins</a></span></dt><dt><span class="section"><a href="optimization.html#semi-joins">7.2.16. Semi-Join Strategies</a></span></dt><dt><span class="section"><a href="optimization.html#order-by-optimization">7.2.17. <code class="literal">ORDER BY</code> Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#group-by-optimization">7.2.18. <code class="literal">GROUP BY</code> Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#distinct-optimization">7.2.19. <code class="literal">DISTINCT</code> Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#in-subquery-optimization">7.2.20. Optimizing <code class="literal">IN</code>/<code class="literal">=ANY</code> Subqueries</a></span></dt><dt><span class="section"><a href="optimization.html#limit-optimization">7.2.21. <code class="literal">LIMIT</code> Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#switchable-optimizations">7.2.22. Using <code class="literal">optimizer_switch</code> to Control the
        Optimizer</a></span></dt><dt><span class="section"><a href="optimization.html#how-to-avoid-table-scan">7.2.23. How to Avoid Table Scans</a></span></dt><dt><span class="section"><a href="optimization.html#information-schema-optimization">7.2.24. <code class="literal">INFORMATION_SCHEMA</code> Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#insert-speed">7.2.25. Speed of <code class="literal">INSERT</code> Statements</a></span></dt><dt><span class="section"><a href="optimization.html#update-speed">7.2.26. Speed of <code class="literal">UPDATE</code> Statements</a></span></dt><dt><span class="section"><a href="optimization.html#delete-speed">7.2.27. Speed of <code class="literal">DELETE</code> Statements</a></span></dt><dt><span class="section"><a href="optimization.html#miscellaneous-optimization-tips">7.2.28. Other Optimization Tips</a></span></dt></dl></div><a class="indexterm" name="id3160513"></a><a class="indexterm" name="id3160525"></a><a class="indexterm" name="id3160538"></a><p>
      First, one factor affects all statements: The more complex your
      permissions setup, the more overhead you have. Using simpler
      permissions when you issue <a href="sql-syntax.html#grant" title="12.5.1.3. GRANT Syntax"><code class="literal">GRANT</code></a>
      statements enables MySQL to reduce permission-checking overhead
      when clients execute statements. For example, if you do not grant
      any table-level or column-level privileges, the server need not
      ever check the contents of the <code class="literal">tables_priv</code> and
      <code class="literal">columns_priv</code> tables. Similarly, if you place no
      resource limits on any accounts, the server does not have to
      perform resource counting. If you have a very high
      statement-processing load, it may be worth the time to use a
      simplified grant structure to reduce permission-checking overhead.
    </p><p>
      If your problem is with a specific MySQL expression or function,
      you can perform a timing test by invoking the
      <a href="functions.html#function_benchmark"><code class="literal">BENCHMARK()</code></a> function using the
      <a href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span><strong class="command">mysql</strong></span></a> client program. Its syntax is
      <a href="functions.html#function_benchmark"><code class="literal">BENCHMARK(<em class="replaceable"><code>loop_count</code></em>,<em class="replaceable"><code>expression</code></em>)</code></a>.
      The return value is always zero, but <a href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span><strong class="command">mysql</strong></span></a>
      prints a line displaying approximately how long the statement took
      to execute. For example:
    </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT BENCHMARK(1000000,1+1);</code></strong>
+------------------------+
| BENCHMARK(1000000,1+1) |
+------------------------+
|                      0 |
+------------------------+
1 row in set (0.32 sec)
</pre><p>
      This result was obtained on a Pentium II 400MHz system. It shows
      that MySQL can execute 1,000,000 simple addition expressions in
      0.32 seconds on that system.
    </p><p>
      All MySQL functions should be highly optimized, but there may be
      some exceptions. <a href="functions.html#function_benchmark"><code class="literal">BENCHMARK()</code></a> is an
      excellent tool for finding out if some function is a problem for
      your queries.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="using-explain"></a>7.2.1. Optimizing Queries with <code class="literal">EXPLAIN</code></h3></div></div></div><a class="indexterm" name="id3160674"></a><a class="indexterm" name="id3160683"></a><p>
        The <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> statement can be used
        either as a synonym for <a href="sql-syntax.html#describe" title="12.3.1. DESCRIBE Syntax"><code class="literal">DESCRIBE</code></a>
        or as a way to obtain information about how MySQL executes a
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            <code class="literal">EXPLAIN
            <em class="replaceable"><code>tbl_name</code></em></code> is synonymous
            with <code class="literal">DESCRIBE
            <em class="replaceable"><code>tbl_name</code></em></code> or
            <code class="literal">SHOW COLUMNS FROM
            <em class="replaceable"><code>tbl_name</code></em></code>:
          </p><pre class="programlisting">EXPLAIN <em class="replaceable"><code>tbl_name</code></em>
</pre></li><li><p>
            When you precede a <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
            statement with the keyword
            <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a>, MySQL displays
            information from the optimizer about the query execution
            plan. That is, MySQL explains how it would process the
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>, including information
            about how tables are joined and in which order:

</p><pre class="programlisting">EXPLAIN [EXTENDED | PARTITIONS] SELECT <em class="replaceable"><code>select_options</code></em>
</pre><p>
          </p></li><li><p>
            <code class="literal">EXPLAIN PARTITIONS</code> is useful only when
            examining queries involving partitioned tables. For details,
            see <a href="partitioning.html#partitioning-info" title="17.3.4. Obtaining Information About Partitions">Section 17.3.4, “Obtaining Information About Partitions”</a>.
          </p></li></ul></div><p>
        This section describes the second use of
        <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> for obtaining query
        execution plan information. See also <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax">Section 12.3.2, “<code class="literal">EXPLAIN</code> Syntax”</a>.
        For a description of the <a href="sql-syntax.html#describe" title="12.3.1. DESCRIBE Syntax"><code class="literal">DESCRIBE</code></a>
        and <a href="sql-syntax.html#show-columns" title="12.5.6.6. SHOW COLUMNS Syntax"><code class="literal">SHOW COLUMNS</code></a> statements, see
        <a href="sql-syntax.html#describe" title="12.3.1. DESCRIBE Syntax">Section 12.3.1, “<code class="literal">DESCRIBE</code> Syntax”</a>, and <a href="sql-syntax.html#show-columns" title="12.5.6.6. SHOW COLUMNS Syntax">Section 12.5.6.6, “<code class="literal">SHOW COLUMNS</code> Syntax”</a>.
      </p><p>
        <a class="indexterm" name="id3160874"></a>

        With the help of <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a>, you can
        see where you should add indexes to tables to get a faster
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> that uses indexes to find
        rows. You can also use <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> to
        check whether the optimizer joins the tables in an optimal
        order. To give a hint to the optimizer to use a join order
        corresponding to the order in which the tables are named in the
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement, begin the
        statement with <code class="literal">SELECT STRAIGHT_JOIN</code> rather
        than just <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>. (See
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax">Section 12.2.9, “<code class="literal">SELECT</code> Syntax”</a>.)
      </p><p>
        If you have a problem with indexes not being used when you
        believe that they should be, you should run
        <a href="sql-syntax.html#analyze-table" title="12.5.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> to update table
        statistics such as cardinality of keys, that can affect the
        choices the optimizer makes. See
        <a href="sql-syntax.html#analyze-table" title="12.5.2.1. ANALYZE TABLE Syntax">Section 12.5.2.1, “<code class="literal">ANALYZE TABLE</code> Syntax”</a>.
      </p><p>
        <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> returns a row of
        information for each table used in the
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement. The tables are
        listed in the output in the order that MySQL would read them
        while processing the query. MySQL resolves all joins using a
        <em class="firstterm">single-sweep multi-join</em> method. This
        means that MySQL reads a row from the first table, and then
        finds a matching row in the second table, the third table, and
        so on. When all tables are processed, MySQL outputs the selected
        columns and backtracks through the table list until a table is
        found for which there are more matching rows. The next row is
        read from this table and the process continues with the next
        table.
      </p><p>
        When the <code class="literal">EXTENDED</code> keyword is used,
        <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> produces extra
        information that can be viewed by issuing a
        <a href="sql-syntax.html#show-warnings" title="12.5.6.40. SHOW WARNINGS Syntax"><code class="literal">SHOW WARNINGS</code></a> statement following
        the <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> statement. This
        information displays how the optimizer qualifies table and
        column names in the <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
        statement, what the <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> looks
        like after the application of rewriting and optimization rules,
        and possibly other notes about the optimization process.
        <code class="literal">EXPLAIN EXTENDED</code> also displays the
        <code class="literal">filtered</code> column.
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
          You cannot use the <code class="literal">EXTENDED</code> and
          <code class="literal">PARTITIONS</code> keywords together in the same
          <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> statement.
        </p></div><p>
        Each output row from <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a>
        provides information about one table, and each row contains the
        following columns:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            <code class="literal">id</code>
          </p><p>
            The <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> identifier. This
            is the sequential number of the
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> within the query.
          </p></li><li><p>
            <code class="literal">select_type</code>
          </p><p>
            The type of <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>, which can
            be any of those shown in the following table.
          </p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><code class="literal">SIMPLE</code></td><td>Simple <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> (not using
                    <a href="sql-syntax.html#union" title="12.2.9.3. UNION Syntax"><code class="literal">UNION</code></a> or subqueries)</td></tr><tr><td><code class="literal">PRIMARY</code></td><td>Outermost <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a></td></tr><tr><td><a href="sql-syntax.html#union" title="12.2.9.3. UNION Syntax"><code class="literal">UNION</code></a></td><td>Second or later <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement in a
                    <a href="sql-syntax.html#union" title="12.2.9.3. UNION Syntax"><code class="literal">UNION</code></a></td></tr><tr><td><code class="literal">DEPENDENT UNION</code></td><td>Second or later <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement in a
                    <a href="sql-syntax.html#union" title="12.2.9.3. UNION Syntax"><code class="literal">UNION</code></a>, dependent on
                    outer query</td></tr><tr><td><code class="literal">UNION RESULT</code></td><td>Result of a <a href="sql-syntax.html#union" title="12.2.9.3. UNION Syntax"><code class="literal">UNION</code></a>.</td></tr><tr><td><code class="literal">SUBQUERY</code></td><td>First <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> in subquery</td></tr><tr><td><code class="literal">DEPENDENT SUBQUERY</code></td><td>First <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> in subquery, dependent on
                    outer query</td></tr><tr><td><code class="literal">DERIVED</code></td><td>Derived table <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> (subquery in
                    <code class="literal">FROM</code> clause)</td></tr><tr><td><code class="literal">UNCACHEABLE SUBQUERY</code></td><td>A subquery for which the result cannot be cached and must be
                    re-evaluated for each row of the outer query</td></tr><tr><td><code class="literal">UNCACHEABLE UNION</code></td><td>The second or later select in a <a href="sql-syntax.html#union" title="12.2.9.3. UNION Syntax"><code class="literal">UNION</code></a>
                    that belongs to an uncacheable subquery (see
                    <code class="literal">UNCACHEABLE SUBQUERY</code>)</td></tr></tbody></table></div><p>
            <code class="literal">DEPENDENT</code> typically signifies the use of
            a correlated subquery. See
            <a href="sql-syntax.html#correlated-subqueries" title="12.2.10.7. Correlated Subqueries">Section 12.2.10.7, “Correlated Subqueries”</a>.
          </p><p>
            “<span class="quote">DEPENDENT SUBQUERY</span>” evaluation differs from
            <code class="literal">UNCACHEABLE SUBQUERY</code> evaluation. For
            “<span class="quote">DEPENDENT SUBQUERY</span>”, the subquery is
            re-evaluated only once for each set of different values of
            the variables from its outer context. For
            <code class="literal">UNCACHEABLE SUBQUERY</code>, the subquery is
            re-evaluated for each row of the outer context. Cacheability
            of subqueries is subject to the restrictions detailed in
            <a href="optimization.html#query-cache-operation" title="7.5.5.1. How the Query Cache Operates">Section 7.5.5.1, “How the Query Cache Operates”</a>. For example,
            referring to user variables makes a subquery uncacheable.
          </p></li><li><p>
            <code class="literal">table</code>
          </p><p>
            The table to which the row of output refers.
          </p></li><li><p>
            <code class="literal">type</code>
          </p><p>
            The join type. The different join types are listed here,
            ordered from the best type to the worst:
          </p><div class="itemizedlist"><ul type="circle"><li><p><a name="jointype_system"></a>
                <a class="indexterm" name="id3161503"></a>

                <a class="indexterm" name="id3161516"></a>

                <a class="indexterm" name="id3161528"></a>

                <a href="optimization.html#jointype_system"><code class="literal">system</code></a>
              </p><p>
                The table has only one row (= system table). This is a
                special case of the
                <a href="optimization.html#jointype_const"><code class="literal">const</code></a> join type.
              </p></li><li><p><a name="jointype_const"></a>
                <a class="indexterm" name="id3161569"></a>

                <a class="indexterm" name="id3161582"></a>

                <a class="indexterm" name="id3161594"></a>

                <a href="optimization.html#jointype_const"><code class="literal">const</code></a>
              </p><p>
                The table has at most one matching row, which is read at
                the start of the query. Because there is only one row,
                values from the column in this row can be regarded as
                constants by the rest of the optimizer.
                <a href="optimization.html#jointype_const"><code class="literal">const</code></a> tables are very
                fast because they are read only once.
              </p><p>
                <a href="optimization.html#jointype_const"><code class="literal">const</code></a> is used when
                you compare all parts of a <code class="literal">PRIMARY
                KEY</code> or <code class="literal">UNIQUE</code> index to
                constant values. In the following queries,
                <em class="replaceable"><code>tbl_name</code></em> can be used as a
                <a href="optimization.html#jointype_const"><code class="literal">const</code></a> table:
              </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>tbl_name</code></em> WHERE <em class="replaceable"><code>primary_key</code></em>=1;

SELECT * FROM <em class="replaceable"><code>tbl_name</code></em>
  WHERE <em class="replaceable"><code>primary_key_part1</code></em>=1 AND <em class="replaceable"><code>primary_key_part2</code></em>=2;
</pre></li><li><p><a name="jointype_eq_ref"></a>
                <a class="indexterm" name="id3161700"></a>

                <a class="indexterm" name="id3161713"></a>

                <a href="optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a>
              </p><p>
                One row is read from this table for each combination of
                rows from the previous tables. Other than the
                <a href="optimization.html#jointype_system"><code class="literal">system</code></a> and
                <a href="optimization.html#jointype_const"><code class="literal">const</code></a> types, this is
                the best possible join type. It is used when all parts
                of an index are used by the join and the index is a
                <code class="literal">PRIMARY KEY</code> or
                <code class="literal">UNIQUE</code> index.
              </p><p>
                <a href="optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a> can be used
                for indexed columns that are compared using the
                <code class="literal">=</code> operator. The comparison value can
                be a constant or an expression that uses columns from
                tables that are read before this table. In the following
                examples, MySQL can use an
                <a href="optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a> join to
                process <em class="replaceable"><code>ref_table</code></em>:
              </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>ref_table</code></em>,<em class="replaceable"><code>other_table</code></em>
  WHERE <em class="replaceable"><code>ref_table</code></em>.<em class="replaceable"><code>key_column</code></em>=<em class="replaceable"><code>other_table</code></em>.<em class="replaceable"><code>column</code></em>;

SELECT * FROM <em class="replaceable"><code>ref_table</code></em>,<em class="replaceable"><code>other_table</code></em>
  WHERE <em class="replaceable"><code>ref_table</code></em>.<em class="replaceable"><code>key_column_part1</code></em>=<em class="replaceable"><code>other_table</code></em>.<em class="replaceable"><code>column</code></em>
  AND <em class="replaceable"><code>ref_table</code></em>.<em class="replaceable"><code>key_column_part2</code></em>=1;
</pre></li><li><p><a name="jointype_ref"></a>
                <a class="indexterm" name="id3161866"></a>

                <a class="indexterm" name="id3161878"></a>

                <a href="optimization.html#jointype_ref"><code class="literal">ref</code></a>
              </p><p>
                All rows with matching index values are read from this
                table for each combination of rows from the previous
                tables. <a href="optimization.html#jointype_ref"><code class="literal">ref</code></a> is used
                if the join uses only a leftmost prefix of the key or if
                the key is not a <code class="literal">PRIMARY KEY</code> or
                <code class="literal">UNIQUE</code> index (in other words, if the
                join cannot select a single row based on the key value).
                If the key that is used matches only a few rows, this is
                a good join type.
              </p><p>
                <a href="optimization.html#jointype_ref"><code class="literal">ref</code></a> can be used for
                indexed columns that are compared using the
                <code class="literal">=</code> or <code class="literal">&lt;=&gt;</code>
                operator. In the following examples, MySQL can use a
                <a href="optimization.html#jointype_ref"><code class="literal">ref</code></a> join to process
                <em class="replaceable"><code>ref_table</code></em>:
              </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>ref_table</code></em> WHERE <em class="replaceable"><code>key_column</code></em>=<em class="replaceable"><code>expr</code></em>;

SELECT * FROM <em class="replaceable"><code>ref_table</code></em>,<em class="replaceable"><code>other_table</code></em>
  WHERE <em class="replaceable"><code>ref_table</code></em>.<em class="replaceable"><code>key_column</code></em>=<em class="replaceable"><code>other_table</code></em>.<em class="replaceable"><code>column</code></em>;

SELECT * FROM <em class="replaceable"><code>ref_table</code></em>,<em class="replaceable"><code>other_table</code></em>
  WHERE <em class="replaceable"><code>ref_table</code></em>.<em class="replaceable"><code>key_column_part1</code></em>=<em class="replaceable"><code>other_table</code></em>.<em class="replaceable"><code>column</code></em>
  AND <em class="replaceable"><code>ref_table</code></em>.<em class="replaceable"><code>key_column_part2</code></em>=1;
</pre></li><li><p><a name="jointype_fulltext"></a>
                <a class="indexterm" name="id3162049"></a>

                <a class="indexterm" name="id3162061"></a>

                <a href="optimization.html#jointype_fulltext"><code class="literal">fulltext</code></a>
              </p><p>
                The join is performed using a
                <code class="literal">FULLTEXT</code> index.
              </p></li><li><p><a name="jointype_ref_or_null"></a>
                <a class="indexterm" name="id3162100"></a>

                <a class="indexterm" name="id3162113"></a>

                <a href="optimization.html#jointype_ref_or_null"><code class="literal">ref_or_null</code></a>
              </p><p>
                This join type is like
                <a href="optimization.html#jointype_ref"><code class="literal">ref</code></a>, but with the
                addition that MySQL does an extra search for rows that
                contain <code class="literal">NULL</code> values. This join type
                optimization is used most often in resolving subqueries.
                In the following examples, MySQL can use a
                <a href="optimization.html#jointype_ref_or_null"><code class="literal">ref_or_null</code></a> join to
                process <em class="replaceable"><code>ref_table</code></em>:
              </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>ref_table</code></em>
  WHERE <em class="replaceable"><code>key_column</code></em>=<em class="replaceable"><code>expr</code></em> OR <em class="replaceable"><code>key_column</code></em> IS NULL;
</pre><p>
                See <a href="optimization.html#is-null-optimization" title="7.2.9. IS NULL Optimization">Section 7.2.9, “<code class="literal">IS NULL</code> Optimization”</a>.
              </p></li><li><p><a name="jointype_index_merge"></a>
                <a class="indexterm" name="id3162204"></a>

                <a class="indexterm" name="id3162217"></a>

                <a href="optimization.html#jointype_index_merge"><code class="literal">index_merge</code></a>
              </p><p>
                This join type indicates that the Index Merge
                optimization is used. In this case, the
                <code class="literal">key</code> column in the output row contains
                a list of indexes used, and <code class="literal">key_len</code>
                contains a list of the longest key parts for the indexes
                used. For more information, see
                <a href="optimization.html#index-merge-optimization" title="7.2.6. Index Merge Optimization">Section 7.2.6, “Index Merge Optimization”</a>.
              </p></li><li><p><a name="jointype_unique_subquery"></a>
                <a class="indexterm" name="id3162271"></a>

                <a class="indexterm" name="id3162284"></a>

                <a href="optimization.html#jointype_unique_subquery"><code class="literal">unique_subquery</code></a>
              </p><p>
                This type replaces
                <a href="optimization.html#jointype_ref"><code class="literal">ref</code></a> for some
                <code class="literal">IN</code> subqueries of the following form:
              </p><pre class="programlisting"><em class="replaceable"><code>value</code></em> IN (SELECT <em class="replaceable"><code>primary_key</code></em> FROM <em class="replaceable"><code>single_table</code></em> WHERE <em class="replaceable"><code>some_expr</code></em>)
</pre><p>
                <a href="optimization.html#jointype_unique_subquery"><code class="literal">unique_subquery</code></a> is
                just an index lookup function that replaces the subquery
                completely for better efficiency.
              </p></li><li><p><a name="jointype_index_subquery"></a>
                <a class="indexterm" name="id3162363"></a>

                <a class="indexterm" name="id3162375"></a>

                <a href="optimization.html#jointype_index_subquery"><code class="literal">index_subquery</code></a>
              </p><p>
                This join type is similar to
                <a href="optimization.html#jointype_unique_subquery"><code class="literal">unique_subquery</code></a>. It
                replaces <code class="literal">IN</code> subqueries, but it works
                for non-unique indexes in subqueries of the following
                form:
              </p><pre class="programlisting"><em class="replaceable"><code>value</code></em> IN (SELECT <em class="replaceable"><code>key_column</code></em> FROM <em class="replaceable"><code>single_table</code></em> WHERE <em class="replaceable"><code>some_expr</code></em>)
</pre></li><li><p><a name="jointype_range"></a>
                <a class="indexterm" name="id3162444"></a>

                <a class="indexterm" name="id3162456"></a>

                <a href="optimization.html#jointype_range"><code class="literal">range</code></a>
              </p><p>
                Only rows that are in a given range are retrieved, using
                an index to select the rows. The <code class="literal">key</code>
                column in the output row indicates which index is used.
                The <code class="literal">key_len</code> contains the longest key
                part that was used. The <code class="literal">ref</code> column is
                <code class="literal">NULL</code> for this type.
              </p><p>
                <a href="optimization.html#jointype_range"><code class="literal">range</code></a> can be used
                when a key column is compared to a constant using any of
                the <a href="functions.html#operator_equal"><code class="literal">=</code></a>,
                <a href="functions.html#operator_not-equal"><code class="literal">&lt;&gt;</code></a>,
                <a href="functions.html#operator_greater-than"><code class="literal">&gt;</code></a>,
                <a href="functions.html#operator_greater-than-or-equal"><code class="literal">&gt;=</code></a>,
                <a href="functions.html#operator_less-than"><code class="literal">&lt;</code></a>,
                <a href="functions.html#operator_less-than-or-equal"><code class="literal">&lt;=</code></a>,
                <a href="functions.html#operator_is-null"><code class="literal">IS NULL</code></a>,
                <a href="functions.html#operator_equal-to"><code class="literal">&lt;=&gt;</code></a>,
                <a href="functions.html#operator_between"><code class="literal">BETWEEN</code></a>, or
                <a href="functions.html#function_in"><code class="literal">IN()</code></a> operators:
              </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>tbl_name</code></em>
  WHERE <em class="replaceable"><code>key_column</code></em> = 10;

SELECT * FROM <em class="replaceable"><code>tbl_name</code></em>
  WHERE <em class="replaceable"><code>key_column</code></em> BETWEEN 10 and 20;

SELECT * FROM <em class="replaceable"><code>tbl_name</code></em>
  WHERE <em class="replaceable"><code>key_column</code></em> IN (10,20,30);

SELECT * FROM <em class="replaceable"><code>tbl_name</code></em>
  WHERE <em class="replaceable"><code>key_part1</code></em>= 10 AND <em class="replaceable"><code>key_part2</code></em> IN (10,20,30);
</pre></li><li><p><a name="jointype_index"></a>
                <a class="indexterm" name="id3162643"></a>

                <a class="indexterm" name="id3162655"></a>

                <a href="optimization.html#jointype_index"><code class="literal">index</code></a>
              </p><p>
                This join type is the same as
                <code class="literal">ALL</code>, except that
                only the index tree is scanned. This usually is faster
                than <code class="literal">ALL</code> because
                the index file usually is smaller than the data file.
              </p><p>
                MySQL can use this join type when the query uses only
                columns that are part of a single index.
              </p></li><li><p><a name="jointype_all"></a>
                <a class="indexterm" name="id3162713"></a>

                <a class="indexterm" name="id3162725"></a>

                <code class="literal">ALL</code>
              </p><p>
                A full table scan is done for each combination of rows
                from the previous tables. This is normally not good if
                the table is the first table not marked
                <a href="optimization.html#jointype_const"><code class="literal">const</code></a>, and usually
                <span class="emphasis"><em>very</em></span> bad in all other cases.
                Normally, you can avoid
                <code class="literal">ALL</code> by adding
                indexes that allow row retrieval from the table based on
                constant values or column values from earlier tables.
              </p></li></ul></div></li><li><p>
            <code class="literal">possible_keys</code>
          </p><p>
            The <code class="literal">possible_keys</code> column indicates which
            indexes MySQL can choose from use to find the rows in this
            table. Note that this column is totally independent of the
            order of the tables as displayed in the output from
            <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a>. That means that some
            of the keys in <code class="literal">possible_keys</code> might not be
            usable in practice with the generated table order.
          </p><p>
            If this column is <code class="literal">NULL</code>, there are no
            relevant indexes. In this case, you may be able to improve
            the performance of your query by examining the
            <code class="literal">WHERE</code> clause to check whether it refers
            to some column or columns that would be suitable for
            indexing. If so, create an appropriate index and check the
            query with <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> again. See
            <a href="sql-syntax.html#alter-table" title="12.1.6. ALTER TABLE Syntax">Section 12.1.6, “<code class="literal">ALTER TABLE</code> Syntax”</a>.
          </p><p>
            To see what indexes a table has, use <code class="literal">SHOW INDEX
            FROM <em class="replaceable"><code>tbl_name</code></em></code>.
          </p></li><li><p>
            <code class="literal">key</code>
          </p><p>
            The <code class="literal">key</code> column indicates the key (index)
            that MySQL actually decided to use. If MySQL decides to use
            one of the <code class="literal">possible_keys</code> indexes to look
            up rows, that index is listed as the key value.
          </p><p>
            It is possible that <code class="literal">key</code> will name an
            index that is not present in the
            <code class="literal">possible_keys</code> value. This can happen if
            none of the <code class="literal">possible_keys</code> indexes are
            suitable for looking up rows, but all the columns selected
            by the query are columns of some other index. That is, the
            named index covers the selected columns, so although it is
            not used to determine which rows to retrieve, an index scan
            is more efficient than a data row scan.
          </p><p>
            For <code class="literal">InnoDB</code>, a secondary index might cover
            the selected columns even if the query also selects the
            primary key because <code class="literal">InnoDB</code> stores the
            primary key value with each secondary index. If
            <code class="literal">key</code> is <code class="literal">NULL</code>, MySQL
            found no index to use for executing the query more
            efficiently.
          </p><p>
            To force MySQL to use or ignore an index listed in the
            <code class="literal">possible_keys</code> column, use <code class="literal">FORCE
            INDEX</code>, <code class="literal">USE INDEX</code>, or
            <code class="literal">IGNORE INDEX</code> in your query. See
            <a href="sql-syntax.html#index-hints" title="12.2.9.2. Index Hint Syntax">Section 12.2.9.2, “Index Hint Syntax”</a>.
          </p><p>
            For <code class="literal">MyISAM</code> tables, running
            <a href="sql-syntax.html#analyze-table" title="12.5.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> helps the
            optimizer choose better indexes. For
            <code class="literal">MyISAM</code> tables, <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk
            --analyze</strong></span></a> does the same. See
            <a href="sql-syntax.html#analyze-table" title="12.5.2.1. ANALYZE TABLE Syntax">Section 12.5.2.1, “<code class="literal">ANALYZE TABLE</code> Syntax”</a>, and
            <a href="backup-and-recovery.html#table-maintenance" title="6.5. Table Maintenance and Crash Recovery">Section 6.5, “Table Maintenance and Crash Recovery”</a>.
          </p></li><li><p>
            <code class="literal">key_len</code>
          </p><p>
            The <code class="literal">key_len</code> column indicates the length
            of the key that MySQL decided to use. The length is
            <code class="literal">NULL</code> if the <code class="literal">key</code> column
            says <code class="literal">NULL</code>. Note that the value of
            <code class="literal">key_len</code> enables you to determine how many
            parts of a multiple-part key MySQL actually uses.
          </p></li><li><p>
            <code class="literal">ref</code>
          </p><p>
            The <code class="literal">ref</code> column shows which columns or
            constants are compared to the index named in the
            <code class="literal">key</code> column to select rows from the table.
          </p></li><li><p>
            <code class="literal">rows</code>
          </p><p>
            The <code class="literal">rows</code> column indicates the number of
            rows MySQL believes it must examine to execute the query.
          </p></li><li><p>
            <code class="literal">filtered</code>
          </p><p>
            The <code class="literal">filtered</code> column indicates an
            estimated percentage of table rows that will be filtered by
            the table condition. That is, <code class="literal">rows</code> shows
            the estimated number of rows examined and
            <code class="literal">rows</code> × <code class="literal">filtered</code>
            / <code class="literal">100</code> shows the number of rows that will
            be joined with previous tables. This column is displayed if
            you use <code class="literal">EXPLAIN EXTENDED</code>.
          </p></li><li><p>
            <code class="literal">Extra</code>
          </p><p>
            This column contains additional information about how MySQL
            resolves the query. The following list explains the values
            that can appear in this column. If you want to make your
            queries as fast as possible, you should look out for
            <code class="literal">Extra</code> values of <code class="literal">Using
            filesort</code> and <code class="literal">Using temporary</code>.
          </p><div class="itemizedlist"><ul type="circle"><li><p>
                <code class="literal">Distinct</code>
              </p><p>
                MySQL is looking for distinct values, so it stops
                searching for more rows for the current row combination
                after it has found the first matching row.
              </p></li><li><p>
                <code class="literal">FirstMatch(<em class="replaceable"><code>tbl_name</code></em>)</code>
              </p><p>
                The semi-join FirstMatch join shortcutting strategy is
                used for <em class="replaceable"><code>tbl_name</code></em>.
              </p></li><li><p>
                <code class="literal">Full scan on NULL key</code>
              </p><p>
                This occurs for subquery optimization as a fallback
                strategy when the optimizer cannot use an index-lookup
                access method.
              </p></li><li><p>
                <code class="literal">Impossible WHERE noticed after reading const
                tables</code>
              </p><p>
                MySQL has read all
                <a href="optimization.html#jointype_const"><code class="literal">const</code></a> (and
                <a href="optimization.html#jointype_system"><code class="literal">system</code></a>) tables and
                notice that the <code class="literal">WHERE</code> clause is
                always false.
              </p></li><li><p>
                <code class="literal">LooseScan(<em class="replaceable"><code>m</code></em>..<em class="replaceable"><code>n</code></em>)</code>
              </p><p>
                The semi-join LooseScan strategy is used.
                <em class="replaceable"><code>m</code></em> and
                <em class="replaceable"><code>n</code></em> are key part numbers.
              </p></li><li><p>
                <code class="literal">No tables</code>
              </p><p>
                The query has no <code class="literal">FROM</code> clause, or has
                a <code class="literal">FROM DUAL</code> clause.
              </p></li><li><p>
                <code class="literal">Not exists</code>
              </p><p>
                MySQL was able to do a <code class="literal">LEFT JOIN</code>
                optimization on the query and does not examine more rows
                in this table for the previous row combination after it
                finds one row that matches the <code class="literal">LEFT
                JOIN</code> criteria. Here is an example of the type
                of query that can be optimized this way:
              </p><pre class="programlisting">SELECT * FROM t1 LEFT JOIN t2 ON t1.id=t2.id
  WHERE t2.id IS NULL;
</pre><p>
                Assume that <code class="literal">t2.id</code> is defined as
                <code class="literal">NOT NULL</code>. In this case, MySQL scans
                <code class="literal">t1</code> and looks up the rows in
                <code class="literal">t2</code> using the values of
                <code class="literal">t1.id</code>. If MySQL finds a matching row
                in <code class="literal">t2</code>, it knows that
                <code class="literal">t2.id</code> can never be
                <code class="literal">NULL</code>, and does not scan through the
                rest of the rows in <code class="literal">t2</code> that have the
                same <code class="literal">id</code> value. In other words, for
                each row in <code class="literal">t1</code>, MySQL needs to do
                only a single lookup in <code class="literal">t2</code>,
                regardless of how many rows actually match in
                <code class="literal">t2</code>.
              </p></li><li><p>
                <code class="literal">Range checked for each record (index map:
                <em class="replaceable"><code>N</code></em>)</code>
              </p><p>
                MySQL found no good index to use, but found that some of
                indexes might be used after column values from preceding
                tables are known. For each row combination in the
                preceding tables, MySQL checks whether it is possible to
                use a <a href="optimization.html#jointype_range"><code class="literal">range</code></a> or
                <a href="optimization.html#jointype_index_merge"><code class="literal">index_merge</code></a> access
                method to retrieve rows. This is not very fast, but is
                faster than performing a join with no index at all. The
                applicability criteria are as described in
                <a href="optimization.html#range-optimization" title="7.2.5. Range Optimization">Section 7.2.5, “Range Optimization”</a>, and
                <a href="optimization.html#index-merge-optimization" title="7.2.6. Index Merge Optimization">Section 7.2.6, “Index Merge Optimization”</a>, with the
                exception that all column values for the preceding table
                are known and considered to be constants.
              </p><p>
                Indexes are numbered beginning with 1, in the same order
                as shown by <a href="sql-syntax.html#show-index" title="12.5.6.23. SHOW INDEX Syntax"><code class="literal">SHOW INDEX</code></a>
                for the table. The index map value
                <em class="replaceable"><code>N</code></em> is a bitmask value that
                indicates which indexes are candidates. For example, a
                value of <code class="literal">0x19</code> (binary 11001) means
                that indexes 1, 4, and 5 will be considered.
              </p></li><li><p>
                <code class="literal">Scanned <em class="replaceable"><code>N</code></em>
                databases</code>
              </p><p>
                This indicates how many directory scans the server
                performs when processing a query for
                <code class="literal">INFORMATION_SCHEMA</code> tables, as
                described in
                <a href="optimization.html#information-schema-optimization" title="7.2.24. INFORMATION_SCHEMA Optimization">Section 7.2.24, “<code class="literal">INFORMATION_SCHEMA</code> Optimization”</a>. The
                value of <em class="replaceable"><code>N</code></em> can be 0, 1, or
                <code class="literal">all</code>.
              </p></li><li><p>
                <code class="literal">Select tables optimized away</code>
              </p><p>
                The query contained only aggregate functions
                (<a href="functions.html#function_min"><code class="literal">MIN()</code></a>,
                <a href="functions.html#function_max"><code class="literal">MAX()</code></a>) that were all
                resolved using an index, or
                <a href="functions.html#function_count"><code class="literal">COUNT(*)</code></a> for
                <code class="literal">MyISAM</code>, and no <code class="literal">GROUP
                BY</code> clause. The optimizer determined that only
                one row should be returned.
              </p></li><li><p>
                <code class="literal">Skip_open_table</code>,
                <code class="literal">Open_frm_only</code>,
                <code class="literal">Open_trigger_only</code>,
                <code class="literal">Open_full_table</code>
              </p><p>
                These values indicate file-opening optimizations that
                apply to queries for
                <code class="literal">INFORMATION_SCHEMA</code> tables, as
                described in
                <a href="optimization.html#information-schema-optimization" title="7.2.24. INFORMATION_SCHEMA Optimization">Section 7.2.24, “<code class="literal">INFORMATION_SCHEMA</code> Optimization”</a>.
              </p><div class="itemizedlist"><ul type="square"><li><p>
                    <code class="literal">Skip_open_table</code>: Table files do
                    not need to be opened. The information has already
                    become available within the query by scanning the
                    database directory.
                  </p></li><li><p>
                    <code class="literal">Open_frm_only</code>: Only the table's
                    <code class="filename">.frm</code> file need be opened.
                  </p></li><li><p>
                    <code class="literal">Open_trigger_only</code>: Only the
                    table's <code class="filename">.TRG</code> file need be
                    opened.
                  </p></li><li><p>
                    <code class="literal">Open_full_table</code>: The unoptimized
                    information lookup. The <code class="filename">.frm</code>,
                    <code class="filename">.MYD</code>, and
                    <code class="filename">.MYI</code> files must be opened.
                  </p></li></ul></div></li><li><p>
                <code class="literal">Start materialize</code>, <code class="literal">End
                materialize</code>, <code class="literal">Scan</code>
              </p><p>
                This indicates temporary table use for materialization.
              </p></li><li><p>
                <code class="literal">Start temporary</code>, <code class="literal">End
                temporary</code>
              </p><p>
                This indicates temporary table use for the semi-join
                Duplicate Weedout strategy.
              </p></li><li><p>
                <code class="literal">Using filesort</code>
              </p><p>
                MySQL must do an extra pass to find out how to retrieve
                the rows in sorted order. The sort is done by going
                through all rows according to the join type and storing
                the sort key and pointer to the row for all rows that
                match the <code class="literal">WHERE</code> clause. The keys then
                are sorted and the rows are retrieved in sorted order.
                See <a href="optimization.html#order-by-optimization" title="7.2.17. ORDER BY Optimization">Section 7.2.17, “<code class="literal">ORDER BY</code> Optimization”</a>.
              </p></li><li><p>
                <code class="literal">Using index</code>
              </p><p>
                The column information is retrieved from the table using
                only information in the index tree without having to do
                an additional seek to read the actual row. This strategy
                can be used when the query uses only columns that are
                part of a single index.
              </p><p>
                For <code class="literal">InnoDB</code> tables that have a
                user-defined clustered index, that index can be used
                even when <code class="literal">Using index</code> is absent from
                the <code class="literal">Extra</code> column. This is the case if
                <code class="literal">type</code> is
                <a href="optimization.html#jointype_index"><code class="literal">index</code></a> and
                <code class="literal">key</code> is <code class="literal">PRIMARY</code>.
              </p></li><li><p>
                <code class="literal">Using index condition</code>
              </p><p>
                Tables are read by accessing index tuples and testing
                them first to determine whether to read full table rows.
                In this way, index information is used to defer
                (“<span class="quote">push down</span>”) reading full table rows
                unless it is necessary. See
                <a href="optimization.html#index-condition-pushdown-optimization" title="7.2.8. Index Condition Pushdown Optimization">Section 7.2.8, “Index Condition Pushdown Optimization”</a>.
              </p></li><li><p>
                <code class="literal">Using index for group-by</code>
              </p><p>
                Similar to the <code class="literal">Using index</code> table
                access method, <code class="literal">Using index for
                group-by</code> indicates that MySQL found an index
                that can be used to retrieve all columns of a
                <code class="literal">GROUP BY</code> or
                <code class="literal">DISTINCT</code> query without any extra disk
                access to the actual table. Additionally, the index is
                used in the most efficient way so that for each group,
                only a few index entries are read. For details, see
                <a href="optimization.html#group-by-optimization" title="7.2.18. GROUP BY Optimization">Section 7.2.18, “<code class="literal">GROUP BY</code> Optimization”</a>.
              </p></li><li><p>
                <code class="literal">Using join buffer</code>
              </p><p>
                Tables from earlier joins are read in portions into the
                join buffer, and then their rows are used from the
                buffer to perform the join with the current table.
              </p></li><li><p>
                <code class="literal">Using MRR</code>
              </p><p>
                Tables are read using the Multi-Range Read optimization
                strategy. See <a href="optimization.html#mrr-optimization" title="7.2.14. Multi-Range Read Optimization">Section 7.2.14, “Multi-Range Read Optimization”</a>.
              </p></li><li><p>
                <code class="literal">Using sort_union(...)</code>, <code class="literal">Using
                union(...)</code>, <code class="literal">Using
                intersect(...)</code>
              </p><p>
                These indicate how index scans are merged for the
                <a href="optimization.html#jointype_index_merge"><code class="literal">index_merge</code></a> join
                type. See <a href="optimization.html#index-merge-optimization" title="7.2.6. Index Merge Optimization">Section 7.2.6, “Index Merge Optimization”</a>.
              </p></li><li><p>
                <code class="literal">Using temporary</code>
              </p><p>
                To resolve the query, MySQL needs to create a temporary
                table to hold the result. This typically happens if the
                query contains <code class="literal">GROUP BY</code> and
                <code class="literal">ORDER BY</code> clauses that list columns
                differently.
              </p></li><li><p>
                <code class="literal">Using where</code>
              </p><p>
                A <code class="literal">WHERE</code> clause is used to restrict
                which rows to match against the next table or send to
                the client. Unless you specifically intend to fetch or
                examine all rows from the table, you may have something
                wrong in your query if the <code class="literal">Extra</code>
                value is not <code class="literal">Using where</code> and the
                table join type is
                <code class="literal">ALL</code> or
                <a href="optimization.html#jointype_index"><code class="literal">index</code></a>.
              </p></li></ul></div></li></ul></div><p>
        You can get a good indication of how good a join is by taking
        the product of the values in the <code class="literal">rows</code> column
        of the <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output. This
        should tell you roughly how many rows MySQL must examine to
        execute the query. If you restrict queries with the
        <a href="server-administration.html#sysvar_max_join_size"><code class="literal">max_join_size</code></a> system variable,
        this row product also is used to determine which multiple-table
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements to execute and
        which to abort. See <a href="optimization.html#server-parameters" title="7.5.3. Tuning Server Parameters">Section 7.5.3, “Tuning Server Parameters”</a>.
      </p><p>
        The following example shows how a multiple-table join can be
        optimized progressively based on the information provided by
        <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a>.
      </p><p>
        Suppose that you have the <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
        statement shown here and that you plan to examine it using
        <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a>:
      </p><pre class="programlisting">EXPLAIN SELECT tt.TicketNumber, tt.TimeIn,
               tt.ProjectReference, tt.EstimatedShipDate,
               tt.ActualShipDate, tt.ClientID,
               tt.ServiceCodes, tt.RepetitiveID,
               tt.CurrentProcess, tt.CurrentDPPerson,
               tt.RecordVolume, tt.DPPrinted, et.COUNTRY,
               et_1.COUNTRY, do.CUSTNAME
        FROM tt, et, et AS et_1, do
        WHERE tt.SubmitTime IS NULL
          AND tt.ActualPC = et.EMPLOYID
          AND tt.AssignedPC = et_1.EMPLOYID
          AND tt.ClientID = do.CUSTNMBR;
</pre><p>
        For this example, make the following assumptions:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            The columns being compared have been declared as follows.
          </p><div class="informaltable"><table border="1"><colgroup><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Table</strong></span></td><td><span class="bold"><strong>Column</strong></span></td><td><span class="bold"><strong>Data Type</strong></span></td></tr><tr><td><code class="literal">tt</code></td><td><code class="literal">ActualPC</code></td><td><code class="literal">CHAR(10)</code></td></tr><tr><td><code class="literal">tt</code></td><td><code class="literal">AssignedPC</code></td><td><code class="literal">CHAR(10)</code></td></tr><tr><td><code class="literal">tt</code></td><td><code class="literal">ClientID</code></td><td><code class="literal">CHAR(10)</code></td></tr><tr><td><code class="literal">et</code></td><td><code class="literal">EMPLOYID</code></td><td><code class="literal">CHAR(15)</code></td></tr><tr><td><code class="literal">do</code></td><td><code class="literal">CUSTNMBR</code></td><td><code class="literal">CHAR(15)</code></td></tr></tbody></table></div></li><li><p>
            The tables have the following indexes.
          </p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Table</strong></span></td><td><span class="bold"><strong>Index</strong></span></td></tr><tr><td><code class="literal">tt</code></td><td><code class="literal">ActualPC</code></td></tr><tr><td><code class="literal">tt</code></td><td><code class="literal">AssignedPC</code></td></tr><tr><td><code class="literal">tt</code></td><td><code class="literal">ClientID</code></td></tr><tr><td><code class="literal">et</code></td><td><code class="literal">EMPLOYID</code> (primary key)</td></tr><tr><td><code class="literal">do</code></td><td><code class="literal">CUSTNMBR</code> (primary key)</td></tr></tbody></table></div></li><li><p>
            The <code class="literal">tt.ActualPC</code> values are not evenly
            distributed.
          </p></li></ul></div><p>
        Initially, before any optimizations have been performed, the
        <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> statement produces the
        following information:
      </p><pre class="programlisting">table type possible_keys key  key_len ref  rows  Extra
et    ALL  PRIMARY       NULL NULL    NULL 74
do    ALL  PRIMARY       NULL NULL    NULL 2135
et_1  ALL  PRIMARY       NULL NULL    NULL 74
tt    ALL  AssignedPC,   NULL NULL    NULL 3872
           ClientID,
           ActualPC
      Range checked for each record (index map: 0x23)
</pre><p>
        Because <code class="literal">type</code> is
        <code class="literal">ALL</code> for each table, this
        output indicates that MySQL is generating a Cartesian product of
        all the tables; that is, every combination of rows. This takes
        quite a long time, because the product of the number of rows in
        each table must be examined. For the case at hand, this product
        is 74 × 2135 × 74 × 3872 = 45,268,558,720
        rows. If the tables were bigger, you can only imagine how long
        it would take.
      </p><p>
        One problem here is that MySQL can use indexes on columns more
        efficiently if they are declared as the same type and size. In
        this context, <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">VARCHAR</code></a> and
        <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">CHAR</code></a> are considered the same if
        they are declared as the same size.
        <code class="literal">tt.ActualPC</code> is declared as
        <code class="literal">CHAR(10)</code> and <code class="literal">et.EMPLOYID</code>
        is <code class="literal">CHAR(15)</code>, so there is a length mismatch.
      </p><p>
        To fix this disparity between column lengths, use
        <a href="sql-syntax.html#alter-table" title="12.1.6. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> to lengthen
        <code class="literal">ActualPC</code> from 10 characters to 15 characters:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>ALTER TABLE tt MODIFY ActualPC VARCHAR(15);</code></strong>
</pre><p>
        Now <code class="literal">tt.ActualPC</code> and
        <code class="literal">et.EMPLOYID</code> are both
        <code class="literal">VARCHAR(15)</code>. Executing the
        <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> statement again produces
        this result:
      </p><pre class="programlisting">table type   possible_keys key     key_len ref         rows    Extra
tt    ALL    AssignedPC,   NULL    NULL    NULL        3872    Using
             ClientID,                                         where
             ActualPC
do    ALL    PRIMARY       NULL    NULL    NULL        2135
      Range checked for each record (index map: 0x1)
et_1  ALL    PRIMARY       NULL    NULL    NULL        74
      Range checked for each record (index map: 0x1)
et    eq_ref PRIMARY       PRIMARY 15      tt.ActualPC 1
</pre><p>
        This is not perfect, but is much better: The product of the
        <code class="literal">rows</code> values is less by a factor of 74. This
        version executes in a couple of seconds.
      </p><p>
        A second alteration can be made to eliminate the column length
        mismatches for the <code class="literal">tt.AssignedPC =
        et_1.EMPLOYID</code> and <code class="literal">tt.ClientID =
        do.CUSTNMBR</code> comparisons:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>ALTER TABLE tt MODIFY AssignedPC VARCHAR(15),</code></strong>
    -&gt;                <strong class="userinput"><code>MODIFY ClientID   VARCHAR(15);</code></strong>
</pre><p>
        After that modification, <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a>
        produces the output shown here:
      </p><pre class="programlisting">table type   possible_keys key      key_len ref           rows Extra
et    ALL    PRIMARY       NULL     NULL    NULL          74
tt    ref    AssignedPC,   ActualPC 15      et.EMPLOYID   52   Using
             ClientID,                                         where
             ActualPC
et_1  eq_ref PRIMARY       PRIMARY  15      tt.AssignedPC 1
do    eq_ref PRIMARY       PRIMARY  15      tt.ClientID   1
</pre><p>
        At this point, the query is optimized almost as well as
        possible. The remaining problem is that, by default, MySQL
        assumes that values in the <code class="literal">tt.ActualPC</code> column
        are evenly distributed, and that is not the case for the
        <code class="literal">tt</code> table. Fortunately, it is easy to tell
        MySQL to analyze the key distribution:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>ANALYZE TABLE tt;</code></strong>
</pre><p>
        With the additional index information, the join is perfect and
        <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> produces this result:
      </p><pre class="programlisting">table type   possible_keys key     key_len ref           rows Extra
tt    ALL    AssignedPC    NULL    NULL    NULL          3872 Using
             ClientID,                                        where
             ActualPC
et    eq_ref PRIMARY       PRIMARY 15      tt.ActualPC   1
et_1  eq_ref PRIMARY       PRIMARY 15      tt.AssignedPC 1
do    eq_ref PRIMARY       PRIMARY 15      tt.ClientID   1
</pre><p>
        <a class="indexterm" name="id3164995"></a>

        Note that the <code class="literal">rows</code> column in the output from
        <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> is an educated guess from
        the MySQL join optimizer. You should check whether the numbers
        are even close to the truth by comparing the
        <code class="literal">rows</code> product with the actual number of rows
        that the query returns. If the numbers are quite different, you
        might get better performance by using
        <code class="literal">STRAIGHT_JOIN</code> in your
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement and trying to
        list the tables in a different order in the
        <code class="literal">FROM</code> clause.
      </p><p>
        It is possible in some cases to execute statements that modify
        data when <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN
        SELECT</code></a> is used with a subquery; for more information,
        see <a href="sql-syntax.html#unnamed-views" title="12.2.10.8. Subqueries in the FROM clause">Section 12.2.10.8, “Subqueries in the <code class="literal">FROM</code> clause”</a>.
      </p><p class="mnmas"><b>MySQL Enterprise</b>
          Subscribers to the MySQL Enterprise Monitor regularly receive
          expert advice on optimization. For more information, see
          <a href="http://www.mysql.com/products/enterprise/advisors.html" target="_top">http://www.mysql.com/products/enterprise/advisors.html</a>.
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="estimating-performance"></a>7.2.2. Estimating Query Performance</h3></div></div></div><a class="indexterm" name="id3165099"></a><a class="indexterm" name="id3165112"></a><a class="indexterm" name="id3165124"></a><p>
        In most cases, you can estimate query performance by counting
        disk seeks. For small tables, you can usually find a row in one
        disk seek (because the index is probably cached). For bigger
        tables, you can estimate that, using B-tree indexes, you need
        this many seeks to find a row:
        <code class="literal">log(<em class="replaceable"><code>row_count</code></em>) /
        log(<em class="replaceable"><code>index_block_length</code></em> / 3 × 2
        / (<em class="replaceable"><code>index_length</code></em> +
        <em class="replaceable"><code>data_pointer_length</code></em>)) + 1</code>.
      </p><p>
        In MySQL, an index block is usually 1,024 bytes and the data
        pointer is usually four bytes. For a 500,000-row table with a
        key value length of three bytes (the size of
        <a href="data-types.html#numeric-types" title="10.2. Numeric Types"><code class="literal">MEDIUMINT</code></a>), the formula indicates
        <code class="literal">log(500,000)/log(1024/3×2/(3+4)) + 1</code> =
        <code class="literal">4</code> seeks.
      </p><p>
        This index would require storage of about 500,000 × 7
        × 3/2 = 5.2MB (assuming a typical index buffer fill ratio
        of 2/3), so you probably have much of the index in memory and so
        need only one or two calls to read data to find the row.
      </p><p>
        For writes, however, you need four seek requests to find where
        to place a new index value and normally two seeks to update the
        index and write the row.
      </p><p>
        Note that the preceding discussion does not mean that your
        application performance slowly degenerates by log
        <em class="replaceable"><code>N</code></em>. As long as everything is cached by
        the OS or the MySQL server, things become only marginally slower
        as the table gets bigger. After the data gets too big to be
        cached, things start to go much slower until your applications
        are bound only by disk seeks (which increase by log
        <em class="replaceable"><code>N</code></em>). To avoid this, increase the key
        cache size as the data grows. For <code class="literal">MyISAM</code>
        tables, the key cache size is controlled by the
        <a href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a> system
        variable. See <a href="optimization.html#server-parameters" title="7.5.3. Tuning Server Parameters">Section 7.5.3, “Tuning Server Parameters”</a>.
      </p><p class="mnmas"><b>MySQL Enterprise</b>
          The MySQL Enterprise Monitor provides a number of advisors
          specifically designed to improve query performance. For more
          information, see
          <a href="http://www.mysql.com/products/enterprise/advisors.html" target="_top">http://www.mysql.com/products/enterprise/advisors.html</a>.
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="select-speed"></a>7.2.3. Speed of <code class="literal">SELECT</code> Queries</h3></div></div></div><a class="indexterm" name="id3165286"></a><a class="indexterm" name="id3165295"></a><p>
        In general, when you want to make a slow <code class="literal">SELECT ...
        WHERE</code> query faster, the first thing to check is
        whether you can add an index. All references between different
        tables should usually be done with indexes. You can use the
        <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> statement to determine
        which indexes are used for a
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>. See
        <a href="optimization.html#using-explain" title="7.2.1. Optimizing Queries with EXPLAIN">Section 7.2.1, “Optimizing Queries with <code class="literal">EXPLAIN</code>”</a>, and
        <a href="optimization.html#mysql-indexes" title="7.4.4. How MySQL Uses Indexes">Section 7.4.4, “How MySQL Uses Indexes”</a>.
      </p><p>
        Some general tips for speeding up queries on
        <code class="literal">MyISAM</code> tables:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            To help MySQL better optimize queries, use
            <a href="sql-syntax.html#analyze-table" title="12.5.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> or run
            <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk --analyze</strong></span></a> on a table after it
            has been loaded with data. This updates a value for each
            index part that indicates the average number of rows that
            have the same value. (For unique indexes, this is always 1.)
            MySQL uses this to decide which index to choose when you
            join two tables based on a non-constant expression. You can
            check the result from the table analysis by using
            <code class="literal">SHOW INDEX FROM
            <em class="replaceable"><code>tbl_name</code></em></code> and examining
            the <code class="literal">Cardinality</code> value. <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk
            --description --verbose</strong></span></a> shows index distribution
            information.
          </p></li><li><p>
            To sort an index and data according to an index, use
            <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk --sort-index --sort-records=1</strong></span></a>
            (assuming that you want to sort on index 1). This is a good
            way to make queries faster if you have a unique index from
            which you want to read all rows in order according to the
            index. The first time you sort a large table this way, it
            may take a long time.
          </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="where-optimizations"></a>7.2.4. <code class="literal">WHERE</code> Clause Optimization</h3></div></div></div><a class="indexterm" name="id3165448"></a><a class="indexterm" name="id3165457"></a><p>
        This section discusses optimizations that can be made for
        processing <code class="literal">WHERE</code> clauses. The examples use
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements, but the same
        optimizations apply for <code class="literal">WHERE</code> clauses in
        <a href="sql-syntax.html#delete" title="12.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> and
        <a href="sql-syntax.html#update" title="12.2.12. UPDATE Syntax"><code class="literal">UPDATE</code></a> statements.
      </p><p>
        Work on the MySQL optimizer is ongoing, so this section is
        incomplete. MySQL performs a great many optimizations, not all
        of which are documented here.
      </p><p>
        Some of the optimizations performed by MySQL follow:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Removal of unnecessary parentheses:
          </p><pre class="programlisting">   ((a AND b) AND c OR (((a AND b) AND (c AND d))))
-&gt; (a AND b AND c) OR (a AND b AND c AND d)
</pre></li><li><p>
            Constant folding:
          </p><pre class="programlisting">   (a&lt;b AND b=c) AND a=5
-&gt; b&gt;5 AND b=c AND a=5
</pre></li><li><p>
            Constant condition removal (needed because of constant
            folding):
          </p><pre class="programlisting">   (B&gt;=5 AND B=5) OR (B=6 AND 5=5) OR (B=7 AND 5=6)
-&gt; B=5 OR B=6
</pre></li><li><p>
            Constant expressions used by indexes are evaluated only
            once.
          </p></li><li><p>
            <a href="functions.html#function_count"><code class="literal">COUNT(*)</code></a> on a single table
            without a <code class="literal">WHERE</code> is retrieved directly
            from the table information for <code class="literal">MyISAM</code> and
            <code class="literal">MEMORY</code> tables. This is also done for any
            <code class="literal">NOT NULL</code> expression when used with only
            one table.
          </p></li><li><p>
            Early detection of invalid constant expressions. MySQL
            quickly detects that some
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements are
            impossible and returns no rows.
          </p></li><li><p>
            <code class="literal">HAVING</code> is merged with
            <code class="literal">WHERE</code> if you do not use <code class="literal">GROUP
            BY</code> or aggregate functions
            (<a href="functions.html#function_count"><code class="literal">COUNT()</code></a>,
            <a href="functions.html#function_min"><code class="literal">MIN()</code></a>, and so on).
          </p></li><li><p>
            For each table in a join, a simpler <code class="literal">WHERE</code>
            is constructed to get a fast <code class="literal">WHERE</code>
            evaluation for the table and also to skip rows as soon as
            possible.
          </p></li><li><p>
            <a class="indexterm" name="id3165696"></a>

            <a class="indexterm" name="id3165705"></a>

            All constant tables are read first before any other tables
            in the query. A constant table is any of the following:
          </p><div class="itemizedlist"><ul type="circle"><li><p>
                An empty table or a table with one row.
              </p></li><li><p>
                A table that is used with a <code class="literal">WHERE</code>
                clause on a <code class="literal">PRIMARY KEY</code> or a
                <code class="literal">UNIQUE</code> index, where all index parts
                are compared to constant expressions and are defined as
                <code class="literal">NOT NULL</code>.
              </p></li></ul></div><p>
            All of the following tables are used as constant tables:
          </p><pre class="programlisting">SELECT * FROM t WHERE <em class="replaceable"><code>primary_key</code></em>=1;
SELECT * FROM t1,t2
  WHERE t1.<em class="replaceable"><code>primary_key</code></em>=1 AND t2.<em class="replaceable"><code>primary_key</code></em>=t1.id;
</pre></li><li><p>
            The best join combination for joining the tables is found by
            trying all possibilities. If all columns in <code class="literal">ORDER
            BY</code> and <code class="literal">GROUP BY</code> clauses come
            from the same table, that table is preferred first when
            joining.
          </p></li><li><p>
            If there is an <code class="literal">ORDER BY</code> clause and a
            different <code class="literal">GROUP BY</code> clause, or if the
            <code class="literal">ORDER BY</code> or <code class="literal">GROUP BY</code>
            contains columns from tables other than the first table in
            the join queue, a temporary table is created.
          </p></li><li><p>
            If you use the <code class="literal">SQL_SMALL_RESULT</code> option,
            MySQL uses an in-memory temporary table.
          </p></li><li><p>
            Each table index is queried, and the best index is used
            unless the optimizer believes that it is more efficient to
            use a table scan. At one time, a scan was used based on
            whether the best index spanned more than 30% of the table,
            but a fixed percentage no longer determines the choice
            between using an index or a scan. The optimizer now is more
            complex and bases its estimate on additional factors such as
            table size, number of rows, and I/O block size.
          </p></li><li><p>
            In some cases, MySQL can read rows from the index without
            even consulting the data file. If all columns used from the
            index are numeric, only the index tree is used to resolve
            the query.
          </p></li><li><p>
            Before each row is output, those that do not match the
            <code class="literal">HAVING</code> clause are skipped.
          </p></li></ul></div><p>
        Some examples of queries that are very fast:
      </p><pre class="programlisting">SELECT COUNT(*) FROM <em class="replaceable"><code>tbl_name</code></em>;

SELECT MIN(<em class="replaceable"><code>key_part1</code></em>),MAX(<em class="replaceable"><code>key_part1</code></em>) FROM <em class="replaceable"><code>tbl_name</code></em>;

SELECT MAX(<em class="replaceable"><code>key_part2</code></em>) FROM <em class="replaceable"><code>tbl_name</code></em>
  WHERE <em class="replaceable"><code>key_part1</code></em>=<em class="replaceable"><code>constant</code></em>;

SELECT ... FROM <em class="replaceable"><code>tbl_name</code></em>
  ORDER BY <em class="replaceable"><code>key_part1</code></em>,<em class="replaceable"><code>key_part2</code></em>,... LIMIT 10;

SELECT ... FROM <em class="replaceable"><code>tbl_name</code></em>
  ORDER BY <em class="replaceable"><code>key_part1</code></em> DESC, <em class="replaceable"><code>key_part2</code></em> DESC, ... LIMIT 10;
</pre><p>
        MySQL resolves the following queries using only the index tree,
        assuming that the indexed columns are numeric:
      </p><pre class="programlisting">SELECT <em class="replaceable"><code>key_part1</code></em>,<em class="replaceable"><code>key_part2</code></em> FROM <em class="replaceable"><code>tbl_name</code></em> WHERE <em class="replaceable"><code>key_part1</code></em>=<em class="replaceable"><code>val</code></em>;

SELECT COUNT(*) FROM <em class="replaceable"><code>tbl_name</code></em>
  WHERE <em class="replaceable"><code>key_part1</code></em>=<em class="replaceable"><code>val1</code></em> AND <em class="replaceable"><code>key_part2</code></em>=<em class="replaceable"><code>val2</code></em>;

SELECT <em class="replaceable"><code>key_part2</code></em> FROM <em class="replaceable"><code>tbl_name</code></em> GROUP BY <em class="replaceable"><code>key_part1</code></em>;
</pre><p>
        The following queries use indexing to retrieve the rows in
        sorted order without a separate sorting pass:
      </p><pre class="programlisting">SELECT ... FROM <em class="replaceable"><code>tbl_name</code></em>
  ORDER BY <em class="replaceable"><code>key_part1</code></em>,<em class="replaceable"><code>key_part2</code></em>,... ;

SELECT ... FROM <em class="replaceable"><code>tbl_name</code></em>
  ORDER BY <em class="replaceable"><code>key_part1</code></em> DESC, <em class="replaceable"><code>key_part2</code></em> DESC, ... ;
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="range-optimization"></a>7.2.5. Range Optimization</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="optimization.html#range-access-single-part">7.2.5.1. The Range Access Method for Single-Part Indexes</a></span></dt><dt><span class="section"><a href="optimization.html#range-access-multi-part">7.2.5.2. The Range Access Method for Multiple-Part Indexes</a></span></dt></dl></div><p>
        The <a href="optimization.html#jointype_range"><code class="literal">range</code></a> access method uses
        a single index to retrieve a subset of table rows that are
        contained within one or several index value intervals. It can be
        used for a single-part or multiple-part index. The following
        sections give a detailed description of how intervals are
        extracted from the <code class="literal">WHERE</code> clause.
      </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="range-access-single-part"></a>7.2.5.1. The Range Access Method for Single-Part Indexes</h4></div></div></div><p>
          For a single-part index, index value intervals can be
          conveniently represented by corresponding conditions in the
          <code class="literal">WHERE</code> clause, so we speak of
          <em class="firstterm">range conditions</em> rather than
          “<span class="quote">intervals.</span>”
        </p><p>
          The definition of a range condition for a single-part index is
          as follows:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              For both <code class="literal">BTREE</code> and
              <code class="literal">HASH</code> indexes, comparison of a key part
              with a constant value is a range condition when using the
              <a href="functions.html#operator_equal"><code class="literal">=</code></a>,
              <a href="functions.html#operator_equal-to"><code class="literal">&lt;=&gt;</code></a>,
              <a href="functions.html#function_in"><code class="literal">IN()</code></a>, <a href="functions.html#operator_is-null"><code class="literal">IS
              NULL</code></a>, or <a href="functions.html#operator_is-not-null"><code class="literal">IS NOT
              NULL</code></a> operators.
            </p></li><li><p>
              For <code class="literal">BTREE</code> indexes, comparison of a key
              part with a constant value is a range condition when using
              the
              <a href="functions.html#operator_greater-than"><code class="literal">&gt;</code></a>,
              <a href="functions.html#operator_less-than"><code class="literal">&lt;</code></a>,
              <a href="functions.html#operator_greater-than-or-equal"><code class="literal">&gt;=</code></a>,
              <a href="functions.html#operator_less-than-or-equal"><code class="literal">&lt;=</code></a>,
              <a href="functions.html#operator_between"><code class="literal">BETWEEN</code></a>,
              <a href="functions.html#operator_not-equal"><code class="literal">!=</code></a>, or
              <a href="functions.html#operator_not-equal"><code class="literal">&lt;&gt;</code></a>
              operators, or <a href="functions.html#operator_like"><code class="literal">LIKE</code></a>
              comparisons if the argument to
              <a href="functions.html#operator_like"><code class="literal">LIKE</code></a> is a constant string
              that does not start with a wildcard character.
            </p></li><li><p>
              For all types of indexes, multiple range conditions
              combined with <a href="functions.html#operator_or"><code class="literal">OR</code></a> or
              <a href="functions.html#operator_and"><code class="literal">AND</code></a> form a range condition.
            </p></li></ul></div><p>
          “<span class="quote">Constant value</span>” in the preceding descriptions
          means one of the following:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              A constant from the query string
            </p></li><li><p>
              A column of a <a href="optimization.html#jointype_const"><code class="literal">const</code></a> or
              <a href="optimization.html#jointype_system"><code class="literal">system</code></a> table from the
              same join
            </p></li><li><p>
              The result of an uncorrelated subquery
            </p></li><li><p>
              Any expression composed entirely from subexpressions of
              the preceding types
            </p></li></ul></div><p>
          Here are some examples of queries with range conditions in the
          <code class="literal">WHERE</code> clause:
        </p><pre class="programlisting">SELECT * FROM t1
  WHERE <em class="replaceable"><code>key_col</code></em> &gt; 1 
  AND <em class="replaceable"><code>key_col</code></em> &lt; 10;

SELECT * FROM t1 
  WHERE <em class="replaceable"><code>key_col</code></em> = 1 
  OR <em class="replaceable"><code>key_col</code></em> IN (15,18,20);

SELECT * FROM t1 
  WHERE <em class="replaceable"><code>key_col</code></em> LIKE 'ab%' 
  OR <em class="replaceable"><code>key_col</code></em> BETWEEN 'bar' AND 'foo';
</pre><p>
          Note that some non-constant values may be converted to
          constants during the constant propagation phase.
        </p><p>
          MySQL tries to extract range conditions from the
          <code class="literal">WHERE</code> clause for each of the possible
          indexes. During the extraction process, conditions that cannot
          be used for constructing the range condition are dropped,
          conditions that produce overlapping ranges are combined, and
          conditions that produce empty ranges are removed.
        </p><p>
          Consider the following statement, where
          <code class="literal">key1</code> is an indexed column and
          <code class="literal">nonkey</code> is not indexed:
        </p><pre class="programlisting">SELECT * FROM t1 WHERE
  (key1 &lt; 'abc' AND (key1 LIKE 'abcde%' OR key1 LIKE '%b')) OR
  (key1 &lt; 'bar' AND nonkey = 4) OR
  (key1 &lt; 'uux' AND key1 &gt; 'z');
</pre><p>
          The extraction process for key <code class="literal">key1</code> is as
          follows:
        </p><div class="orderedlist"><ol type="1"><li><p>
              Start with original <code class="literal">WHERE</code> clause:
            </p><pre class="programlisting">(key1 &lt; 'abc' AND (key1 LIKE 'abcde%' OR key1 LIKE '%b')) OR
(key1 &lt; 'bar' AND nonkey = 4) OR
(key1 &lt; 'uux' AND key1 &gt; 'z')
</pre></li><li><p>
              Remove <code class="literal">nonkey = 4</code> and <code class="literal">key1
              LIKE '%b'</code> because they cannot be used for a
              range scan. The correct way to remove them is to replace
              them with <code class="literal">TRUE</code>, so that we do not miss
              any matching rows when doing the range scan. Having
              replaced them with <code class="literal">TRUE</code>, we get:
            </p><pre class="programlisting">(key1 &lt; 'abc' AND (key1 LIKE 'abcde%' OR TRUE)) OR
(key1 &lt; 'bar' AND TRUE) OR
(key1 &lt; 'uux' AND key1 &gt; 'z')
</pre></li><li><p>
              Collapse conditions that are always true or false:
            </p><div class="itemizedlist"><ul type="disc"><li><p>
                  <code class="literal">(key1 LIKE 'abcde%' OR TRUE)</code> is
                  always true
                </p></li><li><p>
                  <code class="literal">(key1 &lt; 'uux' AND key1 &gt; 'z')</code>
                  is always false
                </p></li></ul></div><p>
              Replacing these conditions with constants, we get:
            </p><pre class="programlisting">(key1 &lt; 'abc' AND TRUE) OR (key1 &lt; 'bar' AND TRUE) OR (FALSE)
</pre><p>
              Removing unnecessary <code class="literal">TRUE</code> and
              <code class="literal">FALSE</code> constants, we obtain:
            </p><pre class="programlisting">(key1 &lt; 'abc') OR (key1 &lt; 'bar')
</pre></li><li><p>
              Combining overlapping intervals into one yields the final
              condition to be used for the range scan:
            </p><pre class="programlisting">(key1 &lt; 'bar')
</pre></li></ol></div><p>
          In general (and as demonstrated by the preceding example), the
          condition used for a range scan is less restrictive than the
          <code class="literal">WHERE</code> clause. MySQL performs an additional
          check to filter out rows that satisfy the range condition but
          not the full <code class="literal">WHERE</code> clause.
        </p><p>
          The range condition extraction algorithm can handle nested
          <a href="functions.html#operator_and"><code class="literal">AND</code></a>/<a href="functions.html#operator_or"><code class="literal">OR</code></a>
          constructs of arbitrary depth, and its output does not depend
          on the order in which conditions appear in
          <code class="literal">WHERE</code> clause.
        </p><p>
          Currently, MySQL does not support merging multiple ranges for
          the <a href="optimization.html#jointype_range"><code class="literal">range</code></a> access method for
          spatial indexes. To work around this limitation, you can use a
          <a href="sql-syntax.html#union" title="12.2.9.3. UNION Syntax"><code class="literal">UNION</code></a> with identical
          <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements, except that
          you put each spatial predicate in a different
          <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>.
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="range-access-multi-part"></a>7.2.5.2. The Range Access Method for Multiple-Part Indexes</h4></div></div></div><p>
          Range conditions on a multiple-part index are an extension of
          range conditions for a single-part index. A range condition on
          a multiple-part index restricts index rows to lie within one
          or several key tuple intervals. Key tuple intervals are
          defined over a set of key tuples, using ordering from the
          index.
        </p><p>
          For example, consider a multiple-part index defined as
          <code class="literal">key1(<em class="replaceable"><code>key_part1</code></em>,
          <em class="replaceable"><code>key_part2</code></em>,
          <em class="replaceable"><code>key_part3</code></em>)</code>, and the
          following set of key tuples listed in key order:
        </p><pre class="programlisting"><em class="replaceable"><code>key_part1</code></em>  <em class="replaceable"><code>key_part2</code></em>  <em class="replaceable"><code>key_part3</code></em>
  NULL       1          'abc'
  NULL       1          'xyz'
  NULL       2          'foo'
   1         1          'abc'
   1         1          'xyz'
   1         2          'abc'
   2         1          'aaa'
</pre><p>
          The condition <code class="literal"><em class="replaceable"><code>key_part1</code></em> =
          1</code> defines this interval:
        </p><pre class="programlisting">(1,-inf,-inf) &lt;= (<em class="replaceable"><code>key_part1</code></em>,<em class="replaceable"><code>key_part2</code></em>,<em class="replaceable"><code>key_part3</code></em>) &lt; (1,+inf,+inf)
</pre><p>
          The interval covers the 4th, 5th, and 6th tuples in the
          preceding data set and can be used by the range access method.
        </p><p>
          By contrast, the condition
          <code class="literal"><em class="replaceable"><code>key_part3</code></em> =
          'abc'</code> does not define a single interval and cannot
          be used by the range access method.
        </p><p>
          The following descriptions indicate how range conditions work
          for multiple-part indexes in greater detail.
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              For <code class="literal">HASH</code> indexes, each interval
              containing identical values can be used. This means that
              the interval can be produced only for conditions in the
              following form:
            </p><pre class="programlisting">    <em class="replaceable"><code>key_part1</code></em> <em class="replaceable"><code>cmp</code></em> <em class="replaceable"><code>const1</code></em>
AND <em class="replaceable"><code>key_part2</code></em> <em class="replaceable"><code>cmp</code></em> <em class="replaceable"><code>const2</code></em>
AND ...
AND <em class="replaceable"><code>key_partN</code></em> <em class="replaceable"><code>cmp</code></em> <em class="replaceable"><code>constN</code></em>;
</pre><p>
              Here, <em class="replaceable"><code>const1</code></em>,
              <em class="replaceable"><code>const2</code></em>, … are constants,
              <em class="replaceable"><code>cmp</code></em> is one of the
              <a href="functions.html#operator_equal"><code class="literal">=</code></a>,
              <a href="functions.html#operator_equal-to"><code class="literal">&lt;=&gt;</code></a>,
              or <a href="functions.html#operator_is-null"><code class="literal">IS NULL</code></a> comparison
              operators, and the conditions cover all index parts. (That
              is, there are <em class="replaceable"><code>N</code></em> conditions, one
              for each part of an <em class="replaceable"><code>N</code></em>-part
              index.) For example, the following is a range condition
              for a three-part <code class="literal">HASH</code> index:
            </p><pre class="programlisting"><em class="replaceable"><code>key_part1</code></em> = 1 AND <em class="replaceable"><code>key_part2</code></em> IS NULL AND <em class="replaceable"><code>key_part3</code></em> = 'foo'
</pre><p>
              For the definition of what is considered to be a constant,
              see <a href="optimization.html#range-access-single-part" title="7.2.5.1. The Range Access Method for Single-Part Indexes">Section 7.2.5.1, “The Range Access Method for Single-Part Indexes”</a>.
            </p></li><li><p>
              For a <code class="literal">BTREE</code> index, an interval might be
              usable for conditions combined with
              <a href="functions.html#operator_and"><code class="literal">AND</code></a>, where each condition
              compares a key part with a constant value using
              <a href="functions.html#operator_equal"><code class="literal">=</code></a>,
              <a href="functions.html#operator_equal-to"><code class="literal">&lt;=&gt;</code></a>,
              <a href="functions.html#operator_is-null"><code class="literal">IS NULL</code></a>,
              <a href="functions.html#operator_greater-than"><code class="literal">&gt;</code></a>,
              <a href="functions.html#operator_less-than"><code class="literal">&lt;</code></a>,
              <a href="functions.html#operator_greater-than-or-equal"><code class="literal">&gt;=</code></a>,
              <a href="functions.html#operator_less-than-or-equal"><code class="literal">&lt;=</code></a>,
              <a href="functions.html#operator_not-equal"><code class="literal">!=</code></a>,
              <a href="functions.html#operator_not-equal"><code class="literal">&lt;&gt;</code></a>,
              <a href="functions.html#operator_between"><code class="literal">BETWEEN</code></a>, or
              <a href="functions.html#operator_like"><code class="literal">LIKE
              '<em class="replaceable"><code>pattern</code></em>'</code></a> (where
              <code class="literal">'<em class="replaceable"><code>pattern</code></em>'</code>
              does not start with a wildcard). An interval can be used
              as long as it is possible to determine a single key tuple
              containing all rows that match the condition (or two
              intervals if
              <a href="functions.html#operator_not-equal"><code class="literal">&lt;&gt;</code></a>
              or <a href="functions.html#operator_not-equal"><code class="literal">!=</code></a>
              is used). For example, for this condition:
            </p><pre class="programlisting"><em class="replaceable"><code>key_part1</code></em> = 'foo' AND <em class="replaceable"><code>key_part2</code></em> &gt;= 10 AND <em class="replaceable"><code>key_part3</code></em> &gt; 10
</pre><p>
              The single interval is:
            </p><pre class="programlisting">('foo',10,10) &lt; (<em class="replaceable"><code>key_part1</code></em>,<em class="replaceable"><code>key_part2</code></em>,<em class="replaceable"><code>key_part3</code></em>) &lt; ('foo',+inf,+inf)
</pre><p>
              It is possible that the created interval contains more
              rows than the initial condition. For example, the
              preceding interval includes the value <code class="literal">('foo', 11,
              0)</code>, which does not satisfy the original
              condition.
            </p></li><li><p>
              If conditions that cover sets of rows contained within
              intervals are combined with
              <a href="functions.html#operator_or"><code class="literal">OR</code></a>, they form a condition
              that covers a set of rows contained within the union of
              their intervals. If the conditions are combined with
              <a href="functions.html#operator_and"><code class="literal">AND</code></a>, they form a condition
              that covers a set of rows contained within the
              intersection of their intervals. For example, for this
              condition on a two-part index:
            </p><pre class="programlisting">(<em class="replaceable"><code>key_part1</code></em> = 1 AND <em class="replaceable"><code>key_part2</code></em> &lt; 2) OR (<em class="replaceable"><code>key_part1</code></em> &gt; 5)
</pre><p>
              The intervals are:
            </p><pre class="programlisting">(1,-inf) &lt; (<em class="replaceable"><code>key_part1</code></em>,<em class="replaceable"><code>key_part2</code></em>) &lt; (1,2)
(5,-inf) &lt; (<em class="replaceable"><code>key_part1</code></em>,<em class="replaceable"><code>key_part2</code></em>)
</pre><p>
              In this example, the interval on the first line uses one
              key part for the left bound and two key parts for the
              right bound. The interval on the second line uses only one
              key part. The <code class="literal">key_len</code> column in the
              <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output indicates
              the maximum length of the key prefix used.
            </p><p>
              In some cases, <code class="literal">key_len</code> may indicate
              that a key part was used, but that might be not what you
              would expect. Suppose that
              <em class="replaceable"><code>key_part1</code></em> and
              <em class="replaceable"><code>key_part2</code></em> can be
              <code class="literal">NULL</code>. Then the
              <code class="literal">key_len</code> column displays two key part
              lengths for the following condition:
            </p><pre class="programlisting"><em class="replaceable"><code>key_part1</code></em> &gt;= 1 AND <em class="replaceable"><code>key_part2</code></em> &lt; 2
</pre><p>
              But, in fact, the condition is converted to this:
            </p><pre class="programlisting"><em class="replaceable"><code>key_part1</code></em> &gt;= 1 AND <em class="replaceable"><code>key_part2</code></em> IS NOT NULL
</pre></li></ul></div><p>
          <a href="optimization.html#range-access-single-part" title="7.2.5.1. The Range Access Method for Single-Part Indexes">Section 7.2.5.1, “The Range Access Method for Single-Part Indexes”</a>, describes how
          optimizations are performed to combine or eliminate intervals
          for range conditions on a single-part index. Analogous steps
          are performed for range conditions on multiple-part indexes.
        </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="index-merge-optimization"></a>7.2.6. Index Merge Optimization</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="optimization.html#index-merge-intersection">7.2.6.1. The Index Merge Intersection Access Algorithm</a></span></dt><dt><span class="section"><a href="optimization.html#index-merge-union">7.2.6.2. The Index Merge Union Access Algorithm</a></span></dt><dt><span class="section"><a href="optimization.html#index-merge-sort-union">7.2.6.3. The Index Merge Sort-Union Access Algorithm</a></span></dt></dl></div><a class="indexterm" name="id3167336"></a><a class="indexterm" name="id3167344"></a><a class="indexterm" name="id3167354"></a><p>
        The <em class="firstterm">Index Merge</em> method is used to
        retrieve rows with several
        <a href="optimization.html#jointype_range"><code class="literal">range</code></a> scans and to merge
        their results into one. The merge can produce unions,
        intersections, or unions-of-intersections of its underlying
        scans. This access method merges index scans from a single
        table; it does not merge scans across multiple tables.
      </p><p>
        In <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output, the Index
        Merge method appears as
        <a href="optimization.html#jointype_index_merge"><code class="literal">index_merge</code></a> in the
        <code class="literal">type</code> column. In this case, the
        <code class="literal">key</code> column contains a list of indexes used,
        and <code class="literal">key_len</code> contains a list of the longest
        key parts for those indexes.
      </p><p>
        Examples:
      </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>tbl_name</code></em> WHERE <em class="replaceable"><code>key1</code></em> = 10 OR <em class="replaceable"><code>key2</code></em> = 20;

SELECT * FROM <em class="replaceable"><code>tbl_name</code></em>
  WHERE (<em class="replaceable"><code>key1</code></em> = 10 OR <em class="replaceable"><code>key2</code></em> = 20) AND <em class="replaceable"><code>non_key</code></em>=30;

SELECT * FROM t1, t2
  WHERE (t1.<em class="replaceable"><code>key1</code></em> IN (1,2) OR t1.<em class="replaceable"><code>key2</code></em> LIKE '<em class="replaceable"><code>value</code></em>%')
  AND t2.<em class="replaceable"><code>key1</code></em>=t1.<em class="replaceable"><code>some_col</code></em>;

SELECT * FROM t1, t2
  WHERE t1.<em class="replaceable"><code>key1</code></em>=1
  AND (t2.<em class="replaceable"><code>key1</code></em>=t1.<em class="replaceable"><code>some_col</code></em> OR t2.<em class="replaceable"><code>key2</code></em>=t1.<em class="replaceable"><code>some_col2</code></em>);
</pre><p>
        The Index Merge method has several access algorithms (seen in
        the <code class="literal">Extra</code> field of
        <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output):
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            <code class="literal">Using intersect(...)</code>
          </p></li><li><p>
            <code class="literal">Using union(...)</code>
          </p></li><li><p>
            <code class="literal">Using sort_union(...)</code>
          </p></li></ul></div><p>
        The following sections describe these methods in greater detail.
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
          The Index Merge optimization algorithm has the following known
          deficiencies:
        </p></div><div class="itemizedlist"><ul type="disc"><li><p>
            If a range scan is possible on some key, the optimizer will
            not consider using Index Merge Union or Index Merge
            Sort-Union algorithms. For example, consider this query:
          </p><pre class="programlisting">SELECT * FROM t1 WHERE (goodkey1 &lt; 10 OR goodkey2 &lt; 20) AND badkey &lt; 30;
</pre><p>
            For this query, two plans are possible:
          </p><div class="itemizedlist"><ul type="circle"><li><p>
                An Index Merge scan using the <code class="literal">(goodkey1 &lt; 10
                OR goodkey2 &lt; 20)</code> condition.
              </p></li><li><p>
                A range scan using the <code class="literal">badkey &lt; 30</code>
                condition.
              </p></li></ul></div><p>
            However, the optimizer considers only the second plan.
          </p></li><li><p>
            If your query has a complex <code class="literal">WHERE</code> clause
            with deep
            <a href="functions.html#operator_and"><code class="literal">AND</code></a>/<a href="functions.html#operator_or"><code class="literal">OR</code></a>
            nesting and MySQL doesn't choose the optimal plan, try
            distributing terms using the following identity laws:
          </p><pre class="programlisting">(<em class="replaceable"><code>x</code></em> AND <em class="replaceable"><code>y</code></em>) OR <em class="replaceable"><code>z</code></em> = (<em class="replaceable"><code>x</code></em> OR <em class="replaceable"><code>z</code></em>) AND (<em class="replaceable"><code>y</code></em> OR <em class="replaceable"><code>z</code></em>)
(<em class="replaceable"><code>x</code></em> OR <em class="replaceable"><code>y</code></em>) AND <em class="replaceable"><code>z</code></em> = (<em class="replaceable"><code>x</code></em> AND <em class="replaceable"><code>z</code></em>) OR (<em class="replaceable"><code>y</code></em> AND <em class="replaceable"><code>z</code></em>)
</pre></li><li><p>
            Index Merge is not applicable to fulltext indexes. We plan
            to extend it to cover these in a future MySQL release.
          </p></li></ul></div><p>
        The choice between different possible variants of the Index
        Merge access method and other access methods is based on cost
        estimates of various available options.
      </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="index-merge-intersection"></a>7.2.6.1. The Index Merge Intersection Access Algorithm</h4></div></div></div><p>
          This access algorithm can be employed when a
          <code class="literal">WHERE</code> clause was converted to several range
          conditions on different keys combined with
          <a href="functions.html#operator_and"><code class="literal">AND</code></a>, and each condition is one of
          the following:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              In this form, where the index has exactly
              <em class="replaceable"><code>N</code></em> parts (that is, all index
              parts are covered):
            </p><pre class="programlisting"><em class="replaceable"><code>key_part1</code></em>=<em class="replaceable"><code>const1</code></em> AND <em class="replaceable"><code>key_part2</code></em>=<em class="replaceable"><code>const2</code></em> ... AND <em class="replaceable"><code>key_partN</code></em>=<em class="replaceable"><code>constN</code></em>
</pre></li><li><p>
              Any range condition over a primary key of an
              <code class="literal">InnoDB</code> table.
            </p></li></ul></div><p>
          Examples:
        </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>innodb_table</code></em> WHERE <em class="replaceable"><code>primary_key</code></em> &lt; 10 AND <em class="replaceable"><code>key_col1</code></em>=20;

SELECT * FROM <em class="replaceable"><code>tbl_name</code></em>
  WHERE (<em class="replaceable"><code>key1_part1</code></em>=1 AND <em class="replaceable"><code>key1_part2</code></em>=2) AND <em class="replaceable"><code>key2</code></em>=2;
</pre><p>
          The Index Merge intersection algorithm performs simultaneous
          scans on all used indexes and produces the intersection of row
          sequences that it receives from the merged index scans.
        </p><p>
          If all columns used in the query are covered by the used
          indexes, full table rows are not retrieved
          (<a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output contains
          <code class="literal">Using index</code> in <code class="literal">Extra</code>
          field in this case). Here is an example of such a query:
        </p><pre class="programlisting">SELECT COUNT(*) FROM t1 WHERE key1=1 AND key2=1;
</pre><p>
          If the used indexes don't cover all columns used in the query,
          full rows are retrieved only when the range conditions for all
          used keys are satisfied.
        </p><p>
          If one of the merged conditions is a condition over a primary
          key of an <code class="literal">InnoDB</code> table, it is not used for
          row retrieval, but is used to filter out rows retrieved using
          other conditions.
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="index-merge-union"></a>7.2.6.2. The Index Merge Union Access Algorithm</h4></div></div></div><p>
          The applicability criteria for this algorithm are similar to
          those for the Index Merge method intersection algorithm. The
          algorithm can be employed when the table's
          <code class="literal">WHERE</code> clause was converted to several range
          conditions on different keys combined with
          <a href="functions.html#operator_or"><code class="literal">OR</code></a>, and each condition is one of
          the following:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              In this form, where the index has exactly
              <em class="replaceable"><code>N</code></em> parts (that is, all index
              parts are covered):
            </p><pre class="programlisting"><em class="replaceable"><code>key_part1</code></em>=<em class="replaceable"><code>const1</code></em> AND <em class="replaceable"><code>key_part2</code></em>=<em class="replaceable"><code>const2</code></em> ... AND <em class="replaceable"><code>key_partN</code></em>=<em class="replaceable"><code>constN</code></em>
</pre></li><li><p>
              Any range condition over a primary key of an
              <code class="literal">InnoDB</code> table.
            </p></li><li><p>
              A condition for which the Index Merge method intersection
              algorithm is applicable.
            </p></li></ul></div><p>
          Examples:
        </p><pre class="programlisting">SELECT * FROM t1 WHERE <em class="replaceable"><code>key1</code></em>=1 OR <em class="replaceable"><code>key2</code></em>=2 OR <em class="replaceable"><code>key3</code></em>=3;

SELECT * FROM <em class="replaceable"><code>innodb_table</code></em> WHERE (<em class="replaceable"><code>key1</code></em>=1 AND <em class="replaceable"><code>key2</code></em>=2) OR
  (<em class="replaceable"><code>key3</code></em>='foo' AND <em class="replaceable"><code>key4</code></em>='bar') AND <em class="replaceable"><code>key5</code></em>=5;
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="index-merge-sort-union"></a>7.2.6.3. The Index Merge Sort-Union Access Algorithm</h4></div></div></div><p>
          This access algorithm is employed when the
          <code class="literal">WHERE</code> clause was converted to several range
          conditions combined by <a href="functions.html#operator_or"><code class="literal">OR</code></a>, but
          for which the Index Merge method union algorithm is not
          applicable.
        </p><p>
          Examples:
        </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>tbl_name</code></em> WHERE <em class="replaceable"><code>key_col1</code></em> &lt; 10 OR <em class="replaceable"><code>key_col2</code></em> &lt; 20;

SELECT * FROM <em class="replaceable"><code>tbl_name</code></em>
  WHERE (<em class="replaceable"><code>key_col1</code></em> &gt; 10 OR <em class="replaceable"><code>key_col2</code></em> = 20) AND <em class="replaceable"><code>nonkey_col</code></em>=30;
</pre><p>
          The difference between the sort-union algorithm and the union
          algorithm is that the sort-union algorithm must first fetch
          row IDs for all rows and sort them before returning any rows.
        </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="condition-pushdown-optimization"></a>7.2.7. Condition Pushdown Optimization</h3></div></div></div><p>
        This optimization improves the efficiency of a direct comparison
        between a non-indexed column and a constant. In such cases, the
        condition is “<span class="quote">pushed down</span>” to the storage engine
        for evaluation. In MySQL 6.0, this optimization can
        be used only by the <code class="literal">MyISAM</code> storage engine; it
        may be implemented for additional storage engines in future
        versions of MySQL.
      </p><p>
        Suppose that a table is defined as follows:
      </p><pre class="programlisting">CREATE TABLE t1 (
    a INT, 
    b INT, 
    KEY(a)
) ENGINE=MyISAM;
      </pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
          It is not necessary to use an explicit
          <code class="literal">ENGINE</code> option to create a
          <code class="literal">MyISAM</code> table if this is the default MySQL
          storage engine type at the time the table is created;
          condition pushdown can still be employed with such a
          <code class="literal">MyISAM</code> table.
        </p></div><p>
        Condition pushdown can be used with a query against this table
        such as the query shown here:
      </p><pre class="programlisting">SELECT a,b FROM t1 WHERE b = 10;
</pre><p>
        This can be seen in the output of
        <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN
        SELECT</code></a>:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>EXPLAIN SELECT a,b FROM t1 WHERE b = 10\G</code></strong>
*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: t1
         type: ALL
possible_keys: NULL
          key: NULL
      key_len: NULL
          ref: NULL
         rows: 10
        Extra: Using where with pushed condition
</pre><p>
        However, condition pushdown <span class="emphasis"><em>cannot</em></span> be used
        with either of these two queries:
      </p><pre class="programlisting">SELECT a,b FROM t1 WHERE a = 10;
SELECT a,b FROM t1 WHERE b + 1 = 10;
</pre><p>
        With regard to the first of these two queries, condition
        pushdown is not applicable because an index exists on column
        <code class="literal">a</code>. (An index access method would be more
        efficient and so would be chosen in preference to condition
        pushdown.) In the case of the second query, condition pushdown
        cannot be employed because the comparison involving the
        non-indexed column <code class="literal">b</code> is indirect. (However,
        condition pushdown could be applied if you were to reduce
        <code class="literal">b + 1 = 10</code> to <code class="literal">b = 9</code> in the
        <code class="literal">WHERE</code> clause.)
      </p><p>
        Condition pushdown may also be employed when an indexed column
        is compared with a constant using a <code class="literal">&gt;</code> or
        <code class="literal">&lt;</code> operator:

</p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>EXPLAIN SELECT a,b FROM t1 WHERE a&lt;2\G</code></strong>
*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: t1
         type: range
possible_keys: a
          key: a
      key_len: 5
          ref: NULL
         rows: 2
        Extra: Using where with pushed condition
</pre><p>
      </p><p>
        Other comparisons which are supported for condition pushdown
        include the following:

        </p><div class="itemizedlist"><ul type="disc"><li><p>
              <code class="literal"><em class="replaceable"><code>column</code></em> [NOT] LIKE
              <em class="replaceable"><code>pattern</code></em></code>
            </p><p>
              <em class="replaceable"><code>pattern</code></em> must be a string
              literal containing the pattern to be matched; for syntax,
              see <a href="functions.html#string-comparison-functions" title="11.4.1. String Comparison Functions">Section 11.4.1, “String Comparison Functions”</a>.
            </p></li><li><p>
              <code class="literal"><em class="replaceable"><code>column</code></em> IS [NOT]
              NULL</code>
            </p></li><li><p>
              <code class="literal"><em class="replaceable"><code>column</code></em> IN
              (<em class="replaceable"><code>value_list</code></em>)</code>
            </p><p>
              Each item in the <em class="replaceable"><code>value_list</code></em>
              must be a constant, literal value.
            </p></li><li><p>
              <code class="literal"><em class="replaceable"><code>column</code></em> BETWEEN
              <em class="replaceable"><code>constant1</code></em> AND
              <em class="replaceable"><code>constant2</code></em></code>
            </p><p>
              <em class="replaceable"><code>constant1</code></em> and
              <em class="replaceable"><code>constant2</code></em> must each be a
              constant, literal value.
            </p></li></ul></div><p>

        In all of the cases in the preceding list, it is possible for
        the condition to be converted into the form of one or more
        direct comparisons between a column and a constant.
      </p><p>
        Condition pushdown capability is not used by default. To enable
        it, you can start <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> with the
        <a href="server-administration.html#option_mysqld_engine-condition-pushdown"><code class="option">--engine-condition-pushdown</code></a>
        option, or you can execute either of the following statements at
        runtime:

</p><pre class="programlisting">SET engine_condition_pushdown=ON;
</pre><p>

</p><pre class="programlisting">SET engine_condition_pushdown=1;
</pre><p>
      </p><p><b>Limitations. </b>
          Condition pushdown is subject to the following limitations:

          </p><div class="itemizedlist"><ul type="disc"><li><p>
                In MySQL 6.0, condition pushdown is
                supported by the <code class="literal">MyISAM</code> storage
                engine only.
              </p></li><li><p>
                Columns may be compared with constants only; however,
                this includes expressions which evaluate to constant
                values.
              </p></li><li><p>
                Columns used in comparisons cannot be of any of the
                <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a> or
                <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">TEXT</code></a> types.
              </p></li><li><p>
                A string value to be compared with a column must use the
                same collation as the column.
              </p></li><li><p>
                Joins are not directly supported; conditions involving
                multiple tables are pushed separately where possible.
                Use <code class="literal">EXPLAIN EXTENDED</code> to determine
                which conditions are actually pushed down.
              </p></li></ul></div><p>
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
          The <code class="literal">NDBCLUSTER</code> storage engine
          used by MySQL Cluster also supports condition pushdown;
          however, this storage engine is currently not available in
          MySQL 6.0. If you are interested in using MySQL Cluster, see
          <a href="http://dev.mysql.com/doc/refman/5.1/en/mysql-cluster.html" target="_top">MySQL Cluster NDB 6.X/7.X</a>, which provides
          information about MySQL Cluster NDB 6.2 and 6.3, which are
          based on MySQL 5.1 but contain the latest improvements and
          fixes for <code class="literal">NDBCLUSTER</code>.
        </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="index-condition-pushdown-optimization"></a>7.2.8. Index Condition Pushdown Optimization</h3></div></div></div><p>
        Index Condition Pushdown optimization is used for the
        <a href="optimization.html#jointype_range"><code class="literal">range</code></a>,
        <a href="optimization.html#jointype_ref"><code class="literal">ref</code></a>,
        <a href="optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a>, and
        <a href="optimization.html#jointype_ref_or_null"><code class="literal">ref_or_null</code></a> access methods
        when there is a need to access full table rows. The optimization
        is that the server tries to use index information to defer
        (“<span class="quote">push down</span>”) reading of full table rows unless it
        is known to be necessary. This is done by performing early tests
        on index tuples first. This strategy can be used for
        <code class="literal">MyISAM</code> tables.
      </p><p>
        To see how this optimization works, consider first how an index
        scan proceeds when Index Condition Pushdown is not used:
      </p><div class="orderedlist"><ol type="1"><li><p>
            Get the next row, first by reading the index tuple, and then
            by using the index tuple to locate and read the full table
            row.
          </p></li><li><p>
            Test the part of the <code class="literal">WHERE</code> condition that
            applies to this table. Accept or reject the row based on the
            test result.
          </p></li></ol></div><p>
        When Index Condition Pushdown is used, the scan proceeds like
        this instead:
      </p><div class="orderedlist"><ol type="1"><li><p>
            Get the next rows's index tuple (but not the full table
            row).
          </p></li><li><p>
            Test the part of the <code class="literal">WHERE</code> condition that
            applies to this table and can be checked using only index
            columns. If the condition is not satisfied, proceed to the
            next row.
          </p></li><li><p>
            Use the index tuple to locate and read the full table row.
          </p></li><li><p>
            Test the part of the <code class="literal">WHERE</code> condition that
            applies to this table. Accept or reject the row based on the
            test result.
          </p></li></ol></div><p>
        When Index Condition Pushdown is used, the
        <code class="literal">Extra</code> column in
        <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output shows
        <code class="literal">Using index condition</code>. It will not show
        <code class="literal">Index only</code> because that does not apply when
        full table rows must be read.
      </p><p>
        Suppose that we have a table containing information about people
        and their addresses and that the table has an index defined as
        <code class="literal">INDEX (zipcode, lastname, firstname)</code>. If we
        know a person's <code class="literal">zipcode</code> value but are not
        sure about the last name, we can search like this:
      </p><pre class="programlisting">SELECT * FROM people 
  WHERE zipcode='95054'
  AND lastname LIKE '%etrunia%'
  AND address LIKE '%Main Street%'
</pre><p>
        MySQL can use the index to scan through people with
        <code class="literal">zipcode='95054'</code>. The second part
        (<code class="literal">lastname LIKE '%etrunia%'</code>) cannot be used to
        limit the number of rows that must be scanned, so without Index
        Condition Pushdown, this query must retrieve full table rows for
        all the people who have <code class="literal">zipcode='95054'</code>.
      </p><p>
        With Index Condition Pushdown, MySQL will check the
        <code class="literal">lastname LIKE '%etrunia%'</code> part before reading
        the full table row. This avoids reading full rows corresponding
        to all index tuples that do not match the
        <code class="literal">lastname</code> condition. The full-row test is
        “<span class="quote">pushed down</span>” to take place later than the
        index-only test.
      </p><p>
        Index Condition Pushdown is enabled by default; it can be
        controlled with the
        <a href="server-administration.html#sysvar_engine_condition_pushdown"><code class="literal">engine_condition_pushdown</code></a>
        system variable. This variable also controls table Condition
        Pushdown as used for NDB; see
        <a href="optimization.html#condition-pushdown-optimization" title="7.2.7. Condition Pushdown Optimization">Section 7.2.7, “Condition Pushdown Optimization”</a>.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="is-null-optimization"></a>7.2.9. <code class="literal">IS NULL</code> Optimization</h3></div></div></div><a class="indexterm" name="id3168898"></a><a class="indexterm" name="id3168907"></a><p>
        MySQL can perform the same optimization on
        <em class="replaceable"><code>col_name</code></em> <a href="functions.html#operator_is-null"><code class="literal">IS
        NULL</code></a> that it can use for
        <em class="replaceable"><code>col_name</code></em> <code class="literal">=</code>
        <em class="replaceable"><code>constant_value</code></em>. For example, MySQL
        can use indexes and ranges to search for <code class="literal">NULL</code>
        with <a href="functions.html#operator_is-null"><code class="literal">IS NULL</code></a>.
      </p><p>
        Examples:
      </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>tbl_name</code></em> WHERE <em class="replaceable"><code>key_col</code></em> IS NULL;

SELECT * FROM <em class="replaceable"><code>tbl_name</code></em> WHERE <em class="replaceable"><code>key_col</code></em> &lt;=&gt; NULL;

SELECT * FROM <em class="replaceable"><code>tbl_name</code></em>
  WHERE <em class="replaceable"><code>key_col</code></em>=<em class="replaceable"><code>const1</code></em> OR <em class="replaceable"><code>key_col</code></em>=<em class="replaceable"><code>const2</code></em> OR <em class="replaceable"><code>key_col</code></em> IS NULL;
</pre><p>
        If a <code class="literal">WHERE</code> clause includes a
        <em class="replaceable"><code>col_name</code></em> <a href="functions.html#operator_is-null"><code class="literal">IS
        NULL</code></a> condition for a column that is declared as
        <code class="literal">NOT NULL</code>, that expression is optimized away.
        This optimization does not occur in cases when the column might
        produce <code class="literal">NULL</code> anyway; for example, if it comes
        from a table on the right side of a <code class="literal">LEFT
        JOIN</code>.
      </p><p>
        MySQL can also optimize the combination
        <code class="literal"><em class="replaceable"><code>col_name</code></em> =
        <em class="replaceable"><code>expr</code></em> OR
        <em class="replaceable"><code>col_name</code></em> IS NULL</code>, a form
        that is common in resolved subqueries.
        <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> shows
        <a href="optimization.html#jointype_ref_or_null"><code class="literal">ref_or_null</code></a> when this
        optimization is used.
      </p><p>
        This optimization can handle one <a href="functions.html#operator_is-null"><code class="literal">IS
        NULL</code></a> for any key part.
      </p><p>
        Some examples of queries that are optimized, assuming that there
        is an index on columns <code class="literal">a</code> and
        <code class="literal">b</code> of table <code class="literal">t2</code>:
      </p><pre class="programlisting">SELECT * FROM t1 WHERE t1.a=<em class="replaceable"><code>expr</code></em> OR t1.a IS NULL;

SELECT * FROM t1, t2 WHERE t1.a=t2.a OR t2.a IS NULL;

SELECT * FROM t1, t2
  WHERE (t1.a=t2.a OR t2.a IS NULL) AND t2.b=t1.b;

SELECT * FROM t1, t2
  WHERE t1.a=t2.a AND (t2.b=t1.b OR t2.b IS NULL);

SELECT * FROM t1, t2
  WHERE (t1.a=t2.a AND t2.a IS NULL AND ...)
  OR (t1.a=t2.a AND t2.a IS NULL AND ...);
</pre><p>
        <a href="optimization.html#jointype_ref_or_null"><code class="literal">ref_or_null</code></a> works by first
        doing a read on the reference key, and then a separate search
        for rows with a <code class="literal">NULL</code> key value.
      </p><p>
        Note that the optimization can handle only one
        <a href="functions.html#operator_is-null"><code class="literal">IS NULL</code></a> level. In the following
        query, MySQL uses key lookups only on the expression
        <code class="literal">(t1.a=t2.a AND t2.a IS NULL)</code> and is not able
        to use the key part on <code class="literal">b</code>:
      </p><pre class="programlisting">SELECT * FROM t1, t2
  WHERE (t1.a=t2.a AND t2.a IS NULL)
  OR (t1.b=t2.b AND t2.b IS NULL);
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="left-join-optimization"></a>7.2.10. <code class="literal">LEFT JOIN</code> and <code class="literal">RIGHT JOIN</code>
        Optimization</h3></div></div></div><a class="indexterm" name="id3169207"></a><a class="indexterm" name="id3169216"></a><p>
        MySQL implements an <code class="literal"><em class="replaceable"><code>A</code></em> LEFT
        JOIN <em class="replaceable"><code>B</code></em> join_condition</code> as
        follows:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Table <em class="replaceable"><code>B</code></em> is set to depend on table
            <em class="replaceable"><code>A</code></em> and all tables on which
            <em class="replaceable"><code>A</code></em> depends.
          </p></li><li><p>
            Table <em class="replaceable"><code>A</code></em> is set to depend on all
            tables (except <em class="replaceable"><code>B</code></em>) that are used
            in the <code class="literal">LEFT JOIN</code> condition.
          </p></li><li><p>
            The <code class="literal">LEFT JOIN</code> condition is used to decide
            how to retrieve rows from table
            <em class="replaceable"><code>B</code></em>. (In other words, any condition
            in the <code class="literal">WHERE</code> clause is not used.)
          </p></li><li><p>
            All standard join optimizations are performed, with the
            exception that a table is always read after all tables on
            which it depends. If there is a circular dependence, MySQL
            issues an error.
          </p></li><li><p>
            All standard <code class="literal">WHERE</code> optimizations are
            performed.
          </p></li><li><p>
            If there is a row in <em class="replaceable"><code>A</code></em> that
            matches the <code class="literal">WHERE</code> clause, but there is no
            row in <em class="replaceable"><code>B</code></em> that matches the
            <code class="literal">ON</code> condition, an extra
            <em class="replaceable"><code>B</code></em> row is generated with all
            columns set to <code class="literal">NULL</code>.
          </p></li><li><p>
            If you use <code class="literal">LEFT JOIN</code> to find rows that do
            not exist in some table and you have the following test:
            <code class="literal"><em class="replaceable"><code>col_name</code></em> IS
            NULL</code> in the <code class="literal">WHERE</code> part, where
            <em class="replaceable"><code>col_name</code></em> is a column that is
            declared as <code class="literal">NOT NULL</code>, MySQL stops
            searching for more rows (for a particular key combination)
            after it has found one row that matches the <code class="literal">LEFT
            JOIN</code> condition.
          </p></li></ul></div><p>
        The implementation of <code class="literal">RIGHT JOIN</code> is analogous
        to that of <code class="literal">LEFT JOIN</code> with the roles of the
        tables reversed.
      </p><p>
        <a class="indexterm" name="id3169443"></a>

        The join optimizer calculates the order in which tables should
        be joined. The table read order forced by <code class="literal">LEFT
        JOIN</code> or <code class="literal">STRAIGHT_JOIN</code> helps the
        join optimizer do its work much more quickly, because there are
        fewer table permutations to check. Note that this means that if
        you do a query of the following type, MySQL does a full scan on
        <code class="literal">b</code> because the <code class="literal">LEFT JOIN</code>
        forces it to be read before <code class="literal">d</code>:
      </p><pre class="programlisting">SELECT *
  FROM a JOIN b LEFT JOIN c ON (c.key=a.key) 
  LEFT JOIN d ON (d.key=a.key)
  WHERE b.key=d.key;
</pre><p>
        The fix in this case is reverse the order in which
        <code class="literal">a</code> and <code class="literal">b</code> are listed in the
        <code class="literal">FROM</code> clause:
      </p><pre class="programlisting">SELECT *
  FROM b JOIN a LEFT JOIN c ON (c.key=a.key) 
  LEFT JOIN d ON (d.key=a.key)
  WHERE b.key=d.key;
</pre><p>
        For a <code class="literal">LEFT JOIN</code>, if the
        <code class="literal">WHERE</code> condition is always false for the
        generated <code class="literal">NULL</code> row, the <code class="literal">LEFT
        JOIN</code> is changed to a normal join. For example, the
        <code class="literal">WHERE</code> clause would be false in the following
        query if <code class="literal">t2.column1</code> were
        <code class="literal">NULL</code>:
      </p><pre class="programlisting">SELECT * FROM t1 LEFT JOIN t2 ON (column1) WHERE t2.column2=5;
</pre><p>
        Therefore, it is safe to convert the query to a normal join:
      </p><pre class="programlisting">SELECT * FROM t1, t2 WHERE t2.column2=5 AND t1.column1=t2.column1;
</pre><p>
        <a class="indexterm" name="id3169595"></a>

        This can be made faster because MySQL can use table
        <code class="literal">t2</code> before table <code class="literal">t1</code> if
        doing so would result in a better query plan. To provide a hint
        about the table join order, use
        <code class="literal">STRAIGHT_JOIN</code>. (See
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax">Section 12.2.9, “<code class="literal">SELECT</code> Syntax”</a>.)
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="nested-loop-joins"></a>7.2.11. Nested-Loop Join Algorithms</h3></div></div></div><a class="indexterm" name="id3169641"></a><a class="indexterm" name="id3169650"></a><a class="indexterm" name="id3169662"></a><a class="indexterm" name="id3169672"></a><p>
        MySQL executes joins between tables using a nested-loop
        algorithm or variations on it.
      </p><p>
        <span class="bold"><strong>Nested-Loop Join Algorithm</strong></span>
      </p><p>
        A simple nested-loop join (NLJ) algorithm reads rows from the
        first table in a loop one at a time, passing each row to a
        nested loop that processes the next table in the join. This
        process is repeated as many times as there remain tables to be
        joined.
      </p><p>
        Assume that a join between three tables <code class="literal">t1</code>,
        <code class="literal">t2</code>, and <code class="literal">t3</code> is to be
        executed using the following join types:
      </p><pre class="programlisting">Table   Join Type
t1      range
t2      ref
t3      ALL
</pre><p>
        If a simple NLJ algorithm is used, the join would be processed
        like this:
      </p><pre class="programlisting">for each row in t1 matching range {
  for each row in t2 matching reference key {
    for each row in t3 {
      if row satisfies join conditions,
      send to client
    }
  }
}
</pre><p>
        Because the NLJ algorithm passes rows one at a time from outer
        loops to inner loops, tables processed in the inner loops
        typically are read many times.
      </p><p>
        <span class="bold"><strong>Block Nested-Loop Join
        Algorithm</strong></span>
      </p><p>
        A Block Nested-Loop (BNL) Join algorithm uses buffering of rows
        read in outer loops to reduce the number of times that tables in
        inner loops must be read. For example, if 10 rows are read into
        a buffer and the buffer is passed to the next inner loop, each
        row read in the inner loop can be compared against all 10 rows
        in the buffer. The reduces the number of times the inner table
        must be read by an order of magnitude.
      </p><p>
        MySQL uses join buffering under these conditions:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            The <a href="server-administration.html#sysvar_join_buffer_size"><code class="literal">join_buffer_size</code></a> system
            variable determines the size of each join buffer.
          </p></li><li><p>
            Join buffering can be used when the join is of type
            <a href="optimization.html#jointype_all"><code class="literal">ALL</code></a> or
            <a href="optimization.html#jointype_index"><code class="literal">index</code></a> (in other words,
            when no possible keys can be used, and a full scan is done,
            of either the data or index rows, respectively), or
            <a href="optimization.html#jointype_range"><code class="literal">range</code></a>. As of MySQL 6.0.9,
            use of buffering is extended to be applicable to outer joins
            and semi-joins, as described in
            <a href="optimization.html#bnl-bka-optimization" title="7.2.15. Block Nested-Loop and Batched Key Access Joins">Section 7.2.15, “Block Nested-Loop and Batched Key Access Joins”</a>.
          </p></li><li><p>
            One buffer is allocated for each join that can be buffered,
            so a given query might be processed using multiple join
            buffers.
          </p></li><li><p>
            A join buffer is never allocated for the first non-const
            table, even if it would be of type
            <a href="optimization.html#jointype_all"><code class="literal">ALL</code></a> or
            <a href="optimization.html#jointype_index"><code class="literal">index</code></a>.
          </p></li><li><p>
            A join buffer is allocated prior to executing the join and
            freed after the query is done.
          </p></li><li><p>
            Only columns of interest to the join are stored in the join
            buffer, not whole rows.
          </p></li></ul></div><p>
        For the example join described previously for the NLJ algorithm
        (without buffering), the join would be done as follow using join
        buffering:
      </p><pre class="programlisting">for each row in t1 matching range {
  for each row in t2 matching reference key {
    store used columns from t1, t2 in join buffer
    if buffer is full {
      for each row in t3 {
        for each t1, t2 combination in join buffer {
          if row satisfies join conditions,
          send to client
        }
      }
      empty buffer
    }
  }
}

if buffer is not empty {
  for each row in t3 {
    for each t1, t2 combination in join buffer {
      if row satisfies join conditions,
      send to client
    }
  }
}
</pre><p>
        If <em class="replaceable"><code>S</code></em> is the size of each stored
        <code class="literal">t1</code>, <code class="literal">t2</code> combination is the
        join buffer and <em class="replaceable"><code>C</code></em> is the number of
        combinations in the buffer, the number of times table
        <code class="literal">t3</code> is scanned is:
      </p><pre class="programlisting">(<em class="replaceable"><code>S</code></em> * <em class="replaceable"><code>C</code></em>)/join_buffer_size + 1
</pre><p>
        One implication is that the number of <code class="literal">t3</code>
        scans decreases as the value of
        <a href="server-administration.html#sysvar_join_buffer_size"><code class="literal">join_buffer_size</code></a> increases, up
        to the point when
        <a href="server-administration.html#sysvar_join_buffer_size"><code class="literal">join_buffer_size</code></a> is large
        enough to hold all previous row combinations. At that point,
        there is no speed to be gained by making it larger.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="nested-join-optimization"></a>7.2.12. Nested Join Optimization</h3></div></div></div><p>
        The syntax for expressing joins allows nested joins. The
        following discussion refers to the join syntax described in
        <a href="sql-syntax.html#join" title="12.2.9.1. JOIN Syntax">Section 12.2.9.1, “<code class="literal">JOIN</code> Syntax”</a>.
      </p><p>
        The syntax of <em class="replaceable"><code>table_factor</code></em> is
        extended in comparison with the SQL Standard. The latter accepts
        only <em class="replaceable"><code>table_reference</code></em>, not a list of
        them inside a pair of parentheses. This is a conservative
        extension if we consider each comma in a list of
        <em class="replaceable"><code>table_reference</code></em> items as equivalent
        to an inner join. For example:
      </p><pre class="programlisting">SELECT * FROM t1 LEFT JOIN (t2, t3, t4)
                 ON (t2.a=t1.a AND t3.b=t1.b AND t4.c=t1.c)
</pre><p>
        is equivalent to:
      </p><pre class="programlisting">SELECT * FROM t1 LEFT JOIN (t2 CROSS JOIN t3 CROSS JOIN t4)
                 ON (t2.a=t1.a AND t3.b=t1.b AND t4.c=t1.c)
</pre><p>
        In MySQL, <code class="literal">CROSS JOIN</code> is a syntactic
        equivalent to <code class="literal">INNER JOIN</code> (they can replace
        each other). In standard SQL, they are not equivalent.
        <code class="literal">INNER JOIN</code> is used with an
        <code class="literal">ON</code> clause; <code class="literal">CROSS JOIN</code> is
        used otherwise.
      </p><p>
        In general, parentheses can be ignored in join expressions
        containing only inner join operations. After removing
        parentheses and grouping operations to the left, the join
        expression:
      </p><pre class="programlisting">t1 LEFT JOIN (t2 LEFT JOIN t3 ON t2.b=t3.b OR t2.b IS NULL)
   ON t1.a=t2.a
</pre><p>
        transforms into the expression:
      </p><pre class="programlisting">(t1 LEFT JOIN t2 ON t1.a=t2.a) LEFT JOIN t3
    ON t2.b=t3.b OR t2.b IS NULL
</pre><p>
        Yet, the two expressions are not equivalent. To see this,
        suppose that the tables <code class="literal">t1</code>,
        <code class="literal">t2</code>, and <code class="literal">t3</code> have the
        following state:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Table <code class="literal">t1</code> contains rows
            <code class="literal">(1)</code>, <code class="literal">(2)</code>
          </p></li><li><p>
            Table <code class="literal">t2</code> contains row
            <code class="literal">(1,101)</code>
          </p></li><li><p>
            Table <code class="literal">t3</code> contains row
            <code class="literal">(101)</code>
          </p></li></ul></div><p>
        In this case, the first expression returns a result set
        including the rows <code class="literal">(1,1,101,101)</code>,
        <code class="literal">(2,NULL,NULL,NULL)</code>, whereas the second
        expression returns the rows <code class="literal">(1,1,101,101)</code>,
        <code class="literal">(2,NULL,NULL,101)</code>:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT *</code></strong>
    -&gt; <strong class="userinput"><code>FROM t1</code></strong>
    -&gt;      <strong class="userinput"><code>LEFT JOIN</code></strong>
    -&gt;      <strong class="userinput"><code>(t2 LEFT JOIN t3 ON t2.b=t3.b OR t2.b IS NULL)</code></strong>
    -&gt;      <strong class="userinput"><code>ON t1.a=t2.a;</code></strong>
+------+------+------+------+
| a    | a    | b    | b    |
+------+------+------+------+
|    1 |    1 |  101 |  101 |
|    2 | NULL | NULL | NULL |
+------+------+------+------+

mysql&gt; <strong class="userinput"><code>SELECT *</code></strong>
    -&gt; <strong class="userinput"><code>FROM (t1 LEFT JOIN t2 ON t1.a=t2.a)</code></strong>
    -&gt;      <strong class="userinput"><code>LEFT JOIN t3</code></strong>
    -&gt;      <strong class="userinput"><code>ON t2.b=t3.b OR t2.b IS NULL;</code></strong>
+------+------+------+------+
| a    | a    | b    | b    |
+------+------+------+------+
|    1 |    1 |  101 |  101 |
|    2 | NULL | NULL |  101 |
+------+------+------+------+
</pre><p>
        In the following example, an outer join operation is used
        together with an inner join operation:
      </p><pre class="programlisting">t1 LEFT JOIN (t2, t3) ON t1.a=t2.a
</pre><p>
        That expression cannot be transformed into the following
        expression:
      </p><pre class="programlisting">t1 LEFT JOIN t2 ON t1.a=t2.a, t3.
</pre><p>
        For the given table states, the two expressions return different
        sets of rows:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT *</code></strong>
    -&gt; <strong class="userinput"><code>FROM t1 LEFT JOIN (t2, t3) ON t1.a=t2.a;</code></strong>
+------+------+------+------+
| a    | a    | b    | b    |
+------+------+------+------+
|    1 |    1 |  101 |  101 |
|    2 | NULL | NULL | NULL |
+------+------+------+------+

mysql&gt; <strong class="userinput"><code>SELECT *</code></strong>
    -&gt; <strong class="userinput"><code>FROM t1 LEFT JOIN t2 ON t1.a=t2.a, t3;</code></strong>
+------+------+------+------+
| a    | a    | b    | b    |
+------+------+------+------+
|    1 |    1 |  101 |  101 |
|    2 | NULL | NULL |  101 |
+------+------+------+------+
</pre><p>
        Therefore, if we omit parentheses in a join expression with
        outer join operators, we might change the result set for the
        original expression.
      </p><p>
        More exactly, we cannot ignore parentheses in the right operand
        of the left outer join operation and in the left operand of a
        right join operation. In other words, we cannot ignore
        parentheses for the inner table expressions of outer join
        operations. Parentheses for the other operand (operand for the
        outer table) can be ignored.
      </p><p>
        The following expression:
      </p><pre class="programlisting">(t1,t2) LEFT JOIN t3 ON P(t2.b,t3.b)
</pre><p>
        is equivalent to this expression:
      </p><pre class="programlisting">t1, t2 LEFT JOIN t3 ON P(t2.b,t3.b)
</pre><p>
        for any tables <code class="literal">t1,t2,t3</code> and any condition
        <code class="literal">P</code> over attributes <code class="literal">t2.b</code> and
        <code class="literal">t3.b</code>.
      </p><p>
        Whenever the order of execution of the join operations in a join
        expression (<em class="replaceable"><code>join_table</code></em>) is not from
        left to right, we talk about nested joins. Consider the
        following queries:
      </p><pre class="programlisting">SELECT * FROM t1 LEFT JOIN (t2 LEFT JOIN t3 ON t2.b=t3.b) ON t1.a=t2.a
  WHERE t1.a &gt; 1

SELECT * FROM t1 LEFT JOIN (t2, t3) ON t1.a=t2.a
  WHERE (t2.b=t3.b OR t2.b IS NULL) AND t1.a &gt; 1
</pre><p>
        Those queries are considered to contain these nested joins:
      </p><pre class="programlisting">t2 LEFT JOIN t3 ON t2.b=t3.b
t2, t3
</pre><p>
        The nested join is formed in the first query with a left join
        operation, whereas in the second query it is formed with an
        inner join operation.
      </p><p>
        In the first query, the parentheses can be omitted: The
        grammatical structure of the join expression will dictate the
        same order of execution for join operations. For the second
        query, the parentheses cannot be omitted, although the join
        expression here can be interpreted unambiguously without them.
        (In our extended syntax the parentheses in <code class="literal">(t2,
        t3)</code> of the second query are required, although
        theoretically the query could be parsed without them: We still
        would have unambiguous syntactical structure for the query
        because <code class="literal">LEFT JOIN</code> and <code class="literal">ON</code>
        would play the role of the left and right delimiters for the
        expression <code class="literal">(t2,t3)</code>.)
      </p><p>
        The preceding examples demonstrate these points:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            For join expressions involving only inner joins (and not
            outer joins), parentheses can be removed. You can remove
            parentheses and evaluate left to right (or, in fact, you can
            evaluate the tables in any order).
          </p></li><li><p>
            The same is not true, in general, for outer joins or for
            outer joins mixed with inner joins. Removal of parentheses
            may change the result.
          </p></li></ul></div><a class="indexterm" name="id3170532"></a><a class="indexterm" name="id3170545"></a><p>
        Queries with nested outer joins are executed in the same
        pipeline manner as queries with inner joins. More exactly, a
        variation of the nested-loop join algorithm is exploited. Recall
        by what algorithmic schema the nested-loop join executes a
        query. Suppose that we have a join query over 3 tables
        <code class="literal">T1,T2,T3</code> of the form:
      </p><pre class="programlisting">SELECT * FROM T1 INNER JOIN T2 ON P1(T1,T2)
                 INNER JOIN T3 ON P2(T2,T3)
  WHERE P(T1,T2,T3).
</pre><p>
        Here, <code class="literal">P1(T1,T2)</code> and
        <code class="literal">P2(T3,T3)</code> are some join conditions (on
        expressions), whereas <code class="literal">P(t1,t2,t3)</code> is a
        condition over columns of tables <code class="literal">T1,T2,T3</code>.
      </p><p>
        The nested-loop join algorithm would execute this query in the
        following manner:
      </p><pre class="programlisting">FOR each row t1 in T1 {
  FOR each row t2 in T2 such that P1(t1,t2) {
    FOR each row t3 in T3 such that P2(t2,t3) {
      IF P(t1,t2,t3) {
         t:=t1||t2||t3; OUTPUT t;
      }
    }
  }
}
</pre><p>
        The notation <code class="literal">t1||t2||t3</code> means “<span class="quote">a row
        constructed by concatenating the columns of rows
        <code class="literal">t1</code>, <code class="literal">t2</code>, and
        <code class="literal">t3</code>.</span>” In some of the following
        examples, <code class="literal">NULL</code> where a row name appears means
        that <code class="literal">NULL</code> is used for each column of that
        row. For example, <code class="literal">t1||t2||NULL</code> means “<span class="quote">a
        row constructed by concatenating the columns of rows
        <code class="literal">t1</code> and <code class="literal">t2</code>, and
        <code class="literal">NULL</code> for each column of
        <code class="literal">t3</code>.</span>”
      </p><p>
        Now let's consider a query with nested outer joins:
      </p><pre class="programlisting">SELECT * FROM T1 LEFT JOIN
              (T2 LEFT JOIN T3 ON P2(T2,T3))
              ON P1(T1,T2)
  WHERE P(T1,T2,T3).
</pre><p>
        For this query, we modify the nested-loop pattern to get:
      </p><pre class="programlisting">FOR each row t1 in T1 {
  BOOL f1:=FALSE;
  FOR each row t2 in T2 such that P1(t1,t2) {
    BOOL f2:=FALSE;
    FOR each row t3 in T3 such that P2(t2,t3) {
      IF P(t1,t2,t3) {
        t:=t1||t2||t3; OUTPUT t;
      }
      f2=TRUE;
      f1=TRUE;
    }
    IF (!f2) {
      IF P(t1,t2,NULL) {
        t:=t1||t2||NULL; OUTPUT t;
      }
      f1=TRUE;
    }
  }
  IF (!f1) {
    IF P(t1,NULL,NULL) {
      t:=t1||NULL||NULL; OUTPUT t;
    }
  }
}
</pre><p>
        In general, for any nested loop for the first inner table in an
        outer join operation, a flag is introduced that is turned off
        before the loop and is checked after the loop. The flag is
        turned on when for the current row from the outer table a match
        from the table representing the inner operand is found. If at
        the end of the loop cycle the flag is still off, no match has
        been found for the current row of the outer table. In this case,
        the row is complemented by <code class="literal">NULL</code> values for
        the columns of the inner tables. The result row is passed to the
        final check for the output or into the next nested loop, but
        only if the row satisfies the join condition of all embedded
        outer joins.
      </p><p>
        In our example, the outer join table expressed by the following
        expression is embedded:
      </p><pre class="programlisting">(T2 LEFT JOIN T3 ON P2(T2,T3))
</pre><p>
        Note that for the query with inner joins, the optimizer could
        choose a different order of nested loops, such as this one:
      </p><pre class="programlisting">FOR each row t3 in T3 {
  FOR each row t2 in T2 such that P2(t2,t3) {
    FOR each row t1 in T1 such that P1(t1,t2) {
      IF P(t1,t2,t3) {
         t:=t1||t2||t3; OUTPUT t;
      }
    }
  }
}
</pre><p>
        For the queries with outer joins, the optimizer can choose only
        such an order where loops for outer tables precede loops for
        inner tables. Thus, for our query with outer joins, only one
        nesting order is possible. For the following query, the
        optimizer will evaluate two different nestings:
      </p><pre class="programlisting">SELECT * T1 LEFT JOIN (T2,T3) ON P1(T1,T2) AND P2(T1,T3)
  WHERE P(T1,T2,T3)
</pre><p>
        The nestings are these:
      </p><pre class="programlisting">FOR each row t1 in T1 {
  BOOL f1:=FALSE;
  FOR each row t2 in T2 such that P1(t1,t2) {
    FOR each row t3 in T3 such that P2(t1,t3) {
      IF P(t1,t2,t3) {
        t:=t1||t2||t3; OUTPUT t;
      }
      f1:=TRUE
    }
  }
  IF (!f1) {
    IF P(t1,NULL,NULL) {
      t:=t1||NULL||NULL; OUTPUT t;
    }
  }
}
</pre><p>
        and:
      </p><pre class="programlisting">FOR each row t1 in T1 {
  BOOL f1:=FALSE;
  FOR each row t3 in T3 such that P2(t1,t3) {
    FOR each row t2 in T2 such that P1(t1,t2) {
      IF P(t1,t2,t3) {
        t:=t1||t2||t3; OUTPUT t;
      }
      f1:=TRUE
    }
  }
  IF (!f1) {
    IF P(t1,NULL,NULL) {
      t:=t1||NULL||NULL; OUTPUT t;
    }
  }
}
</pre><p>
        In both nestings, <code class="literal">T1</code> must be processed in the
        outer loop because it is used in an outer join.
        <code class="literal">T2</code> and <code class="literal">T3</code> are used in an
        inner join, so that join must be processed in the inner loop.
        However, because the join is an inner join,
        <code class="literal">T2</code> and <code class="literal">T3</code> can be processed
        in either order.
      </p><p>
        When discussing the nested-loop algorithm for inner joins, we
        omitted some details whose impact on the performance of query
        execution may be huge. We did not mention so-called
        “<span class="quote">pushed-down</span>” conditions. Suppose that our
        <code class="literal">WHERE</code> condition
        <code class="literal">P(T1,T2,T3)</code> can be represented by a
        conjunctive formula:
      </p><pre class="programlisting">P(T1,T2,T2) = C1(T1) AND C2(T2) AND C3(T3).
</pre><p>
        In this case, MySQL actually uses the following nested-loop
        schema for the execution of the query with inner joins:
      </p><pre class="programlisting">FOR each row t1 in T1 such that C1(t1) {
  FOR each row t2 in T2 such that P1(t1,t2) AND C2(t2)  {
    FOR each row t3 in T3 such that P2(t2,t3) AND C3(t3) {
      IF P(t1,t2,t3) {
         t:=t1||t2||t3; OUTPUT t;
      }
    }
  }
}
</pre><p>
        You see that each of the conjuncts <code class="literal">C1(T1)</code>,
        <code class="literal">C2(T2)</code>, <code class="literal">C3(T3)</code> are pushed
        out of the most inner loop to the most outer loop where it can
        be evaluated. If <code class="literal">C1(T1)</code> is a very restrictive
        condition, this condition pushdown may greatly reduce the number
        of rows from table <code class="literal">T1</code> passed to the inner
        loops. As a result, the execution time for the query may improve
        immensely.
      </p><p>
        For a query with outer joins, the <code class="literal">WHERE</code>
        condition is to be checked only after it has been found that the
        current row from the outer table has a match in the inner
        tables. Thus, the optimization of pushing conditions out of the
        inner nested loops cannot be applied directly to queries with
        outer joins. Here we have to introduce conditional pushed-down
        predicates guarded by the flags that are turned on when a match
        has been encountered.
      </p><p>
        For our example with outer joins with:
      </p><pre class="programlisting">P(T1,T2,T3)=C1(T1) AND C(T2) AND C3(T3)
</pre><p>
        the nested-loop schema using guarded pushed-down conditions
        looks like this:
      </p><pre class="programlisting">FOR each row t1 in T1 such that C1(t1) {
  BOOL f1:=FALSE;
  FOR each row t2 in T2
      such that P1(t1,t2) AND (f1?C2(t2):TRUE) {
    BOOL f2:=FALSE;
    FOR each row t3 in T3
        such that P2(t2,t3) AND (f1&amp;&amp;f2?C3(t3):TRUE) {
      IF (f1&amp;&amp;f2?TRUE:(C2(t2) AND C3(t3))) {
        t:=t1||t2||t3; OUTPUT t;
      }
      f2=TRUE;
      f1=TRUE;
    }
    IF (!f2) {
      IF (f1?TRUE:C2(t2) &amp;&amp; P(t1,t2,NULL)) {
        t:=t1||t2||NULL; OUTPUT t;
      }
      f1=TRUE;
    }
  }
  IF (!f1 &amp;&amp; P(t1,NULL,NULL)) {
      t:=t1||NULL||NULL; OUTPUT t;
  }
}
</pre><p>
        In general, pushed-down predicates can be extracted from join
        conditions such as <code class="literal">P1(T1,T2)</code> and
        <code class="literal">P(T2,T3)</code>. In this case, a pushed-down
        predicate is guarded also by a flag that prevents checking the
        predicate for the <code class="literal">NULL</code>-complemented row
        generated by the corresponding outer join operation.
      </p><p>
        Note that access by key from one inner table to another in the
        same nested join is prohibited if it is induced by a predicate
        from the <code class="literal">WHERE</code> condition. (We could use
        conditional key access in this case, but this technique is not
        employed yet in MySQL 6.0.)
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="outer-join-simplification"></a>7.2.13. Outer Join Simplification</h3></div></div></div><p>
        Table expressions in the <code class="literal">FROM</code> clause of a
        query are simplified in many cases.
      </p><p>
        At the parser stage, queries with right outer joins operations
        are converted to equivalent queries containing only left join
        operations. In the general case, the conversion is performed
        according to the following rule:
      </p><pre class="programlisting">(T1, ...) RIGHT JOIN (T2,...) ON P(T1,...,T2,...) =
(T2, ...) LEFT JOIN (T1,...) ON P(T1,...,T2,...)
</pre><p>
        All inner join expressions of the form <code class="literal">T1 INNER JOIN T2
        ON P(T1,T2)</code> are replaced by the list
        <code class="literal">T1,T2</code>, <code class="literal">P(T1,T2)</code> being
        joined as a conjunct to the <code class="literal">WHERE</code> condition
        (or to the join condition of the embedding join, if there is
        any).
      </p><p>
        When the optimizer evaluates plans for join queries with outer
        join operation, it takes into consideration only the plans
        where, for each such operation, the outer tables are accessed
        before the inner tables. The optimizer options are limited
        because only such plans enables us to execute queries with outer
        joins operations by the nested loop schema.
      </p><p>
        Suppose that we have a query of the form:
      </p><pre class="programlisting">SELECT * T1 LEFT JOIN T2 ON P1(T1,T2)
  WHERE P(T1,T2) AND R(T2)
</pre><p>
        with <code class="literal">R(T2)</code> narrowing greatly the number of
        matching rows from table <code class="literal">T2</code>. If we executed
        the query as it is, the optimizer would have no other choice
        besides to access table <code class="literal">T1</code> before table
        <code class="literal">T2</code> that may lead to a very inefficient
        execution plan.
      </p><p>
        Fortunately, MySQL converts such a query into a query without an
        outer join operation if the <code class="literal">WHERE</code> condition
        is null-rejected. A condition is called null-rejected for an
        outer join operation if it evaluates to <code class="literal">FALSE</code>
        or to <code class="literal">UNKNOWN</code> for any
        <code class="literal">NULL</code>-complemented row built for the
        operation.
      </p><p>
        Thus, for this outer join:
      </p><pre class="programlisting">T1 LEFT JOIN T2 ON T1.A=T2.A
</pre><p>
        Conditions such as these are null-rejected:
      </p><pre class="programlisting">T2.B IS NOT NULL,
T2.B &gt; 3,
T2.C &lt;= T1.C,
T2.B &lt; 2 OR T2.C &gt; 1
</pre><p>
        Conditions such as these are not null-rejected:
      </p><pre class="programlisting">T2.B IS NULL,
T1.B &lt; 3 OR T2.B IS NOT NULL,
T1.B &lt; 3 OR T2.B &gt; 3
</pre><p>
        The general rules for checking whether a condition is
        null-rejected for an outer join operation are simple. A
        condition is null-rejected in the following cases:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            If it is of the form <code class="literal">A IS NOT NULL</code>, where
            <code class="literal">A</code> is an attribute of any of the inner
            tables
          </p></li><li><p>
            If it is a predicate containing a reference to an inner
            table that evaluates to <code class="literal">UNKNOWN</code> when one
            of its arguments is <code class="literal">NULL</code>
          </p></li><li><p>
            If it is a conjunction containing a null-rejected condition
            as a conjunct
          </p></li><li><p>
            If it is a disjunction of null-rejected conditions
          </p></li></ul></div><p>
        A condition can be null-rejected for one outer join operation in
        a query and not null-rejected for another. In the query:
      </p><pre class="programlisting">SELECT * FROM T1 LEFT JOIN T2 ON T2.A=T1.A
                 LEFT JOIN T3 ON T3.B=T1.B
  WHERE T3.C &gt; 0
</pre><p>
        the <code class="literal">WHERE</code> condition is null-rejected for the
        second outer join operation but is not null-rejected for the
        first one.
      </p><p>
        If the <code class="literal">WHERE</code> condition is null-rejected for
        an outer join operation in a query, the outer join operation is
        replaced by an inner join operation.
      </p><p>
        For example, the preceding query is replaced with the query:
      </p><pre class="programlisting">SELECT * FROM T1 LEFT JOIN T2 ON T2.A=T1.A
                 INNER JOIN T3 ON T3.B=T1.B
  WHERE T3.C &gt; 0
</pre><p>
        For the original query, the optimizer would evaluate plans
        compatible with only one access order
        <code class="literal">T1,T2,T3</code>. For the replacing query, it
        additionally considers the access sequence
        <code class="literal">T3,T1,T2</code>.
      </p><p>
        A conversion of one outer join operation may trigger a
        conversion of another. Thus, the query:
      </p><pre class="programlisting">SELECT * FROM T1 LEFT JOIN T2 ON T2.A=T1.A
                 LEFT JOIN T3 ON T3.B=T2.B
  WHERE T3.C &gt; 0
</pre><p>
        will be first converted to the query:
      </p><pre class="programlisting">SELECT * FROM T1 LEFT JOIN T2 ON T2.A=T1.A
                 INNER JOIN T3 ON T3.B=T2.B
  WHERE T3.C &gt; 0
</pre><p>
        which is equivalent to the query:
      </p><pre class="programlisting">SELECT * FROM (T1 LEFT JOIN T2 ON T2.A=T1.A), T3
  WHERE T3.C &gt; 0 AND T3.B=T2.B
</pre><p>
        Now the remaining outer join operation can be replaced by an
        inner join, too, because the condition
        <code class="literal">T3.B=T2.B</code> is null-rejected and we get a query
        without outer joins at all:
      </p><pre class="programlisting">SELECT * FROM (T1 INNER JOIN T2 ON T2.A=T1.A), T3
  WHERE T3.C &gt; 0 AND T3.B=T2.B
</pre><p>
        Sometimes we succeed in replacing an embedded outer join
        operation, but cannot convert the embedding outer join. The
        following query:
      </p><pre class="programlisting">SELECT * FROM T1 LEFT JOIN
              (T2 LEFT JOIN T3 ON T3.B=T2.B)
              ON T2.A=T1.A
  WHERE T3.C &gt; 0
</pre><p>
        is converted to:
      </p><pre class="programlisting">SELECT * FROM T1 LEFT JOIN
              (T2 INNER JOIN T3 ON T3.B=T2.B)
              ON T2.A=T1.A
  WHERE T3.C &gt; 0,
</pre><p>
        That can be rewritten only to the form still containing the
        embedding outer join operation:
      </p><pre class="programlisting">SELECT * FROM T1 LEFT JOIN
              (T2,T3)
              ON (T2.A=T1.A AND T3.B=T2.B)
  WHERE T3.C &gt; 0.
</pre><p>
        When trying to convert an embedded outer join operation in a
        query, we must take into account the join condition for the
        embedding outer join together with the <code class="literal">WHERE</code>
        condition. In the query:
      </p><pre class="programlisting">SELECT * FROM T1 LEFT JOIN
              (T2 LEFT JOIN T3 ON T3.B=T2.B)
              ON T2.A=T1.A AND T3.C=T1.C
  WHERE T3.D &gt; 0 OR T1.D &gt; 0
</pre><p>
        the <code class="literal">WHERE</code> condition is not null-rejected for
        the embedded outer join, but the join condition of the embedding
        outer join <code class="literal">T2.A=T1.A AND T3.C=T1.C</code> is
        null-rejected. So the query can be converted to:
      </p><pre class="programlisting">SELECT * FROM T1 LEFT JOIN
              (T2, T3)
              ON T2.A=T1.A AND T3.C=T1.C AND T3.B=T2.B
  WHERE T3.D &gt; 0 OR T1.D &gt; 0
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mrr-optimization"></a>7.2.14. Multi-Range Read Optimization</h3></div></div></div><a class="indexterm" name="id3171536"></a><a class="indexterm" name="id3171548"></a><p>
        The Multi-Range Read (MRR) optimization provides these benefits:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            MRR enables data rows to be accessed sequentially rather
            than in random order, based on index tuples. The server
            obtains a set of index tuples that satisfy the query
            conditions, sorts them according to data row ID order, and
            uses the sorted tuples to retrieve data rows in order. This
            makes data access more efficient and less expensive.
          </p></li><li><p>
            MRR enables batch processing of requests for key access for
            operations that require access to data rows via index
            tuples, such as range index scans and equi-joins that use an
            index for the join attribute. MRR iterates over a sequence
            of index ranges to obtain qualifying index tuples. As these
            results accumulate, they are used to access the
            corresponding data rows. It is not necessary to acquire all
            index tuples before starting to read data rows.
          </p></li></ul></div><p>
        The following scenarios illustrate when MRR optimization can be
        advantageous:
      </p><p>
        Scenario A: MRR can be used for <code class="literal">MyISAM</code> tables
        for index range scans and equi-join operations.
      </p><div class="orderedlist"><ol type="1"><li><p>
            A portion of the index tuples are accumulated in a buffer.
          </p></li><li><p>
            The tuples in the buffer are sorted by their data row ID.
          </p></li><li><p>
            Data rows are accessed according to the sorted index tuple
            sequence.
          </p></li></ol></div><p>
        Scenario B: MRR can be used for <code class="literal">NDB</code>
        tables for multiple-range index scans or when performing an
        equi-join by an attribute.
      </p><div class="orderedlist"><ol type="1"><li><p>
            A portion of ranges, possibly single-key ranges, is
            accumulated in a buffer on the central node where the query
            is submitted.
          </p></li><li><p>
            The ranges are sent to the execution nodes that access data
            rows.
          </p></li><li><p>
            The accessed rows are packed into packages and sent back to
            the central node.
          </p></li><li><p>
            The received packages with data rows are placed in a buffer.
          </p></li><li><p>
            Data rows are read from the buffer.
          </p></li></ol></div><p>
        When MRR is used, the <code class="literal">Extra</code> column in
        <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output shows
        <code class="literal">Using MRR</code>.
      </p><p>
        <code class="literal">MyISAM</code> does not use MRR if full table rows
        need not be accessed to produce the query result. This is the
        case if results can be produced entirely on the basis on
        information in the index tuples; MRR provides no benefit.
      </p><p>
        Example query for which MRR can be used, assuming that there is
        an index on <code class="literal">(<em class="replaceable"><code>key_part1</code></em>,
        <em class="replaceable"><code>key_part2</code></em>)</code>:
      </p><pre class="programlisting">SELECT * FROM t
  WHERE <em class="replaceable"><code>key_part1</code></em> &gt;= 1000 AND <em class="replaceable"><code>key_part1</code></em> &lt; 2000
  AND <em class="replaceable"><code>key_part2</code></em> = 10000;
</pre><p>
        The index consists of tuples of
        <code class="literal">(<em class="replaceable"><code>key_part1</code></em>,
        <em class="replaceable"><code>key_part2</code></em>)</code> values, ordered
        first by <em class="replaceable"><code>key_part1</code></em> and then by
        <em class="replaceable"><code>key_part2</code></em>.
      </p><p>
        Without MRR, an index scan covers all index tuples for the
        <em class="replaceable"><code>key_part1</code></em> range from 1000 up to 2000,
        regardless of the <em class="replaceable"><code>key_part2</code></em> value in
        these tuples. The scan does extra work to the extent that tuples
        in the range contain <em class="replaceable"><code>key_part2</code></em> values
        other than 10000.
      </p><p>
        With MRR, the scan is broken up into multiple ranges, each for a
        single value of <em class="replaceable"><code>key_part1</code></em> (1000,
        1001, ... , 1999). Each of these scans need look only for tuples
        with <em class="replaceable"><code>key_part2</code></em> = 10000. If the index
        contains many tuples for which
        <em class="replaceable"><code>key_part2</code></em> is not 10000, MRR results
        in many fewer index tuples being read.
      </p><p>
        To express this using interval notation, the non-MRR scan must
        examine the index range <code class="literal">[{1000, 10000}, {2000,
        MIN_INT})</code>, which may include many tuples other than
        those for which <em class="replaceable"><code>key_part2</code></em> = 10000.
        The MRR scan examines multiple single-point intervals
        <code class="literal">[{1000, 10000}]</code>, ..., <code class="literal">[{1999,
        10000}]</code>, which includes only tuples with
        <em class="replaceable"><code>key_part2</code></em> = 10000.
      </p><p>
        The <a href="server-administration.html#sysvar_optimizer_use_mrr"><code class="literal">optimizer_use_mrr</code></a> system
        variable provides an interface to the use of MRR optimization.
        It has supported values of <code class="literal">force</code> and
        <code class="literal">disable</code>. The default value is
        <code class="literal">force</code>. That is, MRR is used whenever it is
        applicable.
      </p><p>
        For MRR, a storage engine uses the value of the
        <a href="server-administration.html#sysvar_read_rnd_buffer_size"><code class="literal">read_rnd_buffer_size</code></a> system
        variable as a guideline for how much memory it can allocate for
        its buffer. The engine uses up to
        <a href="server-administration.html#sysvar_read_rnd_buffer_size"><code class="literal">read_rnd_buffer_size</code></a> bytes and
        determines the number of ranges to process in a single pass.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="bnl-bka-optimization"></a>7.2.15. Block Nested-Loop and Batched Key Access Joins</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="optimization.html#join-buffer-management">7.2.15.1. Join Buffer Management for Block Nested-Loop and Batched Key Access
          Algorithms</a></span></dt><dt><span class="section"><a href="optimization.html#bnl-optimization">7.2.15.2. Block Nested-Loop Algorithm for Outer Joins and Semi-Joins</a></span></dt><dt><span class="section"><a href="optimization.html#bka-optimization">7.2.15.3. Batched Key Access Joins</a></span></dt></dl></div><a class="indexterm" name="id3171945"></a><a class="indexterm" name="id3171958"></a><a class="indexterm" name="id3171970"></a><a class="indexterm" name="id3171983"></a><p>
        Starting from MySQL 6.0.9, a new algorithm that uses both index
        access to the joined table and a join buffer has been
        implemented. It is called the Batched Key Access (BKA) Join
        algorithm. The algorithm supports inner join, outer join and
        semi-join operations, including nested outer joins and nested
        semi-joins. Also, the Block Nested-Loop (BNL) Join algorithm
        previously used only for inner joins has been extended and can
        be employed for outer join and semi-join operations, including
        nested outer joins and nested semi-joins.
      </p><p>
        For BKA, benefits include improved join performance for
        <code class="literal">NDBCLUSTER</code> due to a reduced number
        of round trips, and for disk-based storage engines such as
        <code class="literal">MyISAM</code>,
        <code class="literal">InnoDB</code>,
        <code class="literal">Falcon</code>, and
        <code class="literal">Maria</code> due to more efficient table
        scanning.
      </p><p>
        The following sections discuss the new join buffer management
        that underlies the reimplementation of the original BNL
        algorithm, the extended BNL algorithm, the BKA algorithm, and
        describe how these algorithms operate.
      </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="join-buffer-management"></a>7.2.15.1. Join Buffer Management for Block Nested-Loop and Batched Key Access
          Algorithms</h4></div></div></div><p>
          Starting from version 6.0.9, MySQL Server can employ join
          buffers to execute not only inner joins without index access
          to the inner table, but also outer joins and semi-joins that
          appear after subquery flattening. Moreover, a join buffer now
          can be effectively used when there is an index access to the
          inner table.
        </p><p>
          The new join buffer management code slightly more efficiently
          utilizes join buffer space when storing the values of the
          interesting row columns: No additional bytes are allocated in
          buffers for a row column if its value is
          <code class="literal">NULL</code>, and the minimum number of bytes is
          allocated for any value of the
          <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">VARCHAR</code></a> type.
        </p><p>
          The new code supports two types of buffers, regular and
          incremental. Suppose that join buffer <code class="literal">B1</code> is
          employed to join tables <code class="literal">t1</code> and
          <code class="literal">t2</code> and the result of this operation is
          joined with table <code class="literal">t3</code> using join buffer
          <code class="literal">B2</code>:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              A regular join buffer contains columns from each join
              operand. If <code class="literal">B2</code> is a regular join
              buffer, each row <em class="replaceable"><code>r</code></em> put into
              <code class="literal">B2</code> is composed of the columns of a row
              <em class="replaceable"><code>r1</code></em> from <code class="literal">B1</code>
              and the interesting columns of a matching row
              <em class="replaceable"><code>r2</code></em> from table
              <code class="literal">t2</code>.
            </p></li><li><p>
              An incremental join buffer contains only columns from rows
              of the table produced by the second join operand. That is,
              it is incremental to a row from the first operand buffer.
              If <code class="literal">B2</code> is an incremental join buffer,
              the interesting columns of the row
              <em class="replaceable"><code>r2</code></em> are stored with a link to
              the row <em class="replaceable"><code>r1</code></em> from
              <code class="literal">B1</code>.
            </p></li></ul></div><p>
          Incremental join buffers are always incremental relative to a
          join buffer from an earlier join operation, so the buffer from
          the first join operation is always a regular buffer. In the
          example just given, the buffer <code class="literal">B1</code> used to
          join tables <code class="literal">t1</code> and <code class="literal">t2</code>
          must be a regular buffer.
        </p><p>
          Each row of the incremental buffer used for a join operation
          contains only the interesting columns of a row from the table
          to be joined. These columns are augmented with a reference to
          the interesting columns of the matched row from the table
          produced by the first join operand. Several rows in the
          incremental buffer can refer to the same row
          <em class="replaceable"><code>r</code></em> whose columns are stored in the
          previous join buffers insofar as all these rows match row
          <em class="replaceable"><code>r</code></em>.
        </p><p>
          Incremental buffers enable less frequent copying of columns
          from buffers used for previous join operations. This provides
          a savings in buffer space because in the general case a row
          produced by the first join operand can be matched by several
          rows produced by the second join operand. It is unnecessary to
          make several copies of a row from the first operand.
          Incremental buffers also provide a savings in processing time
          due to the reduction in copying time.
        </p><p>
          The <a href="server-administration.html#sysvar_join_cache_level"><code class="literal">join_cache_level</code></a> system
          variable controls for which join operations of which types
          join buffers are supposed to be used. The allowable
          <a href="server-administration.html#sysvar_join_cache_level"><code class="literal">join_cache_level</code></a> values are
          shown in the following table.
        </p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Option</strong></span></td><td><span class="bold"><strong>Description</strong></span></td></tr><tr><td><code class="literal">0</code></td><td>No join buffer is used for any join operation. This setting can be
                  useful to for assessing baseline join performance in
                  comparison to performance with non-zero values that
                  enable use of join buffering.</td></tr><tr><td><code class="literal">1</code></td><td>This is the default value. Join buffers are employed exactly in the same
                  cases as in versions of MySQL prior to 6.0.9: They are
                  used only for inner joins that are executed by the
                  original Block Nested-Loop (BNL) join algorithm. When
                  this algorithm is applied, rows of the inner table are
                  accessed through a table scan, a plain index scan, or
                  a range index scan.</td></tr><tr><td><code class="literal">2</code></td><td>The server employs an incremental join buffer for a join operation if
                  its first operand is produced by a join operation that
                  uses a join buffer itself.</td></tr><tr><td><code class="literal">3</code></td><td>The BNL algorithm is used for an outer join and semi-join operation with
                  one inner table, and for inner joins.</td></tr><tr><td><code class="literal">4</code></td><td>The BNL algorithm uses incremental buffers for inner tables. In this
                  case, the BNL algorithm can be used for nested outer
                  joins and semi-joins (outer joins and semi-joins with
                  several inner tables). Such an operation can be
                  executed only if incremental join buffers are used to
                  join all inner tables but the first one.</td></tr><tr><td><code class="literal">5</code></td><td>The BKA algorithm uses regular buffers for any join operation with index
                  access to the joined table.</td></tr><tr><td><code class="literal">6</code></td><td>The BKA algorithm uses incremental buffers for any join operation with
                  index access to the joined table.</td></tr><tr><td><code class="literal">7</code></td><td>The BKA algorithm uses regular join buffers with a hash table.</td></tr><tr><td><code class="literal">8</code></td><td>The BKA algorithm uses incremental join buffers with a hash table.</td></tr></tbody></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="bnl-optimization"></a>7.2.15.2. Block Nested-Loop Algorithm for Outer Joins and Semi-Joins</h4></div></div></div><a class="indexterm" name="id3172520"></a><a class="indexterm" name="id3172533"></a><p>
          As of MySQL 6.0.9, the original implementation of the BNL
          algorithm has been extended to support outer join and
          semi-join operations.
        </p><p>
          When any of these operations is executed with a join buffer,
          each row put into the buffer is supplied with a match flag.
        </p><p>
          If an outer join operation is executed using a join buffer,
          each row of the table produced by the second operand is
          checked for a match against each row in the join buffer. When
          a match is found, a new extended row is formed (the original
          row plus columns from the second operand) and sent for further
          extensions by the remaining join operations. In addition, the
          match flag of the matched row in the buffer is enabled. After
          all rows of the table to be joined have been examined, the
          join buffer is scanned. Each row from the buffer that does not
          have its match flag enabled is extended by
          <code class="literal">NULL</code> complements (<code class="literal">NULL</code>
          values for each column in the second operand) and sent for
          further extensions by the remaining join operations.
        </p><p>
          If a join buffer is used for a semi-join operation, only the
          first extension by a row from the inner table is sent for
          further extensions by the remaining join operations.
        </p><p>
          If the value of
          <a href="server-administration.html#sysvar_join_cache_level"><code class="literal">join_cache_level</code></a> is 3, the
          BNL algorithm is used for an outer join and semi-join
          operation with one inner table.
        </p><p>
          If the value of
          <a href="server-administration.html#sysvar_join_cache_level"><code class="literal">join_cache_level</code></a> is 4, the
          BNL algorithm uses incremental buffers for inner tables. In
          this case, the BNL algorithm can be used for nested outer
          joins and semi-joins (outer joins and semi-joins with several
          inner tables). Such an operation can be executed only if
          incremental join buffers are used to join all inner tables but
          the first one.
        </p><p>
          In <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output, use of BNL
          for a table is signified when the <code class="literal">Extra</code>
          value contains <code class="literal">Using join buffer</code> and the
          <code class="literal">type</code> value is
          <a href="optimization.html#jointype_all"><code class="literal">ALL</code></a>,
          <a href="optimization.html#jointype_index"><code class="literal">index</code></a>, or
          <a href="optimization.html#jointype_range"><code class="literal">range</code></a>.
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="bka-optimization"></a>7.2.15.3. Batched Key Access Joins</h4></div></div></div><a class="indexterm" name="id3172686"></a><a class="indexterm" name="id3172699"></a><p>
          MySQL 6.0.9 introduces a new algorithm to join tables called
          the Batched Key Access (BKA) join algorithm. BKA can be
          applied when there is an index access to the table produced by
          the second join operand. Like the BNL join algorithm, the BKA
          join algorithm employs a join buffer to accumulate the
          interesting columns of the rows produced by the first operand
          of the join operation. Then the BKA algorithm builds keys to
          access the table to be joined for all rows in the buffer and
          submits these keys in a batch to the database engine for index
          lookups. Each key in the batch is supplemented with a
          reference to the row in the join buffer from which the key
          originates. This reference is called the key/range
          association. The keys are submitted to the engine through the
          Multi-Range Read (MRR) interface (see
          <a href="optimization.html#mrr-optimization" title="7.2.14. Multi-Range Read Optimization">Section 7.2.14, “Multi-Range Read Optimization”</a>). After submission of the
          keys, the MMR engine functions perform lookups in the index in
          an optimal way, fetching the rows of the joined table found by
          these keys, and starts feeding the BKA join algorithm with
          matching rows.
        </p><p>
          For BKA to be used,
          <a href="server-administration.html#sysvar_join_cache_level"><code class="literal">join_cache_level</code></a> must have a
          value from 5 to 8 (as described shortly) and the value of the
          <a href="server-administration.html#sysvar_optimizer_use_mrr"><code class="literal">optimizer_use_mrr</code></a> system
          variable must not be <code class="literal">'disabled'</code>.
        </p><p>
          Each matching row is coupled with a reference to a row in the
          join buffer. This is exactly the reference passed with the key
          by which the matching row has been fetched. so this is the
          reference to the matched row in the join buffer. The BKA join
          algorithm effectively uses this reference to build the joined
          rows from the matched and the matching rows.
        </p><p>
          There are two scenarios by which MRR functions execute:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              The first scenario is used for remote storage engines such
              as <code class="literal">NDBCLUSTER</code>. A package of
              keys for a portion of rows from the join buffer, together
              with their associations, is sent by MySQL Server to NDB
              nodes. In return, the Server receives a package (or
              several packages) of matching rows coupled with
              corresponding associations. The BKA join algorithm takes
              these rows and builds new joined rows. Then a new portion
              of keys are sent to NDB nodes and the rows from the
              returned packages are used to build new joined rows. The
              process continues until the last keys from the join buffer
              are sent to NDB nodes and the MySQL server receives and
              joins all rows matching these keys. This improves
              performance because the fewer packages with keys the MySQL
              Server sends to the Cluster, the fewer round trips between
              the server and the Cluster nodes are required to perform
              the join operation.
            </p></li><li><p>
              The second scenario is used for conventional disk-based
              storage engine such as
              <code class="literal">MyISAM</code>,
              <code class="literal">InnoDB</code>,
              <code class="literal">Falcon</code>, and
              <code class="literal">Maria</code>. For these engines,
              usually the keys for all rows from the join buffer are
              submitted to the MRR interface at once. Engine-specific
              MRR functions perform index lookups for the submitted
              keys, get row IDs (or primary keys) from them, and then
              fetch rows for all these selected row IDs one by one by
              request from BKA algorithm. Every row is returned with an
              association reference that enables access to the matched
              row in the join buffer. The row are fetched by the MRR
              functions in an optimal way: They are fetched in the row
              ID (primary key) order. This improves performance because
              reads are in disk order rather than random order.
            </p></li></ul></div><p>
          With the second scenario, a portion of the join buffer is
          reserved to store row IDs (primary keys) selected by index
          lookups and passed as a parameter to the MMR functions.
        </p><p>
          There is no special buffer to store keys built for rows from
          the join buffer. Instead, a function that builds the key for
          the next row in the buffer is passed as a parameter to the MRR
          functions.
        </p><p>
          If the value of
          <a href="server-administration.html#sysvar_join_cache_level"><code class="literal">join_cache_level</code></a> is 5 or 6,
          the BKA algorithm is used for any join operation with index
          access to the joined table. Level 5 uses regular join buffers.
          Level 6 uses incremental join buffers.
        </p><p>
          The BKA algorithm supports outer join as well as semi-join
          operations. For outer joins and semi-joins with one inner
          table, both regular and incremental join buffers can be used.
          For nested outer joins and semi-joins, only incremental join
          buffers can be used.
        </p><p>
          Currently, the <code class="literal">Falcon</code> storage
          engine cannot use associations passed to it together with
          keys. <code class="literal">Falcon</code> builds a bitmap of
          rows for keys and uses this bitmap to access matching rows, so
          it returns a matching row without a reference to the matched
          row. To quickly find all matched rows in the join buffer, a
          hash table of the keys passed to the MRR interface is built at
          the very end of the join buffer.
        </p><p>
          Any row in the join buffer with key
          <em class="replaceable"><code>k</code></em> is linked to a list of rows with
          the same key. The list is attached to the key that is stored
          in the hash table.
        </p><p>
          If the average frequency of keys in the join buffer is 2 or
          greater, it makes sense to use a join buffer with a hash table
          with the <code class="literal">MyISAM</code> or
          <code class="literal">InnoDB</code> storage engine as well. In
          this case, fewer keys are passed for lookups.
        </p><p>
          To use a join buffer with hash table, set the value of
          <a href="server-administration.html#sysvar_join_cache_level"><code class="literal">join_cache_level</code></a> to 7 or 8.
          Level 7 is used for regular join buffers with all interesting
          columns. Level 8 is used for incremental join buffers.
        </p><p>
          In <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output, use of BKA
          for a table is signified when the <code class="literal">Extra</code>
          value contains <code class="literal">Using join buffer</code> and the
          <code class="literal">type</code> value is
          <a href="optimization.html#jointype_ref"><code class="literal">ref</code></a> or
          <a href="optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a>.
        </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="semi-joins"></a>7.2.16. Semi-Join Strategies</h3></div></div></div><a class="indexterm" name="id3173058"></a><p>
        For an inner join between two tables, the join returns a row
        from one table as many times as there are matches in the other
        table. But for some questions, the only information that matters
        is whether there is a match, not the number of matches. Suppose
        that there are tables named <code class="literal">class</code> and
        <code class="literal">roster</code> that list classes in a course
        curriculum and class rosters (students enrolled in each class),
        respectively. To list the classes that actually have students
        enrolled, you could use this join:
      </p><pre class="programlisting">SELECT class.class_num, class.class_name
FROM class INNER JOIN roster
WHERE class.class_num = roster.class_num;
</pre><p>
        However, the result lists each class once for each enrolled
        student. For the question being asked, this is unnecessary
        duplication of information.
      </p><p>
        Assuming that <code class="literal">class_num</code> is a primary key in
        the <code class="literal">class</code> table, duplicate suppression could
        be achieved by using
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT
        DISTINCT</code></a>, but it is inefficient to generate all
        matching rows first only to eliminate duplicates later.
      </p><p>
        The same duplicate-free result can be obtained by using a
        subquery:
      </p><pre class="programlisting">SELECT class_num, class_name
FROM class
WHERE class_num IN (SELECT class_num FROM roster);
</pre><p>
        Here, the optimizer can recognize that the <code class="literal">IN</code>
        clause requires the subquery to return only one instance of each
        class number from the <code class="literal">roster</code> table. In this
        case, the query can be executed as a
        <em class="firstterm">semi-join</em>—that is, an operation
        that returns only one instance of each row in
        <code class="literal">class</code> that is matched by rows in
        <code class="literal">roster</code>.
      </p><p>
        In MySQL, a subquery must satisfy these criteria to be handled
        as a semi-join:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            It must be an <code class="literal">IN</code> (or
            <code class="literal">=ANY</code>) subquery that appears at the top
            level of the <code class="literal">WHERE</code> or
            <code class="literal">ON</code> clause, possibly as a term in an
            <code class="literal">AND</code> expression. For example:
          </p><pre class="programlisting">SELECT ...
FROM ot1, ...
WHERE (oe1, ...) IN (SELECT ie1, ... FROM it1, ... WHERE ...);
</pre><p>
            Here, <code class="literal">ot_<em class="replaceable"><code>i</code></em></code> and
            <code class="literal">it_<em class="replaceable"><code>i</code></em></code> represent
            tables in the outer and inner parts of the query, and
            <code class="literal">oe_<em class="replaceable"><code>i</code></em></code> and
            <code class="literal">ie_<em class="replaceable"><code>i</code></em></code> represent
            expressions that refer to columns in the outer and inner
            tables.
          </p></li><li><p>
            It must be a single <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
            without <a href="sql-syntax.html#union" title="12.2.9.3. UNION Syntax"><code class="literal">UNION</code></a> constructs.
          </p></li><li><p>
            It must not contain a <code class="literal">GROUP BY</code> or
            <code class="literal">HAVING</code> clause or aggregate functions.
          </p></li><li><p>
            It must not have <code class="literal">ORDER BY</code> with
            <code class="literal">LIMIT</code>.
          </p></li><li><p>
            The number of outer and inner tables together must be less
            than the maximum number of tables allowed in a join.
          </p></li></ul></div><p>
        The subquery may be correlated or uncorrelated.
        <code class="literal">DISTINCT</code> is allowed, as is
        <code class="literal">LIMIT</code> unless <code class="literal">ORDER BY</code> is
        also used.
      </p><p>
        If a subquery meets the preceding criteria, MySQL converts it to
        a semi-join and makes a cost-based choice from these strategies:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Convert the subquery to a join, or use table pullout and run
            the query as an inner join between subquery tables and outer
            tables. Table pullout pulls a table out from the subquery to
            the outer query.
          </p></li><li><p>
            Duplicate Weedout: Run the semi-join as if it was a join and
            remove duplicate records using a temporary table.
          </p></li><li><p>
            FirstMatch: When scanning the inner tables for row
            combinations and there are multiple instances of a given
            value group, choose one rather than returning them all. This
            "shortcuts" scanning and eliminates production of
            unnecessary rows.
          </p></li><li><p>
            LooseScan: Scan a subquery table using an index that enables
            a single value to be chosen from each subquery's value
            group.
          </p></li><li><p>
            Materialize the subquery into a temporary table with an
            index and use it to perform a join. The temporary table
            index is used to remove duplicates and when joining with the
            outer tables.
          </p></li></ul></div><p>
        Each of these strategies except Duplicate Weedout can be enabled
        or disabled using the
        <a href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a> system
        variable. See <a href="optimization.html#switchable-optimizations" title="7.2.22. Using optimizer_switch to Control the
        Optimizer">Section 7.2.22, “Using <code class="literal">optimizer_switch</code> to Control the
        Optimizer”</a>.
      </p><p>
        The use of semi-join strategies is indicated in
        <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output as follows:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Semi-joined tables show up in the outer select.
            <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN
            EXTENDED</code></a> plus <a href="sql-syntax.html#show-warnings" title="12.5.6.40. SHOW WARNINGS Syntax"><code class="literal">SHOW
            WARNINGS</code></a> shows the rewritten query, which displays
            the semi-join structure. From this you can get an idea about
            which tables were pulled out of the semi-join. If a subquery
            was converted to a semi-join, you will see that the subquery
            predicate is gone and its tables and
            <code class="literal">WHERE</code> clause were merged into the outer
            query join list and <code class="literal">WHERE</code> clause.
          </p></li><li><p>
            Temporary table use for Duplicate Weedout is indicated by
            <code class="literal">Start temporary</code> and <code class="literal">End
            temporary</code> in the <code class="literal">Extra</code> column.
            Tables that were not pulled out and are in the range of
            <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output rows covered
            by <code class="literal">Start temporary</code> and <code class="literal">End
            temporary</code> will have their <code class="literal">rowid</code>
            in the temporary table.
          </p></li><li><p>
            <code class="literal">FirstMatch(<em class="replaceable"><code>tbl_name</code></em>)</code>
            in the <code class="literal">Extra</code> column indicates join
            shortcutting.
          </p></li><li><p>
            <code class="literal">LooseScan(<em class="replaceable"><code>m</code></em>..<em class="replaceable"><code>n</code></em>)</code>
            in the <code class="literal">Extra</code> column indicates use of the
            LooseScan strategy. <em class="replaceable"><code>m</code></em> and
            <em class="replaceable"><code>n</code></em> are key part numbers.
          </p></li><li><p>
            Temporary table use for materialization is indicated by
            <code class="literal">Start materialize</code>, <code class="literal">End
            materialize</code>, and <code class="literal">Scan</code> in the
            <code class="literal">Extra</code> column.
          </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="order-by-optimization"></a>7.2.17. <code class="literal">ORDER BY</code> Optimization</h3></div></div></div><p>
        In some cases, MySQL can use an index to satisfy an
        <code class="literal">ORDER BY</code> clause without doing any extra
        sorting.
      </p><p>
        The index can also be used even if the <code class="literal">ORDER
        BY</code> does not match the index exactly, as long as all of
        the unused portions of the index and all the extra
        <code class="literal">ORDER BY</code> columns are constants in the
        <code class="literal">WHERE</code> clause. The following queries use the
        index to resolve the <code class="literal">ORDER BY</code> part:
      </p><pre class="programlisting">SELECT * FROM t1 
  ORDER BY <em class="replaceable"><code>key_part1</code></em>,<em class="replaceable"><code>key_part2</code></em>,... ;
    
SELECT * FROM t1 
  WHERE <em class="replaceable"><code>key_part1</code></em>=<em class="replaceable"><code>constant</code></em> 
  ORDER BY <em class="replaceable"><code>key_part2</code></em>;
    
SELECT * FROM t1 
  ORDER BY <em class="replaceable"><code>key_part1</code></em> DESC, <em class="replaceable"><code>key_part2</code></em> DESC;
    
SELECT * FROM t1
  WHERE <em class="replaceable"><code>key_part1</code></em>=1 
  ORDER BY <em class="replaceable"><code>key_part1</code></em> DESC, <em class="replaceable"><code>key_part2</code></em> DESC;
</pre><p>
        In some cases, MySQL <span class="emphasis"><em>cannot</em></span> use indexes to
        resolve the <code class="literal">ORDER BY</code>, although it still uses
        indexes to find the rows that match the <code class="literal">WHERE</code>
        clause. These cases include the following:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            You use <code class="literal">ORDER BY</code> on different keys:
          </p><pre class="programlisting">SELECT * FROM t1 ORDER BY <em class="replaceable"><code>key1</code></em>, <em class="replaceable"><code>key2</code></em>;
</pre></li><li><p>
            You use <code class="literal">ORDER BY</code> on non-consecutive parts
            of a key:
          </p><pre class="programlisting">SELECT * FROM t1 WHERE <em class="replaceable"><code>key2</code></em>=<em class="replaceable"><code>constant</code></em> ORDER BY <em class="replaceable"><code>key_part2</code></em>;
</pre></li><li><p>
            You mix <code class="literal">ASC</code> and <code class="literal">DESC</code>:
          </p><pre class="programlisting">SELECT * FROM t1 ORDER BY <em class="replaceable"><code>key_part1</code></em> DESC, <em class="replaceable"><code>key_part2</code></em> ASC;
</pre></li><li><p>
            The key used to fetch the rows is not the same as the one
            used in the <code class="literal">ORDER BY</code>:
          </p><pre class="programlisting">SELECT * FROM t1 WHERE <em class="replaceable"><code>key2</code></em>=<em class="replaceable"><code>constant</code></em> ORDER BY <em class="replaceable"><code>key1</code></em>;
</pre></li><li><p>
            You use <code class="literal">ORDER BY</code> with an expression that
            includes terms other than the key column name:
          </p><pre class="programlisting">SELECT * FROM t1 ORDER BY ABS(<em class="replaceable"><code>key</code></em>);
SELECT * FROM t1 ORDER BY -<em class="replaceable"><code>key</code></em>;
</pre></li><li><p>
            You are joining many tables, and the columns in the
            <code class="literal">ORDER BY</code> are not all from the first
            non-constant table that is used to retrieve rows. (This is
            the first table in the
            <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output that does not
            have a <a href="optimization.html#jointype_const"><code class="literal">const</code></a> join type.)
          </p></li><li><p>
            You have different <code class="literal">ORDER BY</code> and
            <code class="literal">GROUP BY</code> expressions.
          </p></li><li><p>
            You index only a prefix of a column named in the
            <code class="literal">ORDER BY</code> clause. In this case, the index
            cannot be used to fully resolve the sort order. For example,
            if you have a <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">CHAR(20)</code></a>
            column, but index only the first 10 bytes, the index cannot
            distinguish values past the 10th byte and a
            <code class="literal">filesort</code> will be needed.
          </p></li><li><p>
            The type of table index used does not store rows in order.
            For example, this is true for a <code class="literal">HASH</code>
            index in a <code class="literal">MEMORY</code> table.
          </p></li></ul></div><p>
        Availability of an index for sorting may be affected by the use
        of column aliases. Suppose that the column
        <code class="literal">t1.a</code> is indexed. In this statement, the name
        of the column in the select list is <code class="literal">a</code>. It
        refers to <code class="literal">t1.a</code>, so for the reference to
        <code class="literal">a</code> in the <code class="literal">ORDER BY</code>, the
        index can be used:
      </p><pre class="programlisting">SELECT a FROM t1 ORDER BY a;
</pre><p>
        In this statement, the name of the column in the select list is
        also <code class="literal">a</code>, but it is the alias name. It refers
        to <code class="literal">ABS(a)</code>, so for the reference to
        <code class="literal">a</code> in the <code class="literal">ORDER BY</code>, the
        index cannot be used:
      </p><pre class="programlisting">SELECT ABS(a) AS a FROM t1 ORDER BY a;
</pre><p>
        In the following statement, the <code class="literal">ORDER BY</code>
        refers to a name that is not the name of a column in the select
        list. But there is a column in <code class="literal">t1</code> named
        <code class="literal">a</code>, so the <code class="literal">ORDER BY</code> uses
        that, and the index can be used. (The resulting sort order may
        be completely different from the order for
        <code class="literal">ABS(a)</code>, of course.)
      </p><pre class="programlisting">SELECT ABS(a) AS b FROM t1 ORDER BY a;
</pre><a class="indexterm" name="id3174146"></a><a class="indexterm" name="id3174159"></a><p>
        By default, MySQL sorts all <code class="literal">GROUP BY
        <em class="replaceable"><code>col1</code></em>,
        <em class="replaceable"><code>col2</code></em>, ...</code> queries as if you
        specified <code class="literal">ORDER BY <em class="replaceable"><code>col1</code></em>,
        <em class="replaceable"><code>col2</code></em>, ...</code> in the query as
        well. If you include an <code class="literal">ORDER BY</code> clause
        explicitly that contains the same column list, MySQL optimizes
        it away without any speed penalty, although the sorting still
        occurs. If a query includes <code class="literal">GROUP BY</code> but you
        want to avoid the overhead of sorting the result, you can
        suppress sorting by specifying <code class="literal">ORDER BY NULL</code>.
        For example:
      </p><pre class="programlisting">INSERT INTO foo
SELECT a, COUNT(*) FROM bar GROUP BY a ORDER BY NULL;
</pre><p>
        With <code class="literal">EXPLAIN SELECT ... ORDER BY</code>, you can
        check whether MySQL can use indexes to resolve the query. It
        cannot if you see <code class="literal">Using filesort</code> in the
        <code class="literal">Extra</code> column. See
        <a href="optimization.html#using-explain" title="7.2.1. Optimizing Queries with EXPLAIN">Section 7.2.1, “Optimizing Queries with <code class="literal">EXPLAIN</code>”</a>.
      </p><a class="indexterm" name="id3174262"></a><a class="indexterm" name="id3174272"></a><p>
        MySQL has two <code class="literal">filesort</code> algorithms for sorting
        and retrieving results. The original method uses only the
        <code class="literal">ORDER BY</code> columns. The modified method uses
        not just the <code class="literal">ORDER BY</code> columns, but all the
        columns used in the query.
      </p><p>
        The optimizer selects which <code class="literal">filesort</code>
        algorithm to use. It normally uses the modified algorithm except
        when <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a> or
        <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">TEXT</code></a> columns are involved, in
        which case it uses the original algorithm.
      </p><p>
        The original <code class="literal">filesort</code> algorithm works as
        follows:
      </p><div class="orderedlist"><ol type="1"><li><p>
            Read all rows according to key or by table scanning. Rows
            that do not match the <code class="literal">WHERE</code> clause are
            skipped.
          </p></li><li><p>
            For each row, store a pair of values in a buffer (the sort
            key and the row pointer). The size of the buffer is the
            value of the
            <a href="server-administration.html#sysvar_sort_buffer_size"><code class="literal">sort_buffer_size</code></a> system
            variable.
          </p></li><li><p>
            When the buffer gets full, run a qsort (quicksort) on it and
            store the result in a temporary file. Save a pointer to the
            sorted block. (If all pairs fit into the sort buffer, no
            temporary file is created.)
          </p></li><li><p>
            Repeat the preceding steps until all rows have been read.
          </p></li><li><p>
            Do a multi-merge of up to <code class="literal">MERGEBUFF</code> (7)
            regions to one block in another temporary file. Repeat until
            all blocks from the first file are in the second file.
          </p></li><li><p>
            Repeat the following until there are fewer than
            <code class="literal">MERGEBUFF2</code> (15) blocks left.
          </p></li><li><p>
            On the last multi-merge, only the pointer to the row (the
            last part of the sort key) is written to a result file.
          </p></li><li><p>
            Read the rows in sorted order by using the row pointers in
            the result file. To optimize this, we read in a big block of
            row pointers, sort them, and use them to read the rows in
            sorted order into a row buffer. The size of the buffer is
            the value of the
            <a href="server-administration.html#sysvar_read_rnd_buffer_size"><code class="literal">read_rnd_buffer_size</code></a> system
            variable. The code for this step is in the
            <code class="filename">sql/records.cc</code> source file.
          </p></li></ol></div><p>
        One problem with this approach is that it reads rows twice: One
        time when evaluating the <code class="literal">WHERE</code> clause, and
        again after sorting the pair values. And even if the rows were
        accessed successively the first time (for example, if a table
        scan is done), the second time they are accessed randomly. (The
        sort keys are ordered, but the row positions are not.)
      </p><p>
        The modified <code class="literal">filesort</code> algorithm incorporates
        an optimization such that it records not only the sort key value
        and row position, but also the columns required for the query.
        This avoids reading the rows twice. The modified
        <code class="literal">filesort</code> algorithm works like this:
      </p><div class="orderedlist"><ol type="1"><li><p>
            Read the rows that match the <code class="literal">WHERE</code>
            clause.
          </p></li><li><p>
            For each row, record a tuple of values consisting of the
            sort key value and row position, and also the columns
            required for the query.
          </p></li><li><p>
            Sort the tuples by sort key value
          </p></li><li><p>
            Retrieve the rows in sorted order, but read the required
            columns directly from the sorted tuples rather than by
            accessing the table a second time.
          </p></li></ol></div><p>
        Using the modified <code class="literal">filesort</code> algorithm, the
        tuples are longer than the pairs used in the original method,
        and fewer of them fit in the sort buffer (the size of which is
        given by <a href="server-administration.html#sysvar_sort_buffer_size"><code class="literal">sort_buffer_size</code></a>). As
        a result, it is possible for the extra I/O to make the modified
        approach slower, not faster. To avoid a slowdown, the
        optimization is used only if the total size of the extra columns
        in the sort tuple does not exceed the value of the
        <a href="server-administration.html#sysvar_max_length_for_sort_data"><code class="literal">max_length_for_sort_data</code></a> system
        variable. (A symptom of setting the value of this variable too
        high is that you should see high disk activity and low CPU
        activity.)
      </p><p>
        For slow queries for which <code class="literal">filesort</code> is not
        used, you might try lowering
        <a href="server-administration.html#sysvar_max_length_for_sort_data"><code class="literal">max_length_for_sort_data</code></a> to a
        value that is appropriate to trigger a
        <code class="literal">filesort</code>.
      </p><p>
        If you want to increase <code class="literal">ORDER BY</code> speed, check
        whether you can get MySQL to use indexes rather than an extra
        sorting phase. If this is not possible, you can try the
        following strategies:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Increase the size of the
            <a href="server-administration.html#sysvar_sort_buffer_size"><code class="literal">sort_buffer_size</code></a> variable.
          </p></li><li><p>
            Increase the size of the
            <a href="server-administration.html#sysvar_read_rnd_buffer_size"><code class="literal">read_rnd_buffer_size</code></a>
            variable.
          </p></li><li><p>
            Use less RAM per row by declaring columns only as large as
            they need to be to hold the values stored in them. For
            example, <code class="literal">CHAR(16)</code> is better than
            <code class="literal">CHAR(200)</code> if values never exceed 16
            characters.
          </p></li><li><p>
            Change <code class="literal">tmpdir</code> to point to a dedicated
            file system with large amounts of free space. Also, this
            option accepts several paths that are used in round-robin
            fashion, so you can use this feature to spread the load
            across several directories. Paths should be separated by
            colon characters (“<span class="quote"><code class="literal">:</code></span>”) on
            Unix and semicolon characters
            (“<span class="quote"><code class="literal">;</code></span>”) on Windows, NetWare,
            and OS/2. The paths should be for directories in file
            systems that are located on different
            <span class="emphasis"><em>physical</em></span> disks, not different
            partitions on the same disk.
          </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="group-by-optimization"></a>7.2.18. <code class="literal">GROUP BY</code> Optimization</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="optimization.html#loose-index-scan">7.2.18.1. Loose index scan</a></span></dt><dt><span class="section"><a href="optimization.html#tight-index-scan">7.2.18.2. Tight index scan</a></span></dt></dl></div><a class="indexterm" name="id3174738"></a><a class="indexterm" name="id3174747"></a><p>
        The most general way to satisfy a <code class="literal">GROUP BY</code>
        clause is to scan the whole table and create a new temporary
        table where all rows from each group are consecutive, and then
        use this temporary table to discover groups and apply aggregate
        functions (if any). In some cases, MySQL is able to do much
        better than that and to avoid creation of temporary tables by
        using index access.
      </p><p>
        The most important preconditions for using indexes for
        <code class="literal">GROUP BY</code> are that all <code class="literal">GROUP
        BY</code> columns reference attributes from the same index,
        and that the index stores its keys in order (for example, this
        is a <code class="literal">BTREE</code> index and not a
        <code class="literal">HASH</code> index). Whether use of temporary tables
        can be replaced by index access also depends on which parts of
        an index are used in a query, the conditions specified for these
        parts, and the selected aggregate functions.
      </p><p>
        In MySQL, <code class="literal">GROUP BY</code> is used for sorting, so
        the server may also apply <code class="literal">ORDER BY</code>
        optimizations to grouping. See
        <a href="optimization.html#order-by-optimization" title="7.2.17. ORDER BY Optimization">Section 7.2.17, “<code class="literal">ORDER BY</code> Optimization”</a>.
      </p><p>
        There are two ways to execute a <code class="literal">GROUP BY</code>
        query via index access, as detailed in the following sections.
        In the first method, the grouping operation is applied together
        with all range predicates (if any). The second method first
        performs a range scan, and then groups the resulting tuples.
      </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="loose-index-scan"></a>7.2.18.1. Loose index scan</h4></div></div></div><p>
          The most efficient way to process <code class="literal">GROUP BY</code>
          is when the index is used to directly retrieve the group
          columns. With this access method, MySQL uses the property of
          some index types that the keys are ordered (for example,
          <code class="literal">BTREE</code>). This property enables use of lookup
          groups in an index without having to consider all keys in the
          index that satisfy all <code class="literal">WHERE</code> conditions.
          This access method considers only a fraction of the keys in an
          index, so it is called a <em class="firstterm">loose index
          scan</em>. When there is no <code class="literal">WHERE</code>
          clause, a loose index scan reads as many keys as the number of
          groups, which may be a much smaller number than that of all
          keys. If the <code class="literal">WHERE</code> clause contains range
          predicates (see the discussion of the
          <a href="optimization.html#jointype_range"><code class="literal">range</code></a> join type in
          <a href="optimization.html#using-explain" title="7.2.1. Optimizing Queries with EXPLAIN">Section 7.2.1, “Optimizing Queries with <code class="literal">EXPLAIN</code>”</a>), a loose index scan looks up
          the first key of each group that satisfies the range
          conditions, and again reads the least possible number of keys.
          This is possible under the following conditions:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              The query is over a single table.
            </p></li><li><p>
              The <code class="literal">GROUP BY</code> includes the first
              consecutive parts of the index. (If, instead of
              <code class="literal">GROUP BY</code>, the query has a
              <code class="literal">DISTINCT</code> clause, all distinct
              attributes refer to the beginning of the index.)
            </p></li><li><p>
              The only aggregate functions used (if any) are
              <a href="functions.html#function_min"><code class="literal">MIN()</code></a> and
              <a href="functions.html#function_max"><code class="literal">MAX()</code></a>, and all of them
              refer to the same column.
            </p></li><li><p>
              Any other parts of the index than those from the
              <code class="literal">GROUP BY</code> referenced in the query must
              be constants (that is, they must be referenced in
              equalities with constants), except for the argument of
              <a href="functions.html#function_min"><code class="literal">MIN()</code></a> or
              <a href="functions.html#function_max"><code class="literal">MAX()</code></a> functions.
            </p></li></ul></div><p>
          The <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output for such
          queries shows <code class="literal">Using index for group-by</code> in
          the <code class="literal">Extra</code> column.
        </p><p>
          The following queries fall into this category, assuming that
          there is an index <code class="literal">idx(c1,c2,c3)</code> on table
          <code class="literal">t1(c1,c2,c3,c4)</code>:
        </p><pre class="programlisting">SELECT c1, c2 FROM t1 GROUP BY c1, c2;
SELECT DISTINCT c1, c2 FROM t1;
SELECT c1, MIN(c2) FROM t1 GROUP BY c1;
SELECT c1, c2 FROM t1 WHERE c1 &lt; <em class="replaceable"><code>const</code></em> GROUP BY c1, c2;
SELECT MAX(c3), MIN(c3), c1, c2 FROM t1 WHERE c2 &gt; <em class="replaceable"><code>const</code></em> GROUP BY c1, c2;
SELECT c2 FROM t1 WHERE c1 &lt; <em class="replaceable"><code>const</code></em> GROUP BY c1, c2;
SELECT c1, c2 FROM t1 WHERE c3 = <em class="replaceable"><code>const</code></em> GROUP BY c1, c2;
</pre><p>
          The following queries cannot be executed with this quick
          select method, for the reasons given:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              There are aggregate functions other than
              <a href="functions.html#function_min"><code class="literal">MIN()</code></a> or
              <a href="functions.html#function_max"><code class="literal">MAX()</code></a>, for example:
            </p><pre class="programlisting">SELECT c1, SUM(c2) FROM t1 GROUP BY c1;
</pre></li><li><p>
              The columns in the <code class="literal">GROUP BY</code> clause do
              not refer to the beginning of the index, as shown here:
            </p><pre class="programlisting">SELECT c1,c2 FROM t1 GROUP BY c2, c3;
</pre></li><li><p>
              The query refers to a part of a key that comes after the
              <code class="literal">GROUP BY</code> part, and for which there is
              no equality with a constant, an example being:
            </p><pre class="programlisting">SELECT c1,c3 FROM t1 GROUP BY c1, c2;
</pre></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="tight-index-scan"></a>7.2.18.2. Tight index scan</h4></div></div></div><p>
          A tight index scan may be either a full index scan or a range
          index scan, depending on the query conditions.
        </p><p>
          When the conditions for a loose index scan are not met, it is
          still possible to avoid creation of temporary tables for
          <code class="literal">GROUP BY</code> queries. If there are range
          conditions in the <code class="literal">WHERE</code> clause, this method
          reads only the keys that satisfy these conditions. Otherwise,
          it performs an index scan. Because this method reads all keys
          in each range defined by the <code class="literal">WHERE</code> clause,
          or scans the whole index if there are no range conditions, we
          term it a <em class="firstterm">tight index scan</em>. Notice that
          with a tight index scan, the grouping operation is performed
          only after all keys that satisfy the range conditions have
          been found.
        </p><p>
          For this method to work, it is sufficient that there is a
          constant equality condition for all columns in a query
          referring to parts of the key coming before or in between
          parts of the <code class="literal">GROUP BY</code> key. The constants
          from the equality conditions fill in any “<span class="quote">gaps</span>”
          in the search keys so that it is possible to form complete
          prefixes of the index. These index prefixes then can be used
          for index lookups. If we require sorting of the <code class="literal">GROUP
          BY</code> result, and it is possible to form search keys
          that are prefixes of the index, MySQL also avoids extra
          sorting operations because searching with prefixes in an
          ordered index already retrieves all the keys in order.
        </p><p>
          The following queries do not work with the loose index scan
          access method described earlier, but still work with the tight
          index scan access method (assuming that there is an index
          <code class="literal">idx(c1,c2,c3)</code> on table
          <code class="literal">t1(c1,c2,c3,c4)</code>).
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              There is a gap in the <code class="literal">GROUP BY</code>, but it
              is covered by the condition <code class="literal">c2 = 'a'</code>:
            </p><pre class="programlisting">SELECT c1, c2, c3 FROM t1 WHERE c2 = 'a' GROUP BY c1, c3;
</pre></li><li><p>
              The <code class="literal">GROUP BY</code> does not begin with the
              first part of the key, but there is a condition that
              provides a constant for that part:
            </p><pre class="programlisting">SELECT c1, c2, c3 FROM t1 WHERE c1 = 'a' GROUP BY c2, c3;
</pre></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="distinct-optimization"></a>7.2.19. <code class="literal">DISTINCT</code> Optimization</h3></div></div></div><a class="indexterm" name="id3175336"></a><a class="indexterm" name="id3175345"></a><p>
        <code class="literal">DISTINCT</code> combined with <code class="literal">ORDER
        BY</code> needs a temporary table in many cases.
      </p><p>
        Because <code class="literal">DISTINCT</code> may use <code class="literal">GROUP
        BY</code>, you should be aware of how MySQL works with
        columns in <code class="literal">ORDER BY</code> or
        <code class="literal">HAVING</code> clauses that are not part of the
        selected columns. See <a href="functions.html#group-by-hidden-columns" title="11.12.3. GROUP BY and HAVING with Hidden
        Columns">Section 11.12.3, “<code class="literal">GROUP BY</code> and <code class="literal">HAVING</code> with Hidden
        Columns”</a>.
      </p><p>
        In most cases, a <code class="literal">DISTINCT</code> clause can be
        considered as a special case of <code class="literal">GROUP BY</code>. For
        example, the following two queries are equivalent:
      </p><pre class="programlisting">SELECT DISTINCT c1, c2, c3 FROM t1
WHERE c1 &gt; <em class="replaceable"><code>const</code></em>;

SELECT c1, c2, c3 FROM t1
WHERE c1 &gt; <em class="replaceable"><code>const</code></em> GROUP BY c1, c2, c3;
</pre><p>
        Due to this equivalence, the optimizations applicable to
        <code class="literal">GROUP BY</code> queries can be also applied to
        queries with a <code class="literal">DISTINCT</code> clause. Thus, for
        more details on the optimization possibilities for
        <code class="literal">DISTINCT</code> queries, see
        <a href="optimization.html#group-by-optimization" title="7.2.18. GROUP BY Optimization">Section 7.2.18, “<code class="literal">GROUP BY</code> Optimization”</a>.
      </p><p>
        When combining <code class="literal">LIMIT
        <em class="replaceable"><code>row_count</code></em></code> with
        <code class="literal">DISTINCT</code>, MySQL stops as soon as it finds
        <em class="replaceable"><code>row_count</code></em> unique rows.
      </p><p>
        If you do not use columns from all tables named in a query,
        MySQL stops scanning any unused tables as soon as it finds the
        first match. In the following case, assuming that
        <code class="literal">t1</code> is used before <code class="literal">t2</code>
        (which you can check with
        <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a>), MySQL stops reading
        from <code class="literal">t2</code> (for any particular row in
        <code class="literal">t1</code>) when it finds the first row in
        <code class="literal">t2</code>:
      </p><pre class="programlisting">SELECT DISTINCT t1.a FROM t1, t2 where t1.a=t2.a;
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="in-subquery-optimization"></a>7.2.20. Optimizing <code class="literal">IN</code>/<code class="literal">=ANY</code> Subqueries</h3></div></div></div><a class="indexterm" name="id3175567"></a><a class="indexterm" name="id3175576"></a><p>
        Certain optimizations are applicable to comparisons that use the
        <code class="literal">IN</code> operator to test subquery results (or that
        use <code class="literal">=ANY</code>, which is equivalent). This section
        discusses these optimizations, particularly with regard to the
        challenges that <code class="literal">NULL</code> values present.
        Suggestions on what you can do to help the optimizer are given
        at the end of the discussion.
      </p><p>
        Consider the following subquery comparison:
      </p><pre class="programlisting"><em class="replaceable"><code>outer_expr</code></em> IN (SELECT <em class="replaceable"><code>inner_expr</code></em> FROM ... WHERE <em class="replaceable"><code>subquery_where</code></em>)
</pre><p>
        MySQL evaluates queries “<span class="quote">from outside to inside.</span>”
        That is, it first obtains the value of the outer expression
        <em class="replaceable"><code>outer_expr</code></em>, and then runs the
        subquery and captures the rows that it produces.
      </p><p>
        A very useful optimization is to “<span class="quote">inform</span>” the
        subquery that the only rows of interest are those where the
        inner expression <em class="replaceable"><code>inner_expr</code></em> is equal
        to <em class="replaceable"><code>outer_expr</code></em>. This is done by
        pushing down an appropriate equality into the subquery's
        <code class="literal">WHERE</code> clause. That is, the comparison is
        converted to this:
      </p><pre class="programlisting">EXISTS (SELECT 1 FROM ... WHERE <em class="replaceable"><code>subquery_where</code></em> AND <em class="replaceable"><code>outer_expr</code></em>=<em class="replaceable"><code>inner_expr</code></em>)
</pre><p>
        After the conversion, MySQL can use the pushed-down equality to
        limit the number of rows that it must examine when evaluating
        the subquery.
      </p><p>
        More generally, a comparison of <em class="replaceable"><code>N</code></em>
        values to a subquery that returns
        <em class="replaceable"><code>N</code></em>-value rows is subject to the same
        conversion. If <em class="replaceable"><code>oe_i</code></em> and
        <em class="replaceable"><code>ie_i</code></em> represent corresponding outer
        and inner expression values, this subquery comparison:
      </p><pre class="programlisting">(<em class="replaceable"><code>oe_1</code></em>, ..., <em class="replaceable"><code>oe_N</code></em>) IN
  (SELECT <em class="replaceable"><code>ie_1</code></em>, ..., <em class="replaceable"><code>ie_N</code></em> FROM ... WHERE <em class="replaceable"><code>subquery_where</code></em>)
</pre><p>
        Becomes:
      </p><pre class="programlisting">EXISTS (SELECT 1 FROM ... WHERE <em class="replaceable"><code>subquery_where</code></em>
                          AND <em class="replaceable"><code>oe_1</code></em> = <em class="replaceable"><code>ie_1</code></em>
                          AND ...
                          AND <em class="replaceable"><code>oe_N</code></em> = <em class="replaceable"><code>ie_N</code></em>)
</pre><p>
        The following discussion assumes a single pair of outer and
        inner expression values for simplicity.
      </p><p>
        The conversion just described has its limitations. It is valid
        only if we ignore possible <code class="literal">NULL</code> values. That
        is, the “<span class="quote">pushdown</span>” strategy works as long as both
        of these two conditions are true:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            <em class="replaceable"><code>outer_expr</code></em> and
            <em class="replaceable"><code>inner_expr</code></em> cannot be
            <code class="literal">NULL</code>.
          </p></li><li><p>
            You do not need to distinguish <code class="literal">NULL</code> from
            <code class="literal">FALSE</code> subquery results. (If the subquery
            is a part of an <a href="functions.html#operator_or"><code class="literal">OR</code></a> or
            <a href="functions.html#operator_and"><code class="literal">AND</code></a> expression in the
            <code class="literal">WHERE</code> clause, MySQL assumes that you
            don't care.)
          </p></li></ul></div><p>
        When either or both of those conditions do not hold,
        optimization is more complex.
      </p><p>
        Suppose that <em class="replaceable"><code>outer_expr</code></em> is known to
        be a non-<code class="literal">NULL</code> value but the subquery does not
        produce a row such that <em class="replaceable"><code>outer_expr</code></em> =
        <em class="replaceable"><code>inner_expr</code></em>. Then
        <code class="literal"><em class="replaceable"><code>outer_expr</code></em> IN (SELECT
        ...)</code> evaluates as follows:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            <code class="literal">NULL</code>, if the
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> produces any row where
            <em class="replaceable"><code>inner_expr</code></em> is
            <code class="literal">NULL</code>
          </p></li><li><p>
            <code class="literal">FALSE</code>, if the
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> produces only
            non-<code class="literal">NULL</code> values or produces nothing
          </p></li></ul></div><p>
        In this situation, the approach of looking for rows with
        <code class="literal"><em class="replaceable"><code>outer_expr</code></em> =
        <em class="replaceable"><code>inner_expr</code></em></code> is no longer
        valid. It is necessary to look for such rows, but if none are
        found, also look for rows where
        <em class="replaceable"><code>inner_expr</code></em> is
        <code class="literal">NULL</code>. Roughly speaking, the subquery can be
        converted to:
      </p><pre class="programlisting">EXISTS (SELECT 1 FROM ... WHERE <em class="replaceable"><code>subquery_where</code></em> AND
        (<em class="replaceable"><code>outer_expr</code></em>=<em class="replaceable"><code>inner_expr</code></em> OR <em class="replaceable"><code>inner_expr</code></em> IS NULL))
</pre><p>
        The need to evaluate the extra <a href="functions.html#operator_is-null"><code class="literal">IS
        NULL</code></a> condition is why MySQL has the
        <a href="optimization.html#jointype_ref_or_null"><code class="literal">ref_or_null</code></a> access method:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>EXPLAIN</code></strong>
    -&gt; <strong class="userinput"><code>SELECT <em class="replaceable"><code>outer_expr</code></em> IN (SELECT t2.maybe_null_key</code></strong>
    -&gt;                       <strong class="userinput"><code>FROM t2, t3 WHERE ...)</code></strong>
    -&gt; FROM t1;
*************************** 1. row ***************************
           id: 1
  select_type: PRIMARY
        table: t1
...
*************************** 2. row ***************************
           id: 2
  select_type: DEPENDENT SUBQUERY
        table: t2
         type: ref_or_null
possible_keys: maybe_null_key
          key: maybe_null_key
      key_len: 5
          ref: func
         rows: 2
        Extra: Using where; Using index
...
</pre><p>
        The <a href="optimization.html#jointype_unique_subquery"><code class="literal">unique_subquery</code></a> and
        <a href="optimization.html#jointype_index_subquery"><code class="literal">index_subquery</code></a>
        subqery-specific access methods also have or-null variants.
        However, they are not visible in
        <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output, so you must use
        <code class="literal">EXPLAIN EXTENDED</code> followed by
        <a href="sql-syntax.html#show-warnings" title="12.5.6.40. SHOW WARNINGS Syntax"><code class="literal">SHOW WARNINGS</code></a> (note the
        <code class="literal">checking NULL</code> in the warning message):
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>EXPLAIN EXTENDED</code></strong>
    -&gt; <strong class="userinput"><code>SELECT <em class="replaceable"><code>outer_expr</code></em> IN (SELECT maybe_null_key FROM t2) FROM t1\G</code></strong>
*************************** 1. row ***************************
           id: 1
  select_type: PRIMARY
        table: t1
...
*************************** 2. row ***************************
           id: 2
  select_type: DEPENDENT SUBQUERY
        table: t2
         type: index_subquery
possible_keys: maybe_null_key
          key: maybe_null_key
      key_len: 5
          ref: func
         rows: 2
        Extra: Using index

mysql&gt; <strong class="userinput"><code>SHOW WARNINGS\G</code></strong>
*************************** 1. row ***************************
  Level: Note
   Code: 1003
Message: select (`test`.`t1`.`outer_expr`,
         (((`test`.`t1`.`outer_expr`) in t2 on
         maybe_null_key checking NULL))) AS `outer_expr IN (SELECT
         maybe_null_key FROM t2)` from `test`.`t1`
</pre><p>
        The additional <code class="literal">OR ... IS NULL</code> condition makes
        query execution slightly more complicated (and some
        optimizations within the subquery become inapplicable), but
        generally this is tolerable.
      </p><p>
        The situation is much worse when
        <em class="replaceable"><code>outer_expr</code></em> can be
        <code class="literal">NULL</code>. According to the SQL interpretation of
        <code class="literal">NULL</code> as “<span class="quote">unknown value,</span>”
        <code class="literal">NULL IN (SELECT <em class="replaceable"><code>inner_expr</code></em>
        ...)</code> should evaluate to:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            <code class="literal">NULL</code>, if the
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> produces any rows
          </p></li><li><p>
            <code class="literal">FALSE</code>, if the
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> produces no rows
          </p></li></ul></div><p>
        For proper evaluation, it is necessary to be able to check
        whether the <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> has produced
        any rows at all, so
        <code class="literal"><em class="replaceable"><code>outer_expr</code></em> =
        <em class="replaceable"><code>inner_expr</code></em></code> cannot be pushed
        down into the subquery. This is a problem, because many real
        world subqueries become very slow unless the equality can be
        pushed down.
      </p><p>
        Essentially, there must be different ways to execute the
        subquery depending on the value of
        <em class="replaceable"><code>outer_expr</code></em>.
      </p><p>
        The optimizer chooses SQL compliance over speed, so it accounts
        for the possibility that <em class="replaceable"><code>outer_expr</code></em>
        might be <code class="literal">NULL</code>.
      </p><p>
        If <em class="replaceable"><code>outer_expr</code></em> is
        <code class="literal">NULL</code>, to evaluate the following expression,
        it is necessary to run the <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
        to determine whether it produces any rows:
      </p><pre class="programlisting">NULL IN (SELECT <em class="replaceable"><code>inner_expr</code></em> FROM ... WHERE <em class="replaceable"><code>subquery_where</code></em>)
</pre><p>
        It is necessary to run the original
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> here, without any
        pushed-down equalities of the kind mentioned earlier.
      </p><p>
        On the other hand, when <em class="replaceable"><code>outer_expr</code></em> is
        not <code class="literal">NULL</code>, it is absolutely essential that
        this comparison:
      </p><pre class="programlisting"><em class="replaceable"><code>outer_expr</code></em> IN (SELECT <em class="replaceable"><code>inner_expr</code></em> FROM ... WHERE <em class="replaceable"><code>subquery_where</code></em>)
</pre><p>
        be converted to this expression that uses a pushed-down
        condition:
      </p><pre class="programlisting">EXISTS (SELECT 1 FROM ... WHERE <em class="replaceable"><code>subquery_where</code></em> AND <em class="replaceable"><code>outer_expr</code></em>=<em class="replaceable"><code>inner_expr</code></em>)
</pre><p>
        Without this conversion, subqueries will be slow. To solve the
        dilemma of whether to push down or not push down conditions into
        the subquery, the conditions are wrapped in
        “<span class="quote">trigger</span>” functions. Thus, an expression of the
        following form:
      </p><pre class="programlisting"><em class="replaceable"><code>outer_expr</code></em> IN (SELECT <em class="replaceable"><code>inner_expr</code></em> FROM ... WHERE <em class="replaceable"><code>subquery_where</code></em>)
</pre><p>
        is converted into:
      </p><pre class="programlisting">EXISTS (SELECT 1 FROM ... WHERE <em class="replaceable"><code>subquery_where</code></em>
                          AND trigcond(<em class="replaceable"><code>outer_expr</code></em>=<em class="replaceable"><code>inner_expr</code></em>))
</pre><p>
        More generally, if the subquery comparison is based on several
        pairs of outer and inner expressions, the conversion takes this
        comparison:
      </p><pre class="programlisting">(<em class="replaceable"><code>oe_1</code></em>, ..., <em class="replaceable"><code>oe_N</code></em>) IN (SELECT <em class="replaceable"><code>ie_1</code></em>, ..., <em class="replaceable"><code>ie_N</code></em> FROM ... WHERE <em class="replaceable"><code>subquery_where</code></em>)
</pre><p>
        and converts it to this expression:
      </p><pre class="programlisting">EXISTS (SELECT 1 FROM ... WHERE <em class="replaceable"><code>subquery_where</code></em>
                          AND trigcond(<em class="replaceable"><code>oe_1</code></em>=<em class="replaceable"><code>ie_1</code></em>)
                          AND ...
                          AND trigcond(<em class="replaceable"><code>oe_N</code></em>=<em class="replaceable"><code>ie_N</code></em>)
       )
</pre><p>
        Each <code class="literal">trigcond(<em class="replaceable"><code>X</code></em>)</code>
        is a special function that evaluates to the following values:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            <em class="replaceable"><code>X</code></em> when the “<span class="quote">linked</span>”
            outer expression <em class="replaceable"><code>oe_i</code></em> is not
            <code class="literal">NULL</code>
          </p></li><li><p>
            <code class="literal">TRUE</code> when the “<span class="quote">linked</span>” outer
            expression <em class="replaceable"><code>oe_i</code></em> is
            <code class="literal">NULL</code>
          </p></li></ul></div><p>
        Note that trigger functions are <span class="emphasis"><em>not</em></span>
        triggers of the kind that you create with
        <a href="sql-syntax.html#create-trigger" title="12.1.15. CREATE TRIGGER Syntax"><code class="literal">CREATE TRIGGER</code></a>.
      </p><p>
        Equalities that are wrapped into <code class="literal">trigcond()</code>
        functions are not first class predicates for the query
        optimizer. Most optimizations cannot deal with predicates that
        may be turned on and off at query execution time, so they assume
        any <code class="literal">trigcond(<em class="replaceable"><code>X</code></em>)</code> to
        be an unknown function and ignore it. At the moment, triggered
        equalities can be used by those optimizations:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Reference optimizations:
            <code class="literal">trigcond(<em class="replaceable"><code>X</code></em>=<em class="replaceable"><code>Y</code></em>
            [OR <em class="replaceable"><code>Y</code></em> IS NULL])</code> can be
            used to construct <a href="optimization.html#jointype_ref"><code class="literal">ref</code></a>,
            <a href="optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a>, or
            <a href="optimization.html#jointype_ref_or_null"><code class="literal">ref_or_null</code></a> table
            accesses.
          </p></li><li><p>
            Index lookup-based subquery execution engines:
            <code class="literal">trigcond(<em class="replaceable"><code>X</code></em>=<em class="replaceable"><code>Y</code></em>)</code>
            can be used to construct
            <a href="optimization.html#jointype_unique_subquery"><code class="literal">unique_subquery</code></a> or
            <a href="optimization.html#jointype_index_subquery"><code class="literal">index_subquery</code></a> accesses.
          </p></li><li><p>
            Table-condition generator: If the subquery is a join of
            several tables, the triggered condition will be checked as
            soon as possible.
          </p></li></ul></div><p>
        When the optimizer uses a triggered condition to create some
        kind of index lookup-based access (as for the first two items of
        the preceding list), it must have a fallback strategy for the
        case when the condition is turned off. This fallback strategy is
        always the same: Do a full table scan. In
        <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output, the fallback
        shows up as <code class="literal">Full scan on NULL key</code> in the
        <code class="literal">Extra</code> column:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>EXPLAIN SELECT t1.col1,</code></strong>
    -&gt; <strong class="userinput"><code>t1.col1 IN (SELECT t2.key1 FROM t2 WHERE t2.col2=t1.col2) FROM t1\G</code></strong>
*************************** 1. row ***************************
           id: 1
  select_type: PRIMARY
        table: t1
        ...
*************************** 2. row ***************************
           id: 2
  select_type: DEPENDENT SUBQUERY
        table: t2
         type: index_subquery
possible_keys: key1
          key: key1
      key_len: 5
          ref: func
         rows: 2
        Extra: Using where; Full scan on NULL key
</pre><p>
        If you run <code class="literal">EXPLAIN EXTENDED</code> followed by
        <a href="sql-syntax.html#show-warnings" title="12.5.6.40. SHOW WARNINGS Syntax"><code class="literal">SHOW WARNINGS</code></a>, you can see the
        triggered condition:
      </p><pre class="programlisting">*************************** 1. row ***************************
  Level: Note
   Code: 1003
Message: select `test`.`t1`.`col1` AS `col1`,
         &lt;in_optimizer&gt;(`test`.`t1`.`col1`,
         &lt;exists&gt;(&lt;index_lookup&gt;(&lt;cache&gt;(`test`.`t1`.`col1`) in t2
         on key1 checking NULL
         where (`test`.`t2`.`col2` = `test`.`t1`.`col2`) having
         trigcond(&lt;is_not_null_test&gt;(`test`.`t2`.`key1`))))) AS
         `t1.col1 IN (select t2.key1 from t2 where t2.col2=t1.col2)`
         from `test`.`t1`
</pre><p>
        The use of triggered conditions has some performance
        implications. A <code class="literal">NULL IN (SELECT ...)</code>
        expression now may cause a full table scan (which is slow) when
        it previously did not. This is the price paid for correct
        results (the goal of the trigger-condition strategy was to
        improve compliance and not speed).
      </p><p>
        For multiple-table subqueries, execution of <code class="literal">NULL IN
        (SELECT ...)</code> will be particularly slow because the
        join optimizer doesn't optimize for the case where the outer
        expression is <code class="literal">NULL</code>. It assumes that subquery
        evaluations with <code class="literal">NULL</code> on the left side are
        very rare, even if there are statistics that indicate otherwise.
        On the other hand, if the outer expression might be
        <code class="literal">NULL</code> but never actually is, there is no
        performance penalty.
      </p><p>
        To help the query optimizer better execute your queries, use
        these tips:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            A column must be declared as <code class="literal">NOT NULL</code> if
            it really is. (This also helps other aspects of the
            optimizer.)
          </p></li><li><p>
            If you don't need to distinguish a <code class="literal">NULL</code>
            from <code class="literal">FALSE</code> subquery result, you can
            easily avoid the slow execution path. Replace a comparison
            that looks like this:
          </p><pre class="programlisting"><em class="replaceable"><code>outer_expr</code></em> IN (SELECT <em class="replaceable"><code>inner_expr</code></em> FROM ...)
</pre><p>
            with this expression:
          </p><pre class="programlisting">(<em class="replaceable"><code>outer_expr</code></em> IS NOT NULL) AND (<em class="replaceable"><code>outer_expr</code></em> IN (SELECT <em class="replaceable"><code>inner_expr</code></em> FROM ...))
</pre><p>
            Then <code class="literal">NULL IN (SELECT ...)</code> will never be
            evaluated because MySQL stops evaluating
            <a href="functions.html#operator_and"><code class="literal">AND</code></a> parts as soon as the
            expression result is clear.
          </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="limit-optimization"></a>7.2.21. <code class="literal">LIMIT</code> Optimization</h3></div></div></div><a class="indexterm" name="id3176978"></a><a class="indexterm" name="id3176987"></a><p>
        In some cases, MySQL handles a query differently when you are
        using <code class="literal">LIMIT
        <em class="replaceable"><code>row_count</code></em></code> and not using
        <code class="literal">HAVING</code>:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            If you are selecting only a few rows with
            <code class="literal">LIMIT</code>, MySQL uses indexes in some cases
            when normally it would prefer to do a full table scan.
          </p></li><li><p>
            If you use <code class="literal">LIMIT
            <em class="replaceable"><code>row_count</code></em></code> with
            <code class="literal">ORDER BY</code>, MySQL ends the sorting as soon
            as it has found the first
            <em class="replaceable"><code>row_count</code></em> rows of the sorted
            result, rather than sorting the entire result. If ordering
            is done by using an index, this is very fast. If a filesort
            must be done, all rows that match the query without the
            <code class="literal">LIMIT</code> clause must be selected, and most
            or all of them must be sorted, before it can be ascertained
            that the first <em class="replaceable"><code>row_count</code></em> rows
            have been found. In either case, after the initial rows have
            been found, there is no need to sort any remainder of the
            result set, and MySQL does not do so.
          </p></li><li><p>
            When combining <code class="literal">LIMIT
            <em class="replaceable"><code>row_count</code></em></code> with
            <code class="literal">DISTINCT</code>, MySQL stops as soon as it finds
            <em class="replaceable"><code>row_count</code></em> unique rows.
          </p></li><li><p>
            In some cases, a <code class="literal">GROUP BY</code> can be resolved
            by reading the key in order (or doing a sort on the key) and
            then calculating summaries until the key value changes. In
            this case, <code class="literal">LIMIT
            <em class="replaceable"><code>row_count</code></em></code> does not
            calculate any unnecessary <code class="literal">GROUP BY</code>
            values.
          </p></li><li><p>
            As soon as MySQL has sent the required number of rows to the
            client, it aborts the query unless you are using
            <code class="literal">SQL_CALC_FOUND_ROWS</code>.
          </p></li><li><p>
            <code class="literal">LIMIT 0</code> quickly returns an empty set.
            This can be useful for checking the validity of a query.
            When using one of the MySQL APIs, it can also be employed
            for obtaining the types of the result columns. (This trick
            does not work in the MySQL Monitor (the
            <a href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span><strong class="command">mysql</strong></span></a> program), which merely displays
            <code class="literal">Empty set</code> in such cases; you should
            instead use <a href="sql-syntax.html#show-columns" title="12.5.6.6. SHOW COLUMNS Syntax"><code class="literal">SHOW COLUMNS</code></a> or
            <a href="sql-syntax.html#describe" title="12.3.1. DESCRIBE Syntax"><code class="literal">DESCRIBE</code></a> for this purpose.)
          </p></li><li><p>
            When the server uses temporary tables to resolve the query,
            it uses the <code class="literal">LIMIT
            <em class="replaceable"><code>row_count</code></em></code> clause to
            calculate how much space is required.
          </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="switchable-optimizations"></a>7.2.22. Using <code class="literal">optimizer_switch</code> to Control the
        Optimizer</h3></div></div></div><a class="indexterm" name="id3177239"></a><p>
        The <a href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a> system
        variable enables control over optimizer behavior.
      </p><p>
        As of MySQL 6.0.11, the value of the
        <a href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a> system
        variable is a set of flags, each of which has a value of
        <code class="literal">on</code> or <code class="literal">off</code> to indicate
        whether the corresponding optimizer behavior is enabled or
        disabled. This variable has global and session values and be
        changed at runtime. The global default can be set at server
        startup.
      </p><p>
        To see the current set of optimizer flags, select the variable
        value:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT @@optimizer_switch\G</code></strong>
*************************** 1. row ***************************
@@optimizer_switch: firstmatch=on,index_merge=on,
                    index_merge_union=on,
                    index_merge_sort_union=on,
                    index_merge_intersection=on,
                    loosescan=on,materialization=on,
                    semijoin=on
</pre><p>
        To change the value of
        <a href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>, assign a
        value consisting of a comma-separated list of one or more
        commands:
      </p><pre class="programlisting">SET [GLOBAL|SESSION] optimizer_switch='<em class="replaceable"><code>command</code></em>[,<em class="replaceable"><code>command</code></em>]...';
</pre><p>
        Each <em class="replaceable"><code>command</code></em> value should have one of
        the forms shown in the following table.
      </p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command Syntax</strong></span></td><td><span class="bold"><strong>Meaning</strong></span></td></tr><tr><td><code class="literal">default</code></td><td>Reset every optimization to its default value</td></tr><tr><td><code class="literal"><em class="replaceable"><code>opt_name</code></em>=default</code></td><td>Set the named optimization to its default value</td></tr><tr><td><code class="literal"><em class="replaceable"><code>opt_name</code></em>=off</code></td><td>Disable the named optimization</td></tr><tr><td><code class="literal"><em class="replaceable"><code>opt_name</code></em>=on</code></td><td>Enable the named optimization</td></tr></tbody></table></div><p>
        The order of the commands in the value does not matter, although
        <code class="literal">default</code> is executed first if present.
        Specifying any given <em class="replaceable"><code>opt_name</code></em> more
        than once in the value is not allowed and causes an error. Any
        errors in the value cause the entire statement to fail with an
        error and the current value of
        <a href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a> remains
        unchanged.
      </p><p>
        The following table lists the allowable
        <em class="replaceable"><code>opt_name</code></em> flag names.
      </p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Flag Name</strong></span></td><td><span class="bold"><strong>Meaning</strong></span></td></tr><tr><td><code class="literal">index_merge</code></td><td>Controls all Index Merge optimizations</td></tr><tr><td><code class="literal">index_merge_union</code></td><td>Controls the Index Merge Union Access optimization</td></tr><tr><td><code class="literal">index_merge_sort_union</code></td><td>Controls the Index Merge Sort-Union Access optimization</td></tr><tr><td><code class="literal">index_merge_intersection</code></td><td>Controls the Index Merge Intersection Access optimization</td></tr><tr><td><code class="literal">semijoin</code></td><td>Controls use of semi-join strategies</td></tr><tr><td><code class="literal">materialization</code></td><td>Controls materialization (including semi-join materialization)</td></tr><tr><td><code class="literal">loosescan</code></td><td>Controls the semi-join LooseScan strategy (not to be confused with
                LooseScan for <code class="literal">GROUP BY</code>)</td></tr><tr><td><code class="literal">firstmatch</code></td><td>Controls the semi-join FirstMatch strategy</td></tr></tbody></table></div><p>
        For information about Index Merge and semi-joins, see
        <a href="optimization.html#index-merge-optimization" title="7.2.6. Index Merge Optimization">Section 7.2.6, “Index Merge Optimization”</a>, and
        <a href="optimization.html#semi-joins" title="7.2.16. Semi-Join Strategies">Section 7.2.16, “Semi-Join Strategies”</a>.
      </p><p>
        When you assign a value to
        <a href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>, flags that
        are not mentioned keep their current values. This makes it
        possible to enable or disable specific optimizer behaviors in a
        single statement without affecting other behaviors. The
        statement does not depend on what other optimizer flags exist
        and what their values are. Suppose that all Index Merge
        optimizations are enabled:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT @@optimizer_switch\G</code></strong>
*************************** 1. row ***************************
@@optimizer_switch: firstmatch=on,index_merge=on,
                    index_merge_union=on,
                    index_merge_sort_union=on,
                    index_merge_intersection=on,
                    loosescan=on,materialization=on,
                    semijoin=on
1 row in set (0.00 sec)
</pre><p>
        If the server is using the Index Merge Union or Index Merge
        Sort-Union access methods for certain queries and you want to
        check whether the optimizer will perform better without them,
        set the variable value like this:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET optimizer_switch='index_merge_union=off,index_merge_sort_union=off';</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT @@optimizer_switch\G</code></strong>
*************************** 1. row ***************************
@@optimizer_switch: firstmatch=on,index_merge=on,
                    index_merge_union=off,
                    index_merge_sort_union=off,
                    index_merge_intersection=on,
                    loosescan=on,materialization=on,
                    semijoin=on
1 row in set (0.00 sec)
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="how-to-avoid-table-scan"></a>7.2.23. How to Avoid Table Scans</h3></div></div></div><a class="indexterm" name="id3177738"></a><p>
        The output from <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> shows
        <code class="literal">ALL</code> in the
        <code class="literal">type</code> column when MySQL uses a table scan to
        resolve a query. This usually happens under the following
        conditions:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            The table is so small that it is faster to perform a table
            scan than to bother with a key lookup. This is common for
            tables with fewer than 10 rows and a short row length.
          </p></li><li><p>
            There are no usable restrictions in the
            <code class="literal">ON</code> or <code class="literal">WHERE</code> clause for
            indexed columns.
          </p></li><li><p>
            You are comparing indexed columns with constant values and
            MySQL has calculated (based on the index tree) that the
            constants cover too large a part of the table and that a
            table scan would be faster. See
            <a href="optimization.html#where-optimizations" title="7.2.4. WHERE Clause Optimization">Section 7.2.4, “<code class="literal">WHERE</code> Clause Optimization”</a>.
          </p></li><li><p>
            You are using a key with low cardinality (many rows match
            the key value) through another column. In this case, MySQL
            assumes that by using the key it probably will do many key
            lookups and that a table scan would be faster.
          </p></li></ul></div><p class="mnmas"><b>MySQL Enterprise</b>
          For expert advice on avoiding excessive table scans subscribe
          to the MySQL Enterprise Monitor. For more information, see
          <a href="http://www.mysql.com/products/enterprise/advisors.html" target="_top">http://www.mysql.com/products/enterprise/advisors.html</a>.
        </p><p>
        For small tables, a table scan often is appropriate and the
        performance impact is negligible. For large tables, try the
        following techniques to avoid having the optimizer incorrectly
        choose a table scan:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Use <code class="literal">ANALYZE TABLE
            <em class="replaceable"><code>tbl_name</code></em></code> to update the
            key distributions for the scanned table. See
            <a href="sql-syntax.html#analyze-table" title="12.5.2.1. ANALYZE TABLE Syntax">Section 12.5.2.1, “<code class="literal">ANALYZE TABLE</code> Syntax”</a>.
          </p></li><li><p>
            Use <code class="literal">FORCE INDEX</code> for the scanned table to
            tell MySQL that table scans are very expensive compared to
            using the given index:
          </p><pre class="programlisting">SELECT * FROM t1, t2 FORCE INDEX (<em class="replaceable"><code>index_for_column</code></em>)
  WHERE t1.<em class="replaceable"><code>col_name</code></em>=t2.<em class="replaceable"><code>col_name</code></em>;
</pre><p>
            See <a href="sql-syntax.html#index-hints" title="12.2.9.2. Index Hint Syntax">Section 12.2.9.2, “Index Hint Syntax”</a>.
          </p></li><li><p>
            Start <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> with the
            <a href="server-administration.html#sysvar_max_seeks_for_key"><code class="option">--max-seeks-for-key=1000</code></a>
            option or use <code class="literal">SET max_seeks_for_key=1000</code>
            to tell the optimizer to assume that no key scan causes more
            than 1,000 key seeks. See
            <a href="server-administration.html#server-system-variables" title="5.1.3. Server System Variables">Section 5.1.3, “Server System Variables”</a>.
          </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="information-schema-optimization"></a>7.2.24. <code class="literal">INFORMATION_SCHEMA</code> Optimization</h3></div></div></div><p>
        As of MySQL 6.0.4, the implementation of
        <code class="literal">INFORMATION_SCHEMA</code> is such that certain types
        of queries for <code class="literal">INFORMATION_SCHEMA</code> tables can
        be optimized to execute more quickly. This section provides
        guidelines on writing queries that take advantage of these
        optimizations. In general, the strategies outlined here minimize
        the need for the server to access the file system to obtain the
        information that makes up the contents of
        <code class="literal">INFORMATION_SCHEMA</code> tables. By writing queries
        that enable the server to avoid directory scans or opening table
        files, you will obtain better performance.
      </p><p>
        <span class="bold"><strong>1) Try to use constant lookup values for
        database and table names in the <code class="literal">WHERE</code>
        clause</strong></span>
      </p><p>
        You can take advantage of this principle as follows:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            To look up databases or tables, use expressions that
            evaluate to a constant, such as literal values, functions
            that return a constant, or scalar subqueries.
          </p></li><li><p>
            Avoid queries that use a non-constant database name lookup
            value (or no lookup value) because they require a scan of
            the data directory to find matching database directory
            names.
          </p></li><li><p>
            Within a database, avoid queries that use a non-constant
            table name lookup value (or no lookup value) because they
            require a scan of the database directory to find matching
            table files.
          </p></li></ul></div><p>
        This principle applies to the
        <code class="literal">INFORMATION_SCHEMA</code> tables shown in the
        following table, which shows the columns for which a constant
        lookup value enables the server to avoid a directory scan. For
        example, if you are selecting from
        <a href="information-schema.html#tables-table" title="19.2. The INFORMATION_SCHEMA TABLES Table"><code class="literal">TABLES</code></a>, using a constant lookup
        value for <code class="literal">TABLE_SCHEMA</code> in the
        <code class="literal">WHERE</code> clause enables a data directory scan to
        be avoided.
      </p><div class="informaltable"><table border="1"><colgroup><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Table</strong></span></td><td><span class="bold"><strong>Column to specify to avoid data directory
                scan</strong></span></td><td><span class="bold"><strong>Column to specify to avoid database directory
                scan</strong></span></td></tr><tr><td><a href="information-schema.html#columns-table" title="19.3. The INFORMATION_SCHEMA COLUMNS Table"><code class="literal">COLUMNS</code></a></td><td><code class="literal">TABLE_SCHEMA</code></td><td><code class="literal">TABLE_NAME</code></td></tr><tr><td><a href="information-schema.html#key-column-usage-table" title="19.13. The INFORMATION_SCHEMA KEY_COLUMN_USAGE Table"><code class="literal">KEY_COLUMN_USAGE</code></a></td><td><code class="literal">TABLE_SCHEMA</code></td><td><code class="literal">TABLE_NAME</code></td></tr><tr><td><a href="information-schema.html#partitions-table" title="19.19. The INFORMATION_SCHEMA PARTITIONS Table"><code class="literal">PARTITIONS</code></a></td><td><code class="literal">TABLE_SCHEMA</code></td><td><code class="literal">TABLE_NAME</code></td></tr><tr><td><a href="information-schema.html#referential-constraints-table" title="19.24. The INFORMATION_SCHEMA REFERENTIAL_CONSTRAINTS Table"><code class="literal">REFERENTIAL_CONSTRAINTS</code></a></td><td><code class="literal">CONSTRAINT_SCHEMA</code></td><td><code class="literal">TABLE_NAME</code></td></tr><tr><td><a href="information-schema.html#statistics-table" title="19.4. The INFORMATION_SCHEMA STATISTICS Table"><code class="literal">STATISTICS</code></a></td><td><code class="literal">TABLE_SCHEMA</code></td><td><code class="literal">TABLE_NAME</code></td></tr><tr><td><a href="information-schema.html#tables-table" title="19.2. The INFORMATION_SCHEMA TABLES Table"><code class="literal">TABLES</code></a></td><td><code class="literal">TABLE_SCHEMA</code></td><td><code class="literal">TABLE_NAME</code></td></tr><tr><td><a href="information-schema.html#table-constraints-table" title="19.12. The INFORMATION_SCHEMA TABLE_CONSTRAINTS Table"><code class="literal">TABLE_CONSTRAINTS</code></a></td><td><code class="literal">TABLE_SCHEMA</code></td><td><code class="literal">TABLE_NAME</code></td></tr><tr><td><a href="information-schema.html#triggers-table" title="19.16. The INFORMATION_SCHEMA TRIGGERS Table"><code class="literal">TRIGGERS</code></a></td><td><code class="literal">EVENT_OBJECT_SCHEMA</code></td><td><code class="literal">EVENT_OBJECT_TABLE</code></td></tr><tr><td><a href="information-schema.html#views-table" title="19.15. The INFORMATION_SCHEMA VIEWS Table"><code class="literal">VIEWS</code></a></td><td><code class="literal">TABLE_SCHEMA</code></td><td><code class="literal">TABLE_NAME</code></td></tr></tbody></table></div><p>
        The benefit of a query that is limited to a specific constant
        database name is that checks need be made only for the named
        database directory. Example:
      </p><pre class="programlisting">SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_SCHEMA = 'test';
</pre><p>
        Use of the literal database name <code class="literal">test</code> enables
        the server to check only the <code class="literal">test</code> database
        directory, regardless of how many databases there might be. By
        contrast, the following query is less efficient because it
        requires a scan of the data directory to determine which
        database names match the pattern <code class="literal">'test%'</code>:
      </p><pre class="programlisting">SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_SCHEMA LIKE 'test%';
</pre><p>
        For a query that is limited to a specific constant table name,
        checks need be made only for the named table within the
        corresponding database directory. Example:
      </p><pre class="programlisting">SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_SCHEMA = 'test' AND TABLE_NAME = 't1';
</pre><p>
        Use of the literal table name <code class="literal">t1</code> enables the
        server to check only the files for the <code class="literal">t1</code>
        table, regardless of how many tables there might be in the
        <code class="literal">test</code> database. By contrast, the following
        query requires a scan of the <code class="literal">test</code> database
        directory to determine which table names match the pattern
        <code class="literal">'t%'</code>:
      </p><pre class="programlisting">SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_SCHEMA = 'test' AND TABLE_NAME LIKE 't%';
</pre><p>
        The following query requires a scan of the database directory to
        determine matching database names for the pattern
        <code class="literal">'test%'</code>, and for each matching database, it
        requires a scan of the database directory to determine matching
        table names for the pattern <code class="literal">'t%'</code>:
      </p><pre class="programlisting">SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_SCHEMA = 'test%' AND TABLE_NAME LIKE 't%';
</pre><p>
        <span class="bold"><strong>2) Write queries that minimize the number
        of table files that must be opened</strong></span>
      </p><p>
        For queries that refer to certain
        <code class="literal">INFORMATION_SCHEMA</code> table columns, several
        optimizations are available that minimize the number of table
        files that must be opened. Example:
      </p><pre class="programlisting">SELECT TABLE_NAME, ENGINE FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_SCHEMA = 'test';
</pre><p>
        In this case, after the server has scanned the database
        directory to determine the names of the tables in the database,
        those names become available with no further file system
        lookups. Thus, <code class="literal">TABLE_NAME</code> requires no files
        to be opened. The <code class="literal">ENGINE</code> (storage engine)
        value can be determined by opening the table's
        <code class="filename">.frm</code> file, without touching other table
        files such as the <code class="filename">.MYD</code> or
        <code class="filename">.MYI</code> file.
      </p><p>
        Some values, such as <code class="literal">INDEX_LENGTH</code> for
        <code class="literal">MyISAM</code> tables, require opening the
        <code class="filename">.MYD</code> or <code class="filename">.MYI</code> file as
        well.
      </p><p>
        The file-opening optimization types are denoted thus:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            <code class="literal">SKIP_OPEN_TABLE</code>: Table files do not need
            to be opened. The information has already become available
            within the query by scanning the database directory.
          </p></li><li><p>
            <code class="literal">OPEN_FRM_ONLY</code>: Only the table's
            <code class="filename">.frm</code> file need be opened.
          </p></li><li><p>
            <code class="literal">OPEN_TRIGGER_ONLY</code>: Only the table's
            <code class="filename">.TRG</code> file need be opened.
          </p></li><li><p>
            <code class="literal">OPEN_FULL_TABLE</code>: The unoptimized
            information lookup. The <code class="filename">.frm</code>,
            <code class="filename">.MYD</code>, and <code class="filename">.MYI</code>
            files must be opened.
          </p></li></ul></div><p>
        The following list indicates how the preceding optimization
        types apply to <code class="literal">INFORMATION_SCHEMA</code> table
        columns. For tables and columns not named, none of the
        optimizations apply.
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            <a href="information-schema.html#columns-table" title="19.3. The INFORMATION_SCHEMA COLUMNS Table"><code class="literal">COLUMNS</code></a>:
            <code class="literal">OPEN_FRM_ONLY</code> applies to all columns
          </p></li><li><p>
            <a href="information-schema.html#key-column-usage-table" title="19.13. The INFORMATION_SCHEMA KEY_COLUMN_USAGE Table"><code class="literal">KEY_COLUMN_USAGE</code></a>:
            <code class="literal">OPEN_FULL_TABLE</code> applies to all columns
          </p></li><li><p>
            <a href="information-schema.html#partitions-table" title="19.19. The INFORMATION_SCHEMA PARTITIONS Table"><code class="literal">PARTITIONS</code></a>:
            <code class="literal">OPEN_FULL_TABLE</code> applies to all columns
          </p></li><li><p>
            <a href="information-schema.html#referential-constraints-table" title="19.24. The INFORMATION_SCHEMA REFERENTIAL_CONSTRAINTS Table"><code class="literal">REFERENTIAL_CONSTRAINTS</code></a>:
            <code class="literal">OPEN_FULL_TABLE</code> applies to all columns
          </p></li><li><p>
            <a href="information-schema.html#statistics-table" title="19.4. The INFORMATION_SCHEMA STATISTICS Table"><code class="literal">STATISTICS</code></a>:
          </p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Column</strong></span></td><td><span class="bold"><strong>Optimization type</strong></span></td></tr><tr><td><code class="literal">TABLE_CATALOG</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td><code class="literal">TABLE_SCHEMA</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td><code class="literal">TABLE_NAME</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td><code class="literal">NON_UNIQUE</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td><code class="literal">INDEX_SCHEMA</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td><code class="literal">INDEX_NAME</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td><code class="literal">SEQ_IN_INDEX</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td><code class="literal">COLUMN_NAME</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td><code class="literal">COLLATION</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td><code class="literal">CARDINALITY</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td><code class="literal">SUB_PART</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td><code class="literal">PACKED</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td><code class="literal">NULLABLE</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td><code class="literal">INDEX_TYPE</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td><code class="literal">COMMENT</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr></tbody></table></div></li><li><p>
            <a href="information-schema.html#tables-table" title="19.2. The INFORMATION_SCHEMA TABLES Table"><code class="literal">TABLES</code></a>:
          </p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Column</strong></span></td><td><span class="bold"><strong>Optimization type</strong></span></td></tr><tr><td><code class="literal">TABLE_CATALOG</code></td><td><code class="literal">SKIP_OPEN_TABLE</code></td></tr><tr><td><code class="literal">TABLE_SCHEMA</code></td><td><code class="literal">SKIP_OPEN_TABLE</code></td></tr><tr><td><code class="literal">TABLE_NAME</code></td><td><code class="literal">SKIP_OPEN_TABLE</code></td></tr><tr><td><code class="literal">TABLE_TYPE</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td><code class="literal">ENGINE</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td><code class="literal">VERSION</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td><code class="literal">ROW_FORMAT</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td><code class="literal">TABLE_ROWS</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td><code class="literal">AVG_ROW_LENGTH</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td><code class="literal">DATA_LENGTH</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td><code class="literal">MAX_DATA_LENGTH</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td><code class="literal">INDEX_LENGTH</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td><code class="literal">DATA_FREE</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td><code class="literal">AUTO_INCREMENT</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td><code class="literal">CREATE_TIME</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td><code class="literal">UPDATE_TIME</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td><code class="literal">CHECK_TIME</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td><code class="literal">TABLE_COLLATION</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td><code class="literal">CHECKSUM</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td><code class="literal">CREATE_OPTIONS</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td><code class="literal">TABLE_COMMENT</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr></tbody></table></div></li><li><p>
            <a href="information-schema.html#table-constraints-table" title="19.12. The INFORMATION_SCHEMA TABLE_CONSTRAINTS Table"><code class="literal">TABLE_CONSTRAINTS</code></a>:
            <code class="literal">OPEN_FULL_TABLE</code> applies to all columns
          </p></li><li><p>
            <a href="information-schema.html#triggers-table" title="19.16. The INFORMATION_SCHEMA TRIGGERS Table"><code class="literal">TRIGGERS</code></a>:
            <code class="literal">OPEN_TRIGGER_ONLY</code> applies to all columns
          </p></li><li><p>
            <a href="information-schema.html#views-table" title="19.15. The INFORMATION_SCHEMA VIEWS Table"><code class="literal">VIEWS</code></a>:
          </p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Column</strong></span></td><td><span class="bold"><strong>Optimization type</strong></span></td></tr><tr><td><code class="literal">TABLE_CATALOG</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td><code class="literal">TABLE_SCHEMA</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td><code class="literal">TABLE_NAME</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td><code class="literal">VIEW_DEFINITION</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td><code class="literal">CHECK_OPTION</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td><code class="literal">IS_UPDATABLE</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td><code class="literal">DEFINER</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td><code class="literal">SECURITY_TYPE</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td><code class="literal">CHARACTER_SET_CLIENT</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td><code class="literal">COLLATION_CONNECTION</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr></tbody></table></div></li></ul></div><p>
        <span class="bold"><strong>3) Use
        <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> to determine whether the
        server can use <code class="literal">INFORMATION_SCHEMA</code>
        optimizations for a query</strong></span>
      </p><p>
        The <code class="literal">Extra</code> value in
        <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output indicates which,
        if any, of the optimizations described earlier the server can
        use to evaluate <code class="literal">INFORMATION_SCHEMA</code> queries.
        The following examples demonstrate the kinds of information you
        can expect to see in the <code class="literal">Extra</code> value.
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>EXPLAIN SELECT TABLE_NAME FROM INFORMATION_SCHEMA.VIEWS WHERE</code></strong>
    -&gt; <strong class="userinput"><code>TABLE_SCHEMA = 'test' AND TABLE_NAME = 'v1'\G</code></strong>
*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: VIEWS
         type: ALL
possible_keys: NULL
          key: TABLE_SCHEMA,TABLE_NAME
      key_len: NULL
          ref: NULL
         rows: NULL
        Extra: Using where; Open_frm_only; Scanned 0 databases
</pre><p>
        Use of constant database and table lookup values enables the
        server to avoid directory scans. For references to
        <code class="literal">VIEWS.TABLE_NAME</code>, only the
        <code class="filename">.frm</code> file need be opened.
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>EXPLAIN SELECT TABLE_NAME, ROW_FORMAT FROM INFORMATION_SCHEMA.TABLES\G</code></strong>
*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: TABLES
         type: ALL
possible_keys: NULL
          key: NULL
      key_len: NULL
          ref: NULL
         rows: NULL
        Extra: Open_full_table; Scanned all databases
</pre><p>
        No lookup values are provided (there is no
        <code class="literal">WHERE</code> clause), so the server must scan the
        data directory and each database directory. For each table thus
        identified, the table name and row format are selected.
        <code class="literal">TABLE_NAME</code> requires no further table files to
        be opened (the <code class="literal">SKIP_OPEN_TABLE</code> optimization
        applies). <code class="literal">ROW_FORMAT</code> requires all table files
        to be opened (<code class="literal">OPEN_FULL_TABLE</code> applies).
        <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> reports
        <code class="literal">OPEN_FULL_TABLE</code> because it is more expensive
        than <code class="literal">SKIP_OPEN_TABLE</code>.
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>EXPLAIN SELECT TABLE_NAME, TABLE_TYPE FROM INFORMATION_SCHEMA.TABLES</code></strong>
    -&gt; <strong class="userinput"><code>WHERE TABLE_SCHEMA = 'test'\G</code></strong>
*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: TABLES
         type: ALL
possible_keys: NULL
          key: TABLE_SCHEMA
      key_len: NULL
          ref: NULL
         rows: NULL
        Extra: Using where; Open_frm_only; Scanned 1 database
</pre><p>
        No table name lookup value is provided, so the server must scan
        the <code class="literal">test</code> database directory. For the
        <code class="literal">TABLE_NAME</code> and <code class="literal">TABLE_TYPE</code>
        columns, the <code class="literal">SKIP_OPEN_TABLE</code> and
        <code class="literal">OPEN_FRM_ONLY</code> optimizations apply,
        respectively. <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> reports
        <code class="literal">OPEN_FRM_ONLY</code> because it is more expensive.
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>EXPLAIN SELECT B.TABLE_NAME</code></strong>
    -&gt; <strong class="userinput"><code>FROM INFORMATION_SCHEMA.TABLES AS A, INFORMATION_SCHEMA.COLUMNS AS B</code></strong>
    -&gt; <strong class="userinput"><code>WHERE A.TABLE_SCHEMA = 'test'</code></strong>
    -&gt; <strong class="userinput"><code>AND A.TABLE_NAME = 't1'</code></strong>
    -&gt; <strong class="userinput"><code>AND B.TABLE_NAME = A.TABLE_NAME\G</code></strong>
*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: A
         type: ALL
possible_keys: NULL
          key: TABLE_SCHEMA,TABLE_NAME
      key_len: NULL
          ref: NULL
         rows: NULL
        Extra: Using where; Skip_open_table; Scanned 0 databases
*************************** 2. row ***************************
           id: 1
  select_type: SIMPLE
        table: B
         type: ALL
possible_keys: NULL
          key: NULL
      key_len: NULL
          ref: NULL
         rows: NULL
        Extra: Using where; Open_frm_only; Scanned all databases;
               Using join buffer
</pre><p>
        For the first <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output row:
        Constant database and table lookup values enable the server to
        avoid directory scans for <code class="literal">TABLES</code> values.
        References to <code class="literal">TABLES.TABLE_NAME</code> require no
        further table files.
      </p><p>
        For the second <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output
        row: All <a href="information-schema.html#columns-table" title="19.3. The INFORMATION_SCHEMA COLUMNS Table"><code class="literal">COLUMNS</code></a> table values are
        <code class="literal">OPEN_FRM_ONLY</code> lookups, so
        <code class="literal">COLUMNS.TABLE_NAME</code> requires the
        <code class="filename">.frm</code> file to be opened.
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>EXPLAIN SELECT * FROM INFORMATION_SCHEMA.COLLATIONS\G</code></strong>
*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: COLLATIONS
         type: ALL
possible_keys: NULL
          key: NULL
      key_len: NULL
          ref: NULL
         rows: NULL
        Extra: 
</pre><p>
        In this case, no optimizations apply because
        <a href="information-schema.html#collations-table" title="19.10. The INFORMATION_SCHEMA COLLATIONS Table"><code class="literal">COLLATIONS</code></a> is not one of the
        <code class="literal">INFORMATION_SCHEMA</code> tables for which
        optimizations are available.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="insert-speed"></a>7.2.25. Speed of <code class="literal">INSERT</code> Statements</h3></div></div></div><a class="indexterm" name="id3180210"></a><a class="indexterm" name="id3180219"></a><a class="indexterm" name="id3180232"></a><p>
        The time required for inserting a row is determined by the
        following factors, where the numbers indicate approximate
        proportions:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Connecting: (3)
          </p></li><li><p>
            Sending query to server: (2)
          </p></li><li><p>
            Parsing query: (2)
          </p></li><li><p>
            Inserting row: (1 × size of row)
          </p></li><li><p>
            Inserting indexes: (1 × number of indexes)
          </p></li><li><p>
            Closing: (1)
          </p></li></ul></div><p>
        This does not take into consideration the initial overhead to
        open tables, which is done once for each concurrently running
        query.
      </p><p>
        The size of the table slows down the insertion of indexes by log
        <em class="replaceable"><code>N</code></em>, assuming B-tree indexes.
      </p><p>
        You can use the following methods to speed up inserts:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            If you are inserting many rows from the same client at the
            same time, use <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>
            statements with multiple <code class="literal">VALUES</code> lists to
            insert several rows at a time. This is considerably faster
            (many times faster in some cases) than using separate
            single-row <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements.
            If you are adding data to a non-empty table, you can tune
            the <a href="server-administration.html#sysvar_bulk_insert_buffer_size"><code class="literal">bulk_insert_buffer_size</code></a>
            variable to make data insertion even faster. See
            <a href="server-administration.html#server-system-variables" title="5.1.3. Server System Variables">Section 5.1.3, “Server System Variables”</a>.
          </p></li><li><p>
            If multiple clients are inserting a lot of rows, you can get
            higher speed by using the <a href="sql-syntax.html#insert-delayed" title="12.2.5.2. INSERT DELAYED Syntax"><code class="literal">INSERT
            DELAYED</code></a> statement. See
            <a href="sql-syntax.html#insert-delayed" title="12.2.5.2. INSERT DELAYED Syntax">Section 12.2.5.2, “<code class="literal">INSERT DELAYED</code> Syntax”</a>.
          </p></li><li><p>
            For a <code class="literal">MyISAM</code> table, you can use
            concurrent inserts to add rows at the same time that
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements are
            running, if there are no deleted rows in middle of the data
            file. See <a href="optimization.html#concurrent-inserts" title="7.3.3. Concurrent Inserts">Section 7.3.3, “Concurrent Inserts”</a>.
          </p></li><li><p>
            When loading a table from a text file, use
            <a href="sql-syntax.html#load-data" title="12.2.6. LOAD DATA INFILE
      Syntax"><code class="literal">LOAD DATA
            INFILE</code></a>. This is usually 20 times faster than using
            <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements. See
            <a href="sql-syntax.html#load-data" title="12.2.6. LOAD DATA INFILE
      Syntax">Section 12.2.6, “<code class="literal">LOAD DATA INFILE</code>
      Syntax”</a>.
          </p></li><li><p>
            With some extra work, it is possible to make
            <a href="sql-syntax.html#load-data" title="12.2.6. LOAD DATA INFILE
      Syntax"><code class="literal">LOAD DATA
            INFILE</code></a> run even faster for a
            <code class="literal">MyISAM</code> table when the table has many
            indexes. Use the following procedure:
          </p><div class="orderedlist"><ol type="1"><li><p>
                Optionally create the table with
                <a href="sql-syntax.html#create-table" title="12.1.14. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>.
              </p></li><li><p>
                Execute a <a href="sql-syntax.html#flush" title="12.5.7.3. FLUSH Syntax"><code class="literal">FLUSH
                TABLES</code></a> statement or a <a href="programs.html#mysqladmin" title="4.5.2. mysqladmin — Client for Administering a MySQL Server"><span><strong class="command">mysqladmin
                flush-tables</strong></span></a> command.
              </p></li><li><p>
                Use <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk --keys-used=0 -rq
                <em class="replaceable"><code>/path/to/db/tbl_name</code></em>.</strong></span></a>
                This removes all use of indexes for the table.
              </p></li><li><p>
                Insert data into the table with
                <a href="sql-syntax.html#load-data" title="12.2.6. LOAD DATA INFILE
      Syntax"><code class="literal">LOAD DATA
                INFILE</code></a>. This does not update any indexes and
                therefore is very fast.
              </p></li><li><p>
                If you intend only to read from the table in the future,
                use <a href="programs.html#myisampack" title="4.6.5. myisampack — Generate Compressed, Read-Only MyISAM Tables"><span><strong class="command">myisampack</strong></span></a> to compress it. See
                <a href="storage-engines.html#compressed-format" title="13.5.3.3. Compressed Table Characteristics">Section 13.5.3.3, “Compressed Table Characteristics”</a>.
              </p></li><li><p>
                Re-create the indexes with <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk -rq
                <em class="replaceable"><code>/path/to/db/tbl_name</code></em></strong></span></a>.
                This creates the index tree in memory before writing it
                to disk, which is much faster that updating the index
                during <a href="sql-syntax.html#load-data" title="12.2.6. LOAD DATA INFILE
      Syntax"><code class="literal">LOAD
                DATA INFILE</code></a> because it avoids lots of disk
                seeks. The resulting index tree is also perfectly
                balanced.
              </p></li><li><p>
                Execute a <a href="sql-syntax.html#flush" title="12.5.7.3. FLUSH Syntax"><code class="literal">FLUSH
                TABLES</code></a> statement or a <a href="programs.html#mysqladmin" title="4.5.2. mysqladmin — Client for Administering a MySQL Server"><span><strong class="command">mysqladmin
                flush-tables</strong></span></a> command.
              </p></li></ol></div><p>
            <a href="sql-syntax.html#load-data" title="12.2.6. LOAD DATA INFILE
      Syntax"><code class="literal">LOAD DATA
            INFILE</code></a> performs the preceding optimization
            automatically if the <code class="literal">MyISAM</code> table into
            which you insert data is empty. The main difference between
            automatic optimization and using the procedure explicitly is
            that you can let <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a> allocate much
            more temporary memory for the index creation than you might
            want the server to allocate for index re-creation when it
            executes the <a href="sql-syntax.html#load-data" title="12.2.6. LOAD DATA INFILE
      Syntax"><code class="literal">LOAD
            DATA INFILE</code></a> statement.
          </p><p>
            You can also disable or enable the non-unique indexes for a
            <code class="literal">MyISAM</code> table by using the following
            statements rather than <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a>. If you
            use these statements, you can skip the
            <a href="sql-syntax.html#flush" title="12.5.7.3. FLUSH Syntax"><code class="literal">FLUSH TABLE</code></a>
            operations:
          </p><pre class="programlisting">ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> DISABLE KEYS;
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> ENABLE KEYS;
</pre></li><li><p>
            To speed up <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> operations
            that are performed with multiple statements for
            non-transactional tables, lock your tables:
          </p><pre class="programlisting">LOCK TABLES a WRITE;
INSERT INTO a VALUES (1,23),(2,34),(4,33);
INSERT INTO a VALUES (8,26),(6,29);
...
UNLOCK TABLES;
</pre><p>
            This benefits performance because the index buffer is
            flushed to disk only once, after all
            <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements have
            completed. Normally, there would be as many index buffer
            flushes as there are <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>
            statements. Explicit locking statements are not needed if
            you can insert all rows with a single
            <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>.
          </p><p>
            To obtain faster insertions for transactional tables, you
            should use <a href="sql-syntax.html#commit" title="12.4.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">START
            TRANSACTION</code></a> and
            <a href="sql-syntax.html#commit" title="12.4.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">COMMIT</code></a> instead of
            <a href="sql-syntax.html#lock-tables" title="12.4.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">LOCK TABLES</code></a>.
          </p><p>
            Locking also lowers the total time for multiple-connection
            tests, although the maximum wait time for individual
            connections might go up because they wait for locks. Suppose
            that five clients attempt to perform inserts simultaneously
            as follows:
          </p><div class="itemizedlist"><ul type="circle"><li><p>
                Connection 1 does 1000 inserts
              </p></li><li><p>
                Connections 2, 3, and 4 do 1 insert
              </p></li><li><p>
                Connection 5 does 1000 inserts
              </p></li></ul></div><p>
            If you do not use locking, connections 2, 3, and 4 finish
            before 1 and 5. If you use locking, connections 2, 3, and 4
            probably do not finish before 1 or 5, but the total time
            should be about 40% faster.
          </p><p>
            <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
            <a href="sql-syntax.html#update" title="12.2.12. UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
            <a href="sql-syntax.html#delete" title="12.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> operations are very
            fast in MySQL, but you can obtain better overall performance
            by adding locks around everything that does more than about
            five successive inserts or updates. If you do very many
            successive inserts, you could do a <a href="sql-syntax.html#lock-tables" title="12.4.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">LOCK
            TABLES</code></a> followed by an
            <a href="sql-syntax.html#lock-tables" title="12.4.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">UNLOCK
            TABLES</code></a> once in a while (each 1,000 rows or so) to
            allow other threads access to the table. This would still
            result in a nice performance gain.
          </p><p>
            <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> is still much slower
            for loading data than
            <a href="sql-syntax.html#load-data" title="12.2.6. LOAD DATA INFILE
      Syntax"><code class="literal">LOAD DATA
            INFILE</code></a>, even when using the strategies just
            outlined.
          </p></li><li><p>
            To increase performance for <code class="literal">MyISAM</code>
            tables, for both
            <a href="sql-syntax.html#load-data" title="12.2.6. LOAD DATA INFILE
      Syntax"><code class="literal">LOAD DATA
            INFILE</code></a> and <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
            enlarge the key cache by increasing the
            <a href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a> system
            variable. See <a href="optimization.html#server-parameters" title="7.5.3. Tuning Server Parameters">Section 7.5.3, “Tuning Server Parameters”</a>.
          </p></li></ul></div><p class="mnmas"><b>MySQL Enterprise</b>
          For more advice on optimizing the performance of your server,
          subscribe to the MySQL Enterprise Monitor. Numerous advisors
          are dedicated to monitoring performance. For more information,
          see <a href="http://www.mysql.com/products/enterprise/advisors.html" target="_top">http://www.mysql.com/products/enterprise/advisors.html</a>.
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="update-speed"></a>7.2.26. Speed of <code class="literal">UPDATE</code> Statements</h3></div></div></div><p>
        An update statement is optimized like a
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> query with the additional
        overhead of a write. The speed of the write depends on the
        amount of data being updated and the number of indexes that are
        updated. Indexes that are not changed do not get updated.
      </p><p>
        Another way to get fast updates is to delay updates and then do
        many updates in a row later. Performing multiple updates
        together is much quicker than doing one at a time if you lock
        the table.
      </p><p>
        For a <code class="literal">MyISAM</code> table that uses dynamic row
        format, updating a row to a longer total length may split the
        row. If you do this often, it is very important to use
        <a href="sql-syntax.html#optimize-table" title="12.5.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> occasionally. See
        <a href="sql-syntax.html#optimize-table" title="12.5.2.4. OPTIMIZE TABLE Syntax">Section 12.5.2.4, “<code class="literal">OPTIMIZE TABLE</code> Syntax”</a>.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="delete-speed"></a>7.2.27. Speed of <code class="literal">DELETE</code> Statements</h3></div></div></div><p>
        The time required to delete individual rows is exactly
        proportional to the number of indexes. To delete rows more
        quickly, you can increase the size of the key cache by
        increasing the <a href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a>
        system variable. See <a href="optimization.html#server-parameters" title="7.5.3. Tuning Server Parameters">Section 7.5.3, “Tuning Server Parameters”</a>.
      </p><p>
        To delete all rows from a table, <code class="literal">TRUNCATE TABLE
        <em class="replaceable"><code>tbl_name</code></em></code> is faster than
        than <code class="literal">DELETE FROM
        <em class="replaceable"><code>tbl_name</code></em></code>. Truncate
        operations are not transaction-safe; an error occurs when
        attempting one in the course of an active transaction or active
        table lock. See <a href="sql-syntax.html#truncate" title="12.2.11. TRUNCATE Syntax">Section 12.2.11, “<code class="literal">TRUNCATE</code> Syntax”</a>.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="miscellaneous-optimization-tips"></a>7.2.28. Other Optimization Tips</h3></div></div></div><a class="indexterm" name="id3181088"></a><a class="indexterm" name="id3181101"></a><p>
        This section lists a number of miscellaneous tips for improving
        query processing speed:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Use persistent connections to the database to avoid
            connection overhead. If you cannot use persistent
            connections and you are initiating many new connections to
            the database, you may want to change the value of the
            <a href="server-administration.html#sysvar_thread_cache_size"><code class="literal">thread_cache_size</code></a> variable.
            See <a href="optimization.html#server-parameters" title="7.5.3. Tuning Server Parameters">Section 7.5.3, “Tuning Server Parameters”</a>.
          </p></li><li><p>
            Always check whether all your queries really use the indexes
            that you have created in the tables. In MySQL, you can do
            this with the <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a>
            statement. See <a href="optimization.html#using-explain" title="7.2.1. Optimizing Queries with EXPLAIN">Section 7.2.1, “Optimizing Queries with <code class="literal">EXPLAIN</code>”</a>.
          </p></li><li><p>
            Try to avoid complex <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
            queries on <code class="literal">MyISAM</code> tables that are updated
            frequently, to avoid problems with table locking that occur
            due to contention between readers and writers.
          </p></li><li><p>
            <code class="literal">MyISAM</code> supports concurrent inserts: If a
            table has no free blocks in the middle of the data file, you
            can <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> new rows into it
            at the same time that other threads are reading from the
            table. If it is important to be able to do this, you should
            consider using the table in ways that avoid deleting rows.
            Another possibility is to run <a href="sql-syntax.html#optimize-table" title="12.5.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE
            TABLE</code></a> to defragment the table after you have
            deleted a lot of rows from it. This behavior is altered by
            setting the
            <a href="server-administration.html#sysvar_concurrent_insert"><code class="literal">concurrent_insert</code></a> variable.
            You can force new rows to be appended (and therefore allow
            concurrent inserts), even in tables that have deleted rows.
            See <a href="optimization.html#concurrent-inserts" title="7.3.3. Concurrent Inserts">Section 7.3.3, “Concurrent Inserts”</a>.
          </p><p class="mnmas"><b>MySQL Enterprise</b>
              For optimization tips geared to your specific
              circumstances subscribe to the MySQL Enterprise Monitor.
              For more information, see
              <a href="http://www.mysql.com/products/enterprise/advisors.html" target="_top">http://www.mysql.com/products/enterprise/advisors.html</a>.
            </p></li><li><p>
            To fix any compression issues that may have occurred with
            <code class="literal">ARCHIVE</code> tables, you can use
            <a href="sql-syntax.html#optimize-table" title="12.5.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>. See
            <a href="storage-engines.html#archive-storage-engine" title="13.13. The ARCHIVE Storage Engine">Section 13.13, “The <code class="literal">ARCHIVE</code> Storage Engine”</a>.
          </p></li><li><p>
            Use <code class="literal">ALTER TABLE ... ORDER BY
            <em class="replaceable"><code>expr1</code></em>,
            <em class="replaceable"><code>expr2</code></em>, ...</code> if you
            usually retrieve rows in
            <code class="literal"><em class="replaceable"><code>expr1</code></em>,
            <em class="replaceable"><code>expr2</code></em>, ...</code> order. By
            using this option after extensive changes to the table, you
            may be able to get higher performance.
          </p></li><li><p>
            In some cases, it may make sense to introduce a column that
            is “<span class="quote">hashed</span>” based on information from other
            columns. If this column is short, reasonably unique, and
            indexed, it may be much faster than a “<span class="quote">wide</span>”
            index on many columns. In MySQL, it is very easy to use this
            extra column:
          </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>tbl_name</code></em>
  WHERE <em class="replaceable"><code>hash_col</code></em>=MD5(CONCAT(<em class="replaceable"><code>col1</code></em>,<em class="replaceable"><code>col2</code></em>))
  AND <em class="replaceable"><code>col1</code></em>='<em class="replaceable"><code>constant</code></em>' AND <em class="replaceable"><code>col2</code></em>='<em class="replaceable"><code>constant</code></em>';
</pre></li><li><p>
            For <code class="literal">MyISAM</code> tables that change frequently,
            you should try to avoid all variable-length columns
            (<a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">VARCHAR</code></a>,
            <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a>, and
            <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">TEXT</code></a>). The table uses dynamic
            row format if it includes even a single variable-length
            column. See <a href="storage-engines.html" title="Chapter 13. Storage Engines">Chapter 13, <i>Storage Engines</i></a>.
          </p></li><li><p>
            It is normally not useful to split a table into different
            tables just because the rows become large. In accessing a
            row, the biggest performance hit is the disk seek needed to
            find the first byte of the row. After finding the data, most
            modern disks can read the entire row fast enough for most
            applications. The only cases where splitting up a table
            makes an appreciable difference is if it is a
            <code class="literal">MyISAM</code> table using dynamic row format
            that you can change to a fixed row size, or if you very
            often need to scan the table but do not need most of the
            columns. See <a href="storage-engines.html" title="Chapter 13. Storage Engines">Chapter 13, <i>Storage Engines</i></a>.
          </p></li><li><p>
            If you often need to calculate results such as counts based
            on information from a lot of rows, it may be preferable to
            introduce a new table and update the counter in real time.
            An update of the following form is very fast:
          </p><pre class="programlisting">UPDATE <em class="replaceable"><code>tbl_name</code></em> SET <em class="replaceable"><code>count_col</code></em>=<em class="replaceable"><code>count_col</code></em>+1 WHERE <em class="replaceable"><code>key_col</code></em>=<em class="replaceable"><code>constant</code></em>;
</pre><p>
            This is very important when you use MySQL storage engines
            such as <code class="literal">MyISAM</code> that has only table-level
            locking (multiple readers with single writers). This also
            gives better performance with most database systems, because
            the row locking manager in this case has less to do.
          </p></li><li><p>
            If you need to collect statistics from large log tables, use
            summary tables instead of scanning the entire log table.
            Maintaining the summaries should be much faster than trying
            to calculate statistics “<span class="quote">live.</span>” Regenerating
            new summary tables from the logs when things change
            (depending on business decisions) is faster than changing
            the running application.
          </p></li><li><p>
            If possible, you should classify reports as
            “<span class="quote">live</span>” or as “<span class="quote">statistical,</span>” where
            data needed for statistical reports is created only from
            summary tables that are generated periodically from the live
            data.
          </p></li><li><p>
            Take advantage of the fact that columns have default values.
            Insert values explicitly only when the value to be inserted
            differs from the default. This reduces the parsing that
            MySQL must do and improves the insert speed.
          </p></li><li><p>
            In some cases, it is convenient to pack and store data into
            a <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a> column. In this case,
            you must provide code in your application to pack and unpack
            information, but this may save a lot of accesses at some
            stage. This is practical when you have data that does not
            conform well to a rows-and-columns table structure.
          </p></li><li><p>
            Normally, you should try to keep all data non-redundant
            (observing what is referred to in database theory as
            <em class="firstterm">third normal form</em>). However, there
            may be situations in which it can be advantageous to
            duplicate information or create summary tables to gain more
            speed.
          </p></li><li><p>
            Stored routines or UDFs (user-defined functions) may be a
            good way to gain performance for some tasks. See
            <a href="stored-programs-views.html#stored-routines" title="18.2. Using Stored Routines (Procedures and Functions)">Section 18.2, “Using Stored Routines (Procedures and Functions)”</a>, and
            <a href="extending-mysql.html#adding-functions" title="21.3. Adding New Functions to MySQL">Section 21.3, “Adding New Functions to MySQL”</a>, for more information.
          </p></li><li><p>
            You can increase performance by caching queries or answers
            in your application and then executing many inserts or
            updates together. If your database system supports table
            locks (as do MySQL), this should help to ensure that the
            index cache is only flushed once after all updates. You can
            also take advantage of MySQL's query cache to achieve
            similar results; see <a href="optimization.html#query-cache" title="7.5.5. The MySQL Query Cache">Section 7.5.5, “The MySQL Query Cache”</a>.
          </p></li><li><p>
            Use <a href="sql-syntax.html#insert-delayed" title="12.2.5.2. INSERT DELAYED Syntax"><code class="literal">INSERT DELAYED</code></a> when you
            do not need to know when your data is written. This reduces
            the overall insertion impact because many rows can be
            written with a single disk write.
          </p></li><li><p>
            Use <code class="literal">INSERT LOW_PRIORITY</code> when you want to
            give <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements higher
            priority than your inserts.
          </p><p>
            Use <code class="literal">SELECT HIGH_PRIORITY</code> to get
            retrievals that jump the queue. That is, the
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> is executed even if
            there is another client waiting to do a write.
          </p><p>
            <code class="literal">LOW_PRIORITY</code> and
            <code class="literal">HIGH_PRIORITY</code> have an effect only for
            storage engines that use only table-level locking
            (<code class="literal">MyISAM</code>, <code class="literal">MEMORY</code>,
            <code class="literal">MERGE</code>).
          </p></li><li><p>
            Use multiple-row <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>
            statements to store many rows with one SQL statement. Many
            SQL servers support this, including MySQL.
          </p></li><li><p>
            Use <a href="sql-syntax.html#load-data" title="12.2.6. LOAD DATA INFILE
      Syntax"><code class="literal">LOAD DATA
            INFILE</code></a> to load large amounts of data. This is
            faster than using <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>
            statements.
          </p></li><li><p>
            Use <code class="literal">AUTO_INCREMENT</code> columns so that each
            row in a table can be identified by a single unique value.
            unique values.
          </p></li><li><p>
            Use <a href="sql-syntax.html#optimize-table" title="12.5.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> once in a
            while to avoid fragmentation with dynamic-format
            <code class="literal">MyISAM</code> tables. See
            <a href="storage-engines.html#myisam-table-formats" title="13.5.3. MyISAM Table Storage Formats">Section 13.5.3, “<code class="literal">MyISAM</code> Table Storage Formats”</a>.
          </p></li><li><p>
            Use <code class="literal">MEMORY</code> tables when possible to get
            more speed. See <a href="storage-engines.html#memory-storage-engine" title="13.10. The MEMORY (HEAP) Storage Engine">Section 13.10, “The <code class="literal">MEMORY</code> (<code class="literal">HEAP</code>) Storage Engine”</a>.
            <code class="literal">MEMORY</code> tables are useful for non-critical
            data that is accessed often, such as information about the
            last displayed banner for users who don't have cookies
            enabled in their Web browser. User sessions are another
            alternative available in many Web application environments
            for handling volatile state data.
          </p></li><li><p>
            With Web servers, images and other binary assets should
            normally be stored as files. That is, store only a reference
            to the file rather than the file itself in the database.
            Most Web servers are better at caching files than database
            contents, so using files is generally faster.
          </p></li><li><p>
            Columns with identical information in different tables
            should be declared to have identical data types so that
            joins based on the corresponding columns will be faster.
          </p></li><li><p>
            Try to keep column names simple. For example, in a table
            named <code class="literal">customer</code>, use a column name of
            <code class="literal">name</code> instead of
            <code class="literal">customer_name</code>. To make your names
            portable to other SQL servers, you should keep them shorter
            than 18 characters.
          </p></li><li><p>
            If you need really high speed, you should take a look at the
            low-level interfaces for data storage that the different SQL
            servers support. For example, by accessing the MySQL
            <code class="literal">MyISAM</code> storage engine directly, you could
            get a speed increase of two to five times compared to using
            the SQL interface. To be able to do this, the data must be
            on the same server as the application, and usually it should
            only be accessed by one process (because external file
            locking is really slow). One could eliminate these problems
            by introducing low-level <code class="literal">MyISAM</code> commands
            in the MySQL server (this could be one easy way to get more
            performance if needed). By carefully designing the database
            interface, it should be quite easy to support this type of
            optimization.
          </p></li><li><p>
            If you are using numerical data, it is faster in many cases
            to access information from a database (using a live
            connection) than to access a text file. Information in the
            database is likely to be stored in a more compact format
            than in the text file, so accessing it involves fewer disk
            accesses. You also save code in your application because you
            need not parse your text files to find line and column
            boundaries.
          </p></li><li><p>
            Replication can provide a performance benefit for some
            operations. You can distribute client retrievals among
            replication servers to split up the load. To avoid slowing
            down the master while making backups, you can make backups
            using a slave server. See <a href="replication.html" title="Chapter 16. Replication">Chapter 16, <i>Replication</i></a>.
          </p></li><li><p>
            Declaring a <code class="literal">MyISAM</code> table with the
            <code class="literal">DELAY_KEY_WRITE=1</code> table option makes
            index updates faster because they are not flushed to disk
            until the table is closed. The downside is that if something
            kills the server while such a table is open, you should
            ensure that the table is okay by running the server with the
            <a href="server-administration.html#option_mysqld_myisam-recover"><code class="option">--myisam-recover</code></a> option, or
            by running <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a> before restarting
            the server. (However, even in this case, you should not lose
            anything by using <code class="literal">DELAY_KEY_WRITE</code>,
            because the key information can always be generated from the
            data rows.)
          </p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="locking-issues"></a>7.3. Locking Issues</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="optimization.html#internal-locking">7.3.1. Internal Locking Methods</a></span></dt><dt><span class="section"><a href="optimization.html#table-locking">7.3.2. Table Locking Issues</a></span></dt><dt><span class="section"><a href="optimization.html#concurrent-inserts">7.3.3. Concurrent Inserts</a></span></dt><dt><span class="section"><a href="optimization.html#metadata-locking">7.3.4. Metadata Locking Within Transactions</a></span></dt><dt><span class="section"><a href="optimization.html#external-locking">7.3.5. External Locking</a></span></dt></dl></div><p>
      MySQL manages contention for table contents using locking:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          Internal locking is performed within the MySQL server itself
          to manage contention for table contents by multiple threads.
          This type of locking is internal because it is performed
          entirely by the server and involves no other programs. See
          <a href="optimization.html#internal-locking" title="7.3.1. Internal Locking Methods">Section 7.3.1, “Internal Locking Methods”</a>.
        </p></li><li><p>
          External locking occurs when the server and other programs
          lock table files to coordinate among themselves which program
          can access the tables at which time. See
          <a href="optimization.html#external-locking" title="7.3.5. External Locking">Section 7.3.5, “External Locking”</a>.
        </p></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="internal-locking"></a>7.3.1. Internal Locking Methods</h3></div></div></div><a class="indexterm" name="id3182059"></a><a class="indexterm" name="id3182068"></a><a class="indexterm" name="id3182080"></a><a class="indexterm" name="id3182090"></a><a class="indexterm" name="id3182102"></a><a class="indexterm" name="id3182111"></a><a class="indexterm" name="id3182120"></a><a class="indexterm" name="id3182132"></a><p>
        This section discusses internal locking; that is, locking
        performed within the MySQL server itself to manage contention
        for table contents by multiple sessions. This type of locking is
        internal because it is performed entirely by the server and
        involves no other programs. External locking occurs when the
        server and other programs lock table files to coordinate among
        themselves which program can access the tables at which time.
        See <a href="optimization.html#external-locking" title="7.3.5. External Locking">Section 7.3.5, “External Locking”</a>.
      </p><p>
        MySQL uses table-level locking for <code class="literal">MyISAM</code>,
        <code class="literal">MEMORY</code>, and <code class="literal">MERGE</code> tables,
        and row-level locking for <code class="literal">InnoDB</code> tables.
      </p><p>
        In many cases, you can make an educated guess about which
        locking type is best for an application, but generally it is
        difficult to say that a given lock type is better than another.
        Everything depends on the application and different parts of an
        application may require different lock types.
      </p><p>
        To decide whether you want to use a storage engine with
        row-level locking, you should look at what your application does
        and what mix of select and update statements it uses. For
        example, most Web applications perform many selects, relatively
        few deletes, updates based mainly on key values, and inserts
        into a few specific tables. The base MySQL
        <code class="literal">MyISAM</code> setup is very well tuned for this.
      </p><p class="mnmas"><b>MySQL Enterprise</b>
          The MySQL Enterprise Monitor provides expert advice on when to
          use table-level locking and when to use row-level locking. To
          subscribe see
          <a href="http://www.mysql.com/products/enterprise/advisors.html" target="_top">http://www.mysql.com/products/enterprise/advisors.html</a>.
        </p><p>
        Table locking in MySQL is deadlock-free for storage engines that
        use table-level locking. Deadlock avoidance is managed by always
        requesting all needed locks at once at the beginning of a query
        and always locking the tables in the same order.
      </p><p>
        MySQL grants table write locks as follows:
      </p><div class="orderedlist"><ol type="1"><li><p>
            If there are no locks on the table, put a write lock on it.
          </p></li><li><p>
            Otherwise, put the lock request in the write lock queue.
          </p></li></ol></div><p>
        MySQL grants table read locks as follows:
      </p><div class="orderedlist"><ol type="1"><li><p>
            If there are no write locks on the table, put a read lock on
            it.
          </p></li><li><p>
            Otherwise, put the lock request in the read lock queue.
          </p></li></ol></div><p>
        Table updates are given higher priority than table retrievals.
        Therefore, when a lock is released, the lock is made available
        to the requests in the write lock queue and then to the requests
        in the read lock queue. This ensures that updates to a table are
        not “<span class="quote">starved</span>” even if there is heavy
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> activity for the table.
        However, if you have many updates for a table,
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements wait until
        there are no more updates.
      </p><p>
        For information on altering the priority of reads and writes,
        see <a href="optimization.html#table-locking" title="7.3.2. Table Locking Issues">Section 7.3.2, “Table Locking Issues”</a>.
      </p><p>
        You can analyze the table lock contention on your system by
        checking the
        <a href="server-administration.html#statvar_Table_locks_immediate"><code class="literal">Table_locks_immediate</code></a> and
        <a href="server-administration.html#statvar_Table_locks_waited"><code class="literal">Table_locks_waited</code></a> status
        variables, which indicate the number of times that requests for
        table locks could be granted immediately and the number that had
        to wait, respectively:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW STATUS LIKE 'Table%';</code></strong>
+-----------------------+---------+
| Variable_name         | Value   |
+-----------------------+---------+
| Table_locks_immediate | 1151552 |
| Table_locks_waited    | 15324   |
+-----------------------+---------+
</pre><a class="indexterm" name="id3182378"></a><a class="indexterm" name="id3182387"></a><p>
        The <code class="literal">MyISAM</code> storage engine supports concurrent
        inserts to reduce contention between readers and writers for a
        given table: If a <code class="literal">MyISAM</code> table has no free
        blocks in the middle of the data file, rows are always inserted
        at the end of the data file. In this case, you can freely mix
        concurrent <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> and
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements for a
        <code class="literal">MyISAM</code> table without locks. That is, you can
        insert rows into a <code class="literal">MyISAM</code> table at the same
        time other clients are reading from it. Holes can result from
        rows having been deleted from or updated in the middle of the
        table. If there are holes, concurrent inserts are disabled but
        are enabled again automatically when all holes have been filled
        with new data.. This behavior is altered by the
        <a href="server-administration.html#sysvar_concurrent_insert"><code class="literal">concurrent_insert</code></a> system
        variable. See <a href="optimization.html#concurrent-inserts" title="7.3.3. Concurrent Inserts">Section 7.3.3, “Concurrent Inserts”</a>.
      </p><p>
        If you acquire a table lock explicitly with
        <a href="sql-syntax.html#lock-tables" title="12.4.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">LOCK TABLES</code></a>, you can request a
        <code class="literal">READ LOCAL</code> lock rather than a
        <code class="literal">READ</code> lock to enable other sessions to perform
        concurrent inserts while you have the table locked.
      </p><p>
        To perform many <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> and
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> operations on a table
        <code class="literal">real_table</code> when concurrent inserts are not
        possible, you can insert rows into a temporary table
        <code class="literal">temp_table</code> and update the real table with the
        rows from the temporary table periodically. This can be done
        with the following code:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>LOCK TABLES real_table WRITE, temp_table WRITE;</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO real_table SELECT * FROM temp_table;</code></strong>
mysql&gt; <strong class="userinput"><code>DELETE FROM temp_table;</code></strong>
mysql&gt; <strong class="userinput"><code>UNLOCK TABLES;</code></strong>
</pre><p>
        <code class="literal">InnoDB</code> uses row locks. Deadlocks are possible
        for <code class="literal">InnoDB</code> because it automatically acquires
        locks during the processing of SQL statements, not at the start
        of the transaction.
      </p><p>
        Advantages of row-level locking:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Fewer lock conflicts when different sessions access
            different rows
          </p></li><li><p>
            Fewer changes for rollbacks
          </p></li><li><p>
            Possible to lock a single row for a long time
          </p></li></ul></div><p>
        Disadvantages of row-level locking:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Requires more memory than table-level locks
          </p></li><li><p>
            Slower than table-level locks when used on a large part of
            the table because you must acquire many more locks
          </p></li><li><p>
            Slower than other locks if you often do <code class="literal">GROUP
            BY</code> operations on a large part of the data or if
            you must scan the entire table frequently
          </p></li></ul></div><p>
        Generally, table locks are superior to row-level locks in the
        following cases:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Most statements for the table are reads
          </p></li><li><p>
            Statements for the table are a mix of reads and writes,
            where writes are updates or deletes for a single row that
            can be fetched with one key read:
          </p><pre class="programlisting">UPDATE <em class="replaceable"><code>tbl_name</code></em> SET <em class="replaceable"><code>column</code></em>=<em class="replaceable"><code>value</code></em> WHERE <em class="replaceable"><code>unique_key_col</code></em>=<em class="replaceable"><code>key_value</code></em>;
DELETE FROM <em class="replaceable"><code>tbl_name</code></em> WHERE <em class="replaceable"><code>unique_key_col</code></em>=<em class="replaceable"><code>key_value</code></em>;
</pre></li><li><p>
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> combined with
            concurrent <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements,
            and very few <a href="sql-syntax.html#update" title="12.2.12. UPDATE Syntax"><code class="literal">UPDATE</code></a> or
            <a href="sql-syntax.html#delete" title="12.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> statements
          </p></li><li><p>
            Many scans or <code class="literal">GROUP BY</code> operations on the
            entire table without any writers
          </p></li></ul></div><p>
        With higher-level locks, you can more easily tune applications
        by supporting locks of different types, because the lock
        overhead is less than for row-level locks.
      </p><p>
        Options other than row-level locking:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Versioning (such as that used in MySQL for concurrent
            inserts) where it is possible to have one writer at the same
            time as many readers. This means that the database or table
            supports different views for the data depending on when
            access begins. Other common terms for this are “<span class="quote">time
            travel,</span>” “<span class="quote">copy on write,</span>” or “<span class="quote">copy
            on demand.</span>”
          </p></li><li><p>
            Copy on demand is in many cases superior to row-level
            locking. However, in the worst case, it can use much more
            memory than using normal locks.
          </p></li><li><p>
            Instead of using row-level locks, you can employ
            application-level locks, such as those provided by
            <a href="functions.html#function_get-lock"><code class="literal">GET_LOCK()</code></a> and
            <a href="functions.html#function_release-lock"><code class="literal">RELEASE_LOCK()</code></a> in MySQL.
            These are advisory locks, so they work only with
            applications that cooperate with each other. See
            <a href="functions.html#miscellaneous-functions" title="11.11.4. Miscellaneous Functions">Section 11.11.4, “Miscellaneous Functions”</a>.
          </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="table-locking"></a>7.3.2. Table Locking Issues</h3></div></div></div><a class="indexterm" name="id3182845"></a><p>
        To achieve a very high lock speed, MySQL uses table locking
        (instead of page, row, or column locking) for all storage
        engines except <code class="literal">InnoDB</code>.
      </p><p>
        For <code class="literal">InnoDB</code> tables, MySQL uses table locking
        only if you explicitly lock the table with
        <a href="sql-syntax.html#lock-tables" title="12.4.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">LOCK TABLES</code></a>. For this storage
        engine, we recommend that you not use <a href="sql-syntax.html#lock-tables" title="12.4.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">LOCK
        TABLES</code></a> at all, because <code class="literal">InnoDB</code> uses
        automatic row-level locking to ensure transaction isolation.
      </p><p>
        For large tables, table locking is often better than row
        locking, but there are some disadvantages:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Table locking enables many sessions to read from a table at
            the same time, but if a session wants to write to a table,
            it must first get exclusive access. During the update, all
            other sessions that want to access this particular table
            must wait until the update is done.
          </p></li><li><p>
            Table locking causes problems in cases such as when a
            session is waiting because the disk is full and free space
            needs to become available before the session can proceed. In
            this case, all sessions that want to access the problem
            table are also put in a waiting state until more disk space
            is made available.
          </p></li></ul></div><p>
        Table locking is also disadvantageous under the following
        scenario:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            A session issues a <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
            that takes a long time to run.
          </p></li><li><p>
            Another session then issues an
            <a href="sql-syntax.html#update" title="12.2.12. UPDATE Syntax"><code class="literal">UPDATE</code></a> on the same table.
            This session waits until the
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> is finished.
          </p></li><li><p>
            Another session issues another
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement on the same
            table. Because <a href="sql-syntax.html#update" title="12.2.12. UPDATE Syntax"><code class="literal">UPDATE</code></a> has
            higher priority than <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>,
            this <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> waits for the
            <a href="sql-syntax.html#update" title="12.2.12. UPDATE Syntax"><code class="literal">UPDATE</code></a> to finish,
            <span class="emphasis"><em>after</em></span> waiting for the first
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> to finish.
          </p></li></ul></div><p>
        The following items describe some ways to avoid or reduce
        contention caused by table locking:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Try to get the <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
            statements to run faster so that they lock tables for a
            shorter time. You might have to create some summary tables
            to do this.
          </p></li><li><p>
            Start <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> with
            <a href="server-administration.html#option_mysqld_low-priority-updates"><code class="option">--low-priority-updates</code></a>. For
            storage engines that use only table-level locking
            (<code class="literal">MyISAM</code>, <code class="literal">MEMORY</code>,
            <code class="literal">MERGE</code>), this gives all statements that
            update (modify) a table lower priority than
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements. In this
            case, the second <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
            statement in the preceding scenario would execute before the
            <a href="sql-syntax.html#update" title="12.2.12. UPDATE Syntax"><code class="literal">UPDATE</code></a> statement, and would
            not need to wait for the first
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> to finish.
          </p></li><li><p>
            To specify that all updates issued in a specific connection
            should be done with low priority, use the <code class="literal">SET
            LOW_PRIORITY_UPDATES=1</code> statement. See
            <a href="server-administration.html#server-session-variables" title="5.1.4. Session System Variables">Section 5.1.4, “Session System Variables”</a>.
          </p></li><li><p>
            To give a specific <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
            <a href="sql-syntax.html#update" title="12.2.12. UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
            <a href="sql-syntax.html#delete" title="12.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> statement lower
            priority, use the <code class="literal">LOW_PRIORITY</code> attribute.
          </p></li><li><p>
            To give a specific <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
            statement higher priority, use the
            <code class="literal">HIGH_PRIORITY</code> attribute. See
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax">Section 12.2.9, “<code class="literal">SELECT</code> Syntax”</a>.
          </p></li><li><p>
            Start <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> with a low value for the
            <a href="server-administration.html#sysvar_max_write_lock_count"><code class="literal">max_write_lock_count</code></a> system
            variable to force MySQL to temporarily elevate the priority
            of all <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements that
            are waiting for a table after a specific number of inserts
            to the table occur. This allows <code class="literal">READ</code>
            locks after a certain number of <code class="literal">WRITE</code>
            locks.
          </p></li><li><p>
            If you have problems with
            <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> combined with
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>, consider switching to
            <code class="literal">MyISAM</code> tables, which support concurrent
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> and
            <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements. (See
            <a href="optimization.html#concurrent-inserts" title="7.3.3. Concurrent Inserts">Section 7.3.3, “Concurrent Inserts”</a>.)
          </p></li><li><p>
            If you mix inserts and deletes on the same table,
            <a href="sql-syntax.html#insert-delayed" title="12.2.5.2. INSERT DELAYED Syntax"><code class="literal">INSERT DELAYED</code></a> may be of
            great help. See <a href="sql-syntax.html#insert-delayed" title="12.2.5.2. INSERT DELAYED Syntax">Section 12.2.5.2, “<code class="literal">INSERT DELAYED</code> Syntax”</a>.
          </p></li><li><p>
            If you have problems with mixed
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> and
            <a href="sql-syntax.html#delete" title="12.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> statements, the
            <code class="literal">LIMIT</code> option to
            <a href="sql-syntax.html#delete" title="12.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> may help. See
            <a href="sql-syntax.html#delete" title="12.2.2. DELETE Syntax">Section 12.2.2, “<code class="literal">DELETE</code> Syntax”</a>.
          </p></li><li><p>
            Using <code class="literal">SQL_BUFFER_RESULT</code> with
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements can help to
            make the duration of table locks shorter. See
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax">Section 12.2.9, “<code class="literal">SELECT</code> Syntax”</a>.
          </p></li><li><p>
            You could change the locking code in
            <code class="filename">mysys/thr_lock.c</code> to use a single queue.
            In this case, write locks and read locks would have the same
            priority, which might help some applications.
          </p></li></ul></div><p>
        Here are some tips concerning table locks in MySQL:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Concurrent users are not a problem if you do not mix updates
            with selects that need to examine many rows in the same
            table.
          </p></li><li><p>
            You can use <a href="sql-syntax.html#lock-tables" title="12.4.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">LOCK TABLES</code></a> to
            increase speed, because many updates within a single lock is
            much faster than updating without locks. Splitting table
            contents into separate tables may also help.
          </p></li><li><p>
            If you encounter speed problems with table locks in MySQL,
            you may be able to improve performance by converting some of
            your tables to <code class="literal">InnoDB</code>. See
            <a href="storage-engines.html#innodb" title="13.7. The InnoDB Storage Engine">Section 13.7, “The <code class="literal">InnoDB</code> Storage Engine”</a>.
          </p><p class="mnmas"><b>MySQL Enterprise</b>
              Lock contention can seriously degrade performance. The
              MySQL Enterprise Monitor provides expert advice on
              avoiding this problem. To subscribe, see
              <a href="http://www.mysql.com/products/enterprise/advisors.html" target="_top">http://www.mysql.com/products/enterprise/advisors.html</a>.
            </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="concurrent-inserts"></a>7.3.3. Concurrent Inserts</h3></div></div></div><a class="indexterm" name="id3183505"></a><a class="indexterm" name="id3183514"></a><p>
        The <code class="literal">MyISAM</code> storage engine supports concurrent
        inserts to reduce contention between readers and writers for a
        given table: If a <code class="literal">MyISAM</code> table has no holes
        in the data file (deleted rows in the middle), inserts can be
        performed to add rows to the end of the table at the same time
        that <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements are
        reading rows from the table.
      </p><p>
        The <a href="server-administration.html#sysvar_concurrent_insert"><code class="literal">concurrent_insert</code></a> system
        variable can be set to modify the concurrent-insert processing.
        By default, the variable is set to 1 and concurrent inserts are
        handled as just described. If
        <a href="server-administration.html#sysvar_concurrent_insert"><code class="literal">concurrent_insert</code></a> is set to 0,
        concurrent inserts are disabled. If the variable is set to 2,
        concurrent inserts at the end of the table are allowed even for
        tables that have deleted rows. See also the description of the
        <a href="server-administration.html#sysvar_concurrent_insert"><a href="server-administration.html#sysvar_concurrent_insert"><code class="literal">concurrent_insert</code></a></a>
        system variable.
      </p><p>
        Under circumstances where concurrent inserts can be used, there
        is seldom any need to use the <code class="literal">DELAYED</code>
        modifier for <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements.
        See <a href="sql-syntax.html#insert-delayed" title="12.2.5.2. INSERT DELAYED Syntax">Section 12.2.5.2, “<code class="literal">INSERT DELAYED</code> Syntax”</a>.
      </p><p>
        If you are using the binary log, concurrent inserts are
        converted to normal inserts for <code class="literal">CREATE ...
        SELECT</code> or
        <a href="sql-syntax.html#insert-select" title="12.2.5.1. INSERT ...
        SELECT Syntax"><code class="literal">INSERT ...
        SELECT</code></a> statements. This is done to ensure that you can
        re-create an exact copy of your tables by applying the log
        during a backup operation. See <a href="server-administration.html#binary-log" title="5.2.4. The Binary Log">Section 5.2.4, “The Binary Log”</a>. In
        addition, for those statements a read lock is placed on the
        selected-from table such that inserts into that table are
        blocked. The effect is that concurrent inserts for that table
        must wait as well.
      </p><p>
        With <a href="sql-syntax.html#load-data" title="12.2.6. LOAD DATA INFILE
      Syntax"><code class="literal">LOAD DATA
        INFILE</code></a>, if you specify <code class="literal">CONCURRENT</code>
        with a <code class="literal">MyISAM</code> table that satisfies the
        condition for concurrent inserts (that is, it contains no free
        blocks in the middle), other sessions can retrieve data from the
        table while <a href="sql-syntax.html#load-data" title="12.2.6. LOAD DATA INFILE
      Syntax"><code class="literal">LOAD DATA</code></a> is
        executing. Use of the <code class="literal">CONCURRENT</code> option
        affects the performance of <a href="sql-syntax.html#load-data" title="12.2.6. LOAD DATA INFILE
      Syntax"><code class="literal">LOAD
        DATA</code></a> a bit, even if no other session is using the
        table at the same time.
      </p><p>
        If you specify <code class="literal">HIGH_PRIORITY</code>, it overrides
        the effect of the
        <a href="server-administration.html#option_mysqld_low-priority-updates"><code class="option">--low-priority-updates</code></a> option if
        the server was started with that option. It also causes
        concurrent inserts not to be used.
      </p><p>
        For <a href="sql-syntax.html#lock-tables" title="12.4.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">LOCK
        TABLE</code></a>, the difference between <code class="literal">READ
        LOCAL</code> and <code class="literal">READ</code> is that
        <code class="literal">READ LOCAL</code> allows non-conflicting
        <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements (concurrent
        inserts) to execute while the lock is held. However, this cannot
        be used if you are going to manipulate the database using
        processes external to the server while you hold the lock.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="metadata-locking"></a>7.3.4. Metadata Locking Within Transactions</h3></div></div></div><a class="indexterm" name="id3183764"></a><a class="indexterm" name="id3183777"></a><p>
        To ensure transaction serializability, the server must not allow
        one session to perform a data definition language (DDL)
        statement on a table that is used in an uncompleted transaction
        in another session.
      </p><p>
        As of MySQL 6.0.11, the server achieves this by acquiring
        metadata locks on tables used within a transaction and deferring
        release of those locks until the transaction ends. A metadata
        lock on a table prevents changes to the table's structure. This
        locking approach has certain implications:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            A table that is being used by a transaction within one
            session cannot be used in DDL statements by other sessions
            until the transaction ends. For example, if a table
            <code class="literal">t1</code> is in use by a transaction, another
            session that attempts to execute
            <a href="sql-syntax.html#drop-table" title="12.1.23. DROP TABLE Syntax"><code class="literal">DROP TABLE
            t1</code></a> will block until the transaction ends.
          </p></li><li><p>
            <a href="sql-syntax.html#flush" title="12.5.7.3. FLUSH Syntax"><code class="literal">FLUSH TABLES WITH
            READ LOCK</code></a> blocks for active transactions that hold
            metadata locks until those transactions end. The same is
            true for attempts to set the global value of the
            <a href="server-administration.html#sysvar_read_only"><code class="literal">read_only</code></a> system variable.
          </p></li></ul></div><p>
        Metadata locks acquired during a
        <a href="sql-syntax.html#prepare" title="12.7.1. PREPARE Syntax"><code class="literal">PREPARE</code></a> statement are released
        once the statement has been prepared, even if preparation occurs
        within a multiple-statement transaction.
      </p><p>
        Before MySQL 6.0.11, when a transaction acquired a metadata lock
        for a table used within a statement, it released the lock at the
        end of the statement. This approach had the disadvantage that if
        a DDL statement occurred for a table that was being used by
        another session in an active transaction, statements could be
        written to the binary log in the wrong order.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="external-locking"></a>7.3.5. External Locking</h3></div></div></div><a class="indexterm" name="id3183892"></a><a class="indexterm" name="id3183901"></a><p>
        External locking is the use of file system locking to manage
        contention for database tables by multiple processes. External
        locking is used in situations where a single process such as the
        MySQL server cannot be assumed to be the only process that
        requires access to tables. Here are some examples:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            If you run multiple servers that use the same database
            directory (not recommended), each server must have external
            locking enabled.
          </p></li><li><p>
            If you use <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a> to perform table
            maintenance operations on <code class="literal">MyISAM</code> tables,
            you must either ensure that the server is not running, or
            that the server has external locking enabled so that it
            locks table files as necessary to coordinate with
            <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a> for access to the tables. The
            same is true for use of <a href="programs.html#myisampack" title="4.6.5. myisampack — Generate Compressed, Read-Only MyISAM Tables"><span><strong class="command">myisampack</strong></span></a> to
            pack <code class="literal">MyISAM</code> tables.
          </p><p>
            If the server is run with external locking enabled, you can
            use <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a> at any time for read
            operations such a checking tables. In this case, if the
            server tries to update a table that
            <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a> is using, the server will wait
            for <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a> to finish before it
            continues.
          </p><p>
            If you use <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a> for write operations
            such as repairing or optimizing tables, or if you use
            <a href="programs.html#myisampack" title="4.6.5. myisampack — Generate Compressed, Read-Only MyISAM Tables"><span><strong class="command">myisampack</strong></span></a> to pack tables, you
            <span class="emphasis"><em>must</em></span> always ensure that the
            <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> server is not using the table. If
            you don't stop <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a>, you should at
            least do a <a href="programs.html#mysqladmin" title="4.5.2. mysqladmin — Client for Administering a MySQL Server"><span><strong class="command">mysqladmin flush-tables</strong></span></a> before
            you run <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a>. Your tables
            <span class="emphasis"><em>may become corrupted</em></span> if the server and
            <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a> access the tables
            simultaneously.
          </p></li></ul></div><p>
        With external locking in effect, each process that requires
        access to a table acquires a file system lock for the table
        files before proceeding to access the table. If all necessary
        locks cannot be acquired, the process is blocked from accessing
        the table until the locks can be obtained (after the process
        that currently holds the locks releases them).
      </p><p>
        External locking affects server performance because the server
        must sometimes wait for other processes before it can access
        tables.
      </p><p>
        External locking is unnecessary if you run a single server to
        access a given data directory (which is the usual case) and if
        no other programs such as <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a> need to
        modify tables while the server is running. If you only
        <span class="emphasis"><em>read</em></span> tables with other programs, external
        locking is not required, although <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a>
        might report warnings if the server changes tables while
        <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a> is reading them.
      </p><p>
        With external locking disabled, to use
        <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a>, you must either stop the server
        while <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a> executes or else lock and
        flush the tables before running <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a>.
        (See <a href="optimization.html#system-optimization" title="7.5.2. System Factors and Startup Parameter Tuning">Section 7.5.2, “System Factors and Startup Parameter Tuning”</a>.) To avoid this
        requirement, use the <a href="sql-syntax.html#check-table" title="12.5.2.2. CHECK TABLE Syntax"><code class="literal">CHECK TABLE</code></a>
        and <a href="sql-syntax.html#repair-table" title="12.5.2.5. REPAIR TABLE Syntax"><code class="literal">REPAIR TABLE</code></a> statements to
        check and repair <code class="literal">MyISAM</code> tables.
      </p><p>
        For <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a>, external locking is controlled by
        the value of the
        <a href="server-administration.html#sysvar_skip_external_locking"><code class="literal">skip_external_locking</code></a> system
        variable. When this variable is enabled, external locking is
        disabled, and vice versa. From MySQL 4.0 on, external locking is
        disabled by default. Before MySQL 4.0, external locking is
        enabled by default on Linux or when MySQL is configured to use
        MIT-pthreads.
      </p><p>
        Use of external locking can be controlled at server startup by
        using the <a href="server-administration.html#option_mysqld_external-locking"><code class="option">--external-locking</code></a> or
        <a href="server-administration.html#option_mysqld_skip-external-locking"><code class="option">--skip-external-locking</code></a> option.
      </p><p>
        If you do use external locking option to enable updates to
        <code class="literal">MyISAM</code> tables from many MySQL processes, you
        must ensure that the following conditions are satisfied:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            You should not use the query cache for queries that use
            tables that are updated by another process.
          </p></li><li><p>
            You should not start the server with the
            <a href="server-administration.html#option_mysqld_delay-key-write"><code class="option">--delay-key-write=ALL</code></a> option
            or use the <code class="literal">DELAY_KEY_WRITE=1</code> table option
            for any shared tables. Otherwise, index corruption can
            occur.
          </p></li></ul></div><p>
        The easiest way to satisfy these conditions is to always use
        <a href="server-administration.html#option_mysqld_external-locking"><code class="option">--external-locking</code></a> together with
        <a href="server-administration.html#option_mysqld_delay-key-write"><code class="option">--delay-key-write=OFF</code></a> and
        <a href="server-administration.html#sysvar_query_cache_size"><code class="option">--query-cache-size=0</code></a>. (This is
        not done by default because in many setups it is useful to have
        a mixture of the preceding options.)
      </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="optimizing-database-structure"></a>7.4. Optimizing Database Structure</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="optimization.html#data-size">7.4.1. Make Your Data as Small as Possible</a></span></dt><dt><span class="section"><a href="optimization.html#indexes">7.4.2. Column Indexes</a></span></dt><dt><span class="section"><a href="optimization.html#multiple-column-indexes">7.4.3. Multiple-Column Indexes</a></span></dt><dt><span class="section"><a href="optimization.html#mysql-indexes">7.4.4. How MySQL Uses Indexes</a></span></dt><dt><span class="section"><a href="optimization.html#myisam-key-cache">7.4.5. The <code class="literal">MyISAM</code> Key Cache</a></span></dt><dt><span class="section"><a href="optimization.html#myisam-index-statistics">7.4.6. <code class="literal">MyISAM</code> Index Statistics Collection</a></span></dt><dt><span class="section"><a href="optimization.html#table-cache">7.4.7. How MySQL Opens and Closes Tables</a></span></dt><dt><span class="section"><a href="optimization.html#creating-many-tables">7.4.8. Disadvantages of Creating Many Tables in the Same Database</a></span></dt></dl></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="data-size"></a>7.4.1. Make Your Data as Small as Possible</h3></div></div></div><a class="indexterm" name="id3184326"></a><a class="indexterm" name="id3184338"></a><a class="indexterm" name="id3184350"></a><a class="indexterm" name="id3184363"></a><a class="indexterm" name="id3184376"></a><p>
        One of the most basic optimizations is to design your tables to
        take as little space on the disk as possible. This can result in
        huge improvements because disk reads are faster, and smaller
        tables normally require less main memory while their contents
        are being actively processed during query execution. Indexing
        also is a lesser resource burden if done on smaller columns.
      </p><p>
        MySQL supports many different storage engines (table types) and
        row formats. For each table, you can decide which storage and
        indexing method to use. Choosing the proper table format for
        your application may give you a big performance gain. See
        <a href="storage-engines.html" title="Chapter 13. Storage Engines">Chapter 13, <i>Storage Engines</i></a>.
      </p><p>
        You can get better performance for a table and minimize storage
        space by using the techniques listed here:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Use the most efficient (smallest) data types possible. MySQL
            has many specialized types that save disk space and memory.
            For example, use the smaller integer types if possible to
            get smaller tables. <a href="data-types.html#numeric-types" title="10.2. Numeric Types"><code class="literal">MEDIUMINT</code></a>
            is often a better choice than
            <a href="data-types.html#numeric-types" title="10.2. Numeric Types"><code class="literal">INT</code></a> because a
            <a href="data-types.html#numeric-types" title="10.2. Numeric Types"><code class="literal">MEDIUMINT</code></a> column uses 25%
            less space.
          </p></li><li><p>
            Declare columns to be <code class="literal">NOT NULL</code> if
            possible. It makes everything faster and you save one bit
            per column. If you really need <code class="literal">NULL</code> in
            your application, you should definitely use it. Just avoid
            having it on all columns by default.
          </p></li><li><p>
            For <code class="literal">MyISAM</code> tables, if you do not have any
            variable-length columns
            (<a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">VARCHAR</code></a>,
            <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">TEXT</code></a>, or
            <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a> columns), a fixed-size
            row format is used. This is faster but unfortunately may
            waste some space. See
            <a href="storage-engines.html#myisam-table-formats" title="13.5.3. MyISAM Table Storage Formats">Section 13.5.3, “<code class="literal">MyISAM</code> Table Storage Formats”</a>. You can hint that
            you want to have fixed length rows even if you have
            <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">VARCHAR</code></a> columns with the
            <a href="sql-syntax.html#create-table" title="12.1.14. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> option
            <code class="literal">ROW_FORMAT=FIXED</code>.
          </p></li><li><p>
            <code class="literal">InnoDB</code> tables use a compact storage
            format. In versions of MySQL earlier than 5.0.3,
            <code class="literal">InnoDB</code> rows contain some redundant
            information, such as the number of columns and the length of
            each column, even for fixed-size columns. By default, tables
            are created in the compact format
            (<code class="literal">ROW_FORMAT=COMPACT</code>). If you wish to
            downgrade to older versions of MySQL, you can request the
            old format with <code class="literal">ROW_FORMAT=REDUNDANT</code>.
          </p><p>
            The presence of the compact row format decreases row storage
            space by about 20% at the cost of increasing CPU use for
            some operations. If your workload is a typical one that is
            limited by cache hit rates and disk speed it is likely to be
            faster. If it is a rare case that is limited by CPU speed,
            it might be slower.
          </p><p>
            The compact <code class="literal">InnoDB</code> format also changes
            how <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">CHAR</code></a> columns containing
            UTF-8 data are stored. With
            <code class="literal">ROW_FORMAT=REDUNDANT</code>, a UTF-8
            <code class="literal">CHAR(<em class="replaceable"><code>N</code></em>)</code>
            occupies 3 × <em class="replaceable"><code>N</code></em> bytes, given
            that the maximum length of a UTF-8 encoded character is
            three bytes. Many languages can be written primarily using
            single-byte UTF-8 characters, so a fixed storage length
            often wastes space. With
            <code class="literal">ROW_FORMAT=COMPACT</code> format,
            <code class="literal">InnoDB</code> allocates a variable amount of
            storage in the range from <em class="replaceable"><code>N</code></em> to 3
            × <em class="replaceable"><code>N</code></em> bytes for these columns
            by stripping trailing spaces if necessary. The minimum
            storage length is kept as <em class="replaceable"><code>N</code></em> bytes
            to facilitate in-place updates in typical cases.
          </p></li><li><p>
            The primary index of a table should be as short as possible.
            This makes identification of each row easy and efficient.
          </p></li><li><p>
            Create only the indexes that you really need. Indexes are
            good for retrieval but bad when you need to store data
            quickly. If you access a table mostly by searching on a
            combination of columns, create an index on them. The first
            part of the index should be the column most used. If you
            <span class="emphasis"><em>always</em></span> use many columns when selecting
            from the table, you should use the column with more
            duplicates first to obtain better compression of the index.
          </p></li><li><p>
            If it is very likely that a string column has a unique
            prefix on the first number of characters, it is better to
            index only this prefix, using MySQL's support for creating
            an index on the leftmost part of the column (see
            <a href="sql-syntax.html#create-index" title="12.1.11. CREATE INDEX Syntax">Section 12.1.11, “<code class="literal">CREATE INDEX</code> Syntax”</a>). Shorter indexes are faster,
            not only because they require less disk space, but because
            they also give you more hits in the index cache, and thus
            fewer disk seeks. See <a href="optimization.html#server-parameters" title="7.5.3. Tuning Server Parameters">Section 7.5.3, “Tuning Server Parameters”</a>.
          </p></li><li><p>
            In some circumstances, it can be beneficial to split into
            two a table that is scanned very often. This is especially
            true if it is a dynamic-format table and it is possible to
            use a smaller static format table that can be used to find
            the relevant rows when scanning the table.
          </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="indexes"></a>7.4.2. Column Indexes</h3></div></div></div><a class="indexterm" name="id3184735"></a><a class="indexterm" name="id3184747"></a><a class="indexterm" name="id3184759"></a><p>
        All MySQL data types can be indexed. Use of indexes on the
        relevant columns is the best way to improve the performance of
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> operations.
      </p><p>
        The maximum number of indexes per table and the maximum index
        length is defined per storage engine. See
        <a href="storage-engines.html" title="Chapter 13. Storage Engines">Chapter 13, <i>Storage Engines</i></a>. All storage engines support
        at least 16 indexes per table and a total index length of at
        least 256 bytes. Most storage engines have higher limits.
      </p><a class="indexterm" name="id3184794"></a><a class="indexterm" name="id3184807"></a><a class="indexterm" name="id3184819"></a><a class="indexterm" name="id3184832"></a><p>
        With
        <code class="literal"><em class="replaceable"><code>col_name</code></em>(<em class="replaceable"><code>N</code></em>)</code>
        syntax in an index specification, you can create an index that
        uses only the first <em class="replaceable"><code>N</code></em> characters of a
        string column. Indexing only a prefix of column values in this
        way can make the index file much smaller. When you index a
        <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a> or
        <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">TEXT</code></a> column, you
        <span class="emphasis"><em>must</em></span> specify a prefix length for the index.
        For example:
      </p><pre class="programlisting">CREATE TABLE test (blob_col BLOB, INDEX(blob_col(10)));
</pre><p>
        Prefixes can be up to 1000 bytes long (767 bytes for
        <code class="literal">InnoDB</code> tables). Note that prefix limits are
        measured in bytes, whereas the prefix length in
        <a href="sql-syntax.html#create-table" title="12.1.14. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statements is
        interpreted as number of characters. <span class="emphasis"><em>Be sure to take
        this into account when specifying a prefix length for a column
        that uses a multi-byte character set</em></span>.
      </p><p>
        You can also create <code class="literal">FULLTEXT</code> indexes. These
        are used for full-text searches. Only the
        <code class="literal">MyISAM</code> storage engine supports
        <code class="literal">FULLTEXT</code> indexes and only for
        <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">CHAR</code></a>,
        <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">VARCHAR</code></a>, and
        <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">TEXT</code></a> columns. Indexing always
        takes place over the entire column and column prefix indexing is
        not supported. For details, see
        <a href="functions.html#fulltext-search" title="11.8. Full-Text Search Functions">Section 11.8, “Full-Text Search Functions”</a>.
      </p><p>
        You can also create indexes on spatial data types. Currently,
        only <code class="literal">MyISAM</code> supports R-tree indexes on
        spatial types. Other storage engines use B-trees for indexing
        spatial types (except for <code class="literal">ARCHIVE</code>, which does
        not support spatial type indexing).
      </p><p>
        The <code class="literal">MEMORY</code> storage engine uses
        <code class="literal">HASH</code> indexes by default, but also supports
        <code class="literal">BTREE</code> indexes.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="multiple-column-indexes"></a>7.4.3. Multiple-Column Indexes</h3></div></div></div><a class="indexterm" name="id3185023"></a><a class="indexterm" name="id3185032"></a><a class="indexterm" name="id3185045"></a><p>
        MySQL can create composite indexes (that is, indexes on multiple
        columns). An index may consist of up to 15 columns. For certain
        data types, you can index a prefix of the column (see
        <a href="optimization.html#indexes" title="7.4.2. Column Indexes">Section 7.4.2, “Column Indexes”</a>).
      </p><p>
        A multiple-column index can be considered a sorted array
        containing values that are created by concatenating the values
        of the indexed columns.
      </p><p>
        MySQL uses multiple-column indexes in such a way that queries
        are fast when you specify a known quantity for the first column
        of the index in a <code class="literal">WHERE</code> clause, even if you
        do not specify values for the other columns.
      </p><p>
        Suppose that a table has the following specification:
      </p><pre class="programlisting">CREATE TABLE test (
    id         INT NOT NULL,
    last_name  CHAR(30) NOT NULL,
    first_name CHAR(30) NOT NULL,
    PRIMARY KEY (id),
    INDEX name (last_name,first_name)
);
</pre><p>
        The <code class="literal">name</code> index is an index over the
        <code class="literal">last_name</code> and <code class="literal">first_name</code>
        columns. The index can be used for queries that specify values
        in a known range for <code class="literal">last_name</code>, or for both
        <code class="literal">last_name</code> and <code class="literal">first_name</code>.
        Therefore, the <code class="literal">name</code> index is used in the
        following queries:
      </p><pre class="programlisting">SELECT * FROM test WHERE last_name='Widenius';

SELECT * FROM test
  WHERE last_name='Widenius' AND first_name='Michael';

SELECT * FROM test
  WHERE last_name='Widenius'
  AND (first_name='Michael' OR first_name='Monty');

SELECT * FROM test
  WHERE last_name='Widenius'
  AND first_name &gt;='M' AND first_name &lt; 'N';
</pre><p>
        However, the <code class="literal">name</code> index is
        <span class="emphasis"><em>not</em></span> used in the following queries:
      </p><pre class="programlisting">SELECT * FROM test WHERE first_name='Michael';

SELECT * FROM test
  WHERE last_name='Widenius' OR first_name='Michael';
</pre><p>
        The manner in which MySQL uses indexes to improve query
        performance is discussed further in
        <a href="optimization.html#mysql-indexes" title="7.4.4. How MySQL Uses Indexes">Section 7.4.4, “How MySQL Uses Indexes”</a>.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mysql-indexes"></a>7.4.4. How MySQL Uses Indexes</h3></div></div></div><a class="indexterm" name="id3185208"></a><p>
        Indexes are used to find rows with specific column values
        quickly. Without an index, MySQL must begin with the first row
        and then read through the entire table to find the relevant
        rows. The larger the table, the more this costs. If the table
        has an index for the columns in question, MySQL can quickly
        determine the position to seek to in the middle of the data file
        without having to look at all the data. If a table has 1,000
        rows, this is at least 100 times faster than reading
        sequentially. If you need to access most of the rows, it is
        faster to read sequentially, because this minimizes disk seeks.
      </p><p>
        Most MySQL indexes (<code class="literal">PRIMARY KEY</code>,
        <code class="literal">UNIQUE</code>, <code class="literal">INDEX</code>, and
        <code class="literal">FULLTEXT</code>) are stored in B-trees. Exceptions
        are that indexes on spatial data types use R-trees, and that
        <code class="literal">MEMORY</code> tables also support hash indexes.
      </p><p>
        Strings are automatically prefix- and end-space compressed. See
        <a href="sql-syntax.html#create-index" title="12.1.11. CREATE INDEX Syntax">Section 12.1.11, “<code class="literal">CREATE INDEX</code> Syntax”</a>.
      </p><p>
        In general, indexes are used as described in the following
        discussion. Characteristics specific to hash indexes (as used in
        <code class="literal">MEMORY</code> tables) are described at the end of
        this section.
      </p><p>
        MySQL uses indexes for these operations:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            To find the rows matching a <code class="literal">WHERE</code> clause
            quickly.
          </p></li><li><p>
            To eliminate rows from consideration. If there is a choice
            between multiple indexes, MySQL normally uses the index that
            finds the smallest number of rows.
          </p></li><li><p>
            To retrieve rows from other tables when performing joins.
            MySQL can use indexes on columns more efficiently if they
            are declared as the same type and size. In this context,
            <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">VARCHAR</code></a> and
            <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">CHAR</code></a> are considered the same
            if they are declared as the same size. For example,
            <code class="literal">VARCHAR(10)</code> and
            <code class="literal">CHAR(10)</code> are the same size, but
            <code class="literal">VARCHAR(10)</code> and
            <code class="literal">CHAR(15)</code> are not.
          </p><p>
            Comparison of dissimilar columns may prevent use of indexes
            if values cannot be compared directly without conversion.
            Suppose that a numeric column is compared to a string
            column. For a given value such as <code class="literal">1</code> in
            the numeric column, it might compare equal to any number of
            values in the string column such as <code class="literal">'1'</code>,
            <code class="literal">' 1'</code>, <code class="literal">'00001'</code>, or
            <code class="literal">'01.e1'</code>. This rules out use of any
            indexes for the string column.
          </p></li><li><p>
            To find the <a href="functions.html#function_min"><code class="literal">MIN()</code></a> or
            <a href="functions.html#function_max"><code class="literal">MAX()</code></a> value for a specific
            indexed column <em class="replaceable"><code>key_col</code></em>. This is
            optimized by a preprocessor that checks whether you are
            using <code class="literal">WHERE <em class="replaceable"><code>key_part_N</code></em> =
            <em class="replaceable"><code>constant</code></em></code> on all key
            parts that occur before <em class="replaceable"><code>key_col</code></em>
            in the index. In this case, MySQL does a single key lookup
            for each <a href="functions.html#function_min"><code class="literal">MIN()</code></a> or
            <a href="functions.html#function_max"><code class="literal">MAX()</code></a> expression and replaces
            it with a constant. If all expressions are replaced with
            constants, the query returns at once. For example:
          </p><pre class="programlisting">SELECT MIN(<em class="replaceable"><code>key_part2</code></em>),MAX(<em class="replaceable"><code>key_part2</code></em>)
  FROM <em class="replaceable"><code>tbl_name</code></em> WHERE <em class="replaceable"><code>key_part1</code></em>=10;
</pre></li><li><p>
            To sort or group a table if the sorting or grouping is done
            on a leftmost prefix of a usable key (for example,
            <code class="literal">ORDER BY <em class="replaceable"><code>key_part1</code></em>,
            <em class="replaceable"><code>key_part2</code></em></code>). If all key
            parts are followed by <code class="literal">DESC</code>, the key is
            read in reverse order. See
            <a href="optimization.html#order-by-optimization" title="7.2.17. ORDER BY Optimization">Section 7.2.17, “<code class="literal">ORDER BY</code> Optimization”</a>, and
            <a href="optimization.html#group-by-optimization" title="7.2.18. GROUP BY Optimization">Section 7.2.18, “<code class="literal">GROUP BY</code> Optimization”</a>.
          </p></li><li><p>
            In some cases, a query can be optimized to retrieve values
            without consulting the data rows. If a query uses only
            columns from a table that are numeric and that form a
            leftmost prefix for some key, the selected values may be
            retrieved from the index tree for greater speed:
          </p><pre class="programlisting">SELECT <em class="replaceable"><code>key_part3</code></em> FROM <em class="replaceable"><code>tbl_name</code></em> 
  WHERE <em class="replaceable"><code>key_part1</code></em>=1
</pre></li></ul></div><p>
        Suppose that you issue the following
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM <em class="replaceable"><code>tbl_name</code></em> WHERE col1=<em class="replaceable"><code>val1</code></em> AND col2=<em class="replaceable"><code>val2</code></em>;</code></strong>
</pre><p>
        If a multiple-column index exists on <code class="literal">col1</code> and
        <code class="literal">col2</code>, the appropriate rows can be fetched
        directly. If separate single-column indexes exist on
        <code class="literal">col1</code> and <code class="literal">col2</code>, the
        optimizer will attempt to use the Index Merge optimization (see
        <a href="optimization.html#index-merge-optimization" title="7.2.6. Index Merge Optimization">Section 7.2.6, “Index Merge Optimization”</a>), or attempt to find
        the most restrictive index by deciding which index finds fewer
        rows and using that index to fetch the rows.
      </p><a class="indexterm" name="id3185640"></a><a class="indexterm" name="id3185653"></a><p>
        If the table has a multiple-column index, any leftmost prefix of
        the index can be used by the optimizer to find rows. For
        example, if you have a three-column index on <code class="literal">(col1,
        col2, col3)</code>, you have indexed search capabilities on
        <code class="literal">(col1)</code>, <code class="literal">(col1, col2)</code>, and
        <code class="literal">(col1, col2, col3)</code>.
      </p><p>
        MySQL cannot use an index if the columns do not form a leftmost
        prefix of the index. Suppose that you have the
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements shown here:
      </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>tbl_name</code></em> WHERE col1=<em class="replaceable"><code>val1</code></em>;
SELECT * FROM <em class="replaceable"><code>tbl_name</code></em> WHERE col1=<em class="replaceable"><code>val1</code></em> AND col2=<em class="replaceable"><code>val2</code></em>;

SELECT * FROM <em class="replaceable"><code>tbl_name</code></em> WHERE col2=<em class="replaceable"><code>val2</code></em>;
SELECT * FROM <em class="replaceable"><code>tbl_name</code></em> WHERE col2=<em class="replaceable"><code>val2</code></em> AND col3=<em class="replaceable"><code>val3</code></em>;
</pre><p>
        If an index exists on <code class="literal">(col1, col2, col3)</code>,
        only the first two queries use the index. The third and fourth
        queries do involve indexed columns, but
        <code class="literal">(col2)</code> and <code class="literal">(col2, col3)</code>
        are not leftmost prefixes of <code class="literal">(col1, col2,
        col3)</code>.
      </p><a class="indexterm" name="id3185782"></a><a class="indexterm" name="id3185794"></a><a class="indexterm" name="id3185807"></a><a class="indexterm" name="id3185819"></a><p>
        A B-tree index can be used for column comparisons in expressions
        that use the <a href="functions.html#operator_equal"><code class="literal">=</code></a>,
        <a href="functions.html#operator_greater-than"><code class="literal">&gt;</code></a>,
        <a href="functions.html#operator_greater-than-or-equal"><code class="literal">&gt;=</code></a>,
        <a href="functions.html#operator_less-than"><code class="literal">&lt;</code></a>,
        <a href="functions.html#operator_less-than-or-equal"><code class="literal">&lt;=</code></a>,
        or <a href="functions.html#operator_between"><code class="literal">BETWEEN</code></a> operators. The index
        also can be used for <a href="functions.html#operator_like"><code class="literal">LIKE</code></a>
        comparisons if the argument to <a href="functions.html#operator_like"><code class="literal">LIKE</code></a>
        is a constant string that does not start with a wildcard
        character. For example, the following
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements use indexes:
      </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>tbl_name</code></em> WHERE <em class="replaceable"><code>key_col</code></em> LIKE 'Patrick%';
SELECT * FROM <em class="replaceable"><code>tbl_name</code></em> WHERE <em class="replaceable"><code>key_col</code></em> LIKE 'Pat%_ck%';
</pre><p>
        In the first statement, only rows with <code class="literal">'Patrick' &lt;=
        <em class="replaceable"><code>key_col</code></em> &lt; 'Patricl'</code> are
        considered. In the second statement, only rows with
        <code class="literal">'Pat' &lt;= <em class="replaceable"><code>key_col</code></em> &lt;
        'Pau'</code> are considered.
      </p><p>
        The following <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements
        do not use indexes:
      </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>tbl_name</code></em> WHERE <em class="replaceable"><code>key_col</code></em> LIKE '%Patrick%';
SELECT * FROM <em class="replaceable"><code>tbl_name</code></em> WHERE <em class="replaceable"><code>key_col</code></em> LIKE <em class="replaceable"><code>other_col</code></em>;
</pre><p>
        In the first statement, the <a href="functions.html#operator_like"><code class="literal">LIKE</code></a>
        value begins with a wildcard character. In the second statement,
        the <a href="functions.html#operator_like"><code class="literal">LIKE</code></a> value is not a constant.
      </p><p>
        If you use <code class="literal">... LIKE
        '%<em class="replaceable"><code>string</code></em>%'</code> and
        <em class="replaceable"><code>string</code></em> is longer than three
        characters, MySQL uses the <em class="firstterm">Turbo Boyer-Moore
        algorithm</em> to initialize the pattern for the string
        and then uses this pattern to perform the search more quickly.
      </p><a class="indexterm" name="id3186033"></a><a class="indexterm" name="id3186045"></a><p>
        A search using <code class="literal"><em class="replaceable"><code>col_name</code></em> IS
        NULL</code> employs indexes if
        <em class="replaceable"><code>col_name</code></em> is indexed.
      </p><p>
        Any index that does not span all
        <a href="functions.html#operator_and"><code class="literal">AND</code></a> levels in the
        <code class="literal">WHERE</code> clause is not used to optimize the
        query. In other words, to be able to use an index, a prefix of
        the index must be used in every <a href="functions.html#operator_and"><code class="literal">AND</code></a>
        group.
      </p><p>
        The following <code class="literal">WHERE</code> clauses use indexes:
      </p><pre class="programlisting">... WHERE <em class="replaceable"><code>index_part1</code></em>=1 AND <em class="replaceable"><code>index_part2</code></em>=2 AND <em class="replaceable"><code>other_column</code></em>=3
    /* <em class="replaceable"><code>index</code></em> = 1 OR <em class="replaceable"><code>index</code></em> = 2 */
... WHERE <em class="replaceable"><code>index</code></em>=1 OR A=10 AND <em class="replaceable"><code>index</code></em>=2
    /* optimized like "<em class="replaceable"><code>index_part1</code></em>='hello'" */
... WHERE <em class="replaceable"><code>index_part1</code></em>='hello' AND <em class="replaceable"><code>index_part3</code></em>=5
    /* Can use index on <em class="replaceable"><code>index1</code></em> but not on <em class="replaceable"><code>index2</code></em> or <em class="replaceable"><code>index3</code></em> */
... WHERE <em class="replaceable"><code>index1</code></em>=1 AND <em class="replaceable"><code>index2</code></em>=2 OR <em class="replaceable"><code>index1</code></em>=3 AND <em class="replaceable"><code>index3</code></em>=3;
</pre><p>
        These <code class="literal">WHERE</code> clauses do
        <span class="emphasis"><em>not</em></span> use indexes:
      </p><pre class="programlisting">    /* <em class="replaceable"><code>index_part1</code></em> is not used */
... WHERE <em class="replaceable"><code>index_part2</code></em>=1 AND <em class="replaceable"><code>index_part3</code></em>=2

    /*  Index is not used in both parts of the WHERE clause  */
... WHERE <em class="replaceable"><code>index</code></em>=1 OR A=10

    /* No index spans all rows  */
... WHERE <em class="replaceable"><code>index_part1</code></em>=1 OR <em class="replaceable"><code>index_part2</code></em>=10
</pre><p>
        Sometimes MySQL does not use an index, even if one is available.
        One circumstance under which this occurs is when the optimizer
        estimates that using the index would require MySQL to access a
        very large percentage of the rows in the table. (In this case, a
        table scan is likely to be much faster because it requires fewer
        seeks.) However, if such a query uses <code class="literal">LIMIT</code>
        to retrieve only some of the rows, MySQL uses an index anyway,
        because it can much more quickly find the few rows to return in
        the result.
      </p><p>
        Hash indexes have somewhat different characteristics from those
        just discussed:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            They are used only for equality comparisons that use the
            <code class="literal">=</code> or <code class="literal">&lt;=&gt;</code>
            operators (but are <span class="emphasis"><em>very</em></span> fast). They are
            not used for comparison operators such as
            <code class="literal">&lt;</code> that find a range of values.
          </p></li><li><p>
            The optimizer cannot use a hash index to speed up
            <code class="literal">ORDER BY</code> operations. (This type of index
            cannot be used to search for the next entry in order.)
          </p></li><li><p>
            MySQL cannot determine approximately how many rows there are
            between two values (this is used by the range optimizer to
            decide which index to use). This may affect some queries if
            you change a <code class="literal">MyISAM</code> table to a
            hash-indexed <code class="literal">MEMORY</code> table.
          </p></li><li><p>
            Only whole keys can be used to search for a row. (With a
            B-tree index, any leftmost prefix of the key can be used to
            find rows.)
          </p></li></ul></div><p class="mnmas"><b>MySQL Enterprise</b>
          Often, it is not possible to predict exactly what indexes will
          be required or will be most efficient — actual table
          usage is the best indicator. The MySQL Enterprise Monitor
          provides expert advice on this topic. For more information,
          see <a href="http://www.mysql.com/products/enterprise/advisors.html" target="_top">http://www.mysql.com/products/enterprise/advisors.html</a>.
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="myisam-key-cache"></a>7.4.5. The <code class="literal">MyISAM</code> Key Cache</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="optimization.html#shared-key-cache">7.4.5.1. Shared Key Cache Access</a></span></dt><dt><span class="section"><a href="optimization.html#multiple-key-caches">7.4.5.2. Multiple Key Caches</a></span></dt><dt><span class="section"><a href="optimization.html#midpoint-insertion">7.4.5.3. Midpoint Insertion Strategy</a></span></dt><dt><span class="section"><a href="optimization.html#index-preloading">7.4.5.4. Index Preloading</a></span></dt><dt><span class="section"><a href="optimization.html#key-cache-block-size">7.4.5.5. Key Cache Block Size</a></span></dt><dt><span class="section"><a href="optimization.html#key-cache-restructuring">7.4.5.6. Restructuring a Key Cache</a></span></dt></dl></div><a class="indexterm" name="id3186376"></a><a class="indexterm" name="id3186385"></a><p>
        To minimize disk I/O, the <code class="literal">MyISAM</code> storage
        engine exploits a strategy that is used by many database
        management systems. It employs a cache mechanism to keep the
        most frequently accessed table blocks in memory:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            For index blocks, a special structure called the
            <em class="firstterm">key cache</em> (or <em class="firstterm">key
            buffer</em>) is maintained. The structure contains a
            number of block buffers where the most-used index blocks are
            placed.
          </p></li><li><p>
            For data blocks, MySQL uses no special cache. Instead it
            relies on the native operating system file system cache.
          </p></li></ul></div><p>
        This section first describes the basic operation of the
        <code class="literal">MyISAM</code> key cache. Then it discusses features
        that improve key cache performance and that enable you to better
        control cache operation:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Multiple sessions can access the cache concurrently.
          </p></li><li><p>
            You can set up multiple key caches and assign table indexes
            to specific caches.
          </p></li></ul></div><p>
        To control the size of the key cache, use the
        <a href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a> system
        variable. If this variable is set equal to zero, no key cache is
        used. The key cache also is not used if the
        <a href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a> value is too
        small to allocate the minimal number of block buffers (8).
      </p><p class="mnmas"><b>MySQL Enterprise</b>
          For expert advice on identifying the optimum size for
          <a href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a>, subscribe to
          the MySQL Enterprise Monitor. See
          <a href="http://www.mysql.com/products/enterprise/advisors.html" target="_top">http://www.mysql.com/products/enterprise/advisors.html</a>.
        </p><p>
        When the key cache is not operational, index files are accessed
        using only the native file system buffering provided by the
        operating system. (In other words, table index blocks are
        accessed using the same strategy as that employed for table data
        blocks.)
      </p><p>
        An index block is a contiguous unit of access to the
        <code class="literal">MyISAM</code> index files. Usually the size of an
        index block is equal to the size of nodes of the index B-tree.
        (Indexes are represented on disk using a B-tree data structure.
        Nodes at the bottom of the tree are leaf nodes. Nodes above the
        leaf nodes are non-leaf nodes.)
      </p><p>
        All block buffers in a key cache structure are the same size.
        This size can be equal to, greater than, or less than the size
        of a table index block. Usually one these two values is a
        multiple of the other.
      </p><p>
        When data from any table index block must be accessed, the
        server first checks whether it is available in some block buffer
        of the key cache. If it is, the server accesses data in the key
        cache rather than on disk. That is, it reads from the cache or
        writes into it rather than reading from or writing to disk.
        Otherwise, the server chooses a cache block buffer containing a
        different table index block (or blocks) and replaces the data
        there by a copy of required table index block. As soon as the
        new index block is in the cache, the index data can be accessed.
      </p><p>
        If it happens that a block selected for replacement has been
        modified, the block is considered “<span class="quote">dirty.</span>” In this
        case, prior to being replaced, its contents are flushed to the
        table index from which it came.
      </p><p>
        Usually the server follows an <em class="firstterm">LRU (Least Recently
        Used)</em> strategy: When choosing a block for
        replacement, it selects the least recently used index block. To
        make this choice easier, the key cache module maintains a
        special queue (<em class="firstterm">LRU chain</em>) of all used
        blocks. When a block is accessed, it is placed at the end of the
        queue. When blocks need to be replaced, blocks at the beginning
        of the queue are the least recently used and become the first
        candidates for eviction.
      </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="shared-key-cache"></a>7.4.5.1. Shared Key Cache Access</h4></div></div></div><p>
          Threads can access key cache buffers simultaneously, subject
          to the following conditions:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              A buffer that is not being updated can be accessed by
              multiple sessions.
            </p></li><li><p>
              A buffer that is being updated causes sessions that need
              to use it to wait until the update is complete.
            </p></li><li><p>
              Multiple sessions can initiate requests that result in
              cache block replacements, as long as they do not interfere
              with each other (that is, as long as they need different
              index blocks, and thus cause different cache blocks to be
              replaced).
            </p></li></ul></div><p>
          Shared access to the key cache enables the server to improve
          throughput significantly.
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="multiple-key-caches"></a>7.4.5.2. Multiple Key Caches</h4></div></div></div><p>
          Shared access to the key cache improves performance but does
          not eliminate contention among sessions entirely. They still
          compete for control structures that manage access to the key
          cache buffers. To reduce key cache access contention further,
          MySQL also provides multiple key caches. This feature enables
          you to assign different table indexes to different key caches.
        </p><p>
          Where there are multiple key caches, the server must know
          which cache to use when processing queries for a given
          <code class="literal">MyISAM</code> table. By default, all
          <code class="literal">MyISAM</code> table indexes are cached in the
          default key cache. To assign table indexes to a specific key
          cache, use the <a href="sql-syntax.html#cache-index" title="12.5.7.2. CACHE INDEX Syntax"><code class="literal">CACHE INDEX</code></a>
          statement (see <a href="sql-syntax.html#cache-index" title="12.5.7.2. CACHE INDEX Syntax">Section 12.5.7.2, “<code class="literal">CACHE INDEX</code> Syntax”</a>). For example,
          the following statement assigns indexes from the tables
          <code class="literal">t1</code>, <code class="literal">t2</code>, and
          <code class="literal">t3</code> to the key cache named
          <code class="literal">hot_cache</code>:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CACHE INDEX t1, t2, t3 IN hot_cache;</code></strong>
+---------+--------------------+----------+----------+
| Table   | Op                 | Msg_type | Msg_text |
+---------+--------------------+----------+----------+
| test.t1 | assign_to_keycache | status   | OK       |
| test.t2 | assign_to_keycache | status   | OK       |
| test.t3 | assign_to_keycache | status   | OK       |
+---------+--------------------+----------+----------+
</pre><p>
          The key cache referred to in a <a href="sql-syntax.html#cache-index" title="12.5.7.2. CACHE INDEX Syntax"><code class="literal">CACHE
          INDEX</code></a> statement can be created by setting its size
          with a <a href="sql-syntax.html#set-option" title="12.5.5. SET Syntax"><code class="literal">SET
          GLOBAL</code></a> parameter setting statement or by using
          server startup options. For example:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET GLOBAL keycache1.key_buffer_size=128*1024;</code></strong>
</pre><p>
          To destroy a key cache, set its size to zero:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET GLOBAL keycache1.key_buffer_size=0;</code></strong>
</pre><p>
          Note that you cannot destroy the default key cache. Any
          attempt to do this will be ignored:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET GLOBAL key_buffer_size = 0;</code></strong>

mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'key_buffer_size';</code></strong>
+-----------------+---------+
| Variable_name   | Value   |
+-----------------+---------+
| key_buffer_size | 8384512 |
+-----------------+---------+
</pre><p>
          Key cache variables are structured system variables that have
          a name and components. For
          <code class="literal">keycache1.key_buffer_size</code>,
          <code class="literal">keycache1</code> is the cache variable name and
          <a href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a> is the cache
          component. See <a href="server-administration.html#structured-system-variables" title="5.1.5.1. Structured System Variables">Section 5.1.5.1, “Structured System Variables”</a>,
          for a description of the syntax used for referring to
          structured key cache system variables.
        </p><p>
          By default, table indexes are assigned to the main (default)
          key cache created at the server startup. When a key cache is
          destroyed, all indexes assigned to it are reassigned to the
          default key cache.
        </p><p>
          For a busy server, we recommend a strategy that uses three key
          caches:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              A “<span class="quote">hot</span>” key cache that takes up 20% of the
              space allocated for all key caches. Use this for tables
              that are heavily used for searches but that are not
              updated.
            </p></li><li><p>
              A “<span class="quote">cold</span>” key cache that takes up 20% of the
              space allocated for all key caches. Use this cache for
              medium-sized, intensively modified tables, such as
              temporary tables.
            </p></li><li><p>
              A “<span class="quote">warm</span>” key cache that takes up 60% of the
              key cache space. Employ this as the default key cache, to
              be used by default for all other tables.
            </p></li></ul></div><p>
          One reason the use of three key caches is beneficial is that
          access to one key cache structure does not block access to the
          others. Statements that access tables assigned to one cache do
          not compete with statements that access tables assigned to
          another cache. Performance gains occur for other reasons as
          well:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              The hot cache is used only for retrieval queries, so its
              contents are never modified. Consequently, whenever an
              index block needs to be pulled in from disk, the contents
              of the cache block chosen for replacement need not be
              flushed first.
            </p></li><li><p>
              For an index assigned to the hot cache, if there are no
              queries requiring an index scan, there is a high
              probability that the index blocks corresponding to
              non-leaf nodes of the index B-tree remain in the cache.
            </p></li><li><p>
              An update operation most frequently executed for temporary
              tables is performed much faster when the updated node is
              in the cache and need not be read in from disk first. If
              the size of the indexes of the temporary tables are
              comparable with the size of cold key cache, the
              probability is very high that the updated node is in the
              cache.
            </p></li></ul></div><p>
          <a href="sql-syntax.html#cache-index" title="12.5.7.2. CACHE INDEX Syntax"><code class="literal">CACHE INDEX</code></a> sets up an
          association between a table and a key cache, but the
          association is lost each time the server restarts. If you want
          the association to take effect each time the server starts,
          one way to accomplish this is to use an option file: Include
          variable settings that configure your key caches, and an
          <code class="literal">init-file</code> option that names a file
          containing <a href="sql-syntax.html#cache-index" title="12.5.7.2. CACHE INDEX Syntax"><code class="literal">CACHE INDEX</code></a>
          statements to be executed. For example:
        </p><pre class="programlisting">key_buffer_size = 4G
hot_cache.key_buffer_size = 2G
cold_cache.key_buffer_size = 2G
init_file=/<em class="replaceable"><code>path</code></em>/<em class="replaceable"><code>to</code></em>/<em class="replaceable"><code>data-directory</code></em>/mysqld_init.sql
</pre><p class="mnmas"><b>MySQL Enterprise</b>
            For advice on how best to configure your
            <code class="filename">my.cnf/my.ini </code> option file subscribe to
            MySQL Enterprise Monitor. Recommendations are based on
            actual table usage. For more information, see
            <a href="http://www.mysql.com/products/enterprise/advisors.html" target="_top">http://www.mysql.com/products/enterprise/advisors.html</a>.
          </p><p>
          The statements in <code class="filename">mysqld_init.sql</code> are
          executed each time the server starts. The file should contain
          one SQL statement per line. The following example assigns
          several tables each to <code class="literal">hot_cache</code> and
          <code class="literal">cold_cache</code>:
        </p><pre class="programlisting">CACHE INDEX db1.t1, db1.t2, db2.t3 IN hot_cache
CACHE INDEX db1.t4, db2.t5, db2.t6 IN cold_cache
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="midpoint-insertion"></a>7.4.5.3. Midpoint Insertion Strategy</h4></div></div></div><p>
          By default, the key cache management system uses the LRU
          strategy for choosing key cache blocks to be evicted, but it
          also supports a more sophisticated method called the
          <em class="firstterm">midpoint insertion strategy.</em>
        </p><p>
          When using the midpoint insertion strategy, the LRU chain is
          divided into two parts: a hot sub-chain and a warm sub-chain.
          The division point between two parts is not fixed, but the key
          cache management system takes care that the warm part is not
          “<span class="quote">too short,</span>” always containing at least
          <a href="server-administration.html#sysvar_key_cache_division_limit"><code class="literal">key_cache_division_limit</code></a>
          percent of the key cache blocks.
          <a href="server-administration.html#sysvar_key_cache_division_limit"><code class="literal">key_cache_division_limit</code></a> is a
          component of structured key cache variables, so its value is a
          parameter that can be set per cache.
        </p><p>
          When an index block is read from a table into the key cache,
          it is placed at the end of the warm sub-chain. After a certain
          number of hits (accesses of the block), it is promoted to the
          hot sub-chain. At present, the number of hits required to
          promote a block (3) is the same for all index blocks.
        </p><p>
          A block promoted into the hot sub-chain is placed at the end
          of the chain. The block then circulates within this sub-chain.
          If the block stays at the beginning of the sub-chain for a
          long enough time, it is demoted to the warm chain. This time
          is determined by the value of the
          <a href="server-administration.html#sysvar_key_cache_age_threshold"><code class="literal">key_cache_age_threshold</code></a>
          component of the key cache.
        </p><p>
          The threshold value prescribes that, for a key cache
          containing <em class="replaceable"><code>N</code></em> blocks, the block at
          the beginning of the hot sub-chain not accessed within the
          last <code class="literal"><em class="replaceable"><code>N</code></em> ×
          key_cache_age_threshold / 100</code> hits is to be moved to
          the beginning of the warm sub-chain. It then becomes the first
          candidate for eviction, because blocks for replacement always
          are taken from the beginning of the warm sub-chain.
        </p><p>
          The midpoint insertion strategy allows you to keep more-valued
          blocks always in the cache. If you prefer to use the plain LRU
          strategy, leave the
          <a href="server-administration.html#sysvar_key_cache_division_limit"><code class="literal">key_cache_division_limit</code></a>
          value set to its default of 100.
        </p><p>
          The midpoint insertion strategy helps to improve performance
          when execution of a query that requires an index scan
          effectively pushes out of the cache all the index blocks
          corresponding to valuable high-level B-tree nodes. To avoid
          this, you must use a midpoint insertion strategy with the
          <a href="server-administration.html#sysvar_key_cache_division_limit"><code class="literal">key_cache_division_limit</code></a> set
          to much less than 100. Then valuable frequently hit nodes are
          preserved in the hot sub-chain during an index scan operation
          as well.
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="index-preloading"></a>7.4.5.4. Index Preloading</h4></div></div></div><p>
          If there are enough blocks in a key cache to hold blocks of an
          entire index, or at least the blocks corresponding to its
          non-leaf nodes, it makes sense to preload the key cache with
          index blocks before starting to use it. Preloading allows you
          to put the table index blocks into a key cache buffer in the
          most efficient way: by reading the index blocks from disk
          sequentially.
        </p><p>
          Without preloading, the blocks are still placed into the key
          cache as needed by queries. Although the blocks will stay in
          the cache, because there are enough buffers for all of them,
          they are fetched from disk in random order, and not
          sequentially.
        </p><p>
          To preload an index into a cache, use the
          <a href="sql-syntax.html#load-index" title="12.5.7.5. LOAD INDEX INTO
        CACHE Syntax"><code class="literal">LOAD INDEX INTO
          CACHE</code></a> statement. For example, the following
          statement preloads nodes (index blocks) of indexes of the
          tables <code class="literal">t1</code> and <code class="literal">t2</code>:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>LOAD INDEX INTO CACHE t1, t2 IGNORE LEAVES;</code></strong>
+---------+--------------+----------+----------+
| Table   | Op           | Msg_type | Msg_text |
+---------+--------------+----------+----------+
| test.t1 | preload_keys | status   | OK       |
| test.t2 | preload_keys | status   | OK       |
+---------+--------------+----------+----------+
</pre><p>
          The <code class="literal">IGNORE LEAVES</code> modifier causes only
          blocks for the non-leaf nodes of the index to be preloaded.
          Thus, the statement shown preloads all index blocks from
          <code class="literal">t1</code>, but only blocks for the non-leaf nodes
          from <code class="literal">t2</code>.
        </p><p>
          If an index has been assigned to a key cache using a
          <a href="sql-syntax.html#cache-index" title="12.5.7.2. CACHE INDEX Syntax"><code class="literal">CACHE INDEX</code></a> statement,
          preloading places index blocks into that cache. Otherwise, the
          index is loaded into the default key cache.
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="key-cache-block-size"></a>7.4.5.5. Key Cache Block Size</h4></div></div></div><p>
          It is possible to specify the size of the block buffers for an
          individual key cache using the
          <a href="server-administration.html#sysvar_key_cache_block_size"><code class="literal">key_cache_block_size</code></a>
          variable. This permits tuning of the performance of I/O
          operations for index files.
        </p><p>
          The best performance for I/O operations is achieved when the
          size of read buffers is equal to the size of the native
          operating system I/O buffers. But setting the size of key
          nodes equal to the size of the I/O buffer does not always
          ensure the best overall performance. When reading the big leaf
          nodes, the server pulls in a lot of unnecessary data,
          effectively preventing reading other leaf nodes.
        </p><p>
          To control the size of blocks in the <code class="filename">.MYI</code>
          index file of <code class="literal">MyISAM</code> tables, use the
          <a href="server-administration.html#option_mysqld_myisam-block-size"><code class="option">--myisam-block-size</code></a> option at
          server startup.
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="key-cache-restructuring"></a>7.4.5.6. Restructuring a Key Cache</h4></div></div></div><p>
          A key cache can be restructured at any time by updating its
          parameter values. For example:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET GLOBAL cold_cache.key_buffer_size=4*1024*1024;</code></strong>
</pre><p>
          If you assign to either the
          <a href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a> or
          <a href="server-administration.html#sysvar_key_cache_block_size"><code class="literal">key_cache_block_size</code></a> key
          cache component a value that differs from the component's
          current value, the server destroys the cache's old structure
          and creates a new one based on the new values. If the cache
          contains any dirty blocks, the server saves them to disk
          before destroying and re-creating the cache. Restructuring
          does not occur if you change other key cache parameters.
        </p><p>
          When restructuring a key cache, the server first flushes the
          contents of any dirty buffers to disk. After that, the cache
          contents become unavailable. However, restructuring does not
          block queries that need to use indexes assigned to the cache.
          Instead, the server directly accesses the table indexes using
          native file system caching. File system caching is not as
          efficient as using a key cache, so although queries execute, a
          slowdown can be anticipated. After the cache has been
          restructured, it becomes available again for caching indexes
          assigned to it, and the use of file system caching for the
          indexes ceases.
        </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="myisam-index-statistics"></a>7.4.6. <code class="literal">MyISAM</code> Index Statistics Collection</h3></div></div></div><p>
        Storage engines collect statistics about tables for use by the
        optimizer. Table statistics are based on value groups, where a
        value group is a set of rows with the same key prefix value. For
        optimizer purposes, an important statistic is the average value
        group size.
      </p><p>
        MySQL uses the average value group size in the following ways:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            To estimate how may rows must be read for each
            <a href="optimization.html#jointype_ref"><code class="literal">ref</code></a> access
          </p></li><li><p>
            To estimate how many row a partial join will produce; that
            is, the number of rows that an operation of this form will
            produce:
          </p><pre class="programlisting">(...) JOIN <em class="replaceable"><code>tbl_name</code></em> ON <em class="replaceable"><code>tbl_name</code></em>.<em class="replaceable"><code>key</code></em> = <em class="replaceable"><code>expr</code></em>
</pre></li></ul></div><p>
        As the average value group size for an index increases, the
        index is less useful for those two purposes because the average
        number of rows per lookup increases: For the index to be good
        for optimization purposes, it is best that each index value
        target a small number of rows in the table. When a given index
        value yields a large number of rows, the index is less useful
        and MySQL is less likely to use it.
      </p><p>
        The average value group size is related to table cardinality,
        which is the number of value groups. The
        <a href="sql-syntax.html#show-index" title="12.5.6.23. SHOW INDEX Syntax"><code class="literal">SHOW INDEX</code></a> statement displays a
        cardinality value based on
        <em class="replaceable"><code>N</code></em>/<em class="replaceable"><code>S</code></em>, where
        <em class="replaceable"><code>N</code></em> is the number of rows in the table
        and <em class="replaceable"><code>S</code></em> is the average value group
        size. That ratio yields an approximate number of value groups in
        the table.
      </p><p>
        For a join based on the <code class="literal">&lt;=&gt;</code> comparison
        operator, <code class="literal">NULL</code> is not treated differently
        from any other value: <code class="literal">NULL &lt;=&gt; NULL</code>,
        just as <code class="literal"><em class="replaceable"><code>N</code></em> &lt;=&gt;
        <em class="replaceable"><code>N</code></em></code> for any other
        <em class="replaceable"><code>N</code></em>.
      </p><p>
        However, for a join based on the <code class="literal">=</code> operator,
        <code class="literal">NULL</code> is different from
        non-<code class="literal">NULL</code> values:
        <code class="literal"><em class="replaceable"><code>expr1</code></em> =
        <em class="replaceable"><code>expr2</code></em></code> is not true when
        <em class="replaceable"><code>expr1</code></em> or
        <em class="replaceable"><code>expr2</code></em> (or both) are
        <code class="literal">NULL</code>. This affects
        <a href="optimization.html#jointype_ref"><code class="literal">ref</code></a> accesses for comparisons
        of the form <code class="literal"><em class="replaceable"><code>tbl_name.key</code></em> =
        <em class="replaceable"><code>expr</code></em></code>: MySQL will not access
        the table if the current value of
        <em class="replaceable"><code>expr</code></em> is <code class="literal">NULL</code>,
        because the comparison cannot be true.
      </p><p>
        For <code class="literal">=</code> comparisons, it does not matter how
        many <code class="literal">NULL</code> values are in the table. For
        optimization purposes, the relevant value is the average size of
        the non-<code class="literal">NULL</code> value groups. However, MySQL
        does not currently allow that average size to be collected or
        used.
      </p><p>
        For <code class="literal">MyISAM</code> tables, you have some control over
        collection of table statistics by means of the
        <a href="server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a> system
        variable. This variable has three possible values, which differ
        as follows:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            When <a href="server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a> is
            <code class="literal">nulls_equal</code>, all <code class="literal">NULL</code>
            values are treated as identical (that is, they all form a
            single value group).
          </p><p>
            If the <code class="literal">NULL</code> value group size is much
            higher than the average non-<code class="literal">NULL</code> value
            group size, this method skews the average value group size
            upward. This makes index appear to the optimizer to be less
            useful than it really is for joins that look for
            non-<code class="literal">NULL</code> values. Consequently, the
            <code class="literal">nulls_equal</code> method may cause the
            optimizer not to use the index for
            <a href="optimization.html#jointype_ref"><code class="literal">ref</code></a> accesses when it
            should.
          </p></li><li><p>
            When <a href="server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a> is
            <code class="literal">nulls_unequal</code>, <code class="literal">NULL</code>
            values are not considered the same. Instead, each
            <code class="literal">NULL</code> value forms a separate value group
            of size 1.
          </p><p>
            If you have many <code class="literal">NULL</code> values, this method
            skews the average value group size downward. If the average
            non-<code class="literal">NULL</code> value group size is large,
            counting <code class="literal">NULL</code> values each as a group of
            size 1 causes the optimizer to overestimate the value of the
            index for joins that look for non-<code class="literal">NULL</code>
            values. Consequently, the <code class="literal">nulls_unequal</code>
            method may cause the optimizer to use this index for
            <a href="optimization.html#jointype_ref"><code class="literal">ref</code></a> lookups when other
            methods may be better.
          </p></li><li><p>
            When <a href="server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a> is
            <code class="literal">nulls_ignored</code>, <code class="literal">NULL</code>
            values are ignored.
          </p></li></ul></div><p>
        If you tend to use many joins that use
        <code class="literal">&lt;=&gt;</code> rather than <code class="literal">=</code>,
        <code class="literal">NULL</code> values are not special in comparisons
        and one <code class="literal">NULL</code> is equal to another. In this
        case, <code class="literal">nulls_equal</code> is the appropriate
        statistics method.
      </p><p>
        The <a href="server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a> system
        variable has global and session values. Setting the global value
        affects <code class="literal">MyISAM</code> statistics collection for all
        <code class="literal">MyISAM</code> tables. Setting the session value
        affects statistics collection only for the current client
        connection. This means that you can force a table's statistics
        to be regenerated with a given method without affecting other
        clients by setting the session value of
        <a href="server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a>.
      </p><p>
        To regenerate table statistics, you can use any of the following
        methods:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Execute <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk
            --stats_method=<em class="replaceable"><code>method_name</code></em>
            --analyze</strong></span></a>
          </p></li><li><p>
            Change the table to cause its statistics to go out of date
            (for example, insert a row and then delete it), and then set
            <a href="server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a> and
            issue an <a href="sql-syntax.html#analyze-table" title="12.5.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>
            statement
          </p></li></ul></div><p>
        Some caveats regarding the use of
        <a href="server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a>:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            You can force table statistics to be collected explicitly,
            as just described. However, MySQL may also collect
            statistics automatically. For example, if during the course
            of executing statements for a table, some of those
            statements modify the table, MySQL may collect statistics.
            (This may occur for bulk inserts or deletes, or some
            <a href="sql-syntax.html#alter-table" title="12.1.6. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements, for
            example.) If this happens, the statistics are collected
            using whatever value
            <a href="server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a> has at
            the time. Thus, if you collect statistics using one method,
            but <a href="server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a> is
            set to the other method when a table's statistics are
            collected automatically later, the other method will be
            used.
          </p></li><li><p>
            There is no way to tell which method was used to generate
            statistics for a given <code class="literal">MyISAM</code> table.
          </p></li><li><p>
            <a href="server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a> applies
            only to <code class="literal">MyISAM</code> tables. Other storage
            engines have only one method for collecting table
            statistics. Usually it is closer to the
            <code class="literal">nulls_equal</code> method.
          </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="table-cache"></a>7.4.7. How MySQL Opens and Closes Tables</h3></div></div></div><a class="indexterm" name="id3188170"></a><a class="indexterm" name="id3188179"></a><a class="indexterm" name="id3188191"></a><a class="indexterm" name="id3188203"></a><a class="indexterm" name="id3188216"></a><a class="indexterm" name="id3188228"></a><a class="indexterm" name="id3188237"></a><a class="indexterm" name="id3188250"></a><p>
        When you execute a <a href="programs.html#mysqladmin" title="4.5.2. mysqladmin — Client for Administering a MySQL Server"><span><strong class="command">mysqladmin status</strong></span></a> command,
        you should see something like this:
      </p><pre class="programlisting">Uptime: 426 Running threads: 1 Questions: 11082
Reloads: 1 Open tables: 12
</pre><p>
        The <code class="literal">Open tables</code> value of 12 can be somewhat
        puzzling if you have only six tables.
      </p><p>
        MySQL is multi-threaded, so there may be many clients issuing
        queries for a given table simultaneously. To minimize the
        problem with multiple client sessions having different states on
        the same table, the table is opened independently by each
        concurrent session. This uses additional memory but normally
        increases performance. With <code class="literal">MyISAM</code> tables,
        one extra file descriptor is required for the data file for each
        client that has the table open. (By contrast, the index file
        descriptor is shared between all sessions.)
      </p><p>
        The <a href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a>,
        <a href="server-administration.html#sysvar_max_connections"><code class="literal">max_connections</code></a>, and
        <a href="server-administration.html#sysvar_max_tmp_tables"><code class="literal">max_tmp_tables</code></a> system variables
        affect the maximum number of files the server keeps open. If you
        increase one or more of these values, you may run up against a
        limit imposed by your operating system on the per-process number
        of open file descriptors. Many operating systems allow you to
        increase the open-files limit, although the method varies widely
        from system to system. Consult your operating system
        documentation to determine whether it is possible to increase
        the limit and how to do so.
      </p><p>
        <a href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a> is related to
        <a href="server-administration.html#sysvar_max_connections"><code class="literal">max_connections</code></a>. For example,
        for 200 concurrent running connections, you should have a table
        cache size of at least <code class="literal">200 ×
        <em class="replaceable"><code>N</code></em></code>, where
        <em class="replaceable"><code>N</code></em> is the maximum number of tables per
        join in any of the queries which you execute. You must also
        reserve some extra file descriptors for temporary tables and
        files.
      </p><p>
        Make sure that your operating system can handle the number of
        open file descriptors implied by the
        <a href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a> setting. If
        <a href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a> is set too
        high, MySQL may run out of file descriptors and refuse
        connections, fail to perform queries, and be very unreliable.
        You also have to take into account that the
        <code class="literal">MyISAM</code> storage engine needs two file
        descriptors for each unique open table. You can increase the
        number of file descriptors available to MySQL using the
        <a href="server-administration.html#option_mysqld_open-files-limit"><code class="option">--open-files-limit</code></a> startup option
        to <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a>. See
        <a href="error-handling.html#not-enough-file-handles" title="B.1.2.18. 'File' Not Found and
          Similar Errors">Section B.1.2.18, “<span class="errortext">'<em class="replaceable"><code>File</code></em>' Not Found</span> and
          Similar Errors”</a>.
      </p><p>
        The cache of open tables is kept at a level of
        <a href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a> entries. The
        default value is 64; this can be changed with the
        <a href="server-administration.html#sysvar_table_open_cache"><code class="option">--table_open_cache</code></a> option to
        <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a>. Note that MySQL may temporarily open
        more tables than this to execute queries.
      </p><p class="mnmas"><b>MySQL Enterprise</b>
          Performance may suffer if
          <a href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a> is set too
          low. For expert advice on the optimum value for this variable,
          subscribe to the MySQL Enterprise Monitor. For more
          information, see
          <a href="http://www.mysql.com/products/enterprise/advisors.html" target="_top">http://www.mysql.com/products/enterprise/advisors.html</a>.
        </p><p>
        MySQL closes an unused table and removes it from the table cache
        under the following circumstances:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            When the cache is full and a thread tries to open a table
            that is not in the cache.
          </p></li><li><p>
            When the cache contains more than
            <a href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a> entries
            and a table in the cache is no longer being used by any
            threads.
          </p></li><li><p>
            When a table flushing operation occurs. This happens when
            someone issues a
            <a href="sql-syntax.html#flush" title="12.5.7.3. FLUSH Syntax"><code class="literal">FLUSH
            TABLES</code></a> statement or executes a <a href="programs.html#mysqladmin" title="4.5.2. mysqladmin — Client for Administering a MySQL Server"><span><strong class="command">mysqladmin
            flush-tables</strong></span></a> or <a href="programs.html#mysqladmin" title="4.5.2. mysqladmin — Client for Administering a MySQL Server"><span><strong class="command">mysqladmin
            refresh</strong></span></a> command.
          </p></li></ul></div><p>
        When the table cache fills up, the server uses the following
        procedure to locate a cache entry to use:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Tables that are not currently in use are released, beginning
            with the table least recently used.
          </p></li><li><p>
            If a new table needs to be opened, but the cache is full and
            no tables can be released, the cache is temporarily extended
            as necessary. When the cache is in a temporarily extended
            state and a table goes from a used to unused state, the
            table is closed and released from the cache.
          </p></li></ul></div><p>
        A <code class="literal">MyISAM</code> table is opened for each concurrent
        access. This means the table needs to be opened twice if two
        threads access the same table or if a thread accesses the table
        twice in the same query (for example, by joining the table to
        itself). Each concurrent open requires an entry in the table
        cache. The first open of any <code class="literal">MyISAM</code> table
        takes two file descriptors: one for the data file and one for
        the index file. Each additional use of the table takes only one
        file descriptor for the data file. The index file descriptor is
        shared among all threads.
      </p><p>
        If you are opening a table with the <code class="literal">HANDLER
        <em class="replaceable"><code>tbl_name</code></em> OPEN</code> statement, a
        dedicated table object is allocated for the thread. This table
        object is not shared by other threads and is not closed until
        the thread calls <code class="literal">HANDLER
        <em class="replaceable"><code>tbl_name</code></em> CLOSE</code> or the
        thread terminates. When this happens, the table is put back in
        the table cache (if the cache is not full). See
        <a href="sql-syntax.html#handler" title="12.2.4. HANDLER Syntax">Section 12.2.4, “<code class="literal">HANDLER</code> Syntax”</a>.
      </p><p>
        You can determine whether your table cache is too small by
        checking the <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> status variable
        <a href="server-administration.html#statvar_Opened_tables"><code class="literal">Opened_tables</code></a>, which indicates
        the number of table-opening operations since the server started:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW GLOBAL STATUS LIKE 'Opened_tables';</code></strong>
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| Opened_tables | 2741  |
+---------------+-------+
</pre><p>
        If the value is very large or increases rapidly, even when you
        have not issued many
        <a href="sql-syntax.html#flush" title="12.5.7.3. FLUSH Syntax"><code class="literal">FLUSH TABLES</code></a>
        statements, you should increase the table cache size. See
        <a href="server-administration.html#server-system-variables" title="5.1.3. Server System Variables">Section 5.1.3, “Server System Variables”</a>, and
        <a href="server-administration.html#server-status-variables" title="5.1.6. Server Status Variables">Section 5.1.6, “Server Status Variables”</a>.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="creating-many-tables"></a>7.4.8. Disadvantages of Creating Many Tables in the Same Database</h3></div></div></div><a class="indexterm" name="id3188712"></a><p>
        If you have many <code class="literal">MyISAM</code> tables in the same
        database directory, open, close, and create operations are slow.
        If you execute <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements
        on many different tables, there is a little overhead when the
        table cache is full, because for every table that has to be
        opened, another must be closed. You can reduce this overhead by
        increasing the number of entries allowed in the table cache.
      </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="optimizing-the-server"></a>7.5. Optimizing the MySQL Server</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="optimization.html#compile-and-link-options">7.5.1. How Compiling and Linking Affects the Speed of MySQL</a></span></dt><dt><span class="section"><a href="optimization.html#system-optimization">7.5.2. System Factors and Startup Parameter Tuning</a></span></dt><dt><span class="section"><a href="optimization.html#server-parameters">7.5.3. Tuning Server Parameters</a></span></dt><dt><span class="section"><a href="optimization.html#controlling-optimizer">7.5.4. Controlling Query Optimizer Performance</a></span></dt><dt><span class="section"><a href="optimization.html#query-cache">7.5.5. The MySQL Query Cache</a></span></dt><dt><span class="section"><a href="optimization.html#thread-information">7.5.6. Examining Thread Information</a></span></dt><dt><span class="section"><a href="optimization.html#connection-threads">7.5.7. How MySQL Uses Threads for Client Connections</a></span></dt><dt><span class="section"><a href="optimization.html#memory-use">7.5.8. How MySQL Uses Memory</a></span></dt><dt><span class="section"><a href="optimization.html#large-page-support">7.5.9. Enabling Large Page Support</a></span></dt><dt><span class="section"><a href="optimization.html#internal-temporary-tables">7.5.10. How MySQL Uses Internal Temporary Tables</a></span></dt><dt><span class="section"><a href="optimization.html#dns">7.5.11. How MySQL Uses DNS</a></span></dt></dl></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="compile-and-link-options"></a>7.5.1. How Compiling and Linking Affects the Speed of MySQL</h3></div></div></div><a class="indexterm" name="id3188767"></a><a class="indexterm" name="id3188780"></a><a class="indexterm" name="id3188792"></a><a class="indexterm" name="id3188805"></a><p>
        Most of the following tests were performed on Linux with the
        MySQL benchmarks, but they should give some indication for other
        operating systems and workloads.
      </p><p>
        You obtain the fastest executables when you link with
        <code class="option">-static</code>.
      </p><p>
        On Linux, it is best to compile the server with
        <span><strong class="command">pgcc</strong></span> and <code class="option">-O3</code>. You need about
        200MB memory to compile <code class="filename">sql_yacc.cc</code> with
        these options, because <span><strong class="command">gcc</strong></span> or
        <span><strong class="command">pgcc</strong></span> needs a great deal of memory to make all
        functions inline. You should also set <code class="literal">CXX=gcc</code>
        when configuring MySQL to avoid inclusion of the
        <code class="literal">libstdc++</code> library, which is not needed. Note
        that with some versions of <span><strong class="command">pgcc</strong></span>, the
        resulting binary runs only on true Pentium processors, even if
        you use the compiler option indicating that you want the
        resulting code to work on all x586-type processors (such as
        AMD).
      </p><p>
        By using a better compiler and compilation options, you can
        obtain a 10–30% speed increase in applications. This is
        particularly important if you compile the MySQL server yourself.
      </p><p>
        When we tested both the Cygnus CodeFusion and Fujitsu compilers,
        neither was sufficiently bug-free to allow MySQL to be compiled
        with optimizations enabled.
      </p><p>
        The standard MySQL binary distributions are compiled with
        support for all character sets. When you compile MySQL yourself,
        you should include support only for the character sets that you
        are going to use. This is controlled by the
        <a href="installing.html#option_configure_with-charset"><code class="option">--with-charset</code></a> option to
        <span><strong class="command">configure</strong></span>.
      </p><p>
        Here is a list of some measurements that we have made:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            If you use <span><strong class="command">pgcc</strong></span> and compile everything
            with <code class="option">-O6</code>, the <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a>
            server is 1% faster than with <span><strong class="command">gcc</strong></span> 2.95.2.
          </p></li><li><p>
            If you link dynamically (without <code class="option">-static</code>),
            the result is 13% slower on Linux. Note that you still can
            use a dynamically linked MySQL library for your client
            applications. It is the server that is most critical for
            performance.
          </p></li><li><p>
            For a connection from a client to a server running on the
            same host, if you connect using TCP/IP rather than a Unix
            socket file, performance is 7.5% slower. (On Unix, if you
            connect to the host name <code class="literal">localhost</code>, MySQL
            uses a socket file by default.)
          </p></li><li><p>
            For TCP/IP connections from a client to a server, connecting
            to a remote server on another host is 8–11% slower
            than connecting to a server on the same host, even for
            connections faster than 100Mb/s Ethernet.
          </p></li><li><p>
            When running our benchmark tests using secure connections
            (all data encrypted with internal SSL support) performance
            was 55% slower than with unencrypted connections.
          </p></li><li><p>
            If you compile with
            <a href="installing.html#option_configure_with-debug"><code class="option">--with-debug=full</code></a>, most
            queries are 20% slower. Some queries may take substantially
            longer; for example, the MySQL benchmarks run 35% slower. If
            you use <a href="installing.html#option_configure_with-debug"><code class="option">--with-debug</code></a>
            (without <code class="literal">=full</code>), the speed decrease is
            only 15%. For a version of <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> that
            has been compiled with
            <a href="installing.html#option_configure_with-debug"><code class="option">--with-debug=full</code></a>, you can
            disable memory checking at runtime by starting it with the
            <a href="server-administration.html#option_mysqld_skip-safemalloc"><code class="option">--skip-safemalloc</code></a> option. The
            execution speed should then be close to that obtained when
            configuring with
            <a href="installing.html#option_configure_with-debug"><code class="option">--with-debug</code></a>.
          </p></li><li><p>
            On a Sun UltraSPARC-IIe, a server compiled with Forte 5.0 is
            4% faster than one compiled with <span><strong class="command">gcc</strong></span> 3.2.
          </p></li><li><p>
            On a Sun UltraSPARC-IIe, a server compiled with Forte 5.0 is
            4% faster in 32-bit mode than in 64-bit mode.
          </p></li><li><p>
            Compiling with <span><strong class="command">gcc</strong></span> 2.95.2 for UltraSPARC
            with the <code class="option">-mcpu=v8 -Wa,-xarch=v8plusa</code>
            options gives 4% more performance.
          </p></li><li><p>
            On Solaris 2.5.1, MIT-pthreads is 8–12% slower than
            Solaris native threads on a single processor. With greater
            loads or more CPUs, the difference should be larger.
          </p></li><li><p>
            Compiling on Linux-x86 using <span><strong class="command">gcc</strong></span> without
            frame pointers (<code class="option">-fomit-frame-pointer</code> or
            <code class="option">-fomit-frame-pointer -ffixed-ebp</code>) makes
            <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> 1–4% faster.
          </p></li></ul></div><p>
        Binary MySQL distributions for Linux that are provided by MySQL
        AB used to be compiled with <span><strong class="command">pgcc</strong></span>. We had to
        go back to regular <span><strong class="command">gcc</strong></span> due to a bug in
        <span><strong class="command">pgcc</strong></span> that would generate binaries that do not
        run on AMD. We will continue using <span><strong class="command">gcc</strong></span> until
        that bug is resolved. In the meantime, if you have a non-AMD
        machine, you can build a faster binary by compiling with
        <span><strong class="command">pgcc</strong></span>. The standard MySQL Linux binary is
        linked statically to make it faster and more portable.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="system-optimization"></a>7.5.2. System Factors and Startup Parameter Tuning</h3></div></div></div><a class="indexterm" name="id3189240"></a><a class="indexterm" name="id3189253"></a><a class="indexterm" name="id3189262"></a><p>
        We start with system-level factors, because some of these
        decisions must be made very early to achieve large performance
        gains. In other cases, a quick look at this section may suffice.
        However, it is always nice to have a sense of how much can be
        gained by changing factors that apply at this level.
      </p><p>
        The operating system to use is very important. To get the best
        use of multiple-CPU machines, you should use Solaris (because
        its threads implementation works well) or Linux (because the 2.4
        and later kernels have good SMP support). Note that older Linux
        kernels have a 2GB filesize limit by default. If you have such a
        kernel and a need for files larger than 2GB, you should get the
        Large File Support (LFS) patch for the ext2 file system. Other
        file systems such as ReiserFS and XFS do not have this 2GB
        limitation.
      </p><p>
        Before using MySQL in production, we advise you to test it on
        your intended platform.
      </p><a class="indexterm" name="id3189302"></a><p>
        Other tips:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            If you have enough RAM, you could remove all swap devices.
            Some operating systems use a swap device in some contexts
            even if you have free memory.
          </p></li><li><p>
            Avoid external locking. Since MySQL 4.0, the default has
            been for external locking to be disabled on all systems. The
            <a href="server-administration.html#option_mysqld_external-locking"><code class="option">--external-locking</code></a> and
            <a href="server-administration.html#option_mysqld_skip-external-locking"><code class="option">--skip-external-locking</code></a>
            options explicitly enable and disable external locking.
          </p><p>
            Note that disabling external locking does not affect MySQL's
            functionality as long as you run only one server. Just
            remember to take down the server (or lock and flush the
            relevant tables) before you run
            <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a>. On some systems it is
            mandatory to disable external locking because it does not
            work, anyway.
          </p><p>
            The only case in which you cannot disable external locking
            is when you run multiple MySQL <span class="emphasis"><em>servers</em></span>
            (not clients) on the same data, or if you run
            <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a> to check (not repair) a table
            without telling the server to flush and lock the tables
            first. Note that using multiple MySQL servers to access the
            same data concurrently is generally <span class="emphasis"><em>not</em></span>
            recommended, except when using MySQL Cluster.
          </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
              MySQL Cluster is currently not supported in MySQL 6.0.
              Users wishing to upgrade a MySQL Cluster from MySQL 5.0 or
              5.1 should instead migrate to MySQL Cluster NDB 6.2 or
              6.3; these are based on MySQL 5.1 but contain the latest
              improvements and fixes for
              <code class="literal">NDBCLUSTER</code>.
            </p></div><p>
            The <a href="sql-syntax.html#lock-tables" title="12.4.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">LOCK TABLES</code></a> and
            <a href="sql-syntax.html#lock-tables" title="12.4.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">UNLOCK
            TABLES</code></a> statements use internal locking, so you can
            use them even if external locking is disabled.
          </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="server-parameters"></a>7.5.3. Tuning Server Parameters</h3></div></div></div><a class="indexterm" name="id3189445"></a><a class="indexterm" name="id3189457"></a><a class="indexterm" name="id3189470"></a><a class="indexterm" name="id3189482"></a><p>
        You can determine the default buffer sizes used by the
        <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> server using this command:
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysqld --verbose --help</code></strong>
</pre><a class="indexterm" name="id3189516"></a><a class="indexterm" name="id3189525"></a><p>
        This command produces a list of all <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a>
        options and configurable system variables. The output includes
        the default variable values and looks something like this:
      </p><pre class="programlisting">abort-slave-event-count           0
allow-suspicious-udfs             FALSE
archive                           TRUE
auto-increment-increment          1
auto-increment-offset             1
automatic-sp-privileges           TRUE
backup-history-log                TRUE
backup-progress-log               TRUE
backupdir                         /home/jon/bin/mysql-6.0/var/
back_log                          50
basedir                           /home/jon/bin/mysql-6.0/
bind-address                      (No default value)
binlog-row-event-max-size         1024
binlog_cache_size                 32768
binlog_format                     (No default value)
bulk_insert_buffer_size           8388608
character-set-client-handshake    TRUE
character-set-filesystem          binary
character-set-server              latin1
character-sets-dir                /home/jon/bin/mysql-6.0/share/mysql/charsets/
chroot                            (No default value)
collation-server                  latin1_swedish_ci
completion-type                   0
concurrent-insert                 1
connect_timeout                   10
console                           FALSE
datadir                           .
datetime_format                   %Y-%m-%d %H:%i:%s
date_format                       %Y-%m-%d
default-character-set             latin1
default-collation                 latin1_swedish_ci
default-storage-engine            MyISAM
default-table-type                MyISAM
default-time-zone                 (No default value)
default_week_format               0
delayed_insert_limit              100
delayed_insert_timeout            300
delayed_queue_size                1000
des-key-file                      (No default value)
disconnect-slave-event-count      0
div_precision_increment           4
enable-locking                    FALSE
engine-condition-pushdown         TRUE
expire_logs_days                  0
external-locking                  FALSE
falcon                            TRUE
falcon-checkpoint-schedule        7 * * * * *
falcon-checksums                  TRUE
falcon-consistent-read            TRUE
falcon-debug-mask                 0
falcon-debug-server               FALSE
falcon-debug-trace                0
falcon-direct-io                  1
falcon-gopher-threads             5
falcon-index-chill-threshold      4194304
falcon-io-threads                 2
falcon-large-blob-threshold       160000
falcon-lock-wait-timeout          50
falcon-page-cache-size            4194304
falcon-page-size                  4096
falcon-record-chill-threshold     5242880
falcon-record-memory-max          262144000
falcon-record-scavenge-floor      50
falcon-record-scavenge-threshold  67
falcon-scavenge-schedule          15,45 * * * * *
falcon-serial-log-block-size      0
falcon-serial-log-buffers         20
falcon-serial-log-dir             /home/jon/bin/mysql-6.0/var/
falcon-serial-log-file-size       10485760
falcon-serial-log-priority        1
falcon-support-xa                 FALSE
falcon-use-deferred-index-hash    FALSE
falcon-use-sectorcache            FALSE
falcon-use-supernodes             TRUE
flush_time                        0
ft_max_word_len                   84
ft_min_word_len                   4
ft_query_expansion_limit          20
ft_stopword_file                  (No default value)
gdb                               FALSE
general-log                       FALSE
group_concat_max_len              1024
help                              TRUE
init-connect                      (No default value)
init-file                         (No default value)
init-slave                        (No default value)
innodb                            TRUE
innodb-adaptive-hash-index        TRUE
innodb-additional-mem-pool-size   1048576
innodb-autoextend-increment       8
innodb-autoinc-lock-mode          1
innodb-buffer-pool-size           8388608
innodb-checksums                  TRUE
innodb-commit-concurrency         0
innodb-concurrency-tickets        500
innodb-data-file-path             (No default value)
innodb-data-home-dir              (No default value)
innodb-doublewrite                TRUE
innodb-fast-shutdown              1
innodb-file-io-threads            4
innodb-file-per-table             FALSE
innodb-flush-log-at-trx-commit    1
innodb-flush-method               (No default value)
innodb-force-recovery             0
innodb-lock-wait-timeout          50
innodb-locks-unsafe-for-binlog    FALSE
innodb-log-buffer-size            1048576
innodb-log-file-size              5242880
innodb-log-files-in-group         2
innodb-log-group-home-dir         (No default value)
innodb-max-dirty-pages-pct        90
innodb-max-purge-lag              0
innodb-mirrored-log-groups        1
innodb-open-files                 300
innodb-rollback-on-timeout        FALSE
innodb-stats-on-metadata          TRUE
innodb-status-file                FALSE
innodb-support-xa                 TRUE
innodb-sync-spin-loops            20
innodb-table-locks                TRUE
innodb-thread-concurrency         8
innodb-thread-sleep-delay         10000
interactive_timeout               28800
join_buffer_size                  131072
keep_files_on_create              FALSE
key_buffer_size                   8388600
key_cache_age_threshold           300
key_cache_block_size              1024
key_cache_division_limit          100
language                          /home/jon/bin/mysql-6.0/share/mysql/english/
large-pages                       FALSE
lc-time-names                     en_US
local-infile                      TRUE
log                               (No default value)
log-backup-output                 TABLE
log-bin                           (No default value)
log-bin-index                     (No default value)
log-bin-trust-function-creators   FALSE
log-bin-trust-routine-creators    FALSE
log-error
log-isam                          myisam.log
log-output                        FILE
log-queries-not-using-indexes     FALSE
log-short-format                  FALSE
log-slave-updates                 FALSE
log-slow-admin-statements         FALSE
log-slow-queries                  (No default value)
log-slow-slave-statements         FALSE
log-tc                            tc.log
log-tc-size                       24576
log-update                        (No default value)
log-warnings                      1
long_query_time                   10
low-priority-updates              FALSE
lower_case_table_names            0
maria                             TRUE
maria-block-size                  8192
maria-checkpoint-interval         30
maria-force-start-after-recovery-failures 0
maria-log-dir-path                /home/jon/bin/mysql-6.0/var/
maria-log-file-size               1073741824
maria-log-purge-type              immediate
maria-max-sort-file-size          9223372036854775807
maria-page-checksum               TRUE
maria-pagecache-age-threshold     300
maria-pagecache-buffer-size       8388600
maria-pagecache-division-limit    100
maria-recover                     OFF
maria-repair-threads              1
maria-sort-buffer-size            8388608
maria-stats-method                nulls_unequal
maria-sync-log-dir                NEWFILE
master-info-file                  master.info
master-retry-count                86400
max-binlog-dump-events            0
max_allowed_packet                1048576
max_binlog_cache_size             18446744073709551615
max_binlog_size                   1073741824
max_connections                   151
max_connect_errors                10
max_delayed_threads               20
max_error_count                   64
max_heap_table_size               16777216
max_join_size                     18446744073709551615
max_length_for_sort_data          1024
max_prepared_stmt_count           16382
max_relay_log_size                0
max_seeks_for_key                 18446744073709551615
max_sort_length                   1024
max_sp_recursion_depth            0
max_tmp_tables                    32
max_user_connections              0
max_write_lock_count              18446744073709551615
memlock                           FALSE
min_examined_row_limit            0
myisam-recover                    OFF
myisam_block_size                 1024
myisam_data_pointer_size          6
myisam_max_sort_file_size         9223372036854775807
myisam_repair_threads             1
myisam_sort_buffer_size           8388608
myisam_stats_method               nulls_unequal
myisam_use_mmap                   FALSE
net_buffer_length                 16384
net_read_timeout                  30
net_retry_count                   10
net_write_timeout                 60
new                               FALSE
old                               FALSE
old-alter-table                   FALSE
old-passwords                     FALSE
old-style-user-limits             FALSE
open_files_limit                  1024
optimizer_prune_level             1
optimizer_search_depth            62
pid-file                          /home/jon/bin/mysql-6.0/var/tonfisk.pid
plugin_dir                        /home/jon/bin/mysql-6.0/lib/mysql/plugin
plugin_load                       (No default value)
port                              3306
port-open-timeout                 0
preload_buffer_size               32768
profiling_history_size            15
query_alloc_block_size            8192
query_cache_limit                 1048576
query_cache_min_res_unit          4096
query_cache_size                  0
query_cache_type                  1
query_cache_wlock_invalidate      FALSE
query_prealloc_size               8192
range_alloc_block_size            4096
read_buffer_size                  131072
read_only                         FALSE
read_rnd_buffer_size              262144
record_buffer                     131072
relay-log                         (No default value)
relay-log-index                   (No default value)
relay-log-info-file               relay-log.info
relay_log_purge                   TRUE
relay_log_space_limit             0
replicate-same-server-id          FALSE
report-host                       (No default value)
report-password                   (No default value)
report-port                       3306
report-user                       (No default value)
rpl-recovery-rank                 0
safe-user-create                  FALSE
secure-auth                       FALSE
secure-backup-file-priv           (No default value)
secure-file-priv                  (No default value)
server-id                         0
show-slave-auth-info              FALSE
skip-grant-tables                 FALSE
skip-slave-start                  FALSE
slave-allow-batching              FALSE
slave-exec-mode                   STRICT
slave-load-tmpdir                 /tmp
slave_compressed_protocol         FALSE
slave_net_timeout                 3600
slave_transaction_retries         10
slow-query-log                    FALSE
slow_launch_time                  2
socket                            /tmp/mysql.sock
sort_buffer_size                  2097144
sporadic-binlog-dump-fail         FALSE
sql-mode                          OFF
ssl                               FALSE
ssl-ca                            (No default value)
ssl-capath                        (No default value)
ssl-cert                          (No default value)
ssl-cipher                        (No default value)
ssl-key                           (No default value)
symbolic-links                    TRUE
sync-binlog                       0
sync-frm                          TRUE
sysdate-is-now                    FALSE
table_cache                       64
table_definition_cache            256
table_lock_wait_timeout           50
table_open_cache                  64
tc-heuristic-recover              (No default value)
temp-pool                         TRUE
thread_cache_size                 0
thread_concurrency                10
thread_stack                      262144
timed_mutexes                     FALSE
time_format                       %H:%i:%s
tmpdir                            (No default value)
tmp_table_size                    16777216
transaction_alloc_block_size      8192
transaction_prealloc_size         4096
updatable_views_with_limit        1
use-symbolic-links                TRUE
verbose                           TRUE
wait_timeout                      28800
warnings                          1
</pre><p>
        For a <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> server that is currently
        running, you can see the current values of its system variables
        by connecting to it and issuing this statement:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW VARIABLES;</code></strong>
</pre><p>
        You can also see some statistical and status indicators for a
        running server by issuing this statement:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW STATUS;</code></strong>
</pre><p>
        System variable and status information also can be obtained
        using <a href="programs.html#mysqladmin" title="4.5.2. mysqladmin — Client for Administering a MySQL Server"><span><strong class="command">mysqladmin</strong></span></a>:
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysqladmin variables</code></strong>
shell&gt; <strong class="userinput"><code>mysqladmin extended-status</code></strong>
</pre><p>
        For a full description of all system and status variables, see
        <a href="server-administration.html#server-system-variables" title="5.1.3. Server System Variables">Section 5.1.3, “Server System Variables”</a>, and
        <a href="server-administration.html#server-status-variables" title="5.1.6. Server Status Variables">Section 5.1.6, “Server Status Variables”</a>.
      </p><p>
        MySQL uses algorithms that are very scalable, so you can usually
        run with very little memory. However, normally you get better
        performance by giving MySQL more memory.
      </p><p>
        When tuning a MySQL server, the two most important variables to
        configure are <a href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a>
        and <a href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a>. You
        should first feel confident that you have these set
        appropriately before trying to change any other variables.
      </p><p>
        The following examples indicate some typical variable values for
        different runtime configurations.
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            If you have at least 256MB of memory and many tables and
            want maximum performance with a moderate number of clients,
            you should use something like this:
          </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysqld_safe --key_buffer_size=64M --table_open_cache=256 \</code></strong>
           <strong class="userinput"><code>--sort_buffer_size=4M --read_buffer_size=1M &amp;</code></strong>
</pre></li><li><p>
            If you have only 128MB of memory and only a few tables, but
            you still do a lot of sorting, you can use something like
            this:
          </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysqld_safe --key_buffer_size=16M --sort_buffer_size=1M</code></strong>
</pre><p>
            If there are very many simultaneous connections, swapping
            problems may occur unless <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> has been
            configured to use very little memory for each connection.
            <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> performs better if you have enough
            memory for all connections.
          </p></li><li><p>
            With little memory and lots of connections, use something
            like this:
          </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysqld_safe --key_buffer_size=512K --sort_buffer_size=100K \</code></strong>
           <strong class="userinput"><code>--read_buffer_size=100K &amp;</code></strong>
</pre><p>
            Or even this:
          </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysqld_safe --key_buffer_size=512K --sort_buffer_size=16K \</code></strong>
           <strong class="userinput"><code>--table_open_cache=32 --read_buffer_size=8K \</code></strong>
           <strong class="userinput"><code>--net_buffer_length=1K &amp;</code></strong>
</pre></li></ul></div><p>
        If you are performing <code class="literal">GROUP BY</code> or
        <code class="literal">ORDER BY</code> operations on tables that are much
        larger than your available memory, you should increase the value
        of <a href="server-administration.html#sysvar_read_rnd_buffer_size"><code class="literal">read_rnd_buffer_size</code></a> to
        speed up the reading of rows following sorting operations.
      </p><p>
        You can make use of the example option files included with your
        MySQL distribution; see
        <a href="programs.html#option-files-preconfigured" title="4.2.3.2.2. Preconfigured Option Files">Section 4.2.3.2.2, “Preconfigured Option Files”</a>.
      </p><p>
        If you specify an option on the command line for
        <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> or <a href="programs.html#mysqld-safe" title="4.3.2. mysqld_safe — MySQL Server Startup Script"><span><strong class="command">mysqld_safe</strong></span></a>, it
        remains in effect only for that invocation of the server. To use
        the option every time the server runs, put it in an option file.
      </p><p>
        To see the effects of a parameter change, do something like
        this:
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysqld --key_buffer_size=32M --verbose --help</code></strong>
</pre><p>
        The variable values are listed near the end of the output. Make
        sure that the <a href="server-administration.html#option_mysqld_verbose"><code class="option">--verbose</code></a> and
        <a href="server-administration.html#option_mysqld_help"><code class="option">--help</code></a> options are last.
        Otherwise, the effect of any options listed after them on the
        command line are not reflected in the output.
      </p><p>
        For information on tuning the <code class="literal">InnoDB</code> storage
        engine, see <a href="storage-engines.html#innodb-tuning" title="13.7.13.1. InnoDB Performance Tuning Tips">Section 13.7.13.1, “<code class="literal">InnoDB</code> Performance Tuning Tips”</a>.
      </p><p class="mnmas"><b>MySQL Enterprise</b>
          For expert advice on tuning system parameters subscribe to the
          MySQL Enterprise Monitor. For more information, see
          <a href="http://www.mysql.com/products/enterprise/advisors.html" target="_top">http://www.mysql.com/products/enterprise/advisors.html</a>.
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="controlling-optimizer"></a>7.5.4. Controlling Query Optimizer Performance</h3></div></div></div><a class="indexterm" name="id3190222"></a><p>
        The task of the query optimizer is to find an optimal plan for
        executing an SQL query. Because the difference in performance
        between “<span class="quote">good</span>” and “<span class="quote">bad</span>” plans can be
        orders of magnitude (that is, seconds versus hours or even
        days), most query optimizers, including that of MySQL, perform a
        more or less exhaustive search for an optimal plan among all
        possible query evaluation plans. For join queries, the number of
        possible plans investigated by the MySQL optimizer grows
        exponentially with the number of tables referenced in a query.
        For small numbers of tables (typically less than 7–10)
        this is not a problem. However, when larger queries are
        submitted, the time spent in query optimization may easily
        become the major bottleneck in the server's performance.
      </p><p>
        A more flexible method for query optimization allows the user to
        control how exhaustive the optimizer is in its search for an
        optimal query evaluation plan. The general idea is that the
        fewer plans that are investigated by the optimizer, the less
        time it spends in compiling a query. On the other hand, because
        the optimizer skips some plans, it may miss finding an optimal
        plan.
      </p><p>
        The behavior of the optimizer with respect to the number of
        plans it evaluates can be controlled via two system variables:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            The <a href="server-administration.html#sysvar_optimizer_prune_level"><code class="literal">optimizer_prune_level</code></a>
            variable tells the optimizer to skip certain plans based on
            estimates of the number of rows accessed for each table. Our
            experience shows that this kind of “<span class="quote">educated
            guess</span>” rarely misses optimal plans, and may
            dramatically reduce query compilation times. That is why
            this option is on
            (<code class="literal">optimizer_prune_level=1</code>) by default.
            However, if you believe that the optimizer missed a better
            query plan, this option can be switched off
            (<code class="literal">optimizer_prune_level=0</code>) with the risk
            that query compilation may take much longer. Note that, even
            with the use of this heuristic, the optimizer still explores
            a roughly exponential number of plans.
          </p></li><li><p>
            The <a href="server-administration.html#sysvar_optimizer_search_depth"><code class="literal">optimizer_search_depth</code></a>
            variable tells how far into the “<span class="quote">future</span>” of
            each incomplete plan the optimizer should look to evaluate
            whether it should be expanded further. Smaller values of
            <a href="server-administration.html#sysvar_optimizer_search_depth"><code class="literal">optimizer_search_depth</code></a> may
            result in orders of magnitude smaller query compilation
            times. For example, queries with 12, 13, or more tables may
            easily require hours and even days to compile if
            <a href="server-administration.html#sysvar_optimizer_search_depth"><code class="literal">optimizer_search_depth</code></a> is
            close to the number of tables in the query. At the same
            time, if compiled with
            <a href="server-administration.html#sysvar_optimizer_search_depth"><code class="literal">optimizer_search_depth</code></a>
            equal to 3 or 4, the optimizer may compile in less than a
            minute for the same query. If you are unsure of what a
            reasonable value is for
            <a href="server-administration.html#sysvar_optimizer_search_depth"><code class="literal">optimizer_search_depth</code></a>,
            this variable can be set to 0 to tell the optimizer to
            determine the value automatically.
          </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="query-cache"></a>7.5.5. The MySQL Query Cache</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="optimization.html#query-cache-operation">7.5.5.1. How the Query Cache Operates</a></span></dt><dt><span class="section"><a href="optimization.html#query-cache-in-select">7.5.5.2. Query Cache <code class="literal">SELECT</code> Options</a></span></dt><dt><span class="section"><a href="optimization.html#query-cache-configuration">7.5.5.3. Query Cache Configuration</a></span></dt><dt><span class="section"><a href="optimization.html#query-cache-status-and-maintenance">7.5.5.4. Query Cache Status and Maintenance</a></span></dt></dl></div><a class="indexterm" name="id3190404"></a><a class="indexterm" name="id3190413"></a><p>
        The query cache stores the text of a
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement together with
        the corresponding result that was sent to the client. If an
        identical statement is received later, the server retrieves the
        results from the query cache rather than parsing and executing
        the statement again. The query cache is shared among sessions,
        so a result set generated by one client can be sent in response
        to the same query issued by another client.
      </p><p>
        The query cache is extremely useful in an environment where you
        have tables that do not change very often and for which the
        server receives many identical queries. This is a typical
        situation for many Web servers that generate many dynamic pages
        based on database content.
      </p><p>
        The query cache does not return stale data. When tables are
        modified, any relevant entries in the query cache are flushed.
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
          The query cache does not work in an environment where you have
          multiple <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> servers updating the same
          <code class="literal">MyISAM</code> tables.
        </p></div><p>
        The query cache is used for prepared statements under the
        conditions described in <a href="optimization.html#query-cache-operation" title="7.5.5.1. How the Query Cache Operates">Section 7.5.5.1, “How the Query Cache Operates”</a>.
      </p><p>
        Some performance data for the query cache follows. These results
        were generated by running the MySQL benchmark suite on a Linux
        Alpha 2×500MHz system with 2GB RAM and a 64MB query cache.
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            If all the queries you are performing are simple (such as
            selecting a row from a table with one row), but still differ
            so that the queries cannot be cached, the overhead for
            having the query cache active is 13%. This could be regarded
            as the worst case scenario. In real life, queries tend to be
            much more complicated, so the overhead normally is
            significantly lower.
          </p></li><li><p>
            Searches for a single row in a single-row table are 238%
            faster with the query cache than without it. This can be
            regarded as close to the minimum speedup to be expected for
            a query that is cached.
          </p></li></ul></div><p>
        To disable the query cache at server startup, set the
        <a href="server-administration.html#sysvar_query_cache_size"><code class="literal">query_cache_size</code></a> system
        variable to 0. By disabling the query cache code, there is no
        noticeable overhead. If you build MySQL from source, query cache
        capabilities can be excluded from the server entirely by
        invoking <span><strong class="command">configure</strong></span> with the
        <code class="option">--without-query-cache</code> option.
      </p><p>
        The query cache offers the potential for substantial performance
        improvement, but you should not assume that it will do so under
        all circumstances. With some query cache configurations or
        server workloads, you might actually see a performance decrease:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Be cautious about sizing the query cache excessively large,
            which increases the overhead required to maintain the cache,
            possibly beyond the benefit of enabling it. Sizes in tens of
            megabytes are usually beneficial. Sizes in the hundreds of
            megabytes might not be.
          </p></li><li><p>
            Server workload has a significant effect on query cache
            efficiency. A query mix consisting almost entirely of a
            fixed set of <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
            statements is much more likely to benefit from enabling the
            cache than a mix in which frequent
            <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements cause
            continual invalidation of results in the cache. In some
            cases, a workaround is to use the
            <code class="literal">SQL_NO_CACHE</code> option to prevent results
            from even entering the cache for
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements that use
            frequently modified tables. (See
            <a href="optimization.html#query-cache-in-select" title="7.5.5.2. Query Cache SELECT Options">Section 7.5.5.2, “Query Cache <code class="literal">SELECT</code> Options”</a>.)
          </p></li></ul></div><p>
        To verify that enabling the query cache is beneficial, test the
        operation of your MySQL server with the cache enabled and
        disabled. Then retest periodically because query cache
        efficiency may change as server workload changes.
      </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="query-cache-operation"></a>7.5.5.1. How the Query Cache Operates</h4></div></div></div><p>
          This section describes how the query cache works when it is
          operational. <a href="optimization.html#query-cache-configuration" title="7.5.5.3. Query Cache Configuration">Section 7.5.5.3, “Query Cache Configuration”</a>,
          describes how to control whether it is operational.
        </p><p>
          Incoming queries are compared to those in the query cache
          before parsing, so the following two queries are regarded as
          different by the query cache:
        </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>tbl_name</code></em>
Select * from <em class="replaceable"><code>tbl_name</code></em>
</pre><p>
          Queries must be <span class="emphasis"><em>exactly</em></span> the same (byte
          for byte) to be seen as identical. In addition, query strings
          that are identical may be treated as different for other
          reasons. Queries that use different databases, different
          protocol versions, or different default character sets are
          considered different queries and are cached separately.
        </p><p>
          The cache is not used for queries of the following types:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              Queries that are a subquery of an outer query
            </p></li><li><p>
              Queries executed within the body of a stored function,
              trigger, or event
            </p></li></ul></div><p>
          Before a query result is fetched from the query cache, MySQL
          checks whether the user has
          <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> privilege for all
          databases and tables involved. If this is not the case, the
          cached result is not used.
        </p><p>
          If a query result is returned from query cache, the server
          increments the <a href="server-administration.html#statvar_Qcache_hits"><code class="literal">Qcache_hits</code></a>
          status variable, not <code class="literal">Com_select</code>. See
          <a href="optimization.html#query-cache-status-and-maintenance" title="7.5.5.4. Query Cache Status and Maintenance">Section 7.5.5.4, “Query Cache Status and Maintenance”</a>.
        </p><p>
          If a table changes, all cached queries that use the table
          become invalid and are removed from the cache. This includes
          queries that use <code class="literal">MERGE</code> tables that map to
          the changed table. A table can be changed by many types of
          statements, such as <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
          <a href="sql-syntax.html#update" title="12.2.12. UPDATE Syntax"><code class="literal">UPDATE</code></a>,
          <a href="sql-syntax.html#delete" title="12.2.2. DELETE Syntax"><code class="literal">DELETE</code></a>,
          <a href="sql-syntax.html#truncate" title="12.2.11. TRUNCATE Syntax"><code class="literal">TRUNCATE</code></a>,
          <a href="sql-syntax.html#alter-table" title="12.1.6. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>,
          <a href="sql-syntax.html#drop-table" title="12.1.23. DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a>, or
          <a href="sql-syntax.html#drop-database" title="12.1.17. DROP DATABASE Syntax"><code class="literal">DROP DATABASE</code></a>.
        </p><p>
          The query cache also works within transactions when using
          <code class="literal">InnoDB</code> tables.
        </p><p>
          In MySQL 6.0, the result from a
          <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> query on a view is
          cached.
        </p><p>
          The query cache works for <code class="literal">SELECT SQL_CALC_FOUND_ROWS
          ...</code> queries and stores a value that is returned by a
          following <code class="literal">SELECT FOUND_ROWS()</code> query.
          <a href="functions.html#function_found-rows"><code class="literal">FOUND_ROWS()</code></a> returns the
          correct value even if the preceding query was fetched from the
          cache because the number of found rows is also stored in the
          cache. The <code class="literal">SELECT FOUND_ROWS()</code> query itself
          cannot be cached.
        </p><p>
          Prepared statements that are issued via the binary protocol
          using <a href="connectors-apis.html#mysql-stmt-prepare" title="20.10.7.21. mysql_stmt_prepare()"><code class="literal">mysql_stmt_prepare()</code></a> and
          <a href="connectors-apis.html#mysql-stmt-execute" title="20.10.7.10. mysql_stmt_execute()"><code class="literal">mysql_stmt_execute()</code></a> (see
          <a href="connectors-apis.html#c-api-prepared-statements" title="20.10.4. C API Prepared Statements">Section 20.10.4, “C API Prepared Statements”</a>), are subject to
          limitations on caching. Comparison with statements in the
          query cache is based on the text of the statement after
          expansion of <code class="literal">?</code> parameter markers. The
          statement is compared only with other cached statements that
          were executed via the binary protocol. That is, for query
          cache purposes, prepared statements issued via the binary
          protocol are distinct from prepared statements issued via the
          text protocol (see
          <a href="sql-syntax.html#sql-syntax-prepared-statements" title="12.7. SQL Syntax for Prepared Statements">Section 12.7, “SQL Syntax for Prepared Statements”</a>).
        </p><p>
          A query cannot be cached if it contains any of the functions
          shown in the following table.
        </p><div class="informaltable"><table border="1"><colgroup><col><col><col></colgroup><tbody><tr><td><a href="functions.html#function_benchmark"><code class="literal">BENCHMARK()</code></a></td><td><a href="functions.html#function_connection-id"><code class="literal">CONNECTION_ID()</code></a></td><td><a href="functions.html#function_convert-tz"><code class="literal">CONVERT_TZ()</code></a></td></tr><tr><td><a href="functions.html#function_curdate"><code class="literal">CURDATE()</code></a></td><td><a href="functions.html#function_current-date"><code class="literal">CURRENT_DATE()</code></a></td><td><a href="functions.html#function_current-time"><code class="literal">CURRENT_TIME()</code></a></td></tr><tr><td><a href="functions.html#function_current-timestamp"><code class="literal">CURRENT_TIMESTAMP()</code></a></td><td><a href="functions.html#function_curtime"><code class="literal">CURTIME()</code></a></td><td><a href="functions.html#function_database"><code class="literal">DATABASE()</code></a></td></tr><tr><td><a href="functions.html#function_encrypt"><code class="literal">ENCRYPT()</code></a> with one parameter</td><td><a href="functions.html#function_found-rows"><code class="literal">FOUND_ROWS()</code></a></td><td><a href="functions.html#function_get-lock"><code class="literal">GET_LOCK()</code></a></td></tr><tr><td><a href="functions.html#function_last-insert-id"><code class="literal">LAST_INSERT_ID()</code></a></td><td><a href="functions.html#function_load-file"><code class="literal">LOAD_FILE()</code></a></td><td><a href="functions.html#function_master-pos-wait"><code class="literal">MASTER_POS_WAIT()</code></a></td></tr><tr><td><a href="functions.html#function_now"><code class="literal">NOW()</code></a></td><td><a href="functions.html#function_rand"><code class="literal">RAND()</code></a></td><td><a href="functions.html#function_release-lock"><code class="literal">RELEASE_LOCK()</code></a></td></tr><tr><td><a href="functions.html#function_sleep"><code class="literal">SLEEP()</code></a></td><td><a href="functions.html#function_sysdate"><code class="literal">SYSDATE()</code></a></td><td><a href="functions.html#function_unix-timestamp"><code class="literal">UNIX_TIMESTAMP()</code></a> with no parameters</td></tr><tr><td><a href="functions.html#function_user"><code class="literal">USER()</code></a></td><td><a href="functions.html#function_uuid"><code class="literal">UUID()</code></a></td><td><a href="functions.html#function_uuid-short"><code class="literal">UUID_SHORT()</code></a></td></tr></tbody></table></div><p>
          A query also is not cached under these conditions:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              It refers to user-defined functions (UDFs) or stored
              functions.
            </p></li><li><p>
              It refers to user variables or local stored program
              variables.
            </p></li><li><p>
              It refers to tables in the <code class="literal">mysql</code> or
              <code class="literal">INFORMATION_SCHEMA</code> system database.
            </p></li><li><p>
              It is of any of the following forms:
            </p><pre class="programlisting">SELECT ... LOCK IN SHARE MODE
SELECT ... FOR UPDATE
SELECT ... INTO OUTFILE ...
SELECT ... INTO DUMPFILE ...
SELECT * FROM ... WHERE autoincrement_col IS NULL
</pre><p>
              The last form is not cached because it is used as the ODBC
              workaround for obtaining the last insert ID value. See the
              MyODBC section of <a href="connectors-apis.html" title="Chapter 20. Connectors and APIs">Chapter 20, <i>Connectors and APIs</i></a>.
            </p></li><li><p>
              It uses <code class="literal">TEMPORARY</code> tables.
            </p></li><li><p>
              It does not use any tables.
            </p></li><li><p>
              It generates warnings.
            </p></li><li><p>
              The user has a column-level privilege for any of the
              involved tables.
            </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="query-cache-in-select"></a>7.5.5.2. Query Cache <code class="literal">SELECT</code> Options</h4></div></div></div><p>
          Two query cache-related options may be specified in
          <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              <a class="indexterm" name="id3191308"></a>

              <a class="indexterm" name="id3191317"></a>

              <code class="literal">SQL_CACHE</code>
            </p><p>
              The query result is cached if it is cacheable and the
              value of the
              <a href="server-administration.html#sysvar_query_cache_type"><code class="literal">query_cache_type</code></a> system
              variable is <code class="literal">ON</code> or
              <code class="literal">DEMAND</code>.
            </p></li><li><p>
              <code class="literal">SQL_NO_CACHE</code>
            </p><p>
              The query result is not cached.
            </p></li></ul></div><p>
          Examples:
        </p><pre class="programlisting">SELECT SQL_CACHE id, name FROM customer;
SELECT SQL_NO_CACHE id, name FROM customer;
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="query-cache-configuration"></a>7.5.5.3. Query Cache Configuration</h4></div></div></div><p>
          The <a href="server-administration.html#sysvar_have_query_cache"><code class="literal">have_query_cache</code></a> server
          system variable indicates whether the query cache is
          available:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'have_query_cache';</code></strong>
+------------------+-------+
| Variable_name    | Value |
+------------------+-------+
| have_query_cache | YES   |
+------------------+-------+
</pre><p>
          When using a standard MySQL binary, this value is always
          <code class="literal">YES</code>, even if query caching is disabled.
        </p><p>
          Several other system variables control query cache operation.
          These can be set in an option file or on the command line when
          starting <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a>. The query cache system
          variables all have names that begin with
          <code class="literal">query_cache_</code>. They are described briefly in
          <a href="server-administration.html#server-system-variables" title="5.1.3. Server System Variables">Section 5.1.3, “Server System Variables”</a>, with additional
          configuration information given here.
        </p><p>
          To set the size of the query cache, set the
          <a href="server-administration.html#sysvar_query_cache_size"><code class="literal">query_cache_size</code></a> system
          variable. Setting it to 0 disables the query cache. The
          default size is 0, so the query cache is disabled by default.
        </p><p class="mnmas"><b>MySQL Enterprise</b>
            For expert advice on configuring the query cache subscribe
            to the MySQL Enterprise Monitor. For more information, see
            <a href="http://www.mysql.com/products/enterprise/advisors.html" target="_top">http://www.mysql.com/products/enterprise/advisors.html</a>.
          </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
            When using the Windows Configuration Wizard to install or
            configure MySQL, the default value for
            <a href="server-administration.html#sysvar_query_cache_size"><code class="literal">query_cache_size</code></a> will be
            configured automatically for you based on the different
            configuration types available. When using the Windows
            Configuration Wizard, the query cache may be enabled (that
            is, set to a non-zero value) due to the selected
            configuration. The query cache is also controlled by the
            setting of the
            <a href="server-administration.html#sysvar_query_cache_type"><code class="literal">query_cache_type</code></a> variable.
            You should check the values of these variables as set in
            your <code class="filename">my.ini</code> file after configuration
            has taken place.
          </p></div><p>
          When you set <a href="server-administration.html#sysvar_query_cache_size"><code class="literal">query_cache_size</code></a>
          to a non-zero value, keep in mind that the query cache needs a
          minimum size of about 40KB to allocate its structures. (The
          exact size depends on system architecture.) If you set the
          value too small, you'll get a warning, as in this example:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET GLOBAL query_cache_size = 40000;</code></strong>
Query OK, 0 rows affected, 1 warning (0.00 sec)

mysql&gt; <strong class="userinput"><code>SHOW WARNINGS\G</code></strong>
*************************** 1. row ***************************
  Level: Warning
   Code: 1282
Message: Query cache failed to set size 39936;
         new query cache size is 0

mysql&gt; <strong class="userinput"><code>SET GLOBAL query_cache_size = 41984;</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'query_cache_size';</code></strong>
+------------------+-------+
| Variable_name    | Value |
+------------------+-------+
| query_cache_size | 41984 |
+------------------+-------+
</pre><p>
          For the query cache to actually be able to hold any query
          results, its size must be set larger:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET GLOBAL query_cache_size = 1000000;</code></strong>
Query OK, 0 rows affected (0.04 sec)

mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'query_cache_size';</code></strong>
+------------------+--------+
| Variable_name    | Value  |
+------------------+--------+
| query_cache_size | 999424 | 
+------------------+--------+
1 row in set (0.00 sec)
</pre><p>
          The <a href="server-administration.html#sysvar_query_cache_size"><code class="literal">query_cache_size</code></a> value is
          aligned to the nearest 1024 byte block. The value reported may
          therefore be different from the value that you assign.
        </p><p>
          If the query cache size is greater than 0, the
          <a href="server-administration.html#sysvar_query_cache_type"><code class="literal">query_cache_type</code></a> variable
          influences how it works. This variable can be set to the
          following values:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              A value of <code class="literal">0</code> or <code class="literal">OFF</code>
              prevents caching or retrieval of cached results.
            </p></li><li><p>
              A value of <code class="literal">1</code> or <code class="literal">ON</code>
              allows caching except of those statements that begin with
              <code class="literal">SELECT SQL_NO_CACHE</code>.
            </p></li><li><p>
              A value of <code class="literal">2</code> or
              <code class="literal">DEMAND</code> causes caching of only those
              statements that begin with <code class="literal">SELECT
              SQL_CACHE</code>.
            </p></li></ul></div><p>
          Setting the <code class="literal">GLOBAL</code>
          <a href="server-administration.html#sysvar_query_cache_type"><code class="literal">query_cache_type</code></a> value
          determines query cache behavior for all clients that connect
          after the change is made. Individual clients can control cache
          behavior for their own connection by setting the
          <code class="literal">SESSION</code>
          <a href="server-administration.html#sysvar_query_cache_type"><code class="literal">query_cache_type</code></a> value. For
          example, a client can disable use of the query cache for its
          own queries like this:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET SESSION query_cache_type = OFF;</code></strong>
</pre><p>
          If you set <a href="server-administration.html#sysvar_query_cache_type"><code class="literal">query_cache_type</code></a>
          at server startup (rather than at runtime with a
          <a href="sql-syntax.html#set-option" title="12.5.5. SET Syntax"><code class="literal">SET</code></a>
          statement), only the numeric values are allowed.
        </p><p>
          To control the maximum size of individual query results that
          can be cached, set the
          <a href="server-administration.html#sysvar_query_cache_limit"><code class="literal">query_cache_limit</code></a> system
          variable. The default value is 1MB.
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
            You can set the maximum size that can be specified for the
            query cache at run time with the
            <a href="sql-syntax.html#set-option" title="12.5.5. SET Syntax"><code class="literal">SET</code></a>
            statement by using the
            <code class="option">--maximum-query_cache_size=<em class="replaceable"><code>32M</code></em></code>
            option on the command line or in the configuration file.
          </p></div><p>
          When a query is to be cached, its result (the data sent to the
          client) is stored in the query cache during result retrieval.
          Therefore the data usually is not handled in one big chunk.
          The query cache allocates blocks for storing this data on
          demand, so when one block is filled, a new block is allocated.
          Because memory allocation operation is costly (timewise), the
          query cache allocates blocks with a minimum size given by the
          <a href="server-administration.html#sysvar_query_cache_min_res_unit"><code class="literal">query_cache_min_res_unit</code></a>
          system variable. When a query is executed, the last result
          block is trimmed to the actual data size so that unused memory
          is freed. Depending on the types of queries your server
          executes, you might find it helpful to tune the value of
          <a href="server-administration.html#sysvar_query_cache_min_res_unit"><code class="literal">query_cache_min_res_unit</code></a>:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              The default value of
              <a href="server-administration.html#sysvar_query_cache_min_res_unit"><code class="literal">query_cache_min_res_unit</code></a>
              is 4KB. This should be adequate for most cases.
            </p></li><li><p>
              If you have a lot of queries with small results, the
              default block size may lead to memory fragmentation, as
              indicated by a large number of free blocks. Fragmentation
              can force the query cache to prune (delete) queries from
              the cache due to lack of memory. In this case, you should
              decrease the value of
              <a href="server-administration.html#sysvar_query_cache_min_res_unit"><code class="literal">query_cache_min_res_unit</code></a>.
              The number of free blocks and queries removed due to
              pruning are given by the values of the
              <a href="server-administration.html#statvar_Qcache_free_blocks"><code class="literal">Qcache_free_blocks</code></a> and
              <a href="server-administration.html#statvar_Qcache_lowmem_prunes"><code class="literal">Qcache_lowmem_prunes</code></a>
              status variables.
            </p></li><li><p>
              If most of your queries have large results (check the
              <a href="server-administration.html#statvar_Qcache_total_blocks"><code class="literal">Qcache_total_blocks</code></a> and
              <a href="server-administration.html#statvar_Qcache_queries_in_cache"><code class="literal">Qcache_queries_in_cache</code></a>
              status variables), you can increase performance by
              increasing
              <a href="server-administration.html#sysvar_query_cache_min_res_unit"><code class="literal">query_cache_min_res_unit</code></a>.
              However, be careful to not make it too large (see the
              previous item).
            </p></li></ul></div><p class="mnmas"><b>MySQL Enterprise</b>
            If the query cache is under-utilized, performance will
            suffer. Advice on avoiding this problem is provided to
            subscribers to the MySQL Enterprise Monitor. For more
            information, see
            <a href="http://www.mysql.com/products/enterprise/advisors.html" target="_top">http://www.mysql.com/products/enterprise/advisors.html</a>.
          </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="query-cache-status-and-maintenance"></a>7.5.5.4. Query Cache Status and Maintenance</h4></div></div></div><p>
          You can check whether the query cache is present in your MySQL
          server using the following statement:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'have_query_cache';</code></strong>
+------------------+-------+
| Variable_name    | Value |
+------------------+-------+
| have_query_cache | YES   |
+------------------+-------+
</pre><p>
          You can defragment the query cache to better utilize its
          memory with the <a href="sql-syntax.html#flush" title="12.5.7.3. FLUSH Syntax"><code class="literal">FLUSH
          QUERY CACHE</code></a> statement. The statement does not remove
          any queries from the cache.
        </p><p>
          The <code class="literal">RESET QUERY CACHE</code> statement removes all
          query results from the query cache. The
          <a href="sql-syntax.html#flush" title="12.5.7.3. FLUSH Syntax"><code class="literal">FLUSH TABLES</code></a>
          statement also does this.
        </p><p>
          To monitor query cache performance, use
          <a href="sql-syntax.html#show-status" title="12.5.6.35. SHOW STATUS Syntax"><code class="literal">SHOW STATUS</code></a> to view the cache
          status variables:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW STATUS LIKE 'Qcache%';</code></strong>
+-------------------------+--------+
| Variable_name           | Value  |
+-------------------------+--------+
| Qcache_free_blocks      | 36     |
| Qcache_free_memory      | 138488 |
| Qcache_hits             | 79570  |
| Qcache_inserts          | 27087  |
| Qcache_lowmem_prunes    | 3114   |
| Qcache_not_cached       | 22989  |
| Qcache_queries_in_cache | 415    |
| Qcache_total_blocks     | 912    |
+-------------------------+--------+
</pre><p>
          Descriptions of each of these variables are given in
          <a href="server-administration.html#server-status-variables" title="5.1.6. Server Status Variables">Section 5.1.6, “Server Status Variables”</a>. Some uses for them
          are described here.
        </p><p>
          The total number of <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
          queries is given by this formula:
        </p><pre class="programlisting">  Com_select
+ Qcache_hits
+ queries with errors found by parser
</pre><p>
          The <code class="literal">Com_select</code> value is given by this
          formula:
        </p><pre class="programlisting">  Qcache_inserts
+ Qcache_not_cached
+ queries with errors found during the column-privileges check
</pre><p>
          The query cache uses variable-length blocks, so
          <a href="server-administration.html#statvar_Qcache_total_blocks"><code class="literal">Qcache_total_blocks</code></a> and
          <a href="server-administration.html#statvar_Qcache_free_blocks"><code class="literal">Qcache_free_blocks</code></a> may
          indicate query cache memory fragmentation. After
          <a href="sql-syntax.html#flush" title="12.5.7.3. FLUSH Syntax"><code class="literal">FLUSH QUERY
          CACHE</code></a>, only a single free block remains.
        </p><p>
          Every cached query requires a minimum of two blocks (one for
          the query text and one or more for the query results). Also,
          every table that is used by a query requires one block.
          However, if two or more queries use the same table, only one
          table block needs to be allocated.
        </p><p>
          The information provided by the
          <a href="server-administration.html#statvar_Qcache_lowmem_prunes"><code class="literal">Qcache_lowmem_prunes</code></a> status
          variable can help you tune the query cache size. It counts the
          number of queries that have been removed from the cache to
          free up memory for caching new queries. The query cache uses a
          least recently used (LRU) strategy to decide which queries to
          remove from the cache. Tuning information is given in
          <a href="optimization.html#query-cache-configuration" title="7.5.5.3. Query Cache Configuration">Section 7.5.5.3, “Query Cache Configuration”</a>.
        </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="thread-information"></a>7.5.6. Examining Thread Information</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="optimization.html#thread-commands">7.5.6.1. Thread Command Values</a></span></dt><dt><span class="section"><a href="optimization.html#general-thread-states">7.5.6.2. General Thread States</a></span></dt><dt><span class="section"><a href="optimization.html#delayed-insert-thread-states">7.5.6.3. Delayed-Insert Thread States</a></span></dt><dt><span class="section"><a href="optimization.html#master-thread-states">7.5.6.4. Replication Master Thread States</a></span></dt><dt><span class="section"><a href="optimization.html#slave-io-thread-states">7.5.6.5. Replication Slave I/O Thread States</a></span></dt><dt><span class="section"><a href="optimization.html#slave-sql-thread-states">7.5.6.6. Replication Slave SQL Thread States</a></span></dt><dt><span class="section"><a href="optimization.html#slave-connection-thread-states">7.5.6.7. Replication Slave Connection Thread States</a></span></dt><dt><span class="section"><a href="optimization.html#event-scheduler-thread-states">7.5.6.8. Event Scheduler Thread States</a></span></dt></dl></div><p>
        When you are attempting to ascertain what your MySQL server is
        doing, it can be helpful to examine the process list, which is
        the set of threads currently executing within the server.
        Process list information is available from these sources:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            The <code class="literal">SHOW [FULL] PROCESSLIST</code> statement
            (<a href="sql-syntax.html#show-processlist" title="12.5.6.30. SHOW PROCESSLIST Syntax">Section 12.5.6.30, “<code class="literal">SHOW PROCESSLIST</code> Syntax”</a>)
          </p></li><li><p>
            The <a href="sql-syntax.html#show-profile" title="12.5.6.31. SHOW PROFILE Syntax"><code class="literal">SHOW PROFILE</code></a> statement
            (<a href="sql-syntax.html#show-profiles" title="12.5.6.32. SHOW PROFILES Syntax">Section 12.5.6.32, “<code class="literal">SHOW PROFILES</code> Syntax”</a>)
          </p></li><li><p>
            The <code class="literal">INFORMATION_SCHEMA</code>
            <a href="information-schema.html#processlist-table" title="19.23. The INFORMATION_SCHEMA PROCESSLIST Table"><code class="literal">PROCESSLIST</code></a> table
            (<a href="information-schema.html#processlist-table" title="19.23. The INFORMATION_SCHEMA PROCESSLIST Table">Section 19.23, “The <code class="literal">INFORMATION_SCHEMA PROCESSLIST</code> Table”</a>)
          </p></li><li><p>
            The <a href="programs.html#mysqladmin" title="4.5.2. mysqladmin — Client for Administering a MySQL Server"><span><strong class="command">mysqladmin processlist</strong></span></a> command
            (<a href="programs.html#mysqladmin" title="4.5.2. mysqladmin — Client for Administering a MySQL Server">Section 4.5.2, “<span><strong class="command">mysqladmin</strong></span> — Client for Administering a MySQL Server”</a>)
          </p></li></ul></div><p>
        You can always view information about your own threads. To view
        information about threads being executed for other accounts, you
        must have the <a href="server-administration.html#priv_process"><code class="literal">PROCESS</code></a> privilege.
      </p><p>
        Each process list entry contains several pieces of information:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            <code class="literal">Id</code> is the connection identifier for the
            client associated with the thread.
          </p></li><li><p>
            <code class="literal">User</code> and <code class="literal">Host</code> indicate
            the account associated with the thread.
          </p></li><li><p>
            <code class="literal">db</code> is the default database for the
            thread, or <code class="literal">NULL</code> if none is selected.
          </p></li><li><p>
            <code class="literal">Command</code> and <code class="literal">State</code>
            indicate what the thread is doing.
          </p><p>
            Most states correspond to very quick operations. If a thread
            stays in a given state for many seconds, there might be a
            problem that needs to be investigated.
          </p></li><li><p>
            <code class="literal">Time</code> indicates how long the thread has
            been in its current state. The thread's notion of the
            current time may be altered in some cases: The thread can
            change the time with
            <a href="sql-syntax.html#set-option" title="12.5.5. SET Syntax"><code class="literal">SET TIMESTAMP =
            <em class="replaceable"><code>value</code></em></code></a>. For a thread
            running on a slave that is processing events from the
            master, the thread time is set to the time found in the
            events and thus reflects current time on the master and not
            the slave.
          </p></li><li><p>
            <code class="literal">Info</code> contains the text of the statement
            being executed by the thread, or <code class="literal">NULL</code> if
            it is not executing one. By default, this value contains
            only the first 100 characters of the statement. To see the
            complete statements, use
            <a href="sql-syntax.html#show-processlist" title="12.5.6.30. SHOW PROCESSLIST Syntax"><code class="literal">SHOW FULL
            PROCESSLIST</code></a>.
          </p></li></ul></div><p>
        The following sections list the possible
        <code class="literal">Command</code> values, and <code class="literal">State</code>
        values grouped by category. The meaning for some of these values
        is self-evident. For others, additional description is provided.
      </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="thread-commands"></a>7.5.6.1. Thread Command Values</h4></div></div></div><a class="indexterm" name="id3192508"></a><p>
          A thread can have any of the following
          <code class="literal">Command</code> values:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              <a class="indexterm" name="id3192534"></a>

              <a class="indexterm" name="id3192546"></a>

              <code class="literal">Binlog Dump</code>
            </p><p>
              This is a thread on a master server for sending binary log
              contents to a slave server.
            </p></li><li><p>
              <a class="indexterm" name="id3192576"></a>

              <a class="indexterm" name="id3192589"></a>

              <code class="literal">Change user</code>
            </p><p>
              The thread is executing a change-user operation.
            </p></li><li><p>
              <a class="indexterm" name="id3192618"></a>

              <a class="indexterm" name="id3192631"></a>

              <code class="literal">Close stmt</code>
            </p><p>
              The thread is closing a prepared statement.
            </p></li><li><p>
              <a class="indexterm" name="id3192660"></a>

              <a class="indexterm" name="id3192672"></a>

              <code class="literal">Connect</code>
            </p><p>
              A replication slave is connected to its master.
            </p></li><li><p>
              <a class="indexterm" name="id3192702"></a>

              <a class="indexterm" name="id3192714"></a>

              <code class="literal">Connect Out</code>
            </p><p>
              A replication slave is connecting to its master.
            </p></li><li><p>
              <a class="indexterm" name="id3192743"></a>

              <a class="indexterm" name="id3192756"></a>

              <code class="literal">Create DB</code>
            </p><p>
              The thread is executing a create-database operation.
            </p></li><li><p>
              <a class="indexterm" name="id3192785"></a>

              <a class="indexterm" name="id3192798"></a>

              <code class="literal">Daemon</code>
            </p><p>
              This thread is internal to the server, not a thread that
              services a client connection.
            </p></li><li><p>
              <a class="indexterm" name="id3192828"></a>

              <a class="indexterm" name="id3192840"></a>

              <code class="literal">Debug</code>
            </p><p>
              The thread is generating debugging information.
            </p></li><li><p>
              <a class="indexterm" name="id3192870"></a>

              <a class="indexterm" name="id3192882"></a>

              <code class="literal">Delayed insert</code>
            </p><p>
              The thread is a delayed-insert handler.
            </p></li><li><p>
              <a class="indexterm" name="id3192912"></a>

              <a class="indexterm" name="id3192924"></a>

              <code class="literal">Drop DB</code>
            </p><p>
              The thread is executing a drop-database operation.
            </p></li><li><p>
              <a class="indexterm" name="id3192954"></a>

              <a class="indexterm" name="id3192966"></a>

              <code class="literal">Error</code>
            </p></li><li><p>
              <a class="indexterm" name="id3192991"></a>

              <a class="indexterm" name="id3193003"></a>

              <code class="literal">Execute</code>
            </p><p>
              The thread is executing a prepared statement.
            </p></li><li><p>
              <a class="indexterm" name="id3193032"></a>

              <a class="indexterm" name="id3193045"></a>

              <code class="literal">Fetch</code>
            </p><p>
              The thread is fetching the results from executing a
              prepared statement.
            </p></li><li><p>
              <a class="indexterm" name="id3193075"></a>

              <a class="indexterm" name="id3193087"></a>

              <code class="literal">Field List</code>
            </p><p>
              The thread is retrieving information for table columns.
            </p></li><li><p>
              <a class="indexterm" name="id3193117"></a>

              <a class="indexterm" name="id3193129"></a>

              <code class="literal">Init DB</code>
            </p><p>
              The thread is selecting a default database.
            </p></li><li><p>
              <a class="indexterm" name="id3193158"></a>

              <a class="indexterm" name="id3193171"></a>

              <code class="literal">Kill</code>
            </p><p>
              The thread is killing another thread.
            </p></li><li><p>
              <a class="indexterm" name="id3193200"></a>

              <a class="indexterm" name="id3193213"></a>

              <code class="literal">Long Data</code>
            </p><p>
              The thread is retrieving long data in the result of
              executing a prepared statement.
            </p></li><li><p>
              <a class="indexterm" name="id3193243"></a>

              <a class="indexterm" name="id3193255"></a>

              <code class="literal">Ping</code>
            </p><p>
              The thread is handling a server-ping request.
            </p></li><li><p>
              <a class="indexterm" name="id3193284"></a>

              <a class="indexterm" name="id3193297"></a>

              <code class="literal">Prepare</code>
            </p><p>
              The thread is preparing a prepared statement.
            </p></li><li><p>
              <a class="indexterm" name="id3193326"></a>

              <a class="indexterm" name="id3193339"></a>

              <code class="literal">Processlist</code>
            </p><p>
              The thread is producing information about server threads.
            </p></li><li><p>
              <a class="indexterm" name="id3193368"></a>

              <a class="indexterm" name="id3193381"></a>

              <code class="literal">Query</code>
            </p><p>
              The thread is executing a statement.
            </p></li><li><p>
              <a class="indexterm" name="id3193410"></a>

              <a class="indexterm" name="id3193422"></a>

              <code class="literal">Quit</code>
            </p><p>
              The thread is terminating.
            </p></li><li><p>
              <a class="indexterm" name="id3193451"></a>

              <a class="indexterm" name="id3193464"></a>

              <code class="literal">Refresh</code>
            </p><p>
              The thread is flushing table, logs, or caches, or
              resetting status variable or replication server
              information.
            </p></li><li><p>
              <a class="indexterm" name="id3193495"></a>

              <a class="indexterm" name="id3193507"></a>

              <code class="literal">Register Slave</code>
            </p><p>
              The thread is registering a slave server.
            </p></li><li><p>
              <a class="indexterm" name="id3193537"></a>

              <a class="indexterm" name="id3193549"></a>

              <code class="literal">Reset stmt</code>
            </p><p>
              The thread is resetting a prepared statement.
            </p></li><li><p>
              <a class="indexterm" name="id3193578"></a>

              <a class="indexterm" name="id3193591"></a>

              <code class="literal">Set option</code>
            </p><p>
              The thread is setting or resetting a client
              statement-execution option.
            </p></li><li><p>
              <a class="indexterm" name="id3193621"></a>

              <a class="indexterm" name="id3193633"></a>

              <code class="literal">Shutdown</code>
            </p><p>
              The thread is shutting down the server.
            </p></li><li><p>
              <a class="indexterm" name="id3193662"></a>

              <a class="indexterm" name="id3193675"></a>

              <code class="literal">Sleep</code>
            </p><p>
              The thread is waiting for the client to send a new
              statement to it.
            </p></li><li><p>
              <a class="indexterm" name="id3193705"></a>

              <a class="indexterm" name="id3193717"></a>

              <code class="literal">Statistics</code>
            </p><p>
              The thread is producing server-status information.
            </p></li><li><p>
              <a class="indexterm" name="id3193747"></a>

              <a class="indexterm" name="id3193759"></a>

              <code class="literal">Table Dump</code>
            </p><p>
              The thread is sending table contents to a slave server.
            </p></li><li><p>
              <a class="indexterm" name="id3193789"></a>

              <a class="indexterm" name="id3193801"></a>

              <code class="literal">Time</code>
            </p><p>
              Unused.
            </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="general-thread-states"></a>7.5.6.2. General Thread States</h4></div></div></div><a class="indexterm" name="id3193836"></a><p>
          The following list describes thread <code class="literal">State</code>
          values that are associated with general query processing and
          not more specialized activities such as replication. Many of
          these are useful only for finding bugs in the server.
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              <a class="indexterm" name="id3193868"></a>

              <a class="indexterm" name="id3193881"></a>

              <code class="literal">After create</code>
            </p><p>
              Occurs when the thread creates a table (including internal
              temporary tables), at the end of the function that creates
              the table. This state is used even if the table could not
              be created due to some error.
            </p></li><li><p>
              <a class="indexterm" name="id3193914"></a>

              <a class="indexterm" name="id3193926"></a>

              <code class="literal">Analyzing</code>
            </p><p>
              The thread is calculating a <code class="literal">MyISAM</code>
              table key distributions (for example, for
              <a href="sql-syntax.html#analyze-table" title="12.5.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>).
            </p></li><li><p>
              <a class="indexterm" name="id3193970"></a>

              <a class="indexterm" name="id3193982"></a>

              <code class="literal">checking permissions</code>
            </p><p>
              The thread is checking whether the server has the required
              privileges to execute the statement.
            </p></li><li><p>
              <a class="indexterm" name="id3194013"></a>

              <a class="indexterm" name="id3194026"></a>

              <code class="literal">Checking table</code>
            </p><p>
              The thread is performing a table check operation.
            </p></li><li><p>
              <a class="indexterm" name="id3194056"></a>

              <a class="indexterm" name="id3194068"></a>

              <code class="literal">cleaning up</code>
            </p><p>
              The thread has processed one command and is preparing to
              free memory and reset certain state variables.
            </p></li><li><p>
              <a class="indexterm" name="id3194098"></a>

              <a class="indexterm" name="id3194111"></a>

              <code class="literal">closing tables</code>
            </p><p>
              Means that the thread is flushing the changed table data
              to disk and closing the used tables. This should be a fast
              operation. If not, you should verify that you do not have
              a full disk and that the disk is not in very heavy use.
            </p></li><li><p>
              <a class="indexterm" name="id3194144"></a>

              <a class="indexterm" name="id3194157"></a>

              <code class="literal">converting HEAP to MyISAM</code>
            </p><p>
              The thread is converting an internal temporary table from
              a <code class="literal">MEMORY</code> table to an on-disk
              <code class="literal">MyISAM</code> table.
            </p></li><li><p>
              <a class="indexterm" name="id3194200"></a>

              <a class="indexterm" name="id3194212"></a>

              <code class="literal">copy to tmp table</code>
            </p><p>
              The thread is processing an <a href="sql-syntax.html#alter-table" title="12.1.6. ALTER TABLE Syntax"><code class="literal">ALTER
              TABLE</code></a> statement. This state occurs after the
              table with the new structure has been created but before
              rows are copied into it.
            </p></li><li><p>
              <a class="indexterm" name="id3194251"></a>

              <a class="indexterm" name="id3194264"></a>

              <code class="literal">Copying to group table</code>
            </p><p>
              If a statement has different <code class="literal">ORDER BY</code>
              and <code class="literal">GROUP BY</code> criteria, the rows are
              sorted by group and copied to a temporary table.
            </p></li><li><p>
              <a class="indexterm" name="id3194307"></a>

              <a class="indexterm" name="id3194320"></a>

              <code class="literal">Copying to tmp table</code>
            </p><p>
              The server is copying to a temporary table in memory.
            </p></li><li><p>
              <a class="indexterm" name="id3194350"></a>

              <a class="indexterm" name="id3194363"></a>

              <code class="literal">Copying to tmp table on disk</code>
            </p><p>
              The server is copying to a temporary table on disk. The
              temporary result set was larger than
              <a href="server-administration.html#sysvar_tmp_table_size"><code class="literal">tmp_table_size</code></a> and the
              thread is changing the temporary table from in-memory to
              disk-based format to save memory.
            </p></li><li><p>
              <a class="indexterm" name="id3194403"></a>

              <a class="indexterm" name="id3194416"></a>

              <code class="literal">Creating index</code>
            </p><p>
              The thread is processing <code class="literal">ALTER TABLE ... ENABLE
              KEYS</code> for a <code class="literal">MyISAM</code> table.
            </p></li><li><p>
              <a class="indexterm" name="id3194458"></a>

              <a class="indexterm" name="id3194470"></a>

              <code class="literal">Creating sort index</code>
            </p><p>
              The thread is processing a
              <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> that is resolved
              using an internal temporary table.
            </p></li><li><p>
              <a class="indexterm" name="id3194508"></a>

              <a class="indexterm" name="id3194521"></a>

              <code class="literal">creating table</code>
            </p><p>
              The thread is creating a table. This includes creation of
              temporary tables.
            </p></li><li><p>
              <a class="indexterm" name="id3194551"></a>

              <a class="indexterm" name="id3194564"></a>

              <code class="literal">Creating tmp table</code>
            </p><p>
              The thread is creating a temporary table in memory or on
              disk. If the table is created in memory but later is
              converted to an on-disk table, the state during that
              operation will be <code class="literal">Copying to tmp table on
              disk</code>.
            </p></li><li><p>
              <a class="indexterm" name="id3194602"></a>

              <a class="indexterm" name="id3194615"></a>

              <code class="literal">deleting from main table</code>
            </p><p>
              The server is executing the first part of a multiple-table
              delete. It is deleting only from the first table, and
              saving columns and offsets to be used for deleting from
              the other (reference) tables.
            </p></li><li><p>
              <a class="indexterm" name="id3194648"></a>

              <a class="indexterm" name="id3194661"></a>

              <code class="literal">deleting from reference tables</code>
            </p><p>
              The server is executing the second part of a
              multiple-table delete and deleting the matched rows from
              the other tables.
            </p></li><li><p>
              <a class="indexterm" name="id3194693"></a>

              <a class="indexterm" name="id3194706"></a>

              <code class="literal">discard_or_import_tablespace</code>
            </p><p>
              The thread is processing an <code class="literal">ALTER TABLE ...
              DISCARD TABLESPACE</code> or <code class="literal">ALTER TABLE ...
              IMPORT TABLESPACE</code> statement.
            </p></li><li><p>
              <a class="indexterm" name="id3194749"></a>

              <a class="indexterm" name="id3194761"></a>

              <code class="literal">end</code>
            </p><p>
              This occurs at the end but before the cleanup of
              <a href="sql-syntax.html#alter-table" title="12.1.6. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>,
              <a href="sql-syntax.html#create-view" title="12.1.16. CREATE VIEW Syntax"><code class="literal">CREATE VIEW</code></a>,
              <a href="sql-syntax.html#delete" title="12.2.2. DELETE Syntax"><code class="literal">DELETE</code></a>,
              <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
              <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>, or
              <a href="sql-syntax.html#update" title="12.2.12. UPDATE Syntax"><code class="literal">UPDATE</code></a> statements.
            </p></li><li><p>
              <a class="indexterm" name="id3194833"></a>

              <a class="indexterm" name="id3194846"></a>

              <code class="literal">executing</code>
            </p><p>
              The thread has begun executing a statement.
            </p></li><li><p>
              <a class="indexterm" name="id3194875"></a>

              <a class="indexterm" name="id3194888"></a>

              <code class="literal">Execution of init_command</code>
            </p><p>
              The thread is executing statements in the value of the
              <code class="literal">init_command</code> system variable.
            </p></li><li><p>
              <a class="indexterm" name="id3194924"></a>

              <a class="indexterm" name="id3194937"></a>

              <code class="literal">freeing items</code>
            </p><p>
              The thread has executed a command. This state is usually
              followed by <code class="literal">cleaning up</code>.
            </p></li><li><p>
              <a class="indexterm" name="id3194973"></a>

              <a class="indexterm" name="id3194986"></a>

              <code class="literal">Flushing tables</code>
            </p><p>
              The thread is executing
              <a href="sql-syntax.html#flush" title="12.5.7.3. FLUSH Syntax"><code class="literal">FLUSH
              TABLES</code></a> and is waiting for all threads to close
              their tables.
            </p></li><li><p>
              <a class="indexterm" name="id3195024"></a>

              <a class="indexterm" name="id3195036"></a>

              <code class="literal">FULLTEXT initialization</code>
            </p><p>
              The server is preparing to perform a natural-language
              full-text search.
            </p></li><li><p>
              <a class="indexterm" name="id3195067"></a>

              <a class="indexterm" name="id3195079"></a>

              <code class="literal">init</code>
            </p><p>
              This occurs before the initialization of
              <a href="sql-syntax.html#alter-table" title="12.1.6. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>,
              <a href="sql-syntax.html#delete" title="12.2.2. DELETE Syntax"><code class="literal">DELETE</code></a>,
              <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
              <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>, or
              <a href="sql-syntax.html#update" title="12.2.12. UPDATE Syntax"><code class="literal">UPDATE</code></a> statements.
            </p></li><li><p>
              <a class="indexterm" name="id3195145"></a>

              <a class="indexterm" name="id3195157"></a>

              <code class="literal">Killed</code>
            </p><p>
              Someone has sent a <a href="sql-syntax.html#kill" title="12.5.7.4. KILL Syntax"><code class="literal">KILL</code></a>
              statement to the thread and it should abort next time it
              checks the kill flag. The flag is checked in each major
              loop in MySQL, but in some cases it might still take a
              short time for the thread to die. If the thread is locked
              by some other thread, the kill takes effect as soon as the
              other thread releases its lock.
            </p></li><li><p>
              <a class="indexterm" name="id3195200"></a>

              <a class="indexterm" name="id3195212"></a>

              <code class="literal">Locked</code>
            </p><p>
              The query is locked by another query.
            </p></li><li><p>
              <a class="indexterm" name="id3195241"></a>

              <a class="indexterm" name="id3195254"></a>

              <code class="literal">logging slow query</code>
            </p><p>
              The thread is writing a statement to the slow-query log.
            </p></li><li><p>
              <a class="indexterm" name="id3195284"></a>

              <a class="indexterm" name="id3195296"></a>

              <code class="literal">NULL</code>
            </p><p>
              This state is used for the <a href="sql-syntax.html#show-processlist" title="12.5.6.30. SHOW PROCESSLIST Syntax"><code class="literal">SHOW
              PROCESSLIST</code></a> state.
            </p></li><li><p>
              <a class="indexterm" name="id3195333"></a>

              <a class="indexterm" name="id3195345"></a>

              <code class="literal">login</code>
            </p><p>
              The initial state for a connection thread until the client
              has been authenticated successfully.
            </p></li><li><p>
              <a class="indexterm" name="id3195375"></a>

              <a class="indexterm" name="id3195388"></a>

              <a class="indexterm" name="id3195401"></a>

              <a class="indexterm" name="id3195413"></a>

              <code class="literal">Opening tables</code>, <code class="literal">Opening
              table</code>
            </p><p>
              The thread is trying to open a table. This is should be
              very fast procedure, unless something prevents opening.
              For example, an <a href="sql-syntax.html#alter-table" title="12.1.6. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
              or a <a href="sql-syntax.html#lock-tables" title="12.4.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">LOCK
              TABLE</code></a> statement can prevent opening a table
              until the statement is finished.
            </p></li><li><p>
              <a class="indexterm" name="id3195467"></a>

              <a class="indexterm" name="id3195479"></a>

              <code class="literal">preparing</code>
            </p><p>
              This state occurs during query optimization.
            </p></li><li><p>
              <a class="indexterm" name="id3195508"></a>

              <a class="indexterm" name="id3195521"></a>

              <code class="literal">Purging old relay logs</code>
            </p><p>
              The thread is removing unneeded relay log files.
            </p></li><li><p>
              <a class="indexterm" name="id3195551"></a>

              <a class="indexterm" name="id3195564"></a>

              <code class="literal">query end</code>
            </p><p>
              This state occurs after processing a query but before the
              <code class="literal">freeing items</code> state.
            </p></li><li><p>
              <a class="indexterm" name="id3195599"></a>

              <a class="indexterm" name="id3195612"></a>

              <code class="literal">Reading from net</code>
            </p><p>
              The server is reading a packet from the network.
            </p></li><li><p>
              <a class="indexterm" name="id3195642"></a>

              <a class="indexterm" name="id3195654"></a>

              <code class="literal">Removing duplicates</code>
            </p><p>
              The query was using
              <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT
              DISTINCT</code></a> in such a way that MySQL could not
              optimize away the distinct operation at an early stage.
              Because of this, MySQL requires an extra stage to remove
              all duplicated rows before sending the result to the
              client.
            </p></li><li><p>
              <a class="indexterm" name="id3195695"></a>

              <a class="indexterm" name="id3195708"></a>

              <code class="literal">removing tmp table</code>
            </p><p>
              The thread is removing an internal temporary table after
              processing a <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
              statement. This state is not used if no temporary table
              was created.
            </p></li><li><p>
              <a class="indexterm" name="id3195747"></a>

              <a class="indexterm" name="id3195759"></a>

              <code class="literal">rename</code>
            </p><p>
              The thread is renaming a table.
            </p></li><li><p>
              <a class="indexterm" name="id3195788"></a>

              <a class="indexterm" name="id3195801"></a>

              <code class="literal">rename result table</code>
            </p><p>
              The thread is processing an <a href="sql-syntax.html#alter-table" title="12.1.6. ALTER TABLE Syntax"><code class="literal">ALTER
              TABLE</code></a> statement, has created the new table, and
              is renaming it to replace the original table.
            </p></li><li><p>
              <a class="indexterm" name="id3195839"></a>

              <a class="indexterm" name="id3195852"></a>

              <code class="literal">Reopen tables</code>
            </p><p>
              The thread got a lock for the table, but noticed after
              getting the lock that the underlying table structure
              changed. It has freed the lock, closed the table, and is
              trying to reopen it.
            </p></li><li><p>
              <a class="indexterm" name="id3195884"></a>

              <a class="indexterm" name="id3195897"></a>

              <code class="literal">Repair by sorting</code>
            </p><p>
              The repair code is using a sort to create indexes.
            </p></li><li><p>
              <a class="indexterm" name="id3195926"></a>

              <a class="indexterm" name="id3195939"></a>

              <code class="literal">Repair done</code>
            </p><p>
              The thread has completed a multi-threaded repair for a
              <code class="literal">MyISAM</code> table.
            </p></li><li><p>
              <a class="indexterm" name="id3195975"></a>

              <a class="indexterm" name="id3195987"></a>

              <code class="literal">Repair with keycache</code>
            </p><p>
              The repair code is using creating keys one by one through
              the key cache. This is much slower than <code class="literal">Repair by
              sorting</code>.
            </p></li><li><p>
              <a class="indexterm" name="id3196025"></a>

              <a class="indexterm" name="id3196037"></a>

              <code class="literal">Rolling back</code>
            </p><p>
              The thread is rolling back a transaction.
            </p></li><li><p>
              <a class="indexterm" name="id3196067"></a>

              <a class="indexterm" name="id3196079"></a>

              <code class="literal">Saving state</code>
            </p><p>
              For <code class="literal">MyISAM</code> table operations such as
              repair or analysis, the thread is saving the new table
              state to the <code class="filename">.MYI</code> file header. State
              includes information such as number of rows, the
              <code class="literal">AUTO_INCREMENT</code> counter, and key
              distributions.
            </p></li><li><p>
              <a class="indexterm" name="id3196130"></a>

              <a class="indexterm" name="id3196143"></a>

              <code class="literal">Searching rows for update</code>
            </p><p>
              The thread is doing a first phase to find all matching
              rows before updating them. This has to be done if the
              <a href="sql-syntax.html#update" title="12.2.12. UPDATE Syntax"><code class="literal">UPDATE</code></a> is changing the
              index that is used to find the involved rows.
            </p></li><li><p>
              <code class="literal">Sending data</code>
            </p><p>
              The thread is processing rows for a
              <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement and also
              is sending data to the client.
            </p></li><li><p>
              <a class="indexterm" name="id3196207"></a>

              <a class="indexterm" name="id3196220"></a>

              <code class="literal">setup</code>
            </p><p>
              The thread is beginning an <a href="sql-syntax.html#alter-table" title="12.1.6. ALTER TABLE Syntax"><code class="literal">ALTER
              TABLE</code></a> operation.
            </p></li><li><p>
              <a class="indexterm" name="id3196256"></a>

              <a class="indexterm" name="id3196269"></a>

              <code class="literal">Sorting for group</code>
            </p><p>
              The thread is doing a sort to satisfy a <code class="literal">GROUP
              BY</code>.
            </p></li><li><p>
              <a class="indexterm" name="id3196304"></a>

              <a class="indexterm" name="id3196317"></a>

              <code class="literal">Sorting for order</code>
            </p><p>
              The thread is doing a sort to satisfy a <code class="literal">ORDER
              BY</code>.
            </p></li><li><p>
              <a class="indexterm" name="id3196353"></a>

              <a class="indexterm" name="id3196365"></a>

              <code class="literal">Sorting index</code>
            </p><p>
              The thread is sorting index pages for more efficient
              access during a <code class="literal">MyISAM</code> table
              optimization operation.
            </p></li><li><p>
              <a class="indexterm" name="id3196402"></a>

              <a class="indexterm" name="id3196415"></a>

              <code class="literal">Sorting result</code>
            </p><p>
              For a <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement,
              this is similar to <code class="literal">Creating sort index</code>,
              but for non-temporary tables.
            </p></li><li><p>
              <a class="indexterm" name="id3196458"></a>

              <a class="indexterm" name="id3196471"></a>

              <code class="literal">statistics</code>
            </p><p>
              The server is calculating statistics to develop a query
              execution plan.
            </p></li><li><p>
              <a class="indexterm" name="id3196500"></a>

              <a class="indexterm" name="id3196510"></a>

              <a class="indexterm" name="id3196522"></a>

              <a class="indexterm" name="id3196534"></a>

              <code class="literal">System lock</code>
            </p><p>
              The thread is going to request or is waiting for an
              internal or external system lock for the table. If this
              state is being caused by requests for external locks and
              you are not using multiple <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a>
              servers that are accessing the same tables, you can
              disable external system locks with the
              <a href="server-administration.html#option_mysqld_skip-external-locking"><code class="option">--skip-external-locking</code></a>
              option. However, external locking is disabled by default,
              so it is likely that this option will have no effect. For
              <a href="sql-syntax.html#show-profile" title="12.5.6.31. SHOW PROFILE Syntax"><code class="literal">SHOW PROFILE</code></a>, this state
              means the thread is requesting the lock (not waiting for
              it).
            </p></li><li><p>
              <a class="indexterm" name="id3196595"></a>

              <a class="indexterm" name="id3196608"></a>

              <code class="literal">Table lock</code>
            </p><p>
              The next thread state after <code class="literal">System
              lock</code>. The thread has acquired an external lock
              and is going to request an internal table lock.
            </p></li><li><p>
              <a class="indexterm" name="id3196644"></a>

              <a class="indexterm" name="id3196657"></a>

              <code class="literal">Updating</code>
            </p><p>
              The thread is searching for rows to update and is updating
              them.
            </p></li><li><p>
              <a class="indexterm" name="id3196687"></a>

              <a class="indexterm" name="id3196699"></a>

              <code class="literal">updating main table</code>
            </p><p>
              The server is executing the first part of a multiple-table
              update. It is updating only the first table, and saving
              columns and offsets to be used for updating the other
              (reference) tables.
            </p></li><li><p>
              <a class="indexterm" name="id3196732"></a>

              <a class="indexterm" name="id3196745"></a>

              <code class="literal">updating reference tables</code>
            </p><p>
              The server is executing the second part of a
              multiple-table update and updating the matched rows from
              the other tables.
            </p></li><li><p>
              <a class="indexterm" name="id3196776"></a>

              <a class="indexterm" name="id3196789"></a>

              <code class="literal">User lock</code>
            </p><p>
              The thread is going to request or is waiting for an
              advisory lock requested with a
              <a href="functions.html#function_get-lock"><code class="literal">GET_LOCK()</code></a> call. For
              <a href="sql-syntax.html#show-profile" title="12.5.6.31. SHOW PROFILE Syntax"><code class="literal">SHOW PROFILE</code></a>, this state
              means the thread is requesting the lock (not waiting for
              it).
            </p></li><li><p>
              <a class="indexterm" name="id3196835"></a>

              <a class="indexterm" name="id3196848"></a>

              <a class="indexterm" name="id3196861"></a>

              <a class="indexterm" name="id3196873"></a>

              <code class="literal">Waiting for tables</code>, <code class="literal">Waiting
              for table</code>
            </p><p>
              The thread got a notification that the underlying
              structure for a table has changed and it needs to reopen
              the table to get the new structure. However, to reopen the
              table, it must wait until all other threads have closed
              the table in question.
            </p><p>
              This notification takes place if another thread has used
              <a href="sql-syntax.html#flush" title="12.5.7.3. FLUSH Syntax"><code class="literal">FLUSH
              TABLES</code></a> or one of the following statements on the
              table in question: <code class="literal">FLUSH TABLES
              <em class="replaceable"><code>tbl_name</code></em></code>,
              <a href="sql-syntax.html#alter-table" title="12.1.6. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>,
              <a href="sql-syntax.html#rename-table" title="12.1.26. RENAME TABLE Syntax"><code class="literal">RENAME TABLE</code></a>,
              <a href="sql-syntax.html#repair-table" title="12.5.2.5. REPAIR TABLE Syntax"><code class="literal">REPAIR TABLE</code></a>,
              <a href="sql-syntax.html#analyze-table" title="12.5.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>, or
              <a href="sql-syntax.html#optimize-table" title="12.5.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>.
            </p></li><li><p>
              <a class="indexterm" name="id3196972"></a>

              <a class="indexterm" name="id3196985"></a>

              <code class="literal">Waiting on cond</code>
            </p><p>
              A generic state in which the thread is waiting for a
              condition to become true. No specific state information is
              available.
            </p></li><li><p>
              <a class="indexterm" name="id3197016"></a>

              <a class="indexterm" name="id3197029"></a>

              <code class="literal">Writing to net</code>
            </p><p>
              The server is writing a packet to the network.
            </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="delayed-insert-thread-states"></a>7.5.6.3. Delayed-Insert Thread States</h4></div></div></div><a class="indexterm" name="id3197065"></a><a class="indexterm" name="id3197078"></a><p>
          These thread states are associated with processing for
          <code class="literal">DELAYED</code> inserts (see
          <a href="sql-syntax.html#insert-delayed" title="12.2.5.2. INSERT DELAYED Syntax">Section 12.2.5.2, “<code class="literal">INSERT DELAYED</code> Syntax”</a>). Some states are associated
          with connection threads that process
          <a href="sql-syntax.html#insert-delayed" title="12.2.5.2. INSERT DELAYED Syntax"><code class="literal">INSERT DELAYED</code></a> statements from
          clients. Other states are associated with delayed-insert
          handler threads that insert the rows. There is a
          delayed-insert handler thread for each table for which
          <a href="sql-syntax.html#insert-delayed" title="12.2.5.2. INSERT DELAYED Syntax"><code class="literal">INSERT DELAYED</code></a> statements are
          issued.
        </p><p>
          States associated with a connection thread that processes an
          <a href="sql-syntax.html#insert-delayed" title="12.2.5.2. INSERT DELAYED Syntax"><code class="literal">INSERT DELAYED</code></a> statement from
          the client:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              <a class="indexterm" name="id3197145"></a>

              <a class="indexterm" name="id3197158"></a>

              <code class="literal">allocating local table</code>
            </p><p>
              The thread is preparing to feed rows to the delayed-insert
              handler thread.
            </p></li><li><p>
              <a class="indexterm" name="id3197188"></a>

              <a class="indexterm" name="id3197201"></a>

              <code class="literal">Creating delayed handler</code>
            </p><p>
              The thread is creating a handler for
              <code class="literal">DELAYED</code> inserts.
            </p></li><li><p>
              <a class="indexterm" name="id3197237"></a>

              <a class="indexterm" name="id3197250"></a>

              <code class="literal">got handler lock</code>
            </p><p>
              This occurs before the <code class="literal">allocating local
              table</code> state and after the <code class="literal">waiting for
              handler lock</code> state, when the connection thread
              gets access to the delayed-insert handler thread.
            </p></li><li><p>
              <a class="indexterm" name="id3197294"></a>

              <a class="indexterm" name="id3197306"></a>

              <code class="literal">got old table</code>
            </p><p>
              This occurs after the <code class="literal">waiting for handler
              open</code> state. The delayed-insert handler thread
              has signaled that it has ended its initialization phase,
              which includes opening the table for delayed inserts.
            </p></li><li><p>
              <a class="indexterm" name="id3197345"></a>

              <a class="indexterm" name="id3197358"></a>

              <code class="literal">storing row into queue</code>
            </p><p>
              The thread is adding a new row to the list of rows that
              the delayed-insert handler thread must insert.
            </p></li><li><p>
              <a class="indexterm" name="id3197389"></a>

              <a class="indexterm" name="id3197401"></a>

              <code class="literal">update</code>
            </p></li><li><p>
              <a class="indexterm" name="id3197426"></a>

              <a class="indexterm" name="id3197439"></a>

              <code class="literal">waiting for delay_list</code>
            </p><p>
              This occurs during the initialization phase when the
              thread is trying to find the delayed-insert handler thread
              for the table, and before attempting to gain access to the
              list of delayed-insert threads.
            </p></li><li><p>
              <a class="indexterm" name="id3197472"></a>

              <a class="indexterm" name="id3197485"></a>

              <code class="literal">waiting for handler insert</code>
            </p><p>
              An <a href="sql-syntax.html#insert-delayed" title="12.2.5.2. INSERT DELAYED Syntax"><code class="literal">INSERT DELAYED</code></a> handler
              has processed all pending inserts and is waiting for new
              ones.
            </p></li><li><p>
              <a class="indexterm" name="id3197522"></a>

              <a class="indexterm" name="id3197535"></a>

              <code class="literal">waiting for handler lock</code>
            </p><p>
              This occurs before the <code class="literal">allocating local
              table</code> state when the connection thread waits for
              access to the delayed-insert handler thread.
            </p></li><li><p>
              <a class="indexterm" name="id3197573"></a>

              <a class="indexterm" name="id3197586"></a>

              <code class="literal">waiting for handler open</code>
            </p><p>
              This occurs after the <code class="literal">Creating delayed
              handler</code> state and before the <code class="literal">got old
              table</code> state. The delayed-insert handler thread
              has just been started, and the connection thread is
              waiting for it to initialize.
            </p></li></ul></div><p>
          States associated with a delayed-insert handler thread that
          inserts the rows:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              <a class="indexterm" name="id3197639"></a>

              <a class="indexterm" name="id3197651"></a>

              <code class="literal">insert</code>
            </p><p>
              The state that occurs just before inserting rows into the
              table.
            </p></li><li><p>
              <a class="indexterm" name="id3197681"></a>

              <a class="indexterm" name="id3197694"></a>

              <code class="literal">reschedule</code>
            </p><p>
              After inserting a number of rows, the delayed-insert
              thread sleeps to let other threads do work.
            </p></li><li><p>
              <a class="indexterm" name="id3197724"></a>

              <a class="indexterm" name="id3197736"></a>

              <code class="literal">upgrading lock</code>
            </p><p>
              A delayed-insert handler is trying to get a lock for the
              table to insert rows.
            </p></li><li><p>
              <a class="indexterm" name="id3197767"></a>

              <a class="indexterm" name="id3197779"></a>

              <code class="literal">Waiting for INSERT</code>
            </p><p>
              A delayed-insert handler is waiting for a connection
              thread to add rows to the queue (see <code class="literal">storing row
              into queue</code>).
            </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="master-thread-states"></a>7.5.6.4. Replication Master Thread States</h4></div></div></div><a class="indexterm" name="id3197823"></a><a class="indexterm" name="id3197835"></a><p>
          The following list shows the most common states you may see in
          the <code class="literal">State</code> column for the master's
          <code class="literal">Binlog Dump</code> thread. If you see no
          <code class="literal">Binlog Dump</code> threads on a master server,
          this means that replication is not running — that is,
          that no slaves are currently connected.
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              <a class="indexterm" name="id3197883"></a>

              <a class="indexterm" name="id3197896"></a>

              <code class="literal">Sending binlog event to slave</code>
            </p><p>
              Binary logs consist of <span class="emphasis"><em>events</em></span>, where
              an event is usually an update plus some other information.
              The thread has read an event from the binary log and is
              now sending it to the slave.
            </p></li><li><p>
              <a class="indexterm" name="id3197932"></a>

              <a class="indexterm" name="id3197946"></a>

              <code class="literal">Finished reading one binlog; switching to next
              binlog</code>
            </p><p>
              The thread has finished reading a binary log file and is
              opening the next one to send to the slave.
            </p></li><li><p>
              <a class="indexterm" name="id3197978"></a>

              <a class="indexterm" name="id3197991"></a>

              <code class="literal">Has sent all binlog to slave; waiting for binlog
              to be updated</code>
            </p><p>
              The thread has read all outstanding updates from the
              binary logs and sent them to the slave. The thread is now
              idle, waiting for new events to appear in the binary log
              resulting from new updates occurring on the master.
            </p></li><li><p>
              <a class="indexterm" name="id3198026"></a>

              <a class="indexterm" name="id3198039"></a>

              <code class="literal">Waiting to finalize termination</code>
            </p><p>
              A very brief state that occurs as the thread is stopping.
            </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="slave-io-thread-states"></a>7.5.6.5. Replication Slave I/O Thread States</h4></div></div></div><a class="indexterm" name="id3198076"></a><a class="indexterm" name="id3198089"></a><p>
          The following list shows the most common states you see in the
          <code class="literal">State</code> column for a slave server I/O thread.
          This state also appears in the
          <code class="literal">Slave_IO_State</code> column displayed by
          <a href="sql-syntax.html#show-slave-status" title="12.5.6.34. SHOW SLAVE STATUS Syntax"><code class="literal">SHOW SLAVE STATUS</code></a>, so you can
          get a good view of what is happening by using that statement.
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              <a class="indexterm" name="id3198135"></a>

              <a class="indexterm" name="id3198148"></a>

              <code class="literal">Waiting for master update</code>
            </p><p>
              The initial state before <code class="literal">Connecting to
              master</code>.
            </p></li><li><p>
              <a class="indexterm" name="id3198184"></a>

              <a class="indexterm" name="id3198196"></a>

              <code class="literal">Connecting to master</code>
            </p><p>
              The thread is attempting to connect to the master.
            </p></li><li><p>
              <a class="indexterm" name="id3198226"></a>

              <a class="indexterm" name="id3198239"></a>

              <code class="literal">Checking master version</code>
            </p><p>
              A state that occurs very briefly, after the connection to
              the master is established.
            </p></li><li><p>
              <a class="indexterm" name="id3198270"></a>

              <a class="indexterm" name="id3198283"></a>

              <code class="literal">Registering slave on master</code>
            </p><p>
              A state that occurs very briefly after the connection to
              the master is established.
            </p></li><li><p>
              <a class="indexterm" name="id3198313"></a>

              <a class="indexterm" name="id3198326"></a>

              <code class="literal">Requesting binlog dump</code>
            </p><p>
              A state that occurs very briefly, after the connection to
              the master is established. The thread sends to the master
              a request for the contents of its binary logs, starting
              from the requested binary log file name and position.
            </p></li><li><p>
              <a class="indexterm" name="id3198360"></a>

              <a class="indexterm" name="id3198373"></a>

              <code class="literal">Waiting to reconnect after a failed binlog dump
              request</code>
            </p><p>
              If the binary log dump request failed (due to
              disconnection), the thread goes into this state while it
              sleeps, then tries to reconnect periodically. The interval
              between retries can be specified using the
              <a href="sql-syntax.html#change-master-to" title="12.6.2.1. CHANGE MASTER TO Syntax"><code class="literal">CHANGE MASTER TO</code></a> statement.
            </p></li><li><p>
              <a class="indexterm" name="id3198415"></a>

              <a class="indexterm" name="id3198428"></a>

              <code class="literal">Reconnecting after a failed binlog dump
              request</code>
            </p><p>
              The thread is trying to reconnect to the master.
            </p></li><li><p>
              <a class="indexterm" name="id3198459"></a>

              <a class="indexterm" name="id3198472"></a>

              <code class="literal">Waiting for master to send event</code>
            </p><p>
              The thread has connected to the master and is waiting for
              binary log events to arrive. This can last for a long time
              if the master is idle. If the wait lasts for
              <a href="http://dev.mysql.com/doc/refman/5.1/en/replication-options-slave.html#sysvar_slave_net_timeout" target="_top"><code class="literal">slave_net_timeout</code></a>
              seconds, a timeout occurs. At that point, the thread
              considers the connection to be broken and makes an attempt
              to reconnect.
            </p></li><li><p>
              <a class="indexterm" name="id3198516"></a>

              <a class="indexterm" name="id3198529"></a>

              <code class="literal">Queueing master event to the relay log</code>
            </p><p>
              The thread has read an event and is copying it to the
              relay log so that the SQL thread can process it.
            </p></li><li><p>
              <a class="indexterm" name="id3198561"></a>

              <a class="indexterm" name="id3198574"></a>

              <code class="literal">Waiting to reconnect after a failed master event
              read</code>
            </p><p>
              An error occurred while reading (due to disconnection).
              The thread is sleeping for the number of seconds set by
              the <a href="sql-syntax.html#change-master-to" title="12.6.2.1. CHANGE MASTER TO Syntax"><code class="literal">CHANGE MASTER TO</code></a>
              statement (default 60) before attempting to reconnect.
            </p></li><li><p>
              <a class="indexterm" name="id3198615"></a>

              <a class="indexterm" name="id3198628"></a>

              <code class="literal">Reconnecting after a failed master event
              read</code>
            </p><p>
              The thread is trying to reconnect to the master. When
              connection is established again, the state becomes
              <code class="literal">Waiting for master to send event</code>.
            </p></li><li><p>
              <a class="indexterm" name="id3198667"></a>

              <a class="indexterm" name="id3198680"></a>

              <code class="literal">Waiting for the slave SQL thread to free enough
              relay log space</code>
            </p><p>
              You are using a non-zero
              <a href="server-administration.html#sysvar_relay_log_space_limit"><code class="literal">relay_log_space_limit</code></a>
              value, and the relay logs have grown large enough that
              their combined size exceeds this value. The I/O thread is
              waiting until the SQL thread frees enough space by
              processing relay log contents so that it can delete some
              relay log files.
            </p></li><li><p>
              <a class="indexterm" name="id3198724"></a>

              <a class="indexterm" name="id3198737"></a>

              <code class="literal">Waiting for slave mutex on exit</code>
            </p><p>
              A state that occurs briefly as the thread is stopping.
            </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="slave-sql-thread-states"></a>7.5.6.6. Replication Slave SQL Thread States</h4></div></div></div><a class="indexterm" name="id3198774"></a><a class="indexterm" name="id3198786"></a><p>
          The following list shows the most common states you may see in
          the <code class="literal">State</code> column for a slave server SQL
          thread:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              <a class="indexterm" name="id3198817"></a>

              <a class="indexterm" name="id3198830"></a>

              <code class="literal">Waiting for the next event in relay log</code>
            </p><p>
              The initial state before <code class="literal">Reading event from the
              relay log</code>.
            </p></li><li><p>
              <a class="indexterm" name="id3198866"></a>

              <a class="indexterm" name="id3198879"></a>

              <code class="literal">Reading event from the relay log</code>
            </p><p>
              The thread has read an event from the relay log so that
              the event can be processed.
            </p></li><li><p>
              <a class="indexterm" name="id3198910"></a>

              <a class="indexterm" name="id3198924"></a>

              <code class="literal">Has read all relay log; waiting for the slave I/O
              thread to update it</code>
            </p><p>
              The thread has processed all events in the relay log
              files, and is now waiting for the I/O thread to write new
              events to the relay log.
            </p></li><li><p>
              <a class="indexterm" name="id3198957"></a>

              <a class="indexterm" name="id3198970"></a>

              <code class="literal">Making temp file</code>
            </p><p>
              The thread is executing a
              <a href="sql-syntax.html#load-data" title="12.2.6. LOAD DATA INFILE
      Syntax"><code class="literal">LOAD DATA
              INFILE</code></a> statement and is creating a temporary
              file containing the data from which the slave will read
              rows.
            </p></li><li><p>
              <a class="indexterm" name="id3199009"></a>

              <a class="indexterm" name="id3199022"></a>

              <code class="literal">Waiting for slave mutex on exit</code>
            </p><p>
              A very brief state that occurs as the thread is stopping.
            </p></li></ul></div><p>
          The <code class="literal">State</code> column for the I/O thread may
          also show the text of a statement. This indicates that the
          thread has read an event from the relay log, extracted the
          statement from it, and is executing it.
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="slave-connection-thread-states"></a>7.5.6.7. Replication Slave Connection Thread States</h4></div></div></div><a class="indexterm" name="id3199072"></a><a class="indexterm" name="id3199085"></a><p>
          These thread states occur on a replication slave but are
          associated with connection threads, not with the I/O or SQL
          threads.
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              <a class="indexterm" name="id3199119"></a>

              <a class="indexterm" name="id3199132"></a>

              <code class="literal">Changing master</code>
            </p><p>
              The thread is processing a <a href="sql-syntax.html#change-master-to" title="12.6.2.1. CHANGE MASTER TO Syntax"><code class="literal">CHANGE
              MASTER TO</code></a> statement.
            </p></li><li><p>
              <a class="indexterm" name="id3199168"></a>

              <a class="indexterm" name="id3199181"></a>

              <code class="literal">Killing slave</code>
            </p><p>
              The thread is processing a <code class="literal">SLAVE STOP</code>
              statement.
            </p></li><li><p>
              <a class="indexterm" name="id3199216"></a>

              <a class="indexterm" name="id3199229"></a>

              <code class="literal">Opening master dump table</code>
            </p><p>
              This state occurs after <code class="literal">Creating table from
              master dump</code>.
            </p></li><li><p>
              <a class="indexterm" name="id3199265"></a>

              <a class="indexterm" name="id3199278"></a>

              <code class="literal">Reading master dump table data</code>
            </p><p>
              This state occurs after <code class="literal">Opening master dump
              table</code>.
            </p></li><li><p>
              <a class="indexterm" name="id3199314"></a>

              <a class="indexterm" name="id3199327"></a>

              <code class="literal">Rebuilding the index on master dump
              table</code>
            </p><p>
              This state occurs after <code class="literal">Reading master dump table
              data</code>.
            </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="event-scheduler-thread-states"></a>7.5.6.8. Event Scheduler Thread States</h4></div></div></div><a class="indexterm" name="id3199371"></a><a class="indexterm" name="id3199383"></a><p>
          These states occur for the Event Scheduler thread, threads
          that are created to execute scheduled events, or threads that
          terminate the scheduler.
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              <a class="indexterm" name="id3199409"></a>

              <a class="indexterm" name="id3199421"></a>

              <code class="literal">Clearing</code>
            </p><p>
              The scheduler thread or a thread that was executing an
              event is terminating and is about to end.
            </p></li><li><p>
              <a class="indexterm" name="id3199452"></a>

              <a class="indexterm" name="id3199464"></a>

              <code class="literal">Initialized</code>
            </p><p>
              The scheduler thread or a thread that will execute an
              event has been initialized.
            </p></li><li><p>
              <a class="indexterm" name="id3199494"></a>

              <a class="indexterm" name="id3199507"></a>

              <code class="literal">Waiting for next activation</code>
            </p><p>
              The scheduler has a non-empty event queue but the next
              activation is in the future.
            </p></li><li><p>
              <a class="indexterm" name="id3199538"></a>

              <a class="indexterm" name="id3199551"></a>

              <code class="literal">Waiting for scheduler to stop</code>
            </p><p>
              The thread issued <code class="literal">SET GLOBAL
              event_scheduler=OFF</code> and is waiting for the
              scheduler to stop.
            </p></li><li><p>
              <a class="indexterm" name="id3199588"></a>

              <a class="indexterm" name="id3199600"></a>

              <code class="literal">Waiting on empty queue</code>
            </p><p>
              The scheduler's event queue is empty and it is sleeping.
            </p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="connection-threads"></a>7.5.7. How MySQL Uses Threads for Client Connections</h3></div></div></div><a class="indexterm" name="id3199638"></a><a class="indexterm" name="id3199647"></a><a class="indexterm" name="id3199656"></a><p>
        Connection manager threads handle client connection requests on
        the network interfaces that the server listens to. On all
        platforms, one manager thread handles TCP/IP connection
        requests. On Unix, this manager thread also handles Unix socket
        file connection requests. On Windows, a manager thread handles
        shared-memory connection requests, and another handles
        named-pipe connection requests. The server does not create
        threads to handle interfaces that it does not listen to. For
        example, a Windows server that does not have support for
        named-pipe connections enabled does not create a thread to
        handle them.
      </p><p>
        In the original thread model for handing client connections,
        connection manager threads associate each client connection with
        a thread dedicated to it that handles authentication and request
        processing for that connection. Manager threads create a new
        thread when necessary but try to avoid doing so by consulting
        the thread cache first to see whether it contains a thread that
        can be used for the connection. When a connection ends, its
        thread is returned to the thread cache if the cache is not full.
      </p><p>
        The original connection thread model uses as many threads as
        there are clients currently connected, which has some
        disadvantages when server workload must scale to handle large
        numbers of connections. For example, thread creation and
        disposal becomes expensive. Also, each thread requires server
        and kernel resources, such as stack space. To accommodate a
        large number of simultaneous connections, the stack size per
        thread must be kept small, leading to a situation where it is
        either too small or the server consumes large amounts of memory.
        Exhaustion of other resources can occur as well, and scheduling
        overhead can become significant.
      </p><p>
        As of MySQL 6.0.4, an alternative thread model is available for
        dealing with the preceding issues that occur when scaling to
        large numbers of simultaneous connections. This model uses
        thread pooling:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Connection manager threads do not dedicate a thread to each
            client connection. Instead, the connection is added to the
            set of existing connection sockets. The server collects
            input from these sockets and when a complete request has
            been received from a given client, it is queued for service.
          </p></li><li><p>
            The server maintains a pool of service threads to process
            client requests. When a queued request is waiting and there
            is an available (not busy) service thread in the pool, the
            request is given to the thread to be handled. After
            processing the request, the service thread becomes available
            to process other requests.
          </p></li><li><p>
            Service threads are created at server startup and exist
            until the server terminates. A given service thread is not
            tied to a specific client connection and the requests that
            it processes over time may originate from different client
            connections.
          </p></li><li><p>
            The pool of service threads has a fixed size, so the amount
            of memory required for it does not increase as the number of
            client connections increases.
          </p></li></ul></div><p>
        Thread pooling works best if the normal workload consists mostly
        of lightweight queries, with no more than a few simultaneous
        transactions or long-running statements.
      </p><p>
        Thread pooling is less suitable when you have
        <em class="replaceable"><code>N</code></em> threads in the pool but it is
        possible that all or most of the threads will be tied up
        servicing transactions or long-running statements
        simultaneously. If this happens, the workload from other clients
        will be stalled. Configuring the server to use a pool larger
        than the maximum number of simultaneous transactions or
        long-running statements will help in this case.
      </p><p>
        The following examples illustrate when a too-small thread pool
        might cause problems. Assume a thread pool size of 1 for
        simplicity, but the same issues can occur for a larger pool and
        larger number of clients.
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            One client issues a statement that takes a long time to
            process. This ties up the service thread. If other clients
            issue statements, they are queued and must wait for the
            statement currently executing to finish.
          </p></li><li><p>
            One client acquires an exclusive lock on a table. If another
            client attempts to use the table, its statement blocks and
            the service thread remains occupied waiting for the block to
            end. Any further statements from the original client cannot
            execute, either, because there is no free thread available.
          </p><p>
            In the following scenario, conflicting lock requests cause
            deadlock.
          </p><p>
            Session 1:
          </p><pre class="programlisting">LOCK TABLES t1 WRITE;
</pre><p>
            The service thread executes the statement and becomes free.
          </p><p>
            Session 2:
          </p><pre class="programlisting">LOCK TABLES t1 WRITE;
</pre><p>
            The service thread starts to execute the statement but
            blocks waiting for the exiting lock on <code class="literal">t1</code>
            to be released. The thread does not become free.
          </p><p>
            Session 1:
          </p><pre class="programlisting">INSERT INTO t1 VALUES(1,2);
</pre><p>
            The statement cannot execute and is queued because the
            service thread remains allocated to session 2. At this
            point, the clients are deadlocked and neither cannot
            continue.
          </p><p>
            A similar situation can occur in the absence of explicit
            locks if simultaneous transactions attempt to access tables
            such that one transaction blocks another. Assume that
            <code class="literal">t1</code> is an <code class="literal">InnoDB</code> table.
          </p><p>
            Session 1:
          </p><pre class="programlisting">START TRANSACTION;
SELECT * FROM t1 WHERE id = 7 FOR UPDATE;
</pre><p>
            The service thread executes each of the statements in turn
            and becomes free. The <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
            statement acquires an exclusive lock for the selected row or
            rows.
          </p><p>
            Session 2:
          </p><pre class="programlisting">START TRANSACTION;
UPDATE t1 SET a = a+1 WHERE id = 7;
</pre><p>
            The service thread executes the first statement and attempts
            to execute the second. However, the
            <a href="sql-syntax.html#update" title="12.2.12. UPDATE Syntax"><code class="literal">UPDATE</code></a> blocks because it must
            lock the same rows already locked by session 1, so the
            service thread waits and does not become free.
          </p><p>
            Session 1:
          </p><pre class="programlisting">COMMIT;
</pre><p>
            The statement cannot execute and is queued because the
            service thread remains allocated to the session 2 statement.
            At this point, the transactions are deadlocked. Eventually,
            <code class="literal">InnoDB</code> times out waiting for the lock and
            the session 2 <a href="sql-syntax.html#update" title="12.2.12. UPDATE Syntax"><code class="literal">UPDATE</code></a> fails
            with an error. The service thread becomes free and executes
            the <a href="sql-syntax.html#commit" title="12.4.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">COMMIT</code></a> for session 1.
          </p></li></ul></div><p>
        Thread pooling is based on the <code class="literal">libevent</code>
        library. To build a server that includes the thread-pool
        capability, configure MySQL using the
        <a href="installing.html#option_configure_with-libevent"><code class="option">--with-libevent</code></a> option. The
        <a href="installing.html#option_configure_with-libevent"><code class="option">--without-libevent</code></a>
        option excludes the <code class="literal">libevent</code> code. See
        <a href="installing.html#configure-options" title="2.9.2. Typical configure Options">Section 2.9.2, “Typical <span><strong class="command">configure</strong></span> Options”</a>.
      </p><p>
        To control which thread model the server uses to manage threads
        that handle client connections and to monitor thread use,
        several system and status variables are relevant:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            At server startup, the
            <a href="server-administration.html#sysvar_thread_handling"><code class="literal">thread_handling</code></a> system
            variable controls which thread model is used.
            <a href="server-administration.html#sysvar_thread_handling"><code class="option">--thread_handling=one-thread-per-connection</code></a>
            is the default and selects the model that allocates one
            thread per connected client (the original thread model). To
            use thread pooling, start the server with
            <a href="server-administration.html#sysvar_thread_handling"><code class="option">--thread_handling=pool-of-threads</code></a>.
            If <code class="literal">libevent</code> is not compiled into the
            server, <a href="server-administration.html#sysvar_thread_handling"><code class="literal">thread_handling</code></a> is
            unavailable and the server defaults to one thread per
            client.
          </p></li><li><p>
            When the server uses thread pooling,
            <a href="server-administration.html#sysvar_thread_pool_size"><code class="literal">thread_pool_size</code></a> controls
            the maximum number of requests that the server should be
            allowed to process simultaneously. The pool has a fixed size
            over the lifetime of server execution, but the size can be
            specified at startup. The default pool size is 20 threads.
            Starting the server with
            <a href="server-administration.html#sysvar_thread_pool_size"><code class="option">--thread_pool_size=<em class="replaceable"><code>N</code></em></code></a>
            sets the size to <em class="replaceable"><code>N</code></em> threads, up to
            a maximum of 16,384. If <code class="literal">libevent</code> is not
            compiled into the server,
            <a href="server-administration.html#sysvar_thread_pool_size"><code class="literal">thread_pool_size</code></a> is
            unavailable.
          </p><p>
            With thread pooling enabled, InnoDB concurrency control
            becomes unnecessary, so you can disable InnoDB thread
            concurrency by setting
            <a href="storage-engines.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>
            to 0.
          </p></li><li><p>
            When the server uses one thread per client connection, it
            uses the thread cache, which has a size determined by the
            <a href="server-administration.html#sysvar_thread_cache_size"><code class="literal">thread_cache_size</code></a> system
            variable. The default value is 0 (no caching), which causes
            a thread to be set up for each new connection and disposed
            of when the connection terminates. Set
            <a href="server-administration.html#sysvar_thread_cache_size"><code class="literal">thread_cache_size</code></a> to
            <em class="replaceable"><code>N</code></em> to allow
            <em class="replaceable"><code>N</code></em> inactive connection threads to
            be cached.
            <a href="server-administration.html#sysvar_thread_cache_size"><code class="literal">thread_cache_size</code></a> can be
            set at server startup or changed while the server runs. A
            connection thread becomes inactive when the client
            connection with which it was associated terminates.
          </p><p>
            To monitor the number of threads in the cache and how many
            threads have been created because a thread could not be
            taken from the cache, monitor the
            <a href="server-administration.html#statvar_Threads_cached"><code class="literal">Threads_cached</code></a> and
            <a href="server-administration.html#statvar_Threads_created"><code class="literal">Threads_created</code></a> status
            variables. (See <a href="server-administration.html#server-status-variables" title="5.1.6. Server Status Variables">Section 5.1.6, “Server Status Variables”</a>.)
          </p></li><li><p>
            Regardless of thread model, you can set
            <a href="server-administration.html#sysvar_max_connections"><code class="literal">max_connections</code></a> at server
            startup or at runtime to control the maximum number of
            clients that can connect simultaneously.
          </p></li><li><p>
            When the thread stack is too small, this limits the
            complexity of the SQL statements which the server can
            handle, the recursion depth of stored procedures, and other
            memory-consuming actions. To set a stack size of
            <em class="replaceable"><code>N</code></em> bytes for each thread, start
            the server with
            <a href="server-administration.html#sysvar_thread_stack"><code class="option">--thread_stack=<em class="replaceable"><code>N</code></em></code></a>.
          </p></li></ul></div><p>
        For more information on these system and status variables, see
        <a href="server-administration.html#server-system-variables" title="5.1.3. Server System Variables">Section 5.1.3, “Server System Variables”</a>, and
        <a href="server-administration.html#server-status-variables" title="5.1.6. Server Status Variables">Section 5.1.6, “Server Status Variables”</a>.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="memory-use"></a>7.5.8. How MySQL Uses Memory</h3></div></div></div><a class="indexterm" name="id3200295"></a><p>
        The following list indicates some of the ways that the
        <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> server uses memory. Where applicable,
        the name of the system variable relevant to the memory use is
        given:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            The key buffer is shared by all threads; its size is
            determined by the
            <a href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a> variable.
            Other buffers used by the server are allocated as needed.
            See <a href="optimization.html#server-parameters" title="7.5.3. Tuning Server Parameters">Section 7.5.3, “Tuning Server Parameters”</a>.
          </p></li><li><p>
            Each thread that is used to manage client connections uses
            some thread-specific space. The following list indicates
            these and which variables control their size:
          </p><div class="itemizedlist"><ul type="circle"><li><p>
                A stack (default 192KB, variable
                <a href="server-administration.html#sysvar_thread_stack"><code class="literal">thread_stack</code></a>)
              </p></li><li><p>
                A connection buffer (variable
                <a href="server-administration.html#sysvar_net_buffer_length"><code class="literal">net_buffer_length</code></a>)
              </p></li><li><p>
                A result buffer (variable
                <a href="server-administration.html#sysvar_net_buffer_length"><code class="literal">net_buffer_length</code></a>)
              </p></li></ul></div><p>
            The connection buffer and result buffer both begin with a
            size given by
            <a href="server-administration.html#sysvar_net_buffer_length"><code class="literal">net_buffer_length</code></a> but are
            dynamically enlarged up to
            <a href="server-administration.html#sysvar_max_allowed_packet"><code class="literal">max_allowed_packet</code></a> bytes as
            needed. The result buffer shrinks to
            <a href="server-administration.html#sysvar_net_buffer_length"><code class="literal">net_buffer_length</code></a> after
            each SQL statement. While a statement is running, a copy of
            the current statement string is also allocated.
          </p></li><li><p>
            All threads share the same base memory.
          </p></li><li><p>
            When a thread is no longer needed, the memory allocated to
            it is released and returned to the system unless the thread
            goes back into the thread cache. In that case, the memory
            remains allocated.
          </p></li><li><p>
            The <a href="server-administration.html#sysvar_myisam_use_mmap"><code class="literal">myisam_use_mmap</code></a> system
            variable can be set to 1 to enable memory-mapping for all
            <code class="literal">MyISAM</code> tables.
          </p></li><li><p>
            Each request that performs a sequential scan of a table
            allocates a <em class="firstterm">read buffer</em> (variable
            <a href="server-administration.html#sysvar_read_buffer_size"><code class="literal">read_buffer_size</code></a>).
          </p></li><li><p>
            When reading rows in an arbitrary sequence (for example,
            following a sort), a <em class="firstterm">random-read
            buffer</em> (variable
            <a href="server-administration.html#sysvar_read_rnd_buffer_size"><code class="literal">read_rnd_buffer_size</code></a>) may
            be allocated in order to avoid disk seeks.
          </p></li><li><p>
            All joins are executed in a single pass, and most joins can
            be done without even using a temporary table. Most temporary
            tables are memory-based hash tables. Temporary tables with a
            large row length (calculated as the sum of all column
            lengths) or that contain <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a>
            columns are stored on disk.
          </p><p>
            If an internal heap table exceeds the size of
            <a href="server-administration.html#sysvar_tmp_table_size"><code class="literal">tmp_table_size</code></a>, MySQL
            handles this automatically by changing the in-memory heap
            table to a disk-based <code class="literal">MyISAM</code> table as
            necessary. You can also increase the temporary table size by
            setting the <a href="server-administration.html#sysvar_tmp_table_size"><code class="literal">tmp_table_size</code></a>
            option to <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a>, or by setting the SQL
            option <code class="literal">sql_big_tables</code> in the client
            program. See <a href="server-administration.html#server-session-variables" title="5.1.4. Session System Variables">Section 5.1.4, “Session System Variables”</a>.
          </p><p class="mnmas"><b>MySQL Enterprise</b>
              Subscribers to the MySQL Enterprise Monitor are alerted
              when temporary tables exceed
              <a href="server-administration.html#sysvar_tmp_table_size"><code class="literal">tmp_table_size</code></a>. Advisors
              make recommendations for the optimum value of
              <a href="server-administration.html#sysvar_tmp_table_size"><code class="literal">tmp_table_size</code></a> based on
              actual table usage. For more information about the MySQL
              Enterprise Monitor please see
              <a href="http://www.mysql.com/products/enterprise/advisors.html" target="_top">http://www.mysql.com/products/enterprise/advisors.html</a>.
            </p></li><li><p>
            Most requests that perform a sort allocate a sort buffer and
            zero to two temporary files depending on the result set
            size. See <a href="error-handling.html#temporary-files" title="B.1.4.4. Where MySQL Stores Temporary Files">Section B.1.4.4, “Where MySQL Stores Temporary Files”</a>.
          </p></li><li><p>
            Almost all parsing and calculating is done in a local memory
            store. No memory overhead is needed for small items, so the
            normal slow memory allocation and freeing is avoided. Memory
            is allocated only for unexpectedly large strings. This is
            done with <code class="literal">malloc()</code> and
            <code class="literal">free()</code>.
          </p></li><li><p>
            For each <code class="literal">MyISAM</code> table that is opened, the
            index file is opened once; the data file is opened once for
            each concurrently running thread. For each concurrent
            thread, a table structure, column structures for each
            column, and a buffer of size <code class="literal">3 ×
            <em class="replaceable"><code>N</code></em></code> are allocated (where
            <em class="replaceable"><code>N</code></em> is the maximum row length, not
            counting <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a> columns). A
            <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a> column requires five to
            eight bytes plus the length of the
            <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a> data. The
            <code class="literal">MyISAM</code> storage engine maintains one extra
            row buffer for internal use.
          </p></li><li><p>
            For each table having <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a>
            columns, a buffer is enlarged dynamically to read in larger
            <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a> values. If you scan a
            table, a buffer as large as the largest
            <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a> value is allocated.
          </p></li><li><p>
            Handler structures for all in-use tables are saved in a
            cache and managed as a FIFO. By default, the cache has 64
            entries. If a table has been used by two running threads at
            the same time, the cache contains two entries for the table.
            See <a href="optimization.html#table-cache" title="7.4.7. How MySQL Opens and Closes Tables">Section 7.4.7, “How MySQL Opens and Closes Tables”</a>.
          </p></li><li><p>
            A <a href="sql-syntax.html#flush" title="12.5.7.3. FLUSH Syntax"><code class="literal">FLUSH
            TABLES</code></a> statement or <a href="programs.html#mysqladmin" title="4.5.2. mysqladmin — Client for Administering a MySQL Server"><span><strong class="command">mysqladmin
            flush-tables</strong></span></a> command closes all tables that are
            not in use at once and marks all in-use tables to be closed
            when the currently executing thread finishes. This
            effectively frees most in-use memory.
            <a href="sql-syntax.html#flush" title="12.5.7.3. FLUSH Syntax"><code class="literal">FLUSH
            TABLES</code></a> does not return until all tables have been
            closed.
          </p></li><li><p>
            The server caches information in memory as a result of
            <a href="sql-syntax.html#grant" title="12.5.1.3. GRANT Syntax"><code class="literal">GRANT</code></a>,
            <a href="sql-syntax.html#create-user" title="12.5.1.1. CREATE USER Syntax"><code class="literal">CREATE USER</code></a>,
            <a href="sql-syntax.html#create-server" title="12.1.13. CREATE SERVER Syntax"><code class="literal">CREATE SERVER</code></a>, and
            <a href="sql-syntax.html#install-plugin" title="12.5.4.3. INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a> statements.
            This memory is not released by the corresponding
            <a href="sql-syntax.html#revoke" title="12.5.1.5. REVOKE Syntax"><code class="literal">REVOKE</code></a>,
            <a href="sql-syntax.html#drop-user" title="12.5.1.2. DROP USER Syntax"><code class="literal">DROP USER</code></a>,
            <a href="sql-syntax.html#drop-server" title="12.1.22. DROP SERVER Syntax"><code class="literal">DROP SERVER</code></a>, and
            <a href="sql-syntax.html#uninstall-plugin" title="12.5.4.4. UNINSTALL PLUGIN Syntax"><code class="literal">UNINSTALL PLUGIN</code></a> statements,
            so for a server that executes many instances of the
            statements that cause caching, there will be an increase in
            memory use. This cached memory can be freed with
            <a href="sql-syntax.html#flush" title="12.5.7.3. FLUSH Syntax"><code class="literal">FLUSH
            PRIVILEGES</code></a>.
          </p></li></ul></div><p>
        <span><strong class="command">ps</strong></span> and other system status programs may
        report that <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> uses a lot of memory. This
        may be caused by thread stacks on different memory addresses.
        For example, the Solaris version of <span><strong class="command">ps</strong></span> counts
        the unused memory between stacks as used memory. You can verify
        this by checking available swap with <code class="literal">swap -s</code>.
        We test <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> with several memory-leakage
        detectors (both commercial and Open Source), so there should be
        no memory leaks.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="large-page-support"></a>7.5.9. Enabling Large Page Support</h3></div></div></div><a class="indexterm" name="id3200932"></a><p>
        Some hardware/operating system architectures support memory
        pages greater than the default (usually 4KB). The actual
        implementation of this support depends on the underlying
        hardware and operating system. Applications that perform a lot
        of memory accesses may obtain performance improvements by using
        large pages due to reduced Translation Lookaside Buffer (TLB)
        misses.
      </p><p>
        In MySQL, large pages can be used by InnoDB, to allocate memory
        for its buffer pool and additional memory pool.
      </p><p>
        Currently, MySQL supports only the Linux implementation of large
        page support (which is called HugeTLB in Linux). Before large
        pages can be used on Linux, the kernel must be enabled to
        support them and it is necessary to configure the HugeTLB memory
        pool. For reference, the HugeTBL API is documented in the
        <code class="filename">Documentation/vm/hugetlbpage.txt</code> file of
        your Linux sources.
      </p><p>
        For some recent systems, such as Red Hat Enterprise Linux, the
        kernel appears to have the large pages feature enabled by
        default. To check whether this is true for your kernel, use the
        following command and look for output lines containing
        “<span class="quote">huge</span>”:
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>cat /proc/meminfo | grep -i huge</code></strong>
HugePages_Total:       0
HugePages_Free:        0
HugePages_Rsvd:        0
HugePages_Surp:        0
Hugepagesize:       4096 kB
</pre><p>
        The non-empty command output indicates that large page support
        is present. The zero values indicate that no pages are
        configured for use.
      </p><p>
        If the output is empty, your kernel needs to be reconfigured to
        support large pages. Consult the
        <code class="filename">hugetlbpage.txt</code> file for instructions.
      </p><p>
        Assuming that your Linux kernel has large page support enabled,
        configure it for use by MySQL using the following commands.
        Normally, you put these in an <code class="filename">rc</code> file or
        equivalent startup file that is executed during the system boot
        sequence, so that the commands execute each time the system
        starts. The commands should execute early in the boot sequence,
        before the MySQL server starts. Be sure to change the allocation
        numbers and the group number as appropriate for your system.
      </p><pre class="programlisting"># Set the number of pages to be used.
# Each page is normally 2MB, so a value of 20 = 40MB.
# This command actually allocates memory, so this much
# memory must be available.
echo 20 &gt; /proc/sys/vm/nr_hugepages

# Set the group number that is allowed to access this
# memory (102 in this case). The mysql user must be a
# member of this group.
echo 102 &gt; /proc/sys/vm/hugetlb_shm_group

# Increase the amount of shmem allowed per segment
# (12G in this case).
echo 1560281088 &gt; /proc/sys/kernel/shmmax

# Increase total amount of shared memory.  The value
# is the number of pages. At 4KB/page, 4194304 = 16GB.
echo 4194304 &gt; /proc/sys/kernel/shmall
</pre><p>
        For MySQL usage, you normally want the value of
        <code class="literal">shmmax</code> to be close to the value of
        <code class="literal">shmall</code>.
      </p><p>
        To verify the large page configuration, check
        <code class="filename">/proc/meminfo</code> again as described
        previously. Now you should see some non-zero values:
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>cat /proc/meminfo | grep -i huge</code></strong>
HugePages_Total:      20
HugePages_Free:       20
HugePages_Rsvd:        0
HugePages_Surp:        0
Hugepagesize:       4096 kB
</pre><p>
        The final step to make use of the
        <code class="literal">hugetlb_shm_group</code> is to give the
        <code class="literal">mysql</code> user an “<span class="quote">unlimited</span>” value
        for the memlock limit. This can by done either by editing
        <code class="filename">/etc/security/limits.conf</code> or by adding the
        following command to your <a href="programs.html#mysqld-safe" title="4.3.2. mysqld_safe — MySQL Server Startup Script"><span><strong class="command">mysqld_safe</strong></span></a> script:
      </p><pre class="programlisting">ulimit -l unlimited
</pre><p>
        Adding the <span><strong class="command">ulimit</strong></span> command to
        <a href="programs.html#mysqld-safe" title="4.3.2. mysqld_safe — MySQL Server Startup Script"><span><strong class="command">mysqld_safe</strong></span></a> causes the
        <code class="literal">root</code> user to set the memlock limit to
        <code class="literal">unlimited</code> before switching to the
        <code class="literal">mysql</code> user. (This assumes that
        <a href="programs.html#mysqld-safe" title="4.3.2. mysqld_safe — MySQL Server Startup Script"><span><strong class="command">mysqld_safe</strong></span></a> is started by
        <code class="literal">root</code>.)
      </p><p>
        Large page support in MySQL is disabled by default. To enable
        it, start the server with the
        <a href="server-administration.html#option_mysqld_large-pages"><code class="option">--large-pages</code></a> option. For
        example, you can use the following lines in your server's
        <code class="filename">my.cnf</code> file:
      </p><pre class="programlisting">[mysqld]
large-pages
</pre><p>
        With this option, <code class="literal">InnoDB</code> uses large pages
        automatically for its buffer pool and additional memory pool. If
        <code class="literal">InnoDB</code> cannot do this, it falls back to use
        of traditional memory and writes a warning to the error log:
        <span class="errortext">Warning: Using conventional memory pool</span>
      </p><p>
        You can verify that large pages are being used by checking
        <code class="literal">/proc/meminfo</code> again:
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>cat /proc/meminfo | grep -i huge</code></strong>
HugePages_Total:      20
HugePages_Free:       20
HugePages_Rsvd:        2
HugePages_Surp:        0
Hugepagesize:       4096 kB
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="internal-temporary-tables"></a>7.5.10. How MySQL Uses Internal Temporary Tables</h3></div></div></div><a class="indexterm" name="id3201277"></a><p>
        In some cases, the server creates internal temporary tables
        while processing queries. A temporary table can be held in
        memory and processed by the <code class="literal">MEMORY</code> storage
        engine, or stored on disk and processed by the
        <code class="literal">MyISAM</code> storage engine. Temporary tables can
        be created under conditions such as these:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            If there is an <code class="literal">ORDER BY</code> clause and a
            different <code class="literal">GROUP BY</code> clause, or if the
            <code class="literal">ORDER BY</code> or <code class="literal">GROUP BY</code>
            contains columns from tables other than the first table in
            the join queue, a temporary table is created.
          </p></li><li><p>
            If you use the <code class="literal">SQL_SMALL_RESULT</code> option,
            MySQL uses an in-memory temporary table.
          </p></li><li><p>
            <code class="literal">DISTINCT</code> combined with <code class="literal">ORDER
            BY</code> may require a temporary table.
          </p></li></ul></div><p>
        You can tell whether a query requires a temporary table by using
        <a href="sql-syntax.html#explain" title="12.3.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> and checking the
        <code class="literal">Extra</code> column to see whether it says
        <code class="literal">Using temporary</code>. See
        <a href="optimization.html#using-explain" title="7.2.1. Optimizing Queries with EXPLAIN">Section 7.2.1, “Optimizing Queries with <code class="literal">EXPLAIN</code>”</a>.
      </p><p>
        Some conditions prevent the use of a <code class="literal">MEMORY</code>
        temporary table, in which case the server uses a
        <code class="literal">MyISAM</code> table instead:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Presence of a <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">TEXT</code></a> or
            <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a> column in the table
          </p></li><li><p>
            Presence of any column in a <code class="literal">GROUP BY</code> or
            <code class="literal">DISTINCT</code> clause larger than 512 bytes
          </p></li><li><p>
            Presence of any column larger than 512 bytes in the
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> list, if
            <a href="sql-syntax.html#union" title="12.2.9.3. UNION Syntax"><code class="literal">UNION</code></a> or
            <a href="sql-syntax.html#union" title="12.2.9.3. UNION Syntax"><code class="literal">UNION ALL</code></a>
            is used.
          </p></li></ul></div><p>
        A temporary table that is created initially as a
        <code class="literal">MEMORY</code> table might be converted to a
        <code class="literal">MyISAM</code> table and stored on disk if it becomes
        too large. The
        <a href="server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a> system
        variable determines how large <code class="literal">MEMORY</code> tables
        are allowed to grow. It applies to all <code class="literal">MEMORY</code>
        tables, including those created with <a href="sql-syntax.html#create-table" title="12.1.14. CREATE TABLE Syntax"><code class="literal">CREATE
        TABLE</code></a>. However, for internal <code class="literal">MEMORY</code>
        tables, the actual maximum size is determined by
        <a href="server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a> in
        combination with
        <a href="server-administration.html#sysvar_tmp_table_size"><code class="literal">tmp_table_size</code></a>: Whichever value
        is smaller is the one that applies. If the size of an internal
        <code class="literal">MEMORY</code> table exceeds the limit, MySQL
        automatically converts it to an on-disk
        <code class="literal">MyISAM</code> table.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="dns"></a>7.5.11. How MySQL Uses DNS</h3></div></div></div><a class="indexterm" name="id3201597"></a><a class="indexterm" name="id3201605"></a><a class="indexterm" name="id3201615"></a><p>
        When a new client connects to <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a>,
        <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> spawns a new thread to handle the
        request. This thread first checks whether the host name is in
        the host name cache. If not, the thread attempts to resolve the
        host name:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            The thread takes the IP address and resolves it to a host
            name (using <code class="function">gethostbyaddr()</code>). It then
            takes that host name and resolves it back to the IP address
            (using <code class="function">gethostbyname()</code>) and compares to
            ensure it is the original IP address.
          </p></li><li><p>
            If the operating system supports the thread-safe
            <code class="function">gethostbyaddr_r()</code> and
            <code class="function">gethostbyname_r()</code> calls, the thread
            uses them to perform host name resolution.
          </p></li><li><p>
            If the operating system does not support the thread-safe
            calls, the thread locks a mutex and calls
            <code class="function">gethostbyaddr()</code> and
            <code class="function">gethostbyname()</code> instead. In this case,
            no other thread can resolve host names that are not in the
            host name cache until the first thread unlocks the mutex.
          </p></li></ul></div><p>
        You can disable DNS host name lookups by starting
        <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> with the
        <a href="server-administration.html#option_mysqld_skip-name-resolve"><code class="option">--skip-name-resolve</code></a> option.
        However, in this case, you can use only IP numbers in the MySQL
        grant tables.
      </p><p>
        If you have a very slow DNS and many hosts, you can get more
        performance by either disabling DNS lookups with
        <a href="server-administration.html#option_mysqld_skip-name-resolve"><code class="option">--skip-name-resolve</code></a> or by
        increasing the <code class="literal">HOST_CACHE_SIZE</code> define
        (default value: 128) and recompiling <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a>.
      </p><p>
        You can disable the host name cache by starting the server with
        the <a href="server-administration.html#option_mysqld_skip-host-cache"><code class="option">--skip-host-cache</code></a> option. To
        clear the host name cache, issue a
        <a href="sql-syntax.html#flush" title="12.5.7.3. FLUSH Syntax"><code class="literal">FLUSH HOSTS</code></a>
        statement or execute the <a href="programs.html#mysqladmin" title="4.5.2. mysqladmin — Client for Administering a MySQL Server"><span><strong class="command">mysqladmin
        flush-hosts</strong></span></a> command.
      </p><p>
        To disallow TCP/IP connections entirely, start
        <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> with the
        <a href="server-administration.html#option_mysqld_skip-networking"><code class="option">--skip-networking</code></a> option.
      </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="disk-issues"></a>7.6. Disk Issues</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="optimization.html#symbolic-links">7.6.1. Using Symbolic Links</a></span></dt></dl></div><a class="indexterm" name="id3201823"></a><a class="indexterm" name="id3201832"></a><div class="itemizedlist"><ul type="disc"><li><p>
          Disk seeks are a huge performance bottleneck. This problem
          becomes more apparent when the amount of data starts to grow
          so large that effective caching becomes impossible. For large
          databases where you access data more or less randomly, you can
          be sure that you need at least one disk seek to read and a
          couple of disk seeks to write things. To minimize this
          problem, use disks with low seek times.
        </p></li><li><p>
          Increase the number of available disk spindles (and thereby
          reduce the seek overhead) by either symlinking files to
          different disks or striping the disks:
        </p><div class="itemizedlist"><ul type="circle"><li><p>
              Using symbolic links
            </p><p>
              This means that, for <code class="literal">MyISAM</code> tables, you
              symlink the index file and data files from their usual
              location in the data directory to another disk (that may
              also be striped). This makes both the seek and read times
              better, assuming that the disk is not used for other
              purposes as well. See <a href="optimization.html#symbolic-links" title="7.6.1. Using Symbolic Links">Section 7.6.1, “Using Symbolic Links”</a>.
            </p></li><li><p>
              <a class="indexterm" name="id3201904"></a>

              Striping
            </p><p>
              Striping means that you have many disks and put the first
              block on the first disk, the second block on the second
              disk, and the <em class="replaceable"><code>N</code></em>-th block on the
              (<code class="literal"><em class="replaceable"><code>N</code></em> MOD
              <em class="replaceable"><code>number_of_disks</code></em></code>)
              disk, and so on. This means if your normal data size is
              less than the stripe size (or perfectly aligned), you get
              much better performance. Striping is very dependent on the
              operating system and the stripe size, so benchmark your
              application with different stripe sizes. See
              <a href="optimization.html#custom-benchmarks" title="7.1.5. Using Your Own Benchmarks">Section 7.1.5, “Using Your Own Benchmarks”</a>.
            </p><p>
              The speed difference for striping is
              <span class="emphasis"><em>very</em></span> dependent on the parameters.
              Depending on how you set the striping parameters and
              number of disks, you may get differences measured in
              orders of magnitude. You have to choose to optimize for
              random or sequential access.
            </p></li></ul></div></li><li><p>
          For reliability, you may want to use RAID 0+1 (striping plus
          mirroring), but in this case, you need 2 ×
          <em class="replaceable"><code>N</code></em> drives to hold
          <em class="replaceable"><code>N</code></em> drives of data. This is probably
          the best option if you have the money for it. However, you may
          also have to invest in some volume-management software to
          handle it efficiently.
        </p></li><li><p>
          A good option is to vary the RAID level according to how
          critical a type of data is. For example, store semi-important
          data that can be regenerated on a RAID 0 disk, but store
          really important data such as host information and logs on a
          RAID 0+1 or RAID <em class="replaceable"><code>N</code></em> disk. RAID
          <em class="replaceable"><code>N</code></em> can be a problem if you have many
          writes, due to the time required to update the parity bits.
        </p></li><li><p>
          On Linux, you can get much more performance by using
          <code class="literal">hdparm</code> to configure your disk's interface.
          (Up to 100% under load is not uncommon.) The following
          <code class="literal">hdparm</code> options should be quite good for
          MySQL, and probably for many other applications:
        </p><pre class="programlisting">hdparm -m 16 -d 1
</pre><p>
          Note that performance and reliability when using this command
          depend on your hardware, so we strongly suggest that you test
          your system thoroughly after using <code class="literal">hdparm</code>.
          Please consult the <code class="literal">hdparm</code> manual page for
          more information. If <code class="literal">hdparm</code> is not used
          wisely, file system corruption may result, so back up
          everything before experimenting!
        </p></li><li><p>
          You can also set the parameters for the file system that the
          database uses:
        </p><p>
          If you do not need to know when files were last accessed
          (which is not really useful on a database server), you can
          mount your file systems with the <code class="option">-o noatime</code>
          option. That skips updates to the last access time in inodes
          on the file system, which avoids some disk seeks.
        </p><p>
          On many operating systems, you can set a file system to be
          updated asynchronously by mounting it with the <code class="option">-o
          async</code> option. If your computer is reasonably stable,
          this should give you more performance without sacrificing too
          much reliability. (This flag is on by default on Linux.)
        </p></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="symbolic-links"></a>7.6.1. Using Symbolic Links</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="optimization.html#symbolic-links-to-databases">7.6.1.1. Using Symbolic Links for Databases on Unix</a></span></dt><dt><span class="section"><a href="optimization.html#symbolic-links-to-tables">7.6.1.2. Using Symbolic Links for Tables on Unix</a></span></dt><dt><span class="section"><a href="optimization.html#windows-symbolic-links">7.6.1.3. Using Symbolic Links for Databases on Windows</a></span></dt></dl></div><a class="indexterm" name="id3202107"></a><a class="indexterm" name="id3202116"></a><p>
        You can move tables and databases from the database directory to
        other locations and replace them with symbolic links to the new
        locations. You might want to do this, for example, to move a
        database to a file system with more free space or increase the
        speed of your system by spreading your tables to different disk.
      </p><p>
        The recommended way to do this is simply to symlink databases to
        a different disk. Symlink tables only as a last resort.
      </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="symbolic-links-to-databases"></a>7.6.1.1. Using Symbolic Links for Databases on Unix</h4></div></div></div><a class="indexterm" name="id3202152"></a><p>
          On Unix, the way to symlink a database is first to create a
          directory on some disk where you have free space and then to
          create a symlink to it from the MySQL data directory.
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mkdir /dr1/databases/test</code></strong>
shell&gt; <strong class="userinput"><code>ln -s /dr1/databases/test <em class="replaceable"><code>/path/to/datadir</code></em></code></strong>
</pre><p>
          MySQL does not support linking one directory to multiple
          databases. Replacing a database directory with a symbolic link
          works as long as you do not make a symbolic link between
          databases. Suppose that you have a database
          <code class="literal">db1</code> under the MySQL data directory, and
          then make a symlink <code class="literal">db2</code> that points to
          <code class="literal">db1</code>:
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>cd <em class="replaceable"><code>/path/to/datadir</code></em></code></strong>
shell&gt; <strong class="userinput"><code>ln -s db1 db2</code></strong>
</pre><p>
          The result is that, or any table <code class="literal">tbl_a</code> in
          <code class="literal">db1</code>, there also appears to be a table
          <code class="literal">tbl_a</code> in <code class="literal">db2</code>. If one
          client updates <code class="literal">db1.tbl_a</code> and another client
          updates <code class="literal">db2.tbl_a</code>, problems are likely to
          occur.
        </p><p>
          However, if you really need to do this, it is possible by
          altering the source file
          <code class="filename">mysys/my_symlink.c</code>, in which you should
          look for the following statement:
        </p><pre class="programlisting">if (!(MyFlags &amp; MY_RESOLVE_LINK) ||
    (!lstat(filename,&amp;stat_buff) &amp;&amp; S_ISLNK(stat_buff.st_mode)))
</pre><p>
          Change the statement to this:
        </p><pre class="programlisting">if (1)
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="symbolic-links-to-tables"></a>7.6.1.2. Using Symbolic Links for Tables on Unix</h4></div></div></div><a class="indexterm" name="id3202322"></a><p>
          You should not symlink tables on systems that do not have a
          fully operational <code class="literal">realpath()</code> call. (Linux
          and Solaris support <code class="literal">realpath()</code>). You can
          check whether your system supports symbolic links by issuing a
          <code class="literal">SHOW VARIABLES LIKE 'have_symlink'</code>
          statement.
        </p><p>
          Symlinks are fully supported only for
          <code class="literal">MyISAM</code> tables. For files used by tables for
          other storage engines, you may get strange problems if you try
          to use symbolic links.
        </p><p>
          The handling of symbolic links for <code class="literal">MyISAM</code>
          tables works as follows:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              In the data directory, you always have the table format
              (<code class="filename">.frm</code>) file, the data
              (<code class="filename">.MYD</code>) file, and the index
              (<code class="filename">.MYI</code>) file. The data file and index
              file can be moved elsewhere and replaced in the data
              directory by symlinks. The format file cannot.
            </p></li><li><p>
              You can symlink the data file and the index file
              independently to different directories.
            </p></li><li><p>
              You can instruct a running MySQL server to perform the
              symlinking by using the <code class="literal">DATA DIRECTORY</code>
              and <code class="literal">INDEX DIRECTORY</code> options to
              <a href="sql-syntax.html#create-table" title="12.1.14. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>. See
              <a href="sql-syntax.html#create-table" title="12.1.14. CREATE TABLE Syntax">Section 12.1.14, “<code class="literal">CREATE TABLE</code> Syntax”</a>. Alternatively, symlinking
              can be accomplished manually from the command line using
              <code class="literal">ln -s</code> if <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> is
              not running.
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
                Beginning with MySQL 6.0.5, the path used with either or
                both of the <code class="literal">DATA DIRECTORY</code> and
                <code class="literal">INDEX DIRECTORY</code> options may not
                include the MySQL <code class="literal">data</code> directory.
                (<a href="http://bugs.mysql.com/32167" target="_top">Bug#32167</a>)
              </p></div></li><li><p>
              <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a> does not replace a symlink
              with the data file or index file. It works directly on the
              file to which the symlink points. Any temporary files are
              created in the directory where the data file or index file
              is located. The same is true for the
              <a href="sql-syntax.html#alter-table" title="12.1.6. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>,
              <a href="sql-syntax.html#optimize-table" title="12.5.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>, and
              <a href="sql-syntax.html#repair-table" title="12.5.2.5. REPAIR TABLE Syntax"><code class="literal">REPAIR TABLE</code></a> statements.
            </p></li><li><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
                When you drop a table that is using symlinks,
                <span class="emphasis"><em>both the symlink and the file to which the
                symlink points are dropped</em></span>. This is an
                extremely good reason why you should
                <span class="emphasis"><em>not</em></span> run <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a>
                as the system <code class="literal">root</code> or allow system
                users to have write access to MySQL database
                directories.
              </p></div></li><li><p>
              If you rename a table with <code class="literal">ALTER TABLE ...
              RENAME</code> or <a href="sql-syntax.html#rename-table" title="12.1.26. RENAME TABLE Syntax"><code class="literal">RENAME
              TABLE</code></a> and you do not move the table to another
              database, the symlinks in the database directory are
              renamed to the new names and the data file and index file
              are renamed accordingly.
            </p></li><li><p>
              If you use <code class="literal">ALTER TABLE ... RENAME</code> or
              <a href="sql-syntax.html#rename-table" title="12.1.26. RENAME TABLE Syntax"><code class="literal">RENAME TABLE</code></a> to move a
              table to another database, the table is moved to the other
              database directory. If the table name changed, the
              symlinks in the new database directory are renamed to the
              new names and the data file and index file are renamed
              accordingly.
            </p></li><li><p>
              If you are not using symlinks, you should use the
              <a href="server-administration.html#option_mysqld_symbolic-links"><code class="option">--skip-symbolic-links</code></a>
              option to <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> to ensure that no one
              can use <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> to drop or rename a file
              outside of the data directory.
            </p></li></ul></div><p>
          Table symlink operations that are not yet supported:
        </p><a class="indexterm" name="id3202673"></a><div class="itemizedlist"><ul type="disc"><li><p>
              <a href="sql-syntax.html#alter-table" title="12.1.6. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> ignores the
              <code class="literal">DATA DIRECTORY</code> and <code class="literal">INDEX
              DIRECTORY</code> table options.
            </p></li><li><p>
              The <code class="filename">.frm</code> file must
              <span class="emphasis"><em>never</em></span> be a symbolic link (as
              indicated previously, only the data and index files can be
              symbolic links). Attempting to do this (for example, to
              make synonyms) produces incorrect results. Suppose that
              you have a database <code class="literal">db1</code> under the MySQL
              data directory, a table <code class="literal">tbl1</code> in this
              database, and in the <code class="literal">db1</code> directory you
              make a symlink <code class="literal">tbl2</code> that points to
              <code class="literal">tbl1</code>:
            </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>cd <em class="replaceable"><code>/path/to/datadir</code></em>/db1</code></strong>
shell&gt; <strong class="userinput"><code>ln -s tbl1.frm tbl2.frm</code></strong>
shell&gt; <strong class="userinput"><code>ln -s tbl1.MYD tbl2.MYD</code></strong>
shell&gt; <strong class="userinput"><code>ln -s tbl1.MYI tbl2.MYI</code></strong>
</pre><p>
              Problems result if one thread reads
              <code class="literal">db1.tbl1</code> and another thread updates
              <code class="literal">db1.tbl2</code>:
            </p><div class="itemizedlist"><ul type="circle"><li><p>
                  The query cache is “<span class="quote">fooled</span>” (it has no
                  way of knowing that <code class="literal">tbl1</code> has not
                  been updated, so it returns outdated results).
                </p></li><li><p>
                  <code class="literal">ALTER</code> statements on
                  <code class="literal">tbl2</code> fail.
                </p></li></ul></div></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="windows-symbolic-links"></a>7.6.1.3. Using Symbolic Links for Databases on Windows</h4></div></div></div><a class="indexterm" name="id3202871"></a><a class="indexterm" name="id3202880"></a><a class="indexterm" name="id3202890"></a><p>
          Symbolic links are enabled by default for all Windows servers.
          This enables you to put a database directory on a different
          disk by setting up a symbolic link to it. This is similar to
          the way that database symbolic links work on Unix, although
          the procedure for setting up the link is different. If you do
          not need symbolic links, you can disable them using the
          <a href="server-administration.html#option_mysqld_symbolic-links"><code class="option">--skip-symbolic-links</code></a>
          option.
        </p><p>
          On Windows, create a symbolic link to a MySQL database by
          creating a file in the data directory that contains the path
          to the destination directory. The file should be named
          <code class="filename"><em class="replaceable"><code>db_name</code></em>.sym</code>,
          where <em class="replaceable"><code>db_name</code></em> is the database name.
        </p><p>
          Suppose that the MySQL data directory is
          <code class="filename">C:\mysql\data</code> and you want to have
          database <code class="literal">foo</code> located at
          <code class="filename">D:\data\foo</code>. Set up a symlink using this
          procedure
        </p><div class="orderedlist"><ol type="1"><li><p>
              Make sure that the <code class="filename">D:\data\foo</code>
              directory exists by creating it if necessary. If you
              already have a database directory named
              <code class="filename">foo</code> in the data directory, you should
              move it to <code class="filename">D:\data</code>. Otherwise, the
              symbolic link will be ineffective. To avoid problems, make
              sure that the server is not running when you move the
              database directory.
            </p></li><li><p>
              Create a text file
              <code class="filename">C:\mysql\data\foo.sym</code> that contains
              the path name <code class="literal">D:\data\foo\</code>.
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
                The path name to the new database and tables should be
                absolute. If you specify a relative path, the location
                will be relative to the <code class="filename">foo.sym</code>
                file.
              </p></div></li></ol></div><p>
          After this, all tables created in the database
          <code class="literal">foo</code> are created in
          <code class="filename">D:\data\foo</code>.
        </p><p>
          The following limitations apply to the use of
          <code class="filename">.sym</code> files for database symbolic linking
          on Windows:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              The symbolic link is not used if a directory with the same
              name as the database exists in the MySQL data directory.
            </p></li><li><p>
              The <a href="storage-engines.html#sysvar_innodb_file_per_table"><code class="option">--innodb_file_per_table</code></a>
              option cannot be used.
            </p></li><li><p>
              If you run <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> as a service, you
              cannot use a mapped drive to a remote server as the
              destination of the symbolic link. As a workaround, you can
              use the full path
              (<code class="filename">\\servername\path\</code>).
            </p></li></ul></div></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="backup-and-recovery.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="language-structure.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 6. Backup and Recovery </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 8. Language Structure</td></tr></table></div></body></html>
